
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../example_notebook/">
      
      
        <link rel="next" href="../bibliography/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>API reference - WindScanGEO</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#api-reference" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="WindScanGEO" class="md-header__button md-logo" aria-label="WindScanGEO" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            WindScanGEO
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              API reference
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label=""  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="WindScanGEO" class="md-nav__button md-logo" aria-label="WindScanGEO" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    WindScanGEO
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    WindScanGEO
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../introduction/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introduction
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../validation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Validation and biases
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Install
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../example_notebook/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tutorial WindScanGEO
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    API reference
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    API reference
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func" class="md-nav__link">
    <span class="md-ellipsis">
      main_func
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.Block" class="md-nav__link">
    <span class="md-ellipsis">
      Block
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.Bottleneck" class="md-nav__link">
    <span class="md-ellipsis">
      Bottleneck
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.ConventionalCNN" class="md-nav__link">
    <span class="md-ellipsis">
      ConventionalCNN
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.H5pyDataset" class="md-nav__link">
    <span class="md-ellipsis">
      H5pyDataset
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.Img2Seq" class="md-nav__link">
    <span class="md-ellipsis">
      Img2Seq
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.Normalize" class="md-nav__link">
    <span class="md-ellipsis">
      Normalize
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.ResNet" class="md-nav__link">
    <span class="md-ellipsis">
      ResNet
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.ViT" class="md-nav__link">
    <span class="md-ellipsis">
      ViT
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.conventional_dataset" class="md-nav__link">
    <span class="md-ellipsis">
      conventional_dataset
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.conventional_dataset_inference" class="md-nav__link">
    <span class="md-ellipsis">
      conventional_dataset_inference
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.buoy_data_extract" class="md-nav__link">
    <span class="md-ellipsis">
      buoy_data_extract
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.calculate_degrees" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_degrees
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.create_folder" class="md-nav__link">
    <span class="md-ellipsis">
      create_folder
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.early_stopping" class="md-nav__link">
    <span class="md-ellipsis">
      early_stopping
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.error_plot" class="md-nav__link">
    <span class="md-ellipsis">
      error_plot
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.extract_goes" class="md-nav__link">
    <span class="md-ellipsis">
      extract_goes
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.extract_goes_inference" class="md-nav__link">
    <span class="md-ellipsis">
      extract_goes_inference
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.extract_goes_production" class="md-nav__link">
    <span class="md-ellipsis">
      extract_goes_production
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.extract_matching_orbits" class="md-nav__link">
    <span class="md-ellipsis">
      extract_matching_orbits
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.extract_scatter" class="md-nav__link">
    <span class="md-ellipsis">
      extract_scatter
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.extract_scatter_multisat" class="md-nav__link">
    <span class="md-ellipsis">
      extract_scatter_multisat
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.fill_nans" class="md-nav__link">
    <span class="md-ellipsis">
      fill_nans
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.filter_invalid" class="md-nav__link">
    <span class="md-ellipsis">
      filter_invalid
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.filter_nighttime" class="md-nav__link">
    <span class="md-ellipsis">
      filter_nighttime
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.form_arrays_buoy" class="md-nav__link">
    <span class="md-ellipsis">
      form_arrays_buoy
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.get_goes_url" class="md-nav__link">
    <span class="md-ellipsis">
      get_goes_url
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.get_image" class="md-nav__link">
    <span class="md-ellipsis">
      get_image
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.get_indices" class="md-nav__link">
    <span class="md-ellipsis">
      get_indices
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.get_mlp" class="md-nav__link">
    <span class="md-ellipsis">
      get_mlp
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.goes_index" class="md-nav__link">
    <span class="md-ellipsis">
      goes_index
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.index_parallel" class="md-nav__link">
    <span class="md-ellipsis">
      index_parallel
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.inference_full_goes_image" class="md-nav__link">
    <span class="md-ellipsis">
      inference_full_goes_image
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.inference_model" class="md-nav__link">
    <span class="md-ellipsis">
      inference_model
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.inference_run" class="md-nav__link">
    <span class="md-ellipsis">
      inference_run
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.manage_saved_models" class="md-nav__link">
    <span class="md-ellipsis">
      manage_saved_models
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.package_data" class="md-nav__link">
    <span class="md-ellipsis">
      package_data
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.patchify" class="md-nav__link">
    <span class="md-ellipsis">
      patchify
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.plot_cloud_cover" class="md-nav__link">
    <span class="md-ellipsis">
      plot_cloud_cover
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.plot_cloud_mask" class="md-nav__link">
    <span class="md-ellipsis">
      plot_cloud_mask
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.plot_goes_image" class="md-nav__link">
    <span class="md-ellipsis">
      plot_goes_image
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.plot_save_loss" class="md-nav__link">
    <span class="md-ellipsis">
      plot_save_loss
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.plot_wind_speeds" class="md-nav__link">
    <span class="md-ellipsis">
      plot_wind_speeds
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.rmse_per_range" class="md-nav__link">
    <span class="md-ellipsis">
      rmse_per_range
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.save_overpass_time" class="md-nav__link">
    <span class="md-ellipsis">
      save_overpass_time
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.savedataseperated" class="md-nav__link">
    <span class="md-ellipsis">
      savedataseperated
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.snap_to_nearest" class="md-nav__link">
    <span class="md-ellipsis">
      snap_to_nearest
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.sort_by_time" class="md-nav__link">
    <span class="md-ellipsis">
      sort_by_time
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.test_model" class="md-nav__link">
    <span class="md-ellipsis">
      test_model
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.train_model" class="md-nav__link">
    <span class="md-ellipsis">
      train_model
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.train_test_model" class="md-nav__link">
    <span class="md-ellipsis">
      train_test_model
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.vectorized_solar_angles" class="md-nav__link">
    <span class="md-ellipsis">
      vectorized_solar_angles
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func" class="md-nav__link">
    <span class="md-ellipsis">
      func
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func.calculate_degrees" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_degrees
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func.create_folder" class="md-nav__link">
    <span class="md-ellipsis">
      create_folder
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func.extract_goes" class="md-nav__link">
    <span class="md-ellipsis">
      extract_goes
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func.extract_goes_inference" class="md-nav__link">
    <span class="md-ellipsis">
      extract_goes_inference
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func.extract_scatter" class="md-nav__link">
    <span class="md-ellipsis">
      extract_scatter
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func.fill_nans" class="md-nav__link">
    <span class="md-ellipsis">
      fill_nans
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func.filter_invalid" class="md-nav__link">
    <span class="md-ellipsis">
      filter_invalid
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func.filter_nighttime" class="md-nav__link">
    <span class="md-ellipsis">
      filter_nighttime
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func.get_goes_url" class="md-nav__link">
    <span class="md-ellipsis">
      get_goes_url
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func.get_image" class="md-nav__link">
    <span class="md-ellipsis">
      get_image
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func.get_indices" class="md-nav__link">
    <span class="md-ellipsis">
      get_indices
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func.goes_index" class="md-nav__link">
    <span class="md-ellipsis">
      goes_index
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func.index_parallel" class="md-nav__link">
    <span class="md-ellipsis">
      index_parallel
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func.package_data" class="md-nav__link">
    <span class="md-ellipsis">
      package_data
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func.save_overpass_time" class="md-nav__link">
    <span class="md-ellipsis">
      save_overpass_time
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func.savedataseperated" class="md-nav__link">
    <span class="md-ellipsis">
      savedataseperated
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func.sort_by_time" class="md-nav__link">
    <span class="md-ellipsis">
      sort_by_time
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func.vectorized_solar_angles" class="md-nav__link">
    <span class="md-ellipsis">
      vectorized_solar_angles
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_ml" class="md-nav__link">
    <span class="md-ellipsis">
      func_ml
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_ml.H5pyDataset" class="md-nav__link">
    <span class="md-ellipsis">
      H5pyDataset
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_ml.Normalize" class="md-nav__link">
    <span class="md-ellipsis">
      Normalize
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_ml.conventional_dataset" class="md-nav__link">
    <span class="md-ellipsis">
      conventional_dataset
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_ml.conventional_dataset_inference" class="md-nav__link">
    <span class="md-ellipsis">
      conventional_dataset_inference
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_ml.error_plot" class="md-nav__link">
    <span class="md-ellipsis">
      error_plot
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_ml.plot_cloud_cover" class="md-nav__link">
    <span class="md-ellipsis">
      plot_cloud_cover
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_ml.plot_cloud_mask" class="md-nav__link">
    <span class="md-ellipsis">
      plot_cloud_mask
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_ml.plot_goes_image" class="md-nav__link">
    <span class="md-ellipsis">
      plot_goes_image
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_ml.plot_save_loss" class="md-nav__link">
    <span class="md-ellipsis">
      plot_save_loss
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_ml.plot_wind_speeds" class="md-nav__link">
    <span class="md-ellipsis">
      plot_wind_speeds
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_ml.rmse_per_range" class="md-nav__link">
    <span class="md-ellipsis">
      rmse_per_range
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_ml.vectorized_solar_angles" class="md-nav__link">
    <span class="md-ellipsis">
      vectorized_solar_angles
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference" class="md-nav__link">
    <span class="md-ellipsis">
      func_inference
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.Block" class="md-nav__link">
    <span class="md-ellipsis">
      Block
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.Bottleneck" class="md-nav__link">
    <span class="md-ellipsis">
      Bottleneck
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.ConventionalCNN" class="md-nav__link">
    <span class="md-ellipsis">
      ConventionalCNN
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.H5pyDataset" class="md-nav__link">
    <span class="md-ellipsis">
      H5pyDataset
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.Img2Seq" class="md-nav__link">
    <span class="md-ellipsis">
      Img2Seq
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.Normalize" class="md-nav__link">
    <span class="md-ellipsis">
      Normalize
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.ResNet" class="md-nav__link">
    <span class="md-ellipsis">
      ResNet
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.ViT" class="md-nav__link">
    <span class="md-ellipsis">
      ViT
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.conventional_dataset" class="md-nav__link">
    <span class="md-ellipsis">
      conventional_dataset
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.conventional_dataset_inference" class="md-nav__link">
    <span class="md-ellipsis">
      conventional_dataset_inference
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.buoy_data_extract" class="md-nav__link">
    <span class="md-ellipsis">
      buoy_data_extract
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.calculate_degrees" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_degrees
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.create_folder" class="md-nav__link">
    <span class="md-ellipsis">
      create_folder
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.early_stopping" class="md-nav__link">
    <span class="md-ellipsis">
      early_stopping
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.error_plot" class="md-nav__link">
    <span class="md-ellipsis">
      error_plot
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.extract_goes" class="md-nav__link">
    <span class="md-ellipsis">
      extract_goes
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.extract_goes_inference" class="md-nav__link">
    <span class="md-ellipsis">
      extract_goes_inference
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.extract_goes_production" class="md-nav__link">
    <span class="md-ellipsis">
      extract_goes_production
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.extract_scatter" class="md-nav__link">
    <span class="md-ellipsis">
      extract_scatter
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.extract_scatter_multisat" class="md-nav__link">
    <span class="md-ellipsis">
      extract_scatter_multisat
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.fill_nans" class="md-nav__link">
    <span class="md-ellipsis">
      fill_nans
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.filter_invalid" class="md-nav__link">
    <span class="md-ellipsis">
      filter_invalid
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.filter_nighttime" class="md-nav__link">
    <span class="md-ellipsis">
      filter_nighttime
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.form_arrays_buoy" class="md-nav__link">
    <span class="md-ellipsis">
      form_arrays_buoy
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.get_goes_url" class="md-nav__link">
    <span class="md-ellipsis">
      get_goes_url
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.get_image" class="md-nav__link">
    <span class="md-ellipsis">
      get_image
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.get_indices" class="md-nav__link">
    <span class="md-ellipsis">
      get_indices
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.get_mlp" class="md-nav__link">
    <span class="md-ellipsis">
      get_mlp
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.goes_index" class="md-nav__link">
    <span class="md-ellipsis">
      goes_index
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.index_parallel" class="md-nav__link">
    <span class="md-ellipsis">
      index_parallel
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.inference_model" class="md-nav__link">
    <span class="md-ellipsis">
      inference_model
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.inference_run" class="md-nav__link">
    <span class="md-ellipsis">
      inference_run
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.manage_saved_models" class="md-nav__link">
    <span class="md-ellipsis">
      manage_saved_models
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.package_data" class="md-nav__link">
    <span class="md-ellipsis">
      package_data
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.patchify" class="md-nav__link">
    <span class="md-ellipsis">
      patchify
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.plot_cloud_cover" class="md-nav__link">
    <span class="md-ellipsis">
      plot_cloud_cover
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.plot_cloud_mask" class="md-nav__link">
    <span class="md-ellipsis">
      plot_cloud_mask
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.plot_goes_image" class="md-nav__link">
    <span class="md-ellipsis">
      plot_goes_image
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.plot_save_loss" class="md-nav__link">
    <span class="md-ellipsis">
      plot_save_loss
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.plot_wind_speeds" class="md-nav__link">
    <span class="md-ellipsis">
      plot_wind_speeds
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.rmse_per_range" class="md-nav__link">
    <span class="md-ellipsis">
      rmse_per_range
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.save_overpass_time" class="md-nav__link">
    <span class="md-ellipsis">
      save_overpass_time
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.savedataseperated" class="md-nav__link">
    <span class="md-ellipsis">
      savedataseperated
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.snap_to_nearest" class="md-nav__link">
    <span class="md-ellipsis">
      snap_to_nearest
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.sort_by_time" class="md-nav__link">
    <span class="md-ellipsis">
      sort_by_time
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.test_model" class="md-nav__link">
    <span class="md-ellipsis">
      test_model
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.train_model" class="md-nav__link">
    <span class="md-ellipsis">
      train_model
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.vectorized_solar_angles" class="md-nav__link">
    <span class="md-ellipsis">
      vectorized_solar_angles
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.impl" class="md-nav__link">
    <span class="md-ellipsis">
      impl
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.impl.early_stopping" class="md-nav__link">
    <span class="md-ellipsis">
      early_stopping
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.impl.inference_model" class="md-nav__link">
    <span class="md-ellipsis">
      inference_model
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.impl.manage_saved_models" class="md-nav__link">
    <span class="md-ellipsis">
      manage_saved_models
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.impl.test_model" class="md-nav__link">
    <span class="md-ellipsis">
      test_model
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.impl.train_model" class="md-nav__link">
    <span class="md-ellipsis">
      train_model
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../bibliography/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Bibliography
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func" class="md-nav__link">
    <span class="md-ellipsis">
      main_func
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.Block" class="md-nav__link">
    <span class="md-ellipsis">
      Block
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.Bottleneck" class="md-nav__link">
    <span class="md-ellipsis">
      Bottleneck
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.ConventionalCNN" class="md-nav__link">
    <span class="md-ellipsis">
      ConventionalCNN
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.H5pyDataset" class="md-nav__link">
    <span class="md-ellipsis">
      H5pyDataset
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.Img2Seq" class="md-nav__link">
    <span class="md-ellipsis">
      Img2Seq
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.Normalize" class="md-nav__link">
    <span class="md-ellipsis">
      Normalize
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.ResNet" class="md-nav__link">
    <span class="md-ellipsis">
      ResNet
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.ViT" class="md-nav__link">
    <span class="md-ellipsis">
      ViT
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.conventional_dataset" class="md-nav__link">
    <span class="md-ellipsis">
      conventional_dataset
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.conventional_dataset_inference" class="md-nav__link">
    <span class="md-ellipsis">
      conventional_dataset_inference
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.buoy_data_extract" class="md-nav__link">
    <span class="md-ellipsis">
      buoy_data_extract
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.calculate_degrees" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_degrees
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.create_folder" class="md-nav__link">
    <span class="md-ellipsis">
      create_folder
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.early_stopping" class="md-nav__link">
    <span class="md-ellipsis">
      early_stopping
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.error_plot" class="md-nav__link">
    <span class="md-ellipsis">
      error_plot
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.extract_goes" class="md-nav__link">
    <span class="md-ellipsis">
      extract_goes
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.extract_goes_inference" class="md-nav__link">
    <span class="md-ellipsis">
      extract_goes_inference
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.extract_goes_production" class="md-nav__link">
    <span class="md-ellipsis">
      extract_goes_production
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.extract_matching_orbits" class="md-nav__link">
    <span class="md-ellipsis">
      extract_matching_orbits
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.extract_scatter" class="md-nav__link">
    <span class="md-ellipsis">
      extract_scatter
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.extract_scatter_multisat" class="md-nav__link">
    <span class="md-ellipsis">
      extract_scatter_multisat
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.fill_nans" class="md-nav__link">
    <span class="md-ellipsis">
      fill_nans
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.filter_invalid" class="md-nav__link">
    <span class="md-ellipsis">
      filter_invalid
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.filter_nighttime" class="md-nav__link">
    <span class="md-ellipsis">
      filter_nighttime
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.form_arrays_buoy" class="md-nav__link">
    <span class="md-ellipsis">
      form_arrays_buoy
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.get_goes_url" class="md-nav__link">
    <span class="md-ellipsis">
      get_goes_url
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.get_image" class="md-nav__link">
    <span class="md-ellipsis">
      get_image
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.get_indices" class="md-nav__link">
    <span class="md-ellipsis">
      get_indices
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.get_mlp" class="md-nav__link">
    <span class="md-ellipsis">
      get_mlp
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.goes_index" class="md-nav__link">
    <span class="md-ellipsis">
      goes_index
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.index_parallel" class="md-nav__link">
    <span class="md-ellipsis">
      index_parallel
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.inference_full_goes_image" class="md-nav__link">
    <span class="md-ellipsis">
      inference_full_goes_image
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.inference_model" class="md-nav__link">
    <span class="md-ellipsis">
      inference_model
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.inference_run" class="md-nav__link">
    <span class="md-ellipsis">
      inference_run
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.manage_saved_models" class="md-nav__link">
    <span class="md-ellipsis">
      manage_saved_models
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.package_data" class="md-nav__link">
    <span class="md-ellipsis">
      package_data
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.patchify" class="md-nav__link">
    <span class="md-ellipsis">
      patchify
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.plot_cloud_cover" class="md-nav__link">
    <span class="md-ellipsis">
      plot_cloud_cover
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.plot_cloud_mask" class="md-nav__link">
    <span class="md-ellipsis">
      plot_cloud_mask
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.plot_goes_image" class="md-nav__link">
    <span class="md-ellipsis">
      plot_goes_image
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.plot_save_loss" class="md-nav__link">
    <span class="md-ellipsis">
      plot_save_loss
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.plot_wind_speeds" class="md-nav__link">
    <span class="md-ellipsis">
      plot_wind_speeds
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.rmse_per_range" class="md-nav__link">
    <span class="md-ellipsis">
      rmse_per_range
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.save_overpass_time" class="md-nav__link">
    <span class="md-ellipsis">
      save_overpass_time
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.savedataseperated" class="md-nav__link">
    <span class="md-ellipsis">
      savedataseperated
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.snap_to_nearest" class="md-nav__link">
    <span class="md-ellipsis">
      snap_to_nearest
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.sort_by_time" class="md-nav__link">
    <span class="md-ellipsis">
      sort_by_time
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.test_model" class="md-nav__link">
    <span class="md-ellipsis">
      test_model
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.train_model" class="md-nav__link">
    <span class="md-ellipsis">
      train_model
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.train_test_model" class="md-nav__link">
    <span class="md-ellipsis">
      train_test_model
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.main_func.vectorized_solar_angles" class="md-nav__link">
    <span class="md-ellipsis">
      vectorized_solar_angles
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func" class="md-nav__link">
    <span class="md-ellipsis">
      func
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func.calculate_degrees" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_degrees
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func.create_folder" class="md-nav__link">
    <span class="md-ellipsis">
      create_folder
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func.extract_goes" class="md-nav__link">
    <span class="md-ellipsis">
      extract_goes
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func.extract_goes_inference" class="md-nav__link">
    <span class="md-ellipsis">
      extract_goes_inference
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func.extract_scatter" class="md-nav__link">
    <span class="md-ellipsis">
      extract_scatter
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func.fill_nans" class="md-nav__link">
    <span class="md-ellipsis">
      fill_nans
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func.filter_invalid" class="md-nav__link">
    <span class="md-ellipsis">
      filter_invalid
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func.filter_nighttime" class="md-nav__link">
    <span class="md-ellipsis">
      filter_nighttime
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func.get_goes_url" class="md-nav__link">
    <span class="md-ellipsis">
      get_goes_url
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func.get_image" class="md-nav__link">
    <span class="md-ellipsis">
      get_image
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func.get_indices" class="md-nav__link">
    <span class="md-ellipsis">
      get_indices
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func.goes_index" class="md-nav__link">
    <span class="md-ellipsis">
      goes_index
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func.index_parallel" class="md-nav__link">
    <span class="md-ellipsis">
      index_parallel
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func.package_data" class="md-nav__link">
    <span class="md-ellipsis">
      package_data
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func.save_overpass_time" class="md-nav__link">
    <span class="md-ellipsis">
      save_overpass_time
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func.savedataseperated" class="md-nav__link">
    <span class="md-ellipsis">
      savedataseperated
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func.sort_by_time" class="md-nav__link">
    <span class="md-ellipsis">
      sort_by_time
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func.vectorized_solar_angles" class="md-nav__link">
    <span class="md-ellipsis">
      vectorized_solar_angles
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_ml" class="md-nav__link">
    <span class="md-ellipsis">
      func_ml
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_ml.H5pyDataset" class="md-nav__link">
    <span class="md-ellipsis">
      H5pyDataset
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_ml.Normalize" class="md-nav__link">
    <span class="md-ellipsis">
      Normalize
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_ml.conventional_dataset" class="md-nav__link">
    <span class="md-ellipsis">
      conventional_dataset
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_ml.conventional_dataset_inference" class="md-nav__link">
    <span class="md-ellipsis">
      conventional_dataset_inference
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_ml.error_plot" class="md-nav__link">
    <span class="md-ellipsis">
      error_plot
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_ml.plot_cloud_cover" class="md-nav__link">
    <span class="md-ellipsis">
      plot_cloud_cover
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_ml.plot_cloud_mask" class="md-nav__link">
    <span class="md-ellipsis">
      plot_cloud_mask
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_ml.plot_goes_image" class="md-nav__link">
    <span class="md-ellipsis">
      plot_goes_image
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_ml.plot_save_loss" class="md-nav__link">
    <span class="md-ellipsis">
      plot_save_loss
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_ml.plot_wind_speeds" class="md-nav__link">
    <span class="md-ellipsis">
      plot_wind_speeds
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_ml.rmse_per_range" class="md-nav__link">
    <span class="md-ellipsis">
      rmse_per_range
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_ml.vectorized_solar_angles" class="md-nav__link">
    <span class="md-ellipsis">
      vectorized_solar_angles
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference" class="md-nav__link">
    <span class="md-ellipsis">
      func_inference
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.Block" class="md-nav__link">
    <span class="md-ellipsis">
      Block
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.Bottleneck" class="md-nav__link">
    <span class="md-ellipsis">
      Bottleneck
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.ConventionalCNN" class="md-nav__link">
    <span class="md-ellipsis">
      ConventionalCNN
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.H5pyDataset" class="md-nav__link">
    <span class="md-ellipsis">
      H5pyDataset
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.Img2Seq" class="md-nav__link">
    <span class="md-ellipsis">
      Img2Seq
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.Normalize" class="md-nav__link">
    <span class="md-ellipsis">
      Normalize
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.ResNet" class="md-nav__link">
    <span class="md-ellipsis">
      ResNet
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.ViT" class="md-nav__link">
    <span class="md-ellipsis">
      ViT
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.conventional_dataset" class="md-nav__link">
    <span class="md-ellipsis">
      conventional_dataset
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.conventional_dataset_inference" class="md-nav__link">
    <span class="md-ellipsis">
      conventional_dataset_inference
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.buoy_data_extract" class="md-nav__link">
    <span class="md-ellipsis">
      buoy_data_extract
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.calculate_degrees" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_degrees
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.create_folder" class="md-nav__link">
    <span class="md-ellipsis">
      create_folder
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.early_stopping" class="md-nav__link">
    <span class="md-ellipsis">
      early_stopping
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.error_plot" class="md-nav__link">
    <span class="md-ellipsis">
      error_plot
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.extract_goes" class="md-nav__link">
    <span class="md-ellipsis">
      extract_goes
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.extract_goes_inference" class="md-nav__link">
    <span class="md-ellipsis">
      extract_goes_inference
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.extract_goes_production" class="md-nav__link">
    <span class="md-ellipsis">
      extract_goes_production
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.extract_scatter" class="md-nav__link">
    <span class="md-ellipsis">
      extract_scatter
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.extract_scatter_multisat" class="md-nav__link">
    <span class="md-ellipsis">
      extract_scatter_multisat
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.fill_nans" class="md-nav__link">
    <span class="md-ellipsis">
      fill_nans
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.filter_invalid" class="md-nav__link">
    <span class="md-ellipsis">
      filter_invalid
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.filter_nighttime" class="md-nav__link">
    <span class="md-ellipsis">
      filter_nighttime
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.form_arrays_buoy" class="md-nav__link">
    <span class="md-ellipsis">
      form_arrays_buoy
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.get_goes_url" class="md-nav__link">
    <span class="md-ellipsis">
      get_goes_url
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.get_image" class="md-nav__link">
    <span class="md-ellipsis">
      get_image
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.get_indices" class="md-nav__link">
    <span class="md-ellipsis">
      get_indices
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.get_mlp" class="md-nav__link">
    <span class="md-ellipsis">
      get_mlp
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.goes_index" class="md-nav__link">
    <span class="md-ellipsis">
      goes_index
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.index_parallel" class="md-nav__link">
    <span class="md-ellipsis">
      index_parallel
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.inference_model" class="md-nav__link">
    <span class="md-ellipsis">
      inference_model
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.inference_run" class="md-nav__link">
    <span class="md-ellipsis">
      inference_run
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.manage_saved_models" class="md-nav__link">
    <span class="md-ellipsis">
      manage_saved_models
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.package_data" class="md-nav__link">
    <span class="md-ellipsis">
      package_data
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.patchify" class="md-nav__link">
    <span class="md-ellipsis">
      patchify
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.plot_cloud_cover" class="md-nav__link">
    <span class="md-ellipsis">
      plot_cloud_cover
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.plot_cloud_mask" class="md-nav__link">
    <span class="md-ellipsis">
      plot_cloud_mask
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.plot_goes_image" class="md-nav__link">
    <span class="md-ellipsis">
      plot_goes_image
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.plot_save_loss" class="md-nav__link">
    <span class="md-ellipsis">
      plot_save_loss
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.plot_wind_speeds" class="md-nav__link">
    <span class="md-ellipsis">
      plot_wind_speeds
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.rmse_per_range" class="md-nav__link">
    <span class="md-ellipsis">
      rmse_per_range
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.save_overpass_time" class="md-nav__link">
    <span class="md-ellipsis">
      save_overpass_time
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.savedataseperated" class="md-nav__link">
    <span class="md-ellipsis">
      savedataseperated
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.snap_to_nearest" class="md-nav__link">
    <span class="md-ellipsis">
      snap_to_nearest
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.sort_by_time" class="md-nav__link">
    <span class="md-ellipsis">
      sort_by_time
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.test_model" class="md-nav__link">
    <span class="md-ellipsis">
      test_model
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.train_model" class="md-nav__link">
    <span class="md-ellipsis">
      train_model
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.func_inference.vectorized_solar_angles" class="md-nav__link">
    <span class="md-ellipsis">
      vectorized_solar_angles
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.impl" class="md-nav__link">
    <span class="md-ellipsis">
      impl
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.impl.early_stopping" class="md-nav__link">
    <span class="md-ellipsis">
      early_stopping
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.impl.inference_model" class="md-nav__link">
    <span class="md-ellipsis">
      inference_model
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.impl.manage_saved_models" class="md-nav__link">
    <span class="md-ellipsis">
      manage_saved_models
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.impl.test_model" class="md-nav__link">
    <span class="md-ellipsis">
      test_model
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windscangeo.impl.train_model" class="md-nav__link">
    <span class="md-ellipsis">
      train_model
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                



                  



<h1 id="api-reference">API reference</h1>


<div class="doc doc-object doc-module">



<a id="windscangeo.main_func"></a>
    <div class="doc doc-contents first">









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="windscangeo.main_func.Block" class="doc doc-heading">
            <code>Block</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="torch.nn.Module">Module</span></code></p>


        <p>A basic block for ResNet architecture.
This block consists of two convolutional layers with batch normalization
and ReLU activation. The first layer applies a 3x3 convolution, and the
second layer applies another 3x3 convolution. The block also supports
downsampling through an optional identity downsample layer. The expansion
factor is set to 1, meaning the output channels are the same as the input
channels.</p>
<p>taken from https://github.com/JayPatwardhan/ResNet-PyTorch/blob/master/ResNet/ResNet.py</p>







              <details class="quote">
                <summary>Source code in <code>windscangeo\Models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Block</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A basic block for ResNet architecture.</span>
<span class="sd">    This block consists of two convolutional layers with batch normalization</span>
<span class="sd">    and ReLU activation. The first layer applies a 3x3 convolution, and the</span>
<span class="sd">    second layer applies another 3x3 convolution. The block also supports</span>
<span class="sd">    downsampling through an optional identity downsample layer. The expansion</span>
<span class="sd">    factor is set to 1, meaning the output channels are the same as the input</span>
<span class="sd">    channels.</span>

<span class="sd">    taken from https://github.com/JayPatwardhan/ResNet-PyTorch/blob/master/ResNet/ResNet.py</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">expansion</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">in_channels</span><span class="p">,</span> <span class="n">out_channels</span><span class="p">,</span> <span class="n">i_downsample</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Block</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">conv1</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span><span class="n">in_channels</span><span class="p">,</span> <span class="n">out_channels</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="n">stride</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">batch_norm1</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">BatchNorm2d</span><span class="p">(</span><span class="n">out_channels</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conv2</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span><span class="n">out_channels</span><span class="p">,</span> <span class="n">out_channels</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="n">stride</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">batch_norm2</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">BatchNorm2d</span><span class="p">(</span><span class="n">out_channels</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">i_downsample</span> <span class="o">=</span> <span class="n">i_downsample</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stride</span> <span class="o">=</span> <span class="n">stride</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">relu</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
      <span class="n">identity</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>

      <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">batch_norm2</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conv1</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>
      <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">batch_norm2</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conv2</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">i_downsample</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
          <span class="n">identity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">i_downsample</span><span class="p">(</span><span class="n">identity</span><span class="p">)</span>
      <span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
      <span class="nb">print</span><span class="p">(</span><span class="n">identity</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
      <span class="n">x</span> <span class="o">+=</span> <span class="n">identity</span>
      <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">x</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="windscangeo.main_func.Bottleneck" class="doc doc-heading">
            <code>Bottleneck</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="torch.nn.Module">Module</span></code></p>


        <p>taken from https://github.com/JayPatwardhan/ResNet-PyTorch/blob/master/ResNet/ResNet.py
A bottleneck block for ResNet architecture.
This block consists of three convolutional layers with batch normalization
and ReLU activation. The first layer reduces the number of channels,
the second layer applies a 3x3 convolution, and the third layer expands
the number of channels back to the original size. The block also supports
downsampling through an optional identity downsample layer.</p>







              <details class="quote">
                <summary>Source code in <code>windscangeo\Models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Bottleneck</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    taken from https://github.com/JayPatwardhan/ResNet-PyTorch/blob/master/ResNet/ResNet.py</span>
<span class="sd">    A bottleneck block for ResNet architecture.</span>
<span class="sd">    This block consists of three convolutional layers with batch normalization</span>
<span class="sd">    and ReLU activation. The first layer reduces the number of channels,</span>
<span class="sd">    the second layer applies a 3x3 convolution, and the third layer expands</span>
<span class="sd">    the number of channels back to the original size. The block also supports</span>
<span class="sd">    downsampling through an optional identity downsample layer.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">expansion</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">in_channels</span><span class="p">,</span> <span class="n">out_channels</span><span class="p">,</span> <span class="n">i_downsample</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Bottleneck</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">conv1</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span><span class="n">in_channels</span><span class="p">,</span> <span class="n">out_channels</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">batch_norm1</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">BatchNorm2d</span><span class="p">(</span><span class="n">out_channels</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">conv2</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span><span class="n">out_channels</span><span class="p">,</span> <span class="n">out_channels</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="n">stride</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">batch_norm2</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">BatchNorm2d</span><span class="p">(</span><span class="n">out_channels</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">conv3</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span><span class="n">out_channels</span><span class="p">,</span> <span class="n">out_channels</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">expansion</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">batch_norm3</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">BatchNorm2d</span><span class="p">(</span><span class="n">out_channels</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">expansion</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">i_downsample</span> <span class="o">=</span> <span class="n">i_downsample</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stride</span> <span class="o">=</span> <span class="n">stride</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">relu</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">identity</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">batch_norm1</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conv1</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>

        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">batch_norm2</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conv2</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>

        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conv3</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">batch_norm3</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

        <span class="c1">#downsample if needed</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">i_downsample</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">identity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">i_downsample</span><span class="p">(</span><span class="n">identity</span><span class="p">)</span>
        <span class="c1">#add identity</span>
        <span class="n">x</span><span class="o">+=</span><span class="n">identity</span>
        <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">x</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="windscangeo.main_func.ConventionalCNN" class="doc doc-heading">
            <code>ConventionalCNN</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="torch.nn.Module">Module</span></code></p>


        <p>A simple CNN for image regression tasks.
This model consists of a series of convolutional layers followed by
fully connected layers. It is designed to process images and output a
single regression value (e.g., wind speed).</p>







              <details class="quote">
                <summary>Source code in <code>windscangeo\Models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ConventionalCNN</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A simple CNN for image regression tasks.</span>
<span class="sd">    This model consists of a series of convolutional layers followed by</span>
<span class="sd">    fully connected layers. It is designed to process images and output a</span>
<span class="sd">    single regression value (e.g., wind speed).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">image_height</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">image_width</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">features_cnn</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
        <span class="n">kernel_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">in_channels</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">activation_cnn</span><span class="p">:</span> <span class="n">nn</span><span class="o">.</span><span class="n">Module</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(),</span>
        <span class="n">activation_final</span><span class="p">:</span> <span class="n">nn</span><span class="o">.</span><span class="n">Module</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Identity</span><span class="p">(),</span>
        <span class="n">stride</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">dropout_rate</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">activation_cnn</span> <span class="o">=</span> <span class="n">activation_cnn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">activation_final</span> <span class="o">=</span> <span class="n">activation_final</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dropout_rate</span> <span class="o">=</span> <span class="n">dropout_rate</span>

        <span class="c1"># ------- Convolutional backbone -------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">convs</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ModuleList</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">features_cnn</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">convs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span>
                        <span class="n">in_channels</span><span class="o">=</span><span class="n">in_channels</span><span class="p">,</span>
                        <span class="n">out_channels</span><span class="o">=</span><span class="n">feature</span><span class="p">,</span>
                        <span class="n">kernel_size</span><span class="o">=</span><span class="n">kernel_size</span><span class="p">,</span>
                        <span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                        <span class="n">stride</span><span class="o">=</span><span class="n">stride</span><span class="p">,</span>
                    <span class="p">),</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">activation_cnn</span><span class="p">,</span>
                    <span class="n">nn</span><span class="o">.</span><span class="n">MaxPool2d</span><span class="p">(</span><span class="n">kernel_size</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span>
                    <span class="n">nn</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dropout_rate</span><span class="p">),</span>
                <span class="p">]</span>
            <span class="p">)</span>
            <span class="n">in_channels</span> <span class="o">=</span> <span class="n">feature</span>

        <span class="c1"># ------- Classifier / regressor head -------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flattened_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_flattened_size</span><span class="p">(</span><span class="n">image_height</span><span class="p">,</span> <span class="n">image_width</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fc_cnn</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flattened_size</span><span class="p">,</span> <span class="mi">64</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dropout_cnn</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dropout_rate</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">head</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="mi">16</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">activation_cnn</span><span class="p">,</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dropout_rate</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">activation_final</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_flattened_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">w</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">convs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">in_channels</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">convs</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">layer</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">numel</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">image</span>
        <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">convs</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">layer</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>              <span class="c1"># flatten</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">activation_cnn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fc_cnn</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dropout_cnn</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="windscangeo.main_func.H5pyDataset" class="doc doc-heading">
            <code>H5pyDataset</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="torch.utils.data.Dataset">Dataset</span></code></p>


        <p>A PyTorch Dataset for loading data from an HDF5 file. This is useful when dealing with large datasets that do not fit into memory.
Need to work on Zarr integration for better performance</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>h5_file_path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the HDF5 file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>transform</code>
            </td>
            <td>
                  <code><span title="callable">callable</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A function/transform to apply to the images.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>windscangeo\func_ml.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">H5pyDataset</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Dataset</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A PyTorch Dataset for loading data from an HDF5 file. This is useful when dealing with large datasets that do not fit into memory.</span>
<span class="sd">    Need to work on Zarr integration for better performance</span>

<span class="sd">    Args:</span>
<span class="sd">        h5_file_path (str): Path to the HDF5 file.</span>
<span class="sd">        transform (callable, optional): A function/transform to apply to the images.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h5_file_path</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">h5_file_path</span> <span class="o">=</span> <span class="n">h5_file_path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transform</span> <span class="o">=</span> <span class="n">transform</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Will be initialized per worker</span>
        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h5_file_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="s1">&#39;targets&#39;</span><span class="p">])</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_ensure_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h5_file_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_file</span><span class="p">()</span>

        <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="p">[</span><span class="s1">&#39;images&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span>
        <span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="p">[</span><span class="s1">&#39;targets&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span>

        <span class="n">image</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="n">target</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">:</span>
            <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">image</span><span class="p">,</span> <span class="n">target</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="windscangeo.main_func.Img2Seq" class="doc doc-heading">
            <code>Img2Seq</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="torch.nn.Module">Module</span></code></p>


        <p>This layers takes a batch of images as input and
returns a batch of sequences</p>


<details class="shape" open>
  <summary>Shape</summary>
  <p>input: (b, h, w, c)
output: (b, s, d)</p>
</details>        <p>taken from https://www.kaggle.com/code/umongsain/vision-transformer-from-scratch-pytorch</p>







              <details class="quote">
                <summary>Source code in <code>windscangeo\Models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Img2Seq</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This layers takes a batch of images as input and</span>
<span class="sd">    returns a batch of sequences</span>

<span class="sd">    Shape:</span>
<span class="sd">        input: (b, h, w, c)</span>
<span class="sd">        output: (b, s, d)</span>

<span class="sd">    taken from https://www.kaggle.com/code/umongsain/vision-transformer-from-scratch-pytorch</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img_size</span><span class="p">,</span> <span class="n">patch_size</span><span class="p">,</span> <span class="n">n_channels</span><span class="p">,</span> <span class="n">d_model</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">patch_size</span> <span class="o">=</span> <span class="n">patch_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">img_size</span> <span class="o">=</span> <span class="n">img_size</span>

        <span class="n">nh</span><span class="p">,</span> <span class="n">nw</span> <span class="o">=</span> <span class="n">img_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="n">patch_size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">img_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">//</span> <span class="n">patch_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">n_tokens</span> <span class="o">=</span> <span class="n">nh</span> <span class="o">*</span> <span class="n">nw</span>

        <span class="n">token_dim</span> <span class="o">=</span> <span class="n">patch_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">patch_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_channels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">linear</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">token_dim</span><span class="p">,</span> <span class="n">d_model</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cls_token</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">d_model</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pos_emb</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">n_tokens</span><span class="p">,</span> <span class="n">d_model</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">):</span>
        <span class="n">batch</span> <span class="o">=</span> <span class="n">patchify</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">patch_size</span><span class="p">)</span>

        <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">nh</span><span class="p">,</span> <span class="n">nw</span><span class="p">,</span> <span class="n">ph</span><span class="p">,</span> <span class="n">pw</span> <span class="o">=</span> <span class="n">batch</span><span class="o">.</span><span class="n">shape</span>

        <span class="c1"># Flattening the patches</span>
        <span class="n">batch</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">batch</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="p">[</span><span class="n">b</span><span class="p">,</span> <span class="n">nh</span> <span class="o">*</span> <span class="n">nw</span><span class="p">,</span> <span class="n">ph</span> <span class="o">*</span> <span class="n">pw</span> <span class="o">*</span> <span class="n">c</span><span class="p">])</span>

        <span class="n">batch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">linear</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span>
        <span class="bp">cls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cls_token</span><span class="o">.</span><span class="n">expand</span><span class="p">([</span><span class="n">b</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">emb</span> <span class="o">=</span> <span class="n">batch</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos_emb</span>

        <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="bp">cls</span><span class="p">,</span> <span class="n">emb</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="windscangeo.main_func.Normalize" class="doc doc-heading">
            <code>Normalize</code>


</h2>


    <div class="doc doc-contents ">


        <p>Normalize the input tensor by subtracting the mean and dividing by the standard deviation. Done per batch </p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>mean</code>
            </td>
            <td>
                  <code><span title="list">list</span> or <span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mean values for normalization.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>std</code>
            </td>
            <td>
                  <code><span title="list">list</span> or <span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Standard deviation values for normalization.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>windscangeo\func_ml.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Normalize</span><span class="p">:</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Normalize the input tensor by subtracting the mean and dividing by the standard deviation. Done per batch </span>

<span class="sd">    Args:</span>
<span class="sd">        mean (list or np.ndarray): Mean values for normalization.</span>
<span class="sd">        std (list or np.ndarray): Standard deviation values for normalization.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">std</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mean</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">mean</span><span class="p">)</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">std</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">std</span><span class="p">)</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">std</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="windscangeo.main_func.ResNet" class="doc doc-heading">
            <code>ResNet</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="torch.nn.Module">Module</span></code></p>


        <p>A ResNet model for image classification or regression tasks.
This model consists of an initial convolutional layer, followed by a series
of residual blocks, and a fully connected layer for classification or regression.
The number of residual blocks in each layer is specified by the <code>layer_list</code> parameter.
taken from https://github.com/JayPatwardhan/ResNet-PyTorch/blob/master/ResNet/ResNet.py</p>







              <details class="quote">
                <summary>Source code in <code>windscangeo\Models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ResNet</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A ResNet model for image classification or regression tasks.</span>
<span class="sd">    This model consists of an initial convolutional layer, followed by a series</span>
<span class="sd">    of residual blocks, and a fully connected layer for classification or regression.</span>
<span class="sd">    The number of residual blocks in each layer is specified by the `layer_list` parameter.</span>
<span class="sd">    taken from https://github.com/JayPatwardhan/ResNet-PyTorch/blob/master/ResNet/ResNet.py</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ResBlock</span><span class="p">,</span> <span class="n">layer_list</span><span class="p">,</span> <span class="n">num_classes</span><span class="p">,</span> <span class="n">num_channels</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ResNet</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">in_channels</span> <span class="o">=</span> <span class="mi">64</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">conv1</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span><span class="n">num_channels</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">batch_norm1</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">BatchNorm2d</span><span class="p">(</span><span class="mi">64</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">relu</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_pool</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">MaxPool2d</span><span class="p">(</span><span class="n">kernel_size</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">layer1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_layer</span><span class="p">(</span><span class="n">ResBlock</span><span class="p">,</span> <span class="n">layer_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">planes</span><span class="o">=</span><span class="mi">64</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layer2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_layer</span><span class="p">(</span><span class="n">ResBlock</span><span class="p">,</span> <span class="n">layer_list</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">planes</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layer3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_layer</span><span class="p">(</span><span class="n">ResBlock</span><span class="p">,</span> <span class="n">layer_list</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">planes</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layer4</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_layer</span><span class="p">(</span><span class="n">ResBlock</span><span class="p">,</span> <span class="n">layer_list</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">planes</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">avgpool</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">AdaptiveAvgPool2d</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fc</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">512</span><span class="o">*</span><span class="n">ResBlock</span><span class="o">.</span><span class="n">expansion</span><span class="p">,</span> <span class="n">num_classes</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">batch_norm1</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conv1</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_pool</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">layer1</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">layer2</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">layer3</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">layer4</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">avgpool</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fc</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">x</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_make_layer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ResBlock</span><span class="p">,</span> <span class="n">blocks</span><span class="p">,</span> <span class="n">planes</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">ii_downsample</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">layers</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">stride</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_channels</span> <span class="o">!=</span> <span class="n">planes</span><span class="o">*</span><span class="n">ResBlock</span><span class="o">.</span><span class="n">expansion</span><span class="p">:</span>
            <span class="n">ii_downsample</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
                <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">in_channels</span><span class="p">,</span> <span class="n">planes</span><span class="o">*</span><span class="n">ResBlock</span><span class="o">.</span><span class="n">expansion</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="n">stride</span><span class="p">),</span>
                <span class="n">nn</span><span class="o">.</span><span class="n">BatchNorm2d</span><span class="p">(</span><span class="n">planes</span><span class="o">*</span><span class="n">ResBlock</span><span class="o">.</span><span class="n">expansion</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="n">layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ResBlock</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">in_channels</span><span class="p">,</span> <span class="n">planes</span><span class="p">,</span> <span class="n">i_downsample</span><span class="o">=</span><span class="n">ii_downsample</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="n">stride</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">in_channels</span> <span class="o">=</span> <span class="n">planes</span><span class="o">*</span><span class="n">ResBlock</span><span class="o">.</span><span class="n">expansion</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">blocks</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ResBlock</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">in_channels</span><span class="p">,</span> <span class="n">planes</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span><span class="o">*</span><span class="n">layers</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="windscangeo.main_func.ViT" class="doc doc-heading">
            <code>ViT</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="torch.nn.Module">Module</span></code></p>


        <p>Vision Transformer (ViT) model for image classification or regression tasks.
This model consists of an image-to-sequence layer, a transformer encoder,
and a multi-layer perceptron (MLP) head for classification or regression.</p>
<p>Taken from # https://www.kaggle.com/code/umongsain/vision-transformer-from-scratch-pytorch</p>







              <details class="quote">
                <summary>Source code in <code>windscangeo\Models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ViT</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Vision Transformer (ViT) model for image classification or regression tasks.</span>
<span class="sd">    This model consists of an image-to-sequence layer, a transformer encoder,</span>
<span class="sd">    and a multi-layer perceptron (MLP) head for classification or regression.</span>

<span class="sd">    Taken from # https://www.kaggle.com/code/umongsain/vision-transformer-from-scratch-pytorch</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">img_size</span><span class="p">,</span>
        <span class="n">patch_size</span><span class="p">,</span>
        <span class="n">n_channels</span><span class="p">,</span>
        <span class="n">d_model</span><span class="p">,</span>
        <span class="n">nhead</span><span class="p">,</span>
        <span class="n">dim_feedforward</span><span class="p">,</span>
        <span class="n">blocks</span><span class="p">,</span>
        <span class="n">mlp_head_units</span><span class="p">,</span>
        <span class="n">n_classes</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            img_size: Size of the image</span>
<span class="sd">            patch_size: Size of the patch</span>
<span class="sd">            n_channels: Number of image channels</span>
<span class="sd">            d_model: The number of features in the transformer encoder</span>
<span class="sd">            nhead: The number of heads in the multiheadattention models</span>
<span class="sd">            dim_feedforward: The dimension of the feedforward network model in the encoder</span>
<span class="sd">            blocks: The number of sub-encoder-layers in the encoder</span>
<span class="sd">            mlp_head_units: The hidden units of mlp_head</span>
<span class="sd">            n_classes: The number of output classes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">img2seq</span> <span class="o">=</span> <span class="n">Img2Seq</span><span class="p">(</span><span class="n">img_size</span><span class="p">,</span> <span class="n">patch_size</span><span class="p">,</span> <span class="n">n_channels</span><span class="p">,</span> <span class="n">d_model</span><span class="p">)</span>

        <span class="n">encoder_layer</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">TransformerEncoderLayer</span><span class="p">(</span>
            <span class="n">d_model</span><span class="p">,</span> <span class="n">nhead</span><span class="p">,</span> <span class="n">dim_feedforward</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s2">&quot;gelu&quot;</span><span class="p">,</span> <span class="n">batch_first</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transformer_encoder</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">TransformerEncoder</span><span class="p">(</span>
            <span class="n">encoder_layer</span><span class="p">,</span> <span class="n">blocks</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mlp</span> <span class="o">=</span> <span class="n">get_mlp</span><span class="p">(</span><span class="n">d_model</span><span class="p">,</span> <span class="n">mlp_head_units</span><span class="p">,</span> <span class="n">n_classes</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">output</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Identity</span><span class="p">()</span> <span class="c1"># For regression</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">):</span>

        <span class="n">batch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img2seq</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span>
        <span class="n">batch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformer_encoder</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span>
        <span class="n">batch</span> <span class="o">=</span> <span class="n">batch</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">batch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mlp</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">output</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="windscangeo.main_func.conventional_dataset" class="doc doc-heading">
            <code>conventional_dataset</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="torch.utils.data.Dataset">Dataset</span></code></p>


        <p>A PyTorch Dataset for loading data using regular numpy arrays.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>images</code>
            </td>
            <td>
                  <code><span title="list">list</span> or <span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List or array of images.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>targets</code>
            </td>
            <td>
                  <code><span title="list">list</span> or <span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List or array of targets corresponding to the images.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>transform</code>
            </td>
            <td>
                  <code><span title="callable">callable</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A function/transform to apply to the images.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>windscangeo\func_ml.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">conventional_dataset</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Dataset</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A PyTorch Dataset for loading data using regular numpy arrays.</span>

<span class="sd">    Args:</span>
<span class="sd">        images (list or np.ndarray): List or array of images.</span>
<span class="sd">        targets (list or np.ndarray): List or array of targets corresponding to the images.</span>
<span class="sd">        transform (callable, optional): A function/transform to apply to the images.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">images</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">images</span> <span class="o">=</span> <span class="n">images</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">targets</span> <span class="o">=</span> <span class="n">targets</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transform</span> <span class="o">=</span> <span class="n">transform</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
        <span class="c1"># 1) Image</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">:</span>
            <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

        <span class="c1"># 2) Target for sample &quot;idx&quot;</span>
        <span class="n">target</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">image</span><span class="p">,</span> <span class="n">target</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="windscangeo.main_func.conventional_dataset_inference" class="doc doc-heading">
            <code>conventional_dataset_inference</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="torch.utils.data.Dataset">Dataset</span></code></p>


        <p>A PyTorch Dataset for loading data for inference (no lable) using regular numpy arrays.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>images</code>
            </td>
            <td>
                  <code><span title="list">list</span> or <span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List or array of images to be used for inference.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>transform</code>
            </td>
            <td>
                  <code><span title="callable">callable</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A function/transform to apply to the images.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>windscangeo\func_ml.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">conventional_dataset_inference</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Dataset</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A PyTorch Dataset for loading data for inference (no lable) using regular numpy arrays.</span>

<span class="sd">    Args:</span>
<span class="sd">        images (list or np.ndarray): List or array of images to be used for inference.</span>
<span class="sd">        transform (callable, optional): A function/transform to apply to the images.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">images</span><span class="p">,</span><span class="n">transform</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">images</span> <span class="o">=</span> <span class="n">images</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transform</span> <span class="o">=</span> <span class="n">transform</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
        <span class="c1"># 1) Image</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">:</span>
            <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">image</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h2 id="windscangeo.main_func.buoy_data_extract" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">buoy_data_extract</span><span class="p">(</span><span class="n">folder_path</span><span class="p">,</span> <span class="n">polar_data</span><span class="p">,</span> <span class="n">date</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Extracts buoy data from a specified folder and returns arrays of latitude, longitude, time, wind speed, and buoy names.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>folder_path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the folder containing buoy data files.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>polar_data</code>
            </td>
            <td>
                  <code><span title="xarray.Dataset">Dataset</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Polar data containing latitude and longitude information. Used to snap buoy data to the nearest polar grid points.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>date</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Date for which to extract buoy data, in 'YYYY-MM-DD' format.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>buoy_lat</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of buoy latitudes snapped to the nearest polar grid points.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>buoy_lon</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of buoy longitudes snapped to the nearest polar grid points</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>buoy_time</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of buoy observation times.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>buoy_wind_speed</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of buoy wind speeds.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>buoy_name</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of buoy names.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\func_inference.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">buoy_data_extract</span><span class="p">(</span><span class="n">folder_path</span><span class="p">,</span> <span class="n">polar_data</span><span class="p">,</span> <span class="n">date</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Extracts buoy data from a specified folder and returns arrays of latitude, longitude, time, wind speed, and buoy names.</span>

<span class="sd">    Args:</span>
<span class="sd">        folder_path (str): Path to the folder containing buoy data files.</span>
<span class="sd">        polar_data (xarray.Dataset): Polar data containing latitude and longitude information. Used to snap buoy data to the nearest polar grid points.</span>
<span class="sd">        date (str): Date for which to extract buoy data, in &#39;YYYY-MM-DD&#39; format.</span>

<span class="sd">    Returns:</span>
<span class="sd">        buoy_lat (np.ndarray): Array of buoy latitudes snapped to the nearest polar grid points.</span>
<span class="sd">        buoy_lon (np.ndarray): Array of buoy longitudes snapped to the nearest polar grid points</span>
<span class="sd">        buoy_time (np.ndarray): Array of buoy observation times.</span>
<span class="sd">        buoy_wind_speed (np.ndarray): Array of buoy wind speeds.</span>
<span class="sd">        buoy_name (np.ndarray): Array of buoy names.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">buoy_lat</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">buoy_lon</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">buoy_wind_speed</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">buoy_time</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">buoy_name</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">folder_path</span><span class="p">):</span>
        <span class="k">if</span> <span class="s2">&quot;.cdf&quot;</span> <span class="ow">in</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder_path</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
            <span class="n">opened</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
            <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">wind_speed</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">form_arrays_buoy</span><span class="p">(</span><span class="n">opened</span><span class="p">,</span> <span class="n">date</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">wind_speed</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">buoy_lat</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span>
                <span class="n">buoy_lon</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">lon</span><span class="p">)</span>
                <span class="n">buoy_wind_speed</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">wind_speed</span><span class="p">)</span>
                <span class="n">buoy_time</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
                <span class="n">buoy_name</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="n">buoy_lat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">buoy_lat</span><span class="p">)</span>
    <span class="n">buoy_lat</span> <span class="o">=</span> <span class="n">snap_to_nearest</span><span class="p">(</span><span class="n">buoy_lat</span><span class="p">,</span> <span class="n">polar_data</span><span class="o">.</span><span class="n">latitude</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">cutoff</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
    <span class="n">buoy_lon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">buoy_lon</span><span class="p">)</span>
    <span class="n">buoy_wind_speed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">buoy_wind_speed</span><span class="p">)</span>
    <span class="n">buoy_time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">buoy_time</span><span class="p">)</span>

    <span class="n">buoy_lon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">buoy_lon</span> <span class="o">&gt;</span> <span class="mi">180</span><span class="p">,</span> <span class="n">buoy_lon</span> <span class="o">-</span> <span class="mi">360</span><span class="p">,</span> <span class="n">buoy_lon</span><span class="p">)</span>
    <span class="n">buoy_lon</span> <span class="o">=</span> <span class="n">snap_to_nearest</span><span class="p">(</span><span class="n">buoy_lon</span><span class="p">,</span> <span class="n">polar_data</span><span class="o">.</span><span class="n">longitude</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">cutoff</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">buoy_lat</span><span class="p">,</span> <span class="n">buoy_lon</span><span class="p">,</span> <span class="n">buoy_time</span><span class="p">,</span> <span class="n">buoy_wind_speed</span><span class="p">,</span> <span class="n">buoy_name</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.main_func.calculate_degrees" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_degrees</span><span class="p">(</span><span class="n">file_id</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>This function calculates the latitude and longitude of the GOES ABI fixed grid projection. 
This function comes from NOAA/NESDIS/STAR. (2025). Latitude and longitude remapping of GOES-R ABI imagery using Python . Atmospheric Composition Science Team. Retrieved from https://www.star.nesdis.noaa.gov/atmospheric-composition-training/python_abi_lat_lon.php</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>file_id</code>
            </td>
            <td>
                  <code><span title="xarray.Dataset">Dataset</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The xarray dataset containing the GOES ABI fixed grid projection variables.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>abi_lat</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The latitude of the GOES ABI fixed grid projection.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>abi_lon</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The longitude of the GOES ABI fixed grid projection.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\func.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate_degrees</span><span class="p">(</span><span class="n">file_id</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This function calculates the latitude and longitude of the GOES ABI fixed grid projection. </span>
<span class="sd">    This function comes from NOAA/NESDIS/STAR. (2025). Latitude and longitude remapping of GOES-R ABI imagery using Python . Atmospheric Composition Science Team. Retrieved from https://www.star.nesdis.noaa.gov/atmospheric-composition-training/python_abi_lat_lon.php</span>

<span class="sd">    Args:</span>
<span class="sd">        file_id (xarray.Dataset): The xarray dataset containing the GOES ABI fixed grid projection variables.</span>

<span class="sd">    Returns:</span>
<span class="sd">        abi_lat (numpy.ndarray): The latitude of the GOES ABI fixed grid projection.</span>
<span class="sd">        abi_lon (numpy.ndarray): The longitude of the GOES ABI fixed grid projection.</span>


<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Read in GOES ABI fixed grid projection variables and constants</span>
    <span class="n">x_coordinate_1d</span> <span class="o">=</span> <span class="n">file_id</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">][:]</span>  <span class="c1"># E/W scanning angle in radians</span>
    <span class="n">y_coordinate_1d</span> <span class="o">=</span> <span class="n">file_id</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">][:]</span>  <span class="c1"># N/S elevation angle in radians</span>
    <span class="n">projection_info</span> <span class="o">=</span> <span class="n">file_id</span><span class="o">.</span><span class="n">goes_imager_projection</span>
    <span class="n">lon_origin</span> <span class="o">=</span> <span class="n">projection_info</span><span class="o">.</span><span class="n">longitude_of_projection_origin</span>
    <span class="n">H</span> <span class="o">=</span> <span class="n">projection_info</span><span class="o">.</span><span class="n">perspective_point_height</span> <span class="o">+</span> <span class="n">projection_info</span><span class="o">.</span><span class="n">semi_major_axis</span>
    <span class="n">r_eq</span> <span class="o">=</span> <span class="n">projection_info</span><span class="o">.</span><span class="n">semi_major_axis</span>
    <span class="n">r_pol</span> <span class="o">=</span> <span class="n">projection_info</span><span class="o">.</span><span class="n">semi_minor_axis</span>

    <span class="c1"># Create 2D coordinate matrices from 1D coordinate vectors</span>
    <span class="n">x_coordinate_2d</span><span class="p">,</span> <span class="n">y_coordinate_2d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x_coordinate_1d</span><span class="p">,</span> <span class="n">y_coordinate_1d</span><span class="p">)</span>

    <span class="c1"># Equations to calculate latitude and longitude</span>
    <span class="n">lambda_0</span> <span class="o">=</span> <span class="p">(</span><span class="n">lon_origin</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">/</span> <span class="mf">180.0</span>
    <span class="n">a_var</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x_coordinate_2d</span><span class="p">),</span> <span class="mf">2.0</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">x_coordinate_2d</span><span class="p">),</span> <span class="mf">2.0</span><span class="p">)</span>
        <span class="o">*</span> <span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">y_coordinate_2d</span><span class="p">),</span> <span class="mf">2.0</span><span class="p">)</span>
            <span class="o">+</span> <span class="p">(</span>
                <span class="p">((</span><span class="n">r_eq</span> <span class="o">*</span> <span class="n">r_eq</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">r_pol</span> <span class="o">*</span> <span class="n">r_pol</span><span class="p">))</span>
                <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">y_coordinate_2d</span><span class="p">),</span> <span class="mf">2.0</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="n">b_var</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">H</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">x_coordinate_2d</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">y_coordinate_2d</span><span class="p">)</span>
    <span class="n">c_var</span> <span class="o">=</span> <span class="p">(</span><span class="n">H</span><span class="o">**</span><span class="mf">2.0</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">r_eq</span><span class="o">**</span><span class="mf">2.0</span><span class="p">)</span>
    <span class="n">r_s</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">1.0</span> <span class="o">*</span> <span class="n">b_var</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">b_var</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="mf">4.0</span> <span class="o">*</span> <span class="n">a_var</span> <span class="o">*</span> <span class="n">c_var</span><span class="p">)))</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">a_var</span><span class="p">)</span>
    <span class="n">s_x</span> <span class="o">=</span> <span class="n">r_s</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">x_coordinate_2d</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">y_coordinate_2d</span><span class="p">)</span>
    <span class="n">s_y</span> <span class="o">=</span> <span class="o">-</span><span class="n">r_s</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x_coordinate_2d</span><span class="p">)</span>
    <span class="n">s_z</span> <span class="o">=</span> <span class="n">r_s</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">x_coordinate_2d</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">y_coordinate_2d</span><span class="p">)</span>

    <span class="c1"># Ignore numpy errors for sqrt of negative number; occurs for GOES-16 ABI CONUS sector data</span>
    <span class="n">np</span><span class="o">.</span><span class="n">seterr</span><span class="p">(</span><span class="nb">all</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>

    <span class="n">abi_lat</span> <span class="o">=</span> <span class="p">(</span><span class="mf">180.0</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span>
            <span class="p">((</span><span class="n">r_eq</span> <span class="o">*</span> <span class="n">r_eq</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">r_pol</span> <span class="o">*</span> <span class="n">r_pol</span><span class="p">))</span>
            <span class="o">*</span> <span class="p">((</span><span class="n">s_z</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(((</span><span class="n">H</span> <span class="o">-</span> <span class="n">s_x</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">H</span> <span class="o">-</span> <span class="n">s_x</span><span class="p">))</span> <span class="o">+</span> <span class="p">(</span><span class="n">s_y</span> <span class="o">*</span> <span class="n">s_y</span><span class="p">))))</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="n">abi_lon</span> <span class="o">=</span> <span class="p">(</span><span class="n">lambda_0</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">s_y</span> <span class="o">/</span> <span class="p">(</span><span class="n">H</span> <span class="o">-</span> <span class="n">s_x</span><span class="p">)))</span> <span class="o">*</span> <span class="p">(</span><span class="mf">180.0</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;INFO : Latitude and longitude calculated&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">abi_lat</span><span class="p">,</span> <span class="n">abi_lon</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.main_func.create_folder" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_folder</span><span class="p">(</span><span class="n">experiment_name</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Create a folder for saving results based on the experiment name.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>experiment_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the experiment to create a folder for.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the created folder.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\func.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create_folder</span><span class="p">(</span><span class="n">experiment_name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a folder for saving results based on the experiment name.</span>

<span class="sd">    Args:</span>
<span class="sd">        experiment_name (str): Name of the experiment to create a folder for.</span>
<span class="sd">        If the folder already exists, it will not be created again.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Path to the created folder.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">path_folder</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;./results_folder/model_day_</span><span class="si">{</span><span class="n">experiment_name</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path_folder</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">path_folder</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Folder created at </span><span class="si">{</span><span class="n">path_folder</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">path_folder</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.main_func.early_stopping" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">early_stopping</span><span class="p">(</span><span class="n">valid_losses</span><span class="p">,</span> <span class="n">patience_epochs</span><span class="p">,</span> <span class="n">patience_loss</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Early stopping function to determine if training should stop based on validation losses. From @ Jing Sun</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>valid_losses</code>
            </td>
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of validation losses recorded during training.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>patience_epochs</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of epochs to wait before stopping if no improvement.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>patience_loss</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Minimum change in validation loss to consider as an improvement.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bool</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if training should stop, False otherwise.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\impl.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">early_stopping</span><span class="p">(</span><span class="n">valid_losses</span><span class="p">,</span> <span class="n">patience_epochs</span><span class="p">,</span> <span class="n">patience_loss</span><span class="p">):</span>  <span class="c1"># From @Jing</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Early stopping function to determine if training should stop based on validation losses. From @ Jing Sun</span>

<span class="sd">    Args:</span>
<span class="sd">        valid_losses (list): List of validation losses recorded during training.</span>
<span class="sd">        patience_epochs (int): Number of epochs to wait before stopping if no improvement.</span>
<span class="sd">        patience_loss (float): Minimum change in validation loss to consider as an improvement.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if training should stop, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">valid_losses</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">patience_epochs</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="n">recent_losses</span> <span class="o">=</span> <span class="n">valid_losses</span><span class="p">[</span><span class="o">-</span><span class="n">patience_epochs</span><span class="p">:]</span>

    <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="n">recent_losses</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">recent_losses</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">if</span> <span class="nb">max</span><span class="p">(</span><span class="n">recent_losses</span><span class="p">)</span> <span class="o">-</span> <span class="nb">min</span><span class="p">(</span><span class="n">recent_losses</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">patience_loss</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.main_func.error_plot" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">error_plot</span><span class="p">(</span><span class="n">best_val_outputs</span><span class="p">,</span> <span class="n">best_val_labels</span><span class="p">,</span> <span class="n">path_folder</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Plot a scatter plot of model outputs vs true labels for the validation dataset.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>best_val_outputs</code>
            </td>
            <td>
                  <code><span title="list">list</span> or <span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Model outputs for the validation dataset.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>best_val_labels</code>
            </td>
            <td>
                  <code><span title="list">list</span> or <span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True labels for the validation dataset.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>path_folder</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to save the plot. If None, the plot will not be saved.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\func_ml.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">error_plot</span><span class="p">(</span><span class="n">best_val_outputs</span><span class="p">,</span> <span class="n">best_val_labels</span><span class="p">,</span> <span class="n">path_folder</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot a scatter plot of model outputs vs true labels for the validation dataset.</span>

<span class="sd">    Args:</span>
<span class="sd">        best_val_outputs (list or np.ndarray): Model outputs for the validation dataset.</span>
<span class="sd">        best_val_labels (list or np.ndarray): True labels for the validation dataset.</span>
<span class="sd">        path_folder (str, optional): Path to save the plot. If None, the plot will not be saved.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">max_all</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">best_val_outputs</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">best_val_labels</span><span class="p">))</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">best_val_labels</span><span class="p">,</span> <span class="n">best_val_outputs</span><span class="p">,</span> <span class="s2">&quot;o&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s2">&quot;equal&quot;</span><span class="p">,</span> <span class="n">adjustable</span><span class="o">=</span><span class="s2">&quot;box&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_all</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_all</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;True Labels&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Model Output&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Model Output vs True Labels in test dataset&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">best_val_labels</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">best_val_labels</span><span class="p">)],</span>
        <span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">best_val_labels</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">best_val_labels</span><span class="p">)],</span>
        <span class="s2">&quot;r--&quot;</span><span class="p">,</span>
    <span class="p">)</span>  <span class="c1"># y = x reference line</span>
    <span class="k">if</span> <span class="n">path_folder</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_folder</span><span class="p">,</span> <span class="s2">&quot;scatter_plot.png&quot;</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.main_func.extract_goes" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">extract_goes</span><span class="p">(</span><span class="n">observation_times</span><span class="p">,</span> <span class="n">observation_lats</span><span class="p">,</span> <span class="n">observation_lons</span><span class="p">,</span> <span class="n">scatterometer_data_path</span><span class="p">,</span> <span class="n">goes_aws_url_folder</span><span class="p">,</span> <span class="n">goes_channel</span><span class="o">=</span><span class="s1">&#39;C01&#39;</span><span class="p">,</span> <span class="n">goes_image_size</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>This function extracts GOES images for the given observation times, latitudes, and longitudes.
It retrieves the GOES data from the specified AWS S3 bucket and processes it to create images of the specified size.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>observation_times</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The times of observation of the scatterometer data. </p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>observation_lats</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The latitudes of the scatterometer data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>observation_lons</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The longitudes of the scatterometer data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>scatterometer_data_path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The path to the scatterometer data directory.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>goes_aws_url_folder</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The folder in the AWS S3 bucket where the GOES data is stored.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>goes_channel</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The channel of interest. Default is "C01".</p>
              </div>
            </td>
            <td>
                  <code>&#39;C01&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>goes_image_size</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The size of the output images. Default is 128.</p>
              </div>
            </td>
            <td>
                  <code>128</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>verbose</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, prints progress information.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>images</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A 4D numpy array of shape (num_observations, num_channels, goes_image_size, goes_image_size) containing the extracted GOES images.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\func.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">extract_goes</span><span class="p">(</span>
    <span class="n">observation_times</span><span class="p">,</span>
    <span class="n">observation_lats</span><span class="p">,</span>
    <span class="n">observation_lons</span><span class="p">,</span>
    <span class="n">scatterometer_data_path</span><span class="p">,</span>
    <span class="n">goes_aws_url_folder</span><span class="p">,</span>
    <span class="n">goes_channel</span><span class="o">=</span><span class="s2">&quot;C01&quot;</span><span class="p">,</span>
    <span class="n">goes_image_size</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function extracts GOES images for the given observation times, latitudes, and longitudes.</span>
<span class="sd">    It retrieves the GOES data from the specified AWS S3 bucket and processes it to create images of the specified size.</span>

<span class="sd">    Args:</span>
<span class="sd">        observation_times (numpy.ndarray): The times of observation of the scatterometer data. </span>
<span class="sd">        observation_lats (numpy.ndarray): The latitudes of the scatterometer data.</span>
<span class="sd">        observation_lons (numpy.ndarray): The longitudes of the scatterometer data.</span>
<span class="sd">        scatterometer_data_path (str): The path to the scatterometer data directory.</span>
<span class="sd">        goes_aws_url_folder (str): The folder in the AWS S3 bucket where the GOES data is stored.</span>
<span class="sd">        goes_channel (str): The channel of interest. Default is &quot;C01&quot;.</span>
<span class="sd">        goes_image_size (int): The size of the output images. Default is 128.</span>
<span class="sd">        verbose (bool): If True, prints progress information.</span>

<span class="sd">    Returns:</span>
<span class="sd">        images (numpy.ndarray): A 4D numpy array of shape (num_observations, num_channels, goes_image_size, goes_image_size) containing the extracted GOES images.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">scatterometer_data_path</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.nc&quot;</span><span class="p">):</span>
            <span class="n">polar</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">scatterometer_data_path</span><span class="p">,</span> <span class="n">file</span><span class="p">),</span>
                <span class="n">engine</span><span class="o">=</span><span class="s2">&quot;h5netcdf&quot;</span><span class="p">,</span>
                <span class="n">drop_variables</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;DQF&quot;</span><span class="p">],</span>
            <span class="p">)</span>
            <span class="k">break</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;WARNING : No .nc file found in the scatterometer data path, please check the path&#39;</span><span class="p">)</span>

    <span class="n">template_scatter</span> <span class="o">=</span> <span class="n">polar</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">lat_grd</span><span class="p">,</span> <span class="n">lon_grd</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">template_scatter</span><span class="p">[</span><span class="s2">&quot;latitude&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
        <span class="n">template_scatter</span><span class="p">[</span><span class="s2">&quot;longitude&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">fs</span> <span class="o">=</span> <span class="n">fsspec</span><span class="o">.</span><span class="n">filesystem</span><span class="p">(</span><span class="s2">&quot;s3&quot;</span><span class="p">,</span> <span class="n">anon</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default_block_size</span><span class="o">=</span><span class="mi">512</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">1024</span><span class="p">)</span>

    <span class="n">values</span><span class="p">,</span> <span class="n">counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">observation_times</span><span class="p">,</span> <span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">all_urls</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># getting unique URLS</span>
    <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
        <span class="n">urls</span> <span class="o">=</span> <span class="n">get_goes_url</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">goes_aws_url_folder</span><span class="p">,</span><span class="n">goes_channel</span><span class="p">)</span>
        <span class="n">all_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">urls</span><span class="p">)</span>

    <span class="n">values_url</span><span class="p">,</span> <span class="n">indices_url</span><span class="p">,</span> <span class="n">counts_url</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
        <span class="n">all_urls</span><span class="p">,</span> <span class="n">return_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span>
    <span class="p">)</span>
    <span class="c1"># Sort indices to &quot;unsort&quot; the URLs</span>
    <span class="n">sorted_indices</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">indices_url</span><span class="p">)),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">k</span><span class="p">:</span> <span class="n">indices_url</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
    <span class="n">values_url</span> <span class="o">=</span> <span class="p">[</span><span class="n">all_urls</span><span class="p">[</span><span class="n">indices_url</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">sorted_indices</span><span class="p">]</span>

    <span class="c1"># Reorder counts_url using the same sorted indices</span>
    <span class="n">counts_url</span> <span class="o">=</span> <span class="p">[</span><span class="n">counts_url</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">sorted_indices</span><span class="p">]</span>

    <span class="n">compressed_urls</span> <span class="o">=</span> <span class="n">values_url</span>
    <span class="n">compressed_counts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">start_idx</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">size</span> <span class="ow">in</span> <span class="n">counts_url</span><span class="p">:</span>
        <span class="n">group_sum</span> <span class="o">=</span> <span class="n">counts</span><span class="p">[</span><span class="n">start_idx</span> <span class="p">:</span> <span class="n">start_idx</span> <span class="o">+</span> <span class="n">size</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="n">compressed_counts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">group_sum</span><span class="p">)</span>
        <span class="n">start_idx</span> <span class="o">+=</span> <span class="n">size</span>

    <span class="n">width</span> <span class="o">=</span> <span class="n">goes_image_size</span>
    <span class="n">height</span> <span class="o">=</span> <span class="n">goes_image_size</span>

    <span class="n">images</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">observation_times</span><span class="p">),</span> <span class="mi">1</span> <span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

    <span class="n">total_idx</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">unique_idx</span><span class="p">,</span> <span class="n">unique_urls</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span>
        <span class="nb">enumerate</span><span class="p">(</span><span class="n">compressed_urls</span><span class="p">),</span>
        <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;INFO : Retrieving and processing GOES data&quot;</span><span class="p">,</span>
        <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">compressed_urls</span><span class="p">),</span>
        <span class="n">disable</span><span class="o">=</span><span class="ow">not</span> <span class="n">verbose</span><span class="p">,</span>
    <span class="p">):</span>


        <span class="k">for</span> <span class="n">CH_idx</span><span class="p">,</span> <span class="n">url_CH</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">unique_urls</span><span class="p">):</span>

            <span class="k">if</span> <span class="n">url_CH</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">images</span><span class="p">[</span><span class="n">total_idx</span><span class="p">,</span> <span class="n">CH_idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">])</span>
                <span class="k">continue</span>

            <span class="k">with</span> <span class="n">fs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">url_CH</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>

                <span class="n">ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span>
                    <span class="n">f</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s2">&quot;h5netcdf&quot;</span><span class="p">,</span> <span class="n">drop_variables</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;DQF&quot;</span><span class="p">]</span>
                <span class="p">)</span>  <span class="c1"># this is the bottleneck</span>

                <span class="n">parallel_index</span> <span class="o">=</span> <span class="n">index_parallel</span><span class="p">(</span>
                    <span class="n">ds</span><span class="p">,</span>
                    <span class="n">template_scatter</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">compressed_counts</span><span class="p">[</span><span class="n">unique_idx</span><span class="p">]):</span>
                    <span class="n">images</span><span class="p">[</span><span class="n">total_idx</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span> <span class="n">CH_idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_image</span><span class="p">(</span>
                        <span class="n">ds</span><span class="o">=</span><span class="n">ds</span><span class="p">,</span>
                        <span class="n">parallel_index</span><span class="o">=</span><span class="n">parallel_index</span><span class="p">,</span>
                        <span class="n">lat_grd</span><span class="o">=</span><span class="n">lat_grd</span><span class="p">,</span>
                        <span class="n">lon_grd</span><span class="o">=</span><span class="n">lon_grd</span><span class="p">,</span>
                        <span class="n">lat_search</span><span class="o">=</span><span class="n">observation_lats</span><span class="p">[</span><span class="n">total_idx</span> <span class="o">+</span> <span class="n">i</span><span class="p">],</span>
                        <span class="n">lon_search</span><span class="o">=</span><span class="n">observation_lons</span><span class="p">[</span><span class="n">total_idx</span> <span class="o">+</span> <span class="n">i</span><span class="p">],</span>
                        <span class="n">goes_image_size</span><span class="o">=</span><span class="n">goes_image_size</span><span class="p">,</span>
                    <span class="p">)</span>

        <span class="n">total_idx</span> <span class="o">+=</span> <span class="n">compressed_counts</span><span class="p">[</span><span class="n">unique_idx</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;INFO : Extracted </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">observation_times</span><span class="p">)</span><span class="si">}</span><span class="s2"> images from </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">compressed_urls</span><span class="p">)</span><span class="si">}</span><span class="s2"> GOES files.&quot;</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">images</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.main_func.extract_goes_inference" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">extract_goes_inference</span><span class="p">(</span><span class="n">date_time</span><span class="p">,</span> <span class="n">parallel_index</span><span class="p">,</span> <span class="n">channels</span><span class="o">=</span><span class="s1">&#39;C01&#39;</span><span class="p">,</span> <span class="n">goes_aws_url_folder</span><span class="o">=</span><span class="s1">&#39;noaa-goes16/ABI-L2-CMIPF&#39;</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>This function extracts GOES images for a given date_time and parallel_index. (whole GOES slice, used for inference which differs from images used in training that have a matched orbit with scatterometers.)
It retrieves the GOES data from the specified AWS S3 bucket and processes it to create
images of the specified size (128x128).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>date_time</code>
            </td>
            <td>
                  <code><span title="numpy.datetime64">datetime64</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The time of the GOES data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>parallel_index</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The precomputed indices for GOES pixels corresponding to scatterometer lat/lon.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>channels</code>
            </td>
            <td>
                  <code><span title="str">str</span> or <span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The channel(s) of interest. Default is "C01".</p>
              </div>
            </td>
            <td>
                  <code>&#39;C01&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>goes_aws_url_folder</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The folder in the AWS S3 bucket where the GOES data is stored. Default is 'noaa-goes16/ABI-L2-CMIPF'.</p>
              </div>
            </td>
            <td>
                  <code>&#39;noaa-goes16/ABI-L2-CMIPF&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>images</code></td>            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of numpy arrays containing the extracted GOES images of shape (128, 128).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\func.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">extract_goes_inference</span><span class="p">(</span><span class="n">date_time</span><span class="p">,</span> <span class="n">parallel_index</span><span class="p">,</span><span class="n">channels</span><span class="o">=</span><span class="s2">&quot;C01&quot;</span><span class="p">,</span><span class="n">goes_aws_url_folder</span><span class="o">=</span> <span class="s1">&#39;noaa-goes16/ABI-L2-CMIPF&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function extracts GOES images for a given date_time and parallel_index. (whole GOES slice, used for inference which differs from images used in training that have a matched orbit with scatterometers.)</span>
<span class="sd">    It retrieves the GOES data from the specified AWS S3 bucket and processes it to create</span>
<span class="sd">    images of the specified size (128x128).</span>

<span class="sd">    Args:</span>
<span class="sd">        date_time (numpy.datetime64): The time of the GOES data.</span>
<span class="sd">        parallel_index (numpy.ndarray): The precomputed indices for GOES pixels corresponding to scatterometer lat/lon.</span>
<span class="sd">        channels (str or list): The channel(s) of interest. Default is &quot;C01&quot;.</span>
<span class="sd">        goes_aws_url_folder (str): The folder in the AWS S3 bucket where the GOES data is stored. Default is &#39;noaa-goes16/ABI-L2-CMIPF&#39;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        images (list): A list of numpy arrays containing the extracted GOES images of shape (128, 128).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># ignore divide by zero errors which occur when the GOES data can&#39;t form a 128x128 image</span>
    <span class="n">np</span><span class="o">.</span><span class="n">seterr</span><span class="p">(</span><span class="n">invalid</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">divide</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>

    <span class="n">fs</span> <span class="o">=</span> <span class="n">fsspec</span><span class="o">.</span><span class="n">filesystem</span><span class="p">(</span><span class="s2">&quot;s3&quot;</span><span class="p">,</span> <span class="n">anon</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default_block_size</span><span class="o">=</span><span class="mi">512</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">1024</span><span class="p">)</span>
    <span class="n">urls</span> <span class="o">=</span> <span class="n">get_goes_url</span><span class="p">(</span><span class="n">date_time</span><span class="p">,</span> <span class="n">goes_aws_url_folder</span><span class="o">=</span><span class="s1">&#39;noaa-goes16/ABI-L2-CMIPF&#39;</span><span class="p">,</span> <span class="n">goes_channel</span><span class="o">=</span> <span class="n">channels</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">fs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">urls</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;INFO : Reading file:&quot;</span><span class="p">,</span> <span class="n">urls</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">goes_image</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">goes_image</span> <span class="o">=</span> <span class="n">goes_image</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="s2">&quot;x_index&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="s2">&quot;y_index&quot;</span><span class="p">})</span>

        <span class="c1"># Assign the index coordinates (if not already done)</span>
        <span class="n">goes_image</span> <span class="o">=</span> <span class="n">goes_image</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">(</span>
            <span class="n">x_index</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">goes_image</span><span class="o">.</span><span class="n">sizes</span><span class="p">[</span><span class="s2">&quot;x_index&quot;</span><span class="p">]),</span>
            <span class="n">y_index</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">goes_image</span><span class="o">.</span><span class="n">sizes</span><span class="p">[</span><span class="s2">&quot;y_index&quot;</span><span class="p">]),</span>
        <span class="p">)</span>

        <span class="n">images</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">goes_image</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;INFO : Extracting images&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">parallel_index</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">parallel_index</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">x_mean</span> <span class="o">=</span> <span class="n">parallel_index</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
                    <span class="n">x_min</span> <span class="o">=</span> <span class="n">x_mean</span> <span class="o">-</span> <span class="mi">63</span>
                    <span class="n">x_max</span> <span class="o">=</span> <span class="n">x_mean</span> <span class="o">+</span> <span class="mi">63</span>
                    <span class="n">y_mean</span> <span class="o">=</span> <span class="n">parallel_index</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
                    <span class="n">y_min</span> <span class="o">=</span> <span class="n">y_mean</span> <span class="o">-</span> <span class="mi">63</span>
                    <span class="n">y_max</span> <span class="o">=</span> <span class="n">y_mean</span> <span class="o">+</span> <span class="mi">63</span>
                    <span class="n">image</span> <span class="o">=</span> <span class="n">goes_image</span><span class="o">.</span><span class="n">CMI</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span>
                        <span class="n">x_index</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">),</span> <span class="n">y_index</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span><span class="p">)</span>
                    <span class="p">)</span>

                    <span class="n">target_size</span> <span class="o">=</span> <span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">)</span>

                    <span class="n">padded_image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span>
                        <span class="n">image</span><span class="p">,</span>
                        <span class="p">(</span>
                            <span class="p">(</span>
                                <span class="p">(</span><span class="n">target_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span>
                                <span class="p">(</span><span class="n">target_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span>
                            <span class="p">),</span>
                            <span class="p">(</span>
                                <span class="p">(</span><span class="n">target_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span>
                                <span class="p">(</span><span class="n">target_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span>
                            <span class="p">),</span>
                        <span class="p">),</span>
                        <span class="n">constant_values</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                    <span class="p">)</span>

                <span class="k">except</span><span class="p">:</span>
                    <span class="n">images</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">)))</span>

                    <span class="k">continue</span>
                <span class="n">images</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">padded_image</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">images</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.main_func.extract_goes_production" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">extract_goes_production</span><span class="p">(</span><span class="n">time_choice</span><span class="p">,</span> <span class="n">polar_data</span><span class="p">,</span> <span class="n">parallel_index</span><span class="p">,</span> <span class="n">channels</span><span class="p">,</span> <span class="n">goes_aws_url_folder</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Extracts GOES data for a specific time from the polar data and returns the images along with valid latitudes, longitudes, and times.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>time_choice</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The time for which to extract GOES data, in 'YYYY-MM-DD HH:MM:SS' format.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>polar_data</code>
            </td>
            <td>
                  <code><span title="xarray.Dataset">Dataset</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Polar data containing latitude and longitude information. Used to create a grid of valid latitudes and longitudes.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>parallel_index</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Index for parallel processing, used to identify the specific GOES data to extract, generated by the <code>index_parallel</code> function.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>channels</code>
            </td>
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of GOES channels to extract.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>goes_aws_url_folder</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>AWS URL folder for the GOES data, default is "noaa-goes16/ABI-L2-CMIPF".</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>images</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of extracted GOES images for the specified time.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>valid_lats</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of valid latitudes corresponding to the GOES images</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>valid_lons</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of valid longitudes corresponding to the GOES images</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>valid_times</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of valid times corresponding to the GOES images.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\func_inference.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">extract_goes_production</span><span class="p">(</span><span class="n">time_choice</span><span class="p">,</span> <span class="n">polar_data</span><span class="p">,</span> <span class="n">parallel_index</span><span class="p">,</span><span class="n">channels</span><span class="p">,</span><span class="n">goes_aws_url_folder</span><span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    Extracts GOES data for a specific time from the polar data and returns the images along with valid latitudes, longitudes, and times.</span>

<span class="sd">    Args:</span>
<span class="sd">        time_choice (str): The time for which to extract GOES data, in &#39;YYYY-MM-DD HH:MM:SS&#39; format.</span>
<span class="sd">        polar_data (xarray.Dataset): Polar data containing latitude and longitude information. Used to create a grid of valid latitudes and longitudes.</span>
<span class="sd">        parallel_index (int): Index for parallel processing, used to identify the specific GOES data to extract, generated by the `index_parallel` function.</span>
<span class="sd">        channels (list): List of GOES channels to extract.</span>
<span class="sd">        goes_aws_url_folder (str): AWS URL folder for the GOES data, default is &quot;noaa-goes16/ABI-L2-CMIPF&quot;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        images (np.ndarray): Array of extracted GOES images for the specified time.</span>
<span class="sd">        valid_lats (np.ndarray): Array of valid latitudes corresponding to the GOES images</span>
<span class="sd">        valid_lons (np.ndarray): Array of valid longitudes corresponding to the GOES images</span>
<span class="sd">        valid_times (np.ndarray): Array of valid times corresponding to the GOES images.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">time_formated</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="n">time_choice</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;datetime64[ns]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;float64&quot;</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="n">longrid</span><span class="p">,</span> <span class="n">latgrid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">polar_data</span><span class="p">[</span><span class="s2">&quot;longitude&quot;</span><span class="p">],</span> <span class="n">polar_data</span><span class="p">[</span><span class="s2">&quot;latitude&quot;</span><span class="p">])</span>
    <span class="n">lon_array</span> <span class="o">=</span> <span class="n">longrid</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">lat_array</span> <span class="o">=</span> <span class="n">latgrid</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">time_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">lon_array</span><span class="p">,</span> <span class="n">time_formated</span><span class="p">)</span>

    <span class="n">valid_lons</span> <span class="o">=</span> <span class="n">lon_array</span>
    <span class="n">valid_lats</span> <span class="o">=</span> <span class="n">lat_array</span>
    <span class="n">valid_times</span> <span class="o">=</span> <span class="n">time_array</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;INFO : Extracting GOES data&#39;</span><span class="p">)</span>
    <span class="n">images</span> <span class="o">=</span> <span class="n">extract_goes_inference</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="n">time_choice</span><span class="p">),</span> <span class="n">parallel_index</span><span class="p">,</span><span class="n">channels</span><span class="p">,</span><span class="n">goes_aws_url_folder</span><span class="p">)</span>


    <span class="n">images</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>


    <span class="k">return</span> <span class="n">images</span><span class="p">,</span> <span class="n">valid_lats</span><span class="p">,</span> <span class="n">valid_lons</span><span class="p">,</span> <span class="n">valid_times</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.main_func.extract_matching_orbits" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">extract_matching_orbits</span><span class="p">(</span><span class="n">scatterometer_data_path</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">lat_range</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">],</span> <span class="n">lon_range</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span> <span class="mi">180</span><span class="p">],</span> <span class="n">goes_aws_url_folder</span><span class="o">=</span><span class="s1">&#39;noaa-goes16/ABI-L2-CMIPF&#39;</span><span class="p">,</span> <span class="n">goes_channel</span><span class="o">=</span><span class="s1">&#39;C01&#39;</span><span class="p">,</span> <span class="n">goes_image_size</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Extracts matching orbits from scatterometer data (pre-downloaded) and GOES images (automatically extracted) for a given date. 
The function filters the data to only include daylight observations and returns the images and numerical data in a dictionary format.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>scatterometer_data_path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the pre-downloaded scatterometer data. Data must be in .netCDF format. See tutorial for downloading data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>date</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Date for which to extract the data in 'YYYY-MM-DD' format.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lat_range</code>
            </td>
            <td>
                  <code><span title="tuple">tuple</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Latitude range to filter the data, default is [-90,180] (all latitudes).</p>
              </div>
            </td>
            <td>
                  <code>[-90, 90]</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lon_range</code>
            </td>
            <td>
                  <code><span title="tuple">tuple</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Longitude range to filter the data, default is [-180, 180] (all longitudes).</p>
              </div>
            </td>
            <td>
                  <code>[-180, 180]</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>goes_aws_url_folder</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>AWS URL folder for the GOES data, default is "noaa-goes16/ABI-L2-CMIPF".</p>
              </div>
            </td>
            <td>
                  <code>&#39;noaa-goes16/ABI-L2-CMIPF&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>goes_channel</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>GOES channel to extract, default is "C01" (visible).</p>
              </div>
            </td>
            <td>
                  <code>&#39;C01&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>goes_image_size</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Size of the GOES images to extract, default is 128.</p>
              </div>
            </td>
            <td>
                  <code>128</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>verbose</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, prints additional information during the extraction process, default is True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>save</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, saves the preloaded data to a compressed .npz file, default is True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>images</code></td>            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of filtered GOES images.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>numerical_data</code></td>            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary containing filtered numerical data (latitudes, longitudes, times, wind speeds).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>saved_file_path</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the saved .npz file if save is True, otherwise None.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\main_func.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">extract_matching_orbits</span><span class="p">(</span><span class="n">scatterometer_data_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                            <span class="n">date</span> <span class="p">:</span> <span class="nb">str</span> <span class="p">,</span>
                            <span class="n">lat_range</span> <span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">],</span>
                            <span class="n">lon_range</span> <span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span> <span class="mi">180</span><span class="p">],</span>
                            <span class="n">goes_aws_url_folder</span> <span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;noaa-goes16/ABI-L2-CMIPF&quot;</span><span class="p">,</span>
                            <span class="n">goes_channel</span> <span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;C01&quot;</span><span class="p">,</span>
                            <span class="n">goes_image_size</span> <span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">128</span><span class="p">,</span>
                            <span class="n">verbose</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                            <span class="n">save</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span><span class="kc">True</span>
                            <span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;    Extracts matching orbits from scatterometer data (pre-downloaded) and GOES images (automatically extracted) for a given date. </span>
<span class="sd">    The function filters the data to only include daylight observations and returns the images and numerical data in a dictionary format.</span>

<span class="sd">    Args:</span>
<span class="sd">        scatterometer_data_path (str): Path to the pre-downloaded scatterometer data. Data must be in .netCDF format. See tutorial for downloading data.</span>
<span class="sd">        date (str): Date for which to extract the data in &#39;YYYY-MM-DD&#39; format.</span>
<span class="sd">        lat_range (tuple): Latitude range to filter the data, default is [-90,180] (all latitudes).</span>
<span class="sd">        lon_range (tuple): Longitude range to filter the data, default is [-180, 180] (all longitudes).</span>
<span class="sd">        goes_aws_url_folder (str): AWS URL folder for the GOES data, default is &quot;noaa-goes16/ABI-L2-CMIPF&quot;.</span>
<span class="sd">        goes_channel (str): GOES channel to extract, default is &quot;C01&quot; (visible).</span>
<span class="sd">        goes_image_size (int): Size of the GOES images to extract, default is 128.</span>
<span class="sd">        verbose (bool): If True, prints additional information during the extraction process, default is True.</span>
<span class="sd">        save (bool): If True, saves the preloaded data to a compressed .npz file, default is True.</span>

<span class="sd">    Returns:</span>
<span class="sd">        images (list): List of filtered GOES images.</span>
<span class="sd">        numerical_data (dict): Dictionary containing filtered numerical data (latitudes, longitudes, times, wind speeds).</span>
<span class="sd">        saved_file_path (str): Path to the saved .npz file if save is True, otherwise None.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;START : Extracting matching orbits for date:&quot;</span><span class="p">,</span> <span class="n">date</span><span class="p">)</span> 
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;INFO : lat_range:&quot;</span><span class="p">,</span> <span class="n">lat_range</span><span class="p">,)</span> 
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;INFO : lon_range:&quot;</span><span class="p">,</span> <span class="n">lon_range</span><span class="p">,)</span> 
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;INFO : goes_channel:&quot;</span><span class="p">,</span> <span class="n">goes_channel</span><span class="p">,</span> <span class="s1">&#39;at url:&#39;</span><span class="p">,</span> <span class="n">goes_aws_url_folder</span><span class="p">)</span>

    <span class="c1"># Extract scatterometer data in correct format</span>

    <span class="p">(</span>
        <span class="n">observation_times_local</span><span class="p">,</span>
        <span class="n">observation_lats_local</span><span class="p">,</span>
        <span class="n">observation_lons_local</span><span class="p">,</span>
        <span class="n">observation_wind_speeds_local</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">=</span> <span class="n">extract_scatter_multisat</span><span class="p">(</span>
        <span class="n">scatterometer_data_path</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">lat_range</span><span class="p">,</span> <span class="n">lon_range</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>


    <span class="c1"># filter nighttime data</span>
    <span class="n">valid_times</span><span class="p">,</span> <span class="n">valid_lats</span><span class="p">,</span> <span class="n">valid_lons</span><span class="p">,</span> <span class="n">valid_wind_speeds</span> <span class="o">=</span> <span class="n">filter_nighttime</span><span class="p">(</span>
        <span class="n">observation_times_local</span><span class="p">,</span>
        <span class="n">observation_lats_local</span><span class="p">,</span>
        <span class="n">observation_lons_local</span><span class="p">,</span>
        <span class="n">observation_wind_speeds_local</span><span class="p">,</span>
        <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span>
        <span class="p">)</span>

    <span class="c1"># Extract GOES data from matching orbits </span>
    <span class="c1"># If this is first run with dataset, it will create a folder with indices which takes time.</span>

    <span class="n">images</span> <span class="o">=</span> <span class="n">extract_goes</span><span class="p">(</span>  
        <span class="n">observation_times</span><span class="o">=</span><span class="n">valid_times</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">100</span><span class="p">],</span> <span class="c1">#TODO: REMOVE THIS LIMITATION, only for debugging</span>
        <span class="n">observation_lats</span><span class="o">=</span><span class="n">valid_lats</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">100</span><span class="p">],</span>
        <span class="n">observation_lons</span><span class="o">=</span><span class="n">valid_lons</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">100</span><span class="p">],</span>
        <span class="n">scatterometer_data_path</span><span class="o">=</span><span class="n">scatterometer_data_path</span><span class="p">,</span>
        <span class="n">goes_aws_url_folder</span><span class="o">=</span><span class="n">goes_aws_url_folder</span><span class="p">,</span>
        <span class="n">goes_channel</span><span class="o">=</span><span class="n">goes_channel</span><span class="p">,</span>
        <span class="n">goes_image_size</span><span class="o">=</span><span class="n">goes_image_size</span><span class="p">,</span>
        <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span>
        <span class="p">)</span>

    <span class="c1"># Package the data into a dictionary for easy access and logging. The observation_wind_speeds is the target variable.</span>
    <span class="n">numerical_data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;observation_lats&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">valid_lats</span><span class="p">),</span>
        <span class="s2">&quot;observation_lons&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">valid_lons</span><span class="p">),</span>
        <span class="s2">&quot;observation_times&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">valid_times</span><span class="p">),</span>
        <span class="s2">&quot;observation_wind_speeds&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">valid_wind_speeds</span><span class="p">),</span>
    <span class="p">}</span>

    <span class="c1"># Filter the images and numerical data to remove nans, invalid images</span>

    <span class="n">images_filtered</span><span class="p">,</span> <span class="n">numerical_data_filtered</span> <span class="o">=</span> <span class="n">package_data</span><span class="p">(</span>
        <span class="n">images</span><span class="p">,</span> <span class="n">numerical_data</span><span class="p">,</span> <span class="n">solar_conversion</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;END : Extracted :&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">images_filtered</span><span class="p">),</span><span class="s2">&quot; training pairs&quot;</span><span class="p">)</span>

    <span class="c1"># Save the preloaded data to a compressed .npz file for later use</span>
    <span class="k">if</span> <span class="n">save</span><span class="p">:</span>

        <span class="c1"># check if folder exists</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;./saved_files/&quot;</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="s2">&quot;./saved_files/&quot;</span><span class="p">)</span>

        <span class="n">channels_safe_name</span> <span class="o">=</span> <span class="n">goes_channel</span>
        <span class="n">saved_file_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;./saved_files/file_preloaded_</span><span class="si">{</span><span class="n">date</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">channels_safe_name</span><span class="si">}</span><span class="s2">.npz&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;INFO : Saving preloaded data to file : &quot;</span><span class="p">,</span> <span class="n">saved_file_path</span><span class="p">)</span>

        <span class="n">np</span><span class="o">.</span><span class="n">savez_compressed</span><span class="p">(</span>
            <span class="n">saved_file_path</span><span class="p">,</span>
            <span class="n">images</span><span class="o">=</span><span class="n">images_filtered</span><span class="p">,</span>
            <span class="n">numerical_data</span><span class="o">=</span><span class="n">numerical_data_filtered</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">images_filtered</span><span class="p">,</span> <span class="n">numerical_data_filtered</span><span class="p">,</span> <span class="n">saved_file_path</span>


    <span class="k">return</span> <span class="n">images_filtered</span><span class="p">,</span> <span class="n">numerical_data_filtered</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.main_func.extract_scatter" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">extract_scatter</span><span class="p">(</span><span class="n">polar_data</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">lat_range</span><span class="p">,</span> <span class="n">lon_range</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">main_variable</span><span class="o">=</span><span class="s1">&#39;wind_speed&#39;</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>This function extracts the scatterometer data from the polar_data dataset for the given time range, latitude range and longitude range.
The function then saves the data into 4 numpy files : time of observation, latitude, longitude and main variable.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>polar_data</code>
            </td>
            <td>
                  <code><span title="xarray.Dataset">Dataset</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The scatterometer dataset (ASCAT, HYSCAT etc).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>date</code>
            </td>
            <td>
                  <code><span title="numpy.datetime64">datetime64</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The time of the scatterometer data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lat_range</code>
            </td>
            <td>
                  <code><span title="tuple">tuple</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The latitude range of the scatterometer data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lon_range</code>
            </td>
            <td>
                  <code><span title="tuple">tuple</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The longitude range of the scatterometer data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>verbose</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, the function will print the progress of the extraction.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>main_variable</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The main variable to be extracted from the scatterometer data. This can be wind speed, wind direction, classification etc.</p>
              </div>
            </td>
            <td>
                  <code>&#39;wind_speed&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>observation_times</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The time of observation of the scatterometer data.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>observation_lats</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The latitude of the scatterometer data.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>observation_lons</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The longitude of the scatterometer data.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>observation_main_parameter</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>main parameter extracted (wind_speed).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\func.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">extract_scatter</span><span class="p">(</span>
    <span class="n">polar_data</span><span class="p">,</span>
    <span class="n">date</span><span class="p">,</span>
    <span class="n">lat_range</span><span class="p">,</span>
    <span class="n">lon_range</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">main_variable</span><span class="o">=</span><span class="s2">&quot;wind_speed&quot;</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function extracts the scatterometer data from the polar_data dataset for the given time range, latitude range and longitude range.</span>
<span class="sd">    The function then saves the data into 4 numpy files : time of observation, latitude, longitude and main variable.</span>

<span class="sd">    Args:</span>
<span class="sd">        polar_data (xarray.Dataset): The scatterometer dataset (ASCAT, HYSCAT etc).</span>
<span class="sd">        date (numpy.datetime64): The time of the scatterometer data.</span>
<span class="sd">        lat_range (tuple): The latitude range of the scatterometer data.</span>
<span class="sd">        lon_range (tuple): The longitude range of the scatterometer data.</span>
<span class="sd">        verbose (bool): If True, the function will print the progress of the extraction.</span>
<span class="sd">        main_variable (str): The main variable to be extracted from the scatterometer data. This can be wind speed, wind direction, classification etc.</span>

<span class="sd">    Returns:</span>
<span class="sd">        observation_times (numpy.ndarray): The time of observation of the scatterometer data.</span>
<span class="sd">        observation_lats (numpy.ndarray): The latitude of the scatterometer data.</span>
<span class="sd">        observation_lons (numpy.ndarray): The longitude of the scatterometer data.</span>
<span class="sd">        observation_main_parameter (numpy.ndarray): main parameter extracted (wind_speed).</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">polar</span> <span class="o">=</span> <span class="n">polar_data</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span>
        <span class="n">time</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="n">date</span><span class="p">),</span>
        <span class="n">latitude</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">lat_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lat_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
        <span class="n">longitude</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">lon_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lon_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
    <span class="p">)</span>

    <span class="n">seperated_scatter</span> <span class="o">=</span> <span class="n">savedataseperated</span><span class="p">(</span><span class="n">polar</span><span class="p">,</span> <span class="n">polar</span><span class="p">[</span><span class="n">main_variable</span><span class="p">],</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>

    <span class="n">observation_times</span> <span class="o">=</span> <span class="n">seperated_scatter</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">observation_lats</span> <span class="o">=</span> <span class="n">seperated_scatter</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">observation_lons</span> <span class="o">=</span> <span class="n">seperated_scatter</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">observation_wind_speeds</span> <span class="o">=</span> <span class="n">seperated_scatter</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>



    <span class="k">return</span> <span class="p">(</span>
        <span class="n">observation_times</span><span class="p">,</span>
        <span class="n">observation_lats</span><span class="p">,</span>
        <span class="n">observation_lons</span><span class="p">,</span>
        <span class="n">observation_wind_speeds</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.main_func.extract_scatter_multisat" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">extract_scatter_multisat</span><span class="p">(</span><span class="n">scatterometer_data_path</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">lat_range</span><span class="p">,</span> <span class="n">lon_range</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Extracts scatterometer data from multiple files (<code>.nc</code>) in a specified directory.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>scatterometer_data_path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the directory containing scatterometer data files.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>date</code>
            </td>
            <td>
                  <code><span title="datetime">datetime</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Date for which to extract data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lat_range</code>
            </td>
            <td>
                  <code><span title="tuple">tuple</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Latitude range (min, max) for filtering data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lon_range</code>
            </td>
            <td>
                  <code><span title="tuple">tuple</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Longitude range (min, max) for filtering data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>verbose</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, prints progress information.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>tuple</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A tuple containing:
- list of datetime: observation times
- list of float: latitudes
- list of float: longitudes
- list of float: wind speeds</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\func_inference.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">extract_scatter_multisat</span><span class="p">(</span>
    <span class="n">scatterometer_data_path</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">lat_range</span><span class="p">,</span> <span class="n">lon_range</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="kc">True</span>
<span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extracts scatterometer data from multiple files (`.nc`) in a specified directory.</span>

<span class="sd">    Args:</span>
<span class="sd">        scatterometer_data_path (str): Path to the directory containing scatterometer data files.</span>
<span class="sd">        date (datetime): Date for which to extract data.</span>
<span class="sd">        lat_range (tuple): Latitude range (min, max) for filtering data.</span>
<span class="sd">        lon_range (tuple): Longitude range (min, max) for filtering data.</span>
<span class="sd">        verbose (bool): If True, prints progress information.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple: A tuple containing:</span>
<span class="sd">            - list of datetime: observation times</span>
<span class="sd">            - list of float: latitudes</span>
<span class="sd">            - list of float: longitudes</span>
<span class="sd">            - list of float: wind speeds</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">observation_times</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">observation_lats</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">observation_lons</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">observation_wind_speeds</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;INFO : Extracting scatterometer data from folder : &quot;</span><span class="p">,</span> <span class="n">scatterometer_data_path</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;___&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">scatterometer_data_path</span><span class="p">):</span>
        <span class="k">if</span> <span class="s2">&quot;.nc&quot;</span> <span class="ow">in</span> <span class="n">file</span><span class="p">:</span>
            <span class="c1"># Open the file</span>
            <span class="n">file_path</span> <span class="o">=</span> <span class="n">scatterometer_data_path</span> <span class="o">+</span> <span class="n">file</span>
            <span class="n">polar_data</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
            <span class="p">(</span>
                <span class="n">observation_times_local</span><span class="p">,</span>
                <span class="n">observation_lats_local</span><span class="p">,</span>
                <span class="n">observation_lons_local</span><span class="p">,</span>
                <span class="n">observation_wind_speeds_local</span><span class="p">,</span>
            <span class="p">)</span> <span class="o">=</span> <span class="n">extract_scatter</span><span class="p">(</span>
                <span class="n">polar_data</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">lat_range</span><span class="p">,</span> <span class="n">lon_range</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span>
            <span class="p">)</span>
            <span class="n">observation_times</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">observation_times_local</span><span class="p">)</span>
            <span class="n">observation_lats</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">observation_lats_local</span><span class="p">)</span>
            <span class="n">observation_lons</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">observation_lons_local</span><span class="p">)</span>
            <span class="n">observation_wind_speeds</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">observation_wind_speeds_local</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">verbose</span> <span class="p">:</span> 
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;___&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;INFO : Total number of scatterometer data points: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">observation_times</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="n">observation_times</span><span class="p">,</span>
        <span class="n">observation_lats</span><span class="p">,</span>
        <span class="n">observation_lons</span><span class="p">,</span>
        <span class="n">observation_wind_speeds</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.main_func.fill_nans" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">fill_nans</span><span class="p">(</span><span class="n">images</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>This function fills NaN values in the images with zeros. (This is simply np.nan_to_num)</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>images</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A 4D numpy array of shape (num_images, num_channels, height, width) containing the GOES images.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>images</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A 4D numpy array with NaN values replaced by zeros.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\func.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fill_nans</span><span class="p">(</span><span class="n">images</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function fills NaN values in the images with zeros. (This is simply np.nan_to_num)</span>

<span class="sd">    Args:</span>
<span class="sd">        images (numpy.ndarray): A 4D numpy array of shape (num_images, num_channels, height, width) containing the GOES images.</span>

<span class="sd">    Returns:</span>
<span class="sd">        images (numpy.ndarray): A 4D numpy array with NaN values replaced by zeros.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">images</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="n">nan</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;INFO : Filled nans&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">images</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.main_func.filter_invalid" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">filter_invalid</span><span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="n">numerical_data</span><span class="p">,</span> <span class="n">min_nonzero_pixels</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>This function filters out invalid images and corresponding numerical data based on two criteria:
1) The sum of pixel values in the image is not zero (i.e., the image is not completely empty).
2) The number of non-zero pixels in the image is greater than or equal to a specified minimum threshold (default is 50).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>images</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A 4D numpy array of shape (num_images, num_channels, height, width) containing the GOES images.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>numerical_data</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary containing numerical data associated with the images. The keys should match the dimensions of the images.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>min_nonzero_pixels</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The minimum number of non-zero pixels required for an image to be considered valid. Default is 50.</p>
              </div>
            </td>
            <td>
                  <code>50</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>filtered_images</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A 4D numpy array of shape (num_valid_images, num_channels, height, width) containing the filtered GOES images.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>filtered_numerical_data</code></td>            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary containing the numerical data associated with the valid images.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\func.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">filter_invalid</span><span class="p">(</span>
    <span class="n">images</span><span class="p">,</span>
    <span class="n">numerical_data</span><span class="p">,</span>
    <span class="n">min_nonzero_pixels</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
<span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function filters out invalid images and corresponding numerical data based on two criteria:</span>
<span class="sd">    1) The sum of pixel values in the image is not zero (i.e., the image is not completely empty).</span>
<span class="sd">    2) The number of non-zero pixels in the image is greater than or equal to a specified minimum threshold (default is 50).</span>

<span class="sd">    Args:</span>
<span class="sd">        images (numpy.ndarray): A 4D numpy array of shape (num_images, num_channels, height, width) containing the GOES images.</span>
<span class="sd">        numerical_data (dict): A dictionary containing numerical data associated with the images. The keys should match the dimensions of the images.</span>
<span class="sd">        min_nonzero_pixels (int): The minimum number of non-zero pixels required for an image to be considered valid. Default is 50.</span>

<span class="sd">    Returns:</span>
<span class="sd">        filtered_images (numpy.ndarray): A 4D numpy array of shape (num_valid_images, num_channels, height, width) containing the filtered GOES images.</span>
<span class="sd">        filtered_numerical_data (dict): A dictionary containing the numerical data associated with the valid images.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Sums of pixel values in each image</span>
    <span class="n">sums_images</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">images</span><span class="p">]</span>

    <span class="c1"># Counts of non-zero pixels in each image</span>
    <span class="n">nonzero_counts</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">images</span><span class="p">]</span>

    <span class="c1"># Build a &quot;mask_invalid&quot; array of indices that fail any criterion:</span>
    <span class="c1"># 1) sum == 0 (completely empty)</span>
    <span class="c1"># 2) nonzero pixel count &lt; min_nonzero_pixels (not enough data)</span>

    <span class="n">mask_valid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
        <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sums_images</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">nonzero_counts</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">min_nonzero_pixels</span><span class="p">)</span>
    <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># Delete the invalid entries from each array</span>
    <span class="n">filtered_numerical_data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">key</span><span class="p">:</span> <span class="n">value</span><span class="p">[</span><span class="n">mask_valid</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">numerical_data</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
    <span class="p">}</span>
    <span class="n">filtered_images</span> <span class="o">=</span> <span class="n">images</span><span class="p">[</span><span class="n">mask_valid</span><span class="p">]</span>
    <span class="n">n_removed_images</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">images</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">filtered_images</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span>
        <span class="s2">&quot;INFO : Filtered invalid images. Removed </span><span class="si">{}</span><span class="s2"> entries.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">n_removed_images</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="n">filtered_images</span><span class="p">,</span>
        <span class="n">filtered_numerical_data</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.main_func.filter_nighttime" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">filter_nighttime</span><span class="p">(</span><span class="n">observation_times</span><span class="p">,</span> <span class="n">observation_lats</span><span class="p">,</span> <span class="n">observation_lons</span><span class="p">,</span> <span class="n">observation_wind_speeds</span><span class="p">,</span> <span class="n">min_hour</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">max_hour</span><span class="o">=</span><span class="mi">19</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>This function filters the scatterometer data to only include observations that were made during daylight hours.
The function checks the hour of each observation time and only keeps those that fall within the specified
range (default is 10 to 19, which corresponds to 10 AM to 7 PM UTC).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>observation_times</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The times of observation of the scatterometer data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>observation_lats</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The latitudes of the scatterometer data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>observation_lons</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The longitudes of the scatterometer data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>observation_wind_speeds</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The wind speeds of the scatterometer data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>min_hour</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The minimum hour of the day to include (default is 10).</p>
              </div>
            </td>
            <td>
                  <code>10</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_hour</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The maximum hour of the day to include (default is 19).</p>
              </div>
            </td>
            <td>
                  <code>19</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>verbose</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, prints the number of valid scatterometer data points at daylight.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>valid_times</code></td>            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of valid observation times that fall within the specified hour range.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>valid_lats</code></td>            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of valid latitudes corresponding to the valid observation times</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>valid_lons</code></td>            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of valid longitudes corresponding to the valid observation times.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>valid_wind_speeds</code></td>            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of valid wind speeds corresponding to the valid observation times.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\func.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">filter_nighttime</span><span class="p">(</span>
    <span class="n">observation_times</span><span class="p">,</span>
    <span class="n">observation_lats</span><span class="p">,</span>
    <span class="n">observation_lons</span><span class="p">,</span>
    <span class="n">observation_wind_speeds</span><span class="p">,</span>
    <span class="n">min_hour</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">max_hour</span><span class="o">=</span><span class="mi">19</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function filters the scatterometer data to only include observations that were made during daylight hours.</span>
<span class="sd">    The function checks the hour of each observation time and only keeps those that fall within the specified</span>
<span class="sd">    range (default is 10 to 19, which corresponds to 10 AM to 7 PM UTC).</span>

<span class="sd">    Args:</span>
<span class="sd">        observation_times (numpy.ndarray): The times of observation of the scatterometer data.</span>
<span class="sd">        observation_lats (numpy.ndarray): The latitudes of the scatterometer data.</span>
<span class="sd">        observation_lons (numpy.ndarray): The longitudes of the scatterometer data.</span>
<span class="sd">        observation_wind_speeds (numpy.ndarray): The wind speeds of the scatterometer data.</span>
<span class="sd">        min_hour (int): The minimum hour of the day to include (default is 10).</span>
<span class="sd">        max_hour (int): The maximum hour of the day to include (default is 19).</span>
<span class="sd">        verbose (bool): If True, prints the number of valid scatterometer data points at daylight.</span>

<span class="sd">    Returns:</span>
<span class="sd">        valid_times (list): A list of valid observation times that fall within the specified hour range.</span>
<span class="sd">        valid_lats (list): A list of valid latitudes corresponding to the valid observation times</span>
<span class="sd">        valid_lons (list): A list of valid longitudes corresponding to the valid observation times.</span>
<span class="sd">        valid_wind_speeds (list): A list of valid wind speeds corresponding to the valid observation times.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">valid_times</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">valid_lats</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">valid_lons</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">valid_wind_speeds</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">observation_times</span><span class="p">)):</span>
        <span class="n">only_hour</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
            <span class="n">observation_times</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;datetime64[ns]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;str&quot;</span><span class="p">)[</span><span class="mi">11</span><span class="p">:</span><span class="mi">13</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">min_hour</span> <span class="o">&lt;=</span> <span class="n">only_hour</span> <span class="o">&lt;=</span> <span class="n">max_hour</span><span class="p">:</span>
            <span class="n">valid_times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">observation_times</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
            <span class="n">valid_lats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">observation_lats</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
            <span class="n">valid_lons</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">observation_lons</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
            <span class="n">valid_wind_speeds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">observation_wind_speeds</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;INFO : Total number of scatterometer data points at daylight : </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">valid_times</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">valid_times</span><span class="p">,</span> <span class="n">valid_lats</span><span class="p">,</span> <span class="n">valid_lons</span><span class="p">,</span> <span class="n">valid_wind_speeds</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.main_func.form_arrays_buoy" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">form_arrays_buoy</span><span class="p">(</span><span class="n">buoy</span><span class="p">,</span> <span class="n">date_choice</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Form arrays from buoy data for a specific date.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>buoy</code>
            </td>
            <td>
                  <code><span title="xarray.Dataset">Dataset</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Buoy data containing time, latitude, longitude, and wind speed.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>date_choice</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Date for which to extract buoy data, in 'YYYY-MM</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>lat</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of buoy latitudes.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>lon</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of buoy longitudes.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>time</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of buoy observation times in nanoseconds since epoch.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>wind_speed</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of buoy wind speeds.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>buoy_name</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of buoy names.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\func_inference.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">form_arrays_buoy</span><span class="p">(</span><span class="n">buoy</span><span class="p">,</span> <span class="n">date_choice</span><span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Form arrays from buoy data for a specific date.</span>

<span class="sd">    Args:</span>
<span class="sd">        buoy (xarray.Dataset): Buoy data containing time, latitude, longitude, and wind speed.</span>
<span class="sd">        date_choice (str): Date for which to extract buoy data, in &#39;YYYY-MM</span>

<span class="sd">    Returns:</span>
<span class="sd">        lat (np.ndarray): Array of buoy latitudes.</span>
<span class="sd">        lon (np.ndarray): Array of buoy longitudes.</span>
<span class="sd">        time (np.ndarray): Array of buoy observation times in nanoseconds since epoch.</span>
<span class="sd">        wind_speed (np.ndarray): Array of buoy wind speeds.</span>
<span class="sd">        buoy_name (np.ndarray): Array of buoy names.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="n">date_choice</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">timedelta64</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;m&quot;</span><span class="p">)</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="n">date_choice</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">timedelta64</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;m&quot;</span><span class="p">)</span>

        <span class="n">wind_speed</span> <span class="o">=</span> <span class="n">buoy</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">))</span><span class="o">.</span><span class="n">WS_401</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="n">time</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">buoy</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">))</span>
            <span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;datetime64[ns]&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int64&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">lat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">wind_speed</span><span class="p">),</span> <span class="n">buoy</span><span class="o">.</span><span class="n">lat</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="n">lon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">wind_speed</span><span class="p">),</span> <span class="n">buoy</span><span class="o">.</span><span class="n">lon</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="n">buoy_name</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">wind_speed</span><span class="p">),</span> <span class="n">buoy</span><span class="o">.</span><span class="n">platform_code</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">wind_speed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="n">lat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="n">lon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="n">buoy_name</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;date selection unavailable&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">wind_speed</span><span class="p">,</span> <span class="n">buoy_name</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.main_func.get_goes_url" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_goes_url</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">goes_aws_url_folder</span><span class="o">=</span><span class="s1">&#39;noaa-goes16/ABI-L2-CMIPF&#39;</span><span class="p">,</span> <span class="n">goes_channel</span><span class="o">=</span><span class="s1">&#39;C01&#39;</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>This function gets the nearest GOES-16 files from the time given.
The function returns a list of urls to the files.
The function uses the s3fs library to access the AWS GOES-16 data.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>time</code>
            </td>
            <td>
                  <code><span title="numpy.datetime">datetime</span>[<span title="ns">ns</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The time of the scatterometer data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>goes_aws_url_folder</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The folder in the AWS S3 bucket where the GOES-16 data is stored.</p>
              </div>
            </td>
            <td>
                  <code>&#39;noaa-goes16/ABI-L2-CMIPF&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>goes_channel</code>
            </td>
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The channel of interest.</p>
              </div>
            </td>
            <td>
                  <code>&#39;C01&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>urls</code></td>            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of urls to the GOES-16 files.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\func.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_goes_url</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">goes_aws_url_folder</span><span class="o">=</span><span class="s1">&#39;noaa-goes16/ABI-L2-CMIPF&#39;</span><span class="p">,</span> <span class="n">goes_channel</span><span class="o">=</span><span class="s2">&quot;C01&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function gets the nearest GOES-16 files from the time given.</span>
<span class="sd">    The function returns a list of urls to the files.</span>
<span class="sd">    The function uses the s3fs library to access the AWS GOES-16 data.</span>

<span class="sd">    Args:</span>
<span class="sd">        time (numpy.datetime[ns]): The time of the scatterometer data.</span>
<span class="sd">        goes_aws_url_folder (str): The folder in the AWS S3 bucket where the GOES-16 data is stored.</span>
<span class="sd">        goes_channel (list): The channel of interest.</span>

<span class="sd">    Returns:</span>
<span class="sd">        urls (list): A list of urls to the GOES-16 files.</span>


<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">date_c</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;datetime64[ns]&quot;</span><span class="p">)</span>
    <span class="n">date</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">date_c</span><span class="p">)</span>
    <span class="n">date_str</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y/%j/%H&quot;</span><span class="p">)</span>
    <span class="nb">min</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%M&quot;</span><span class="p">))</span>
    <span class="n">min_range</span> <span class="o">=</span> <span class="p">[(</span><span class="nb">min</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span> <span class="o">%</span> <span class="mi">60</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">)]</span>
    <span class="n">min_range_str</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">x</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">min_range</span><span class="p">]</span>
    <span class="n">fs</span> <span class="o">=</span> <span class="n">s3fs</span><span class="o">.</span><span class="n">S3FileSystem</span><span class="p">(</span><span class="n">anon</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># get the nearest goes file from time</span>

    <span class="n">urls</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">channel</span> <span class="o">=</span> <span class="n">goes_channel</span>
    <span class="n">path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">goes_aws_url_folder</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">date_str</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">files</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">ls</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="n">filter_channel</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">files</span> <span class="k">if</span> <span class="n">channel</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">filter_channel</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;INFO :No file found for </span><span class="si">{</span><span class="n">channel</span><span class="si">}</span><span class="s2"> on day </span><span class="si">{</span><span class="n">date_str</span><span class="si">}</span><span class="s2">, skipping file&quot;</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="n">file</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">filter_channel</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">73</span><span class="p">:</span><span class="mi">75</span><span class="p">]</span> <span class="ow">in</span> <span class="n">min_range_str</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">file</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;INFO :No file found for </span><span class="si">{</span><span class="n">channel</span><span class="si">}</span><span class="s2"> on day </span><span class="si">{</span><span class="n">date_str</span><span class="si">}</span><span class="s2"> for minute </span><span class="si">{</span><span class="nb">min</span><span class="si">}</span><span class="s2">, skipping file&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">goes_channel</span><span class="p">))</span>
    <span class="n">urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;s3://&quot;</span> <span class="o">+</span> <span class="n">file</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">urls</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.main_func.get_image" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_image</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">parallel_index</span><span class="p">,</span> <span class="n">lat_grd</span><span class="p">,</span> <span class="n">lon_grd</span><span class="p">,</span> <span class="n">lat_search</span><span class="p">,</span> <span class="n">lon_search</span><span class="p">,</span> <span class="n">goes_image_size</span><span class="o">=</span><span class="mi">128</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>This function retrieves a trainable GOES image for a given latitude and longitude from a GOES16 <code>.nc</code> file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>ds</code>
            </td>
            <td>
                  <code><span title="xarray.Dataset">Dataset</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The xarray dataset containing the GOES data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>parallel_index</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The precomputed indices for GOES pixels corresponding to scatterometer lat/lon.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lat_grd</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The latitude grid of the scatterometer data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lon_grd</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The longitude grid of the scatterometer data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lat_search</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The latitude to search for in the GOES data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lon_search</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The longitude to search for in the GOES data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>goes_image_size</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The size of the output image. Default is 128.</p>
              </div>
            </td>
            <td>
                  <code>128</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>padded_image</code></td>            <td>
                  <code><span title="xarray.DataArray">DataArray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A padded xarray DataArray containing the GOES image centered around the specified lat/lon.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\func.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_image</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">parallel_index</span><span class="p">,</span> <span class="n">lat_grd</span><span class="p">,</span> <span class="n">lon_grd</span><span class="p">,</span> <span class="n">lat_search</span><span class="p">,</span> <span class="n">lon_search</span><span class="p">,</span><span class="n">goes_image_size</span><span class="o">=</span><span class="mi">128</span><span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function retrieves a trainable GOES image for a given latitude and longitude from a GOES16 `.nc` file.</span>

<span class="sd">    Args:</span>
<span class="sd">        ds (xarray.Dataset): The xarray dataset containing the GOES data.</span>
<span class="sd">        parallel_index (numpy.ndarray): The precomputed indices for GOES pixels corresponding to scatterometer lat/lon.</span>
<span class="sd">        lat_grd (numpy.ndarray): The latitude grid of the scatterometer data.</span>
<span class="sd">        lon_grd (numpy.ndarray): The longitude grid of the scatterometer data.</span>
<span class="sd">        lat_search (float): The latitude to search for in the GOES data.</span>
<span class="sd">        lon_search (float): The longitude to search for in the GOES data.</span>
<span class="sd">        goes_image_size (int): The size of the output image. Default is 128.</span>

<span class="sd">    Returns:</span>
<span class="sd">        padded_image (xarray.DataArray): A padded xarray DataArray containing the GOES image centered around the specified lat/lon.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">index_row</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
        <span class="n">lat_grd</span> <span class="o">==</span> <span class="n">lat_search</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">index_column</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">lon_grd</span> <span class="o">==</span> <span class="n">lon_search</span><span class="p">)</span>

    <span class="n">rows_goes</span> <span class="o">=</span> <span class="n">parallel_index</span><span class="p">[</span><span class="n">index_row</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">index_column</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">columns_goes</span> <span class="o">=</span> <span class="n">parallel_index</span><span class="p">[</span><span class="n">index_row</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">index_column</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]][</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">rows_goes</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">columns_goes</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="n">pixels_from_center</span> <span class="o">=</span> <span class="p">(</span><span class="n">goes_image_size</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
    <span class="n">mean_row</span> <span class="o">=</span> <span class="n">rows_goes</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">min_row</span> <span class="o">=</span> <span class="n">mean_row</span> <span class="o">-</span> <span class="n">pixels_from_center</span>
    <span class="n">max_row</span> <span class="o">=</span> <span class="n">mean_row</span> <span class="o">+</span> <span class="n">pixels_from_center</span>

    <span class="n">mean_col</span> <span class="o">=</span> <span class="n">columns_goes</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">min_col</span> <span class="o">=</span> <span class="n">mean_col</span> <span class="o">-</span> <span class="n">pixels_from_center</span>
    <span class="n">max_col</span> <span class="o">=</span> <span class="n">mean_col</span> <span class="o">+</span> <span class="n">pixels_from_center</span>

    <span class="k">if</span> <span class="s2">&quot;CMI&quot;</span> <span class="ow">in</span> <span class="n">ds</span><span class="p">:</span> <span class="c1"># If using GOES-16 L2 processed data</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">CMI</span><span class="p">[</span><span class="n">min_row</span><span class="p">:</span><span class="n">max_row</span><span class="p">,</span> <span class="n">min_col</span><span class="p">:</span><span class="n">max_col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

    <span class="k">elif</span> <span class="s2">&quot;Rad&quot;</span> <span class="ow">in</span> <span class="n">ds</span><span class="p">:</span> <span class="c1">#If using GOES-16 L1b data</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">Rad</span><span class="p">[</span><span class="n">min_row</span><span class="p">:</span><span class="n">max_row</span><span class="p">,</span> <span class="n">min_col</span><span class="p">:</span><span class="n">max_col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

    <span class="c1"># debug</span>
    <span class="c1"># print(min_row,&#39;= min_row&#39;, max_row,&#39;= max_row&#39;, min_col, &#39;= min_col&#39;, max_col, &#39;= max_col&#39;)</span>
    <span class="n">target_size</span> <span class="o">=</span> <span class="p">(</span><span class="n">goes_image_size</span><span class="p">,</span> <span class="n">goes_image_size</span><span class="p">)</span>

    <span class="n">padded_image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span>
        <span class="n">image</span><span class="p">,</span>
        <span class="p">(</span>
            <span class="p">(</span>
                <span class="p">(</span><span class="n">target_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span>
                <span class="p">(</span><span class="n">target_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="p">(</span>
                <span class="p">(</span><span class="n">target_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span>
                <span class="p">(</span><span class="n">target_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">),</span>
        <span class="n">constant_values</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">padded_image</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">padded_image</span><span class="p">,</span> <span class="n">dims</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">padded_image</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.main_func.get_indices" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_indices</span><span class="p">(</span><span class="n">lat_grid</span><span class="p">,</span> <span class="n">lon_grid</span><span class="p">,</span> <span class="n">Goeslat</span><span class="p">,</span> <span class="n">Goeslon</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mf">0.125</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Finds the corresponding GOES row and column indices for each scatterometer point
using a BallTree for efficiency, and then filtering points to form a square bounding box.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>lat_grid</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>2D array of latitudes from the scatterometer data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lon_grid</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>2D array of longitudes from the scatterometer data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>Goeslat</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>2D array of latitudes from the GOES data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>Goeslon</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>2D array of longitudes from the GOES data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>radius</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Radius in degrees to define the bounding box around each scatterometer point.</p>
              </div>
            </td>
            <td>
                  <code>0.125</code>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Returns:
    indices_array (numpy.ndarray): 2D array of tuples, where each tuple contains the row and column indices of the corresponding GOES pixel for each scatterometer point.</p>


            <details class="quote">
              <summary>Source code in <code>windscangeo\func.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_indices</span><span class="p">(</span><span class="n">lat_grid</span><span class="p">,</span> <span class="n">lon_grid</span><span class="p">,</span> <span class="n">Goeslat</span><span class="p">,</span> <span class="n">Goeslon</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mf">0.125</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Finds the corresponding GOES row and column indices for each scatterometer point</span>
<span class="sd">    using a BallTree for efficiency, and then filtering points to form a square bounding box.</span>

<span class="sd">    Args:</span>
<span class="sd">        lat_grid (numpy.ndarray): 2D array of latitudes from the scatterometer data.</span>
<span class="sd">        lon_grid (numpy.ndarray): 2D array of longitudes from the scatterometer data.</span>
<span class="sd">        Goeslat (numpy.ndarray): 2D array of latitudes from the GOES data.</span>
<span class="sd">        Goeslon (numpy.ndarray): 2D array of longitudes from the GOES data.</span>
<span class="sd">        radius (float): Radius in degrees to define the bounding box around each scatterometer point.</span>
<span class="sd">    Returns:</span>
<span class="sd">        indices_array (numpy.ndarray): 2D array of tuples, where each tuple contains the row and column indices of the corresponding GOES pixel for each scatterometer point.</span>


<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;INFO : Calculating indices&quot;</span><span class="p">)</span>
    <span class="c1"># Flatten GOES data</span>
    <span class="n">Goeslat_flat</span> <span class="o">=</span> <span class="n">Goeslat</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">Goeslon_flat</span> <span class="o">=</span> <span class="n">Goeslon</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">goes_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">Goeslat_flat</span><span class="p">,</span> <span class="n">Goeslon_flat</span><span class="p">))</span>

    <span class="c1"># Build BallTree with haversine distance</span>
    <span class="n">goes_points_rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">goes_points</span><span class="p">)</span>
    <span class="n">goes_tree</span> <span class="o">=</span> <span class="n">BallTree</span><span class="p">(</span><span class="n">goes_points_rad</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s2">&quot;haversine&quot;</span><span class="p">)</span>

    <span class="c1"># Flatten scatter grids</span>
    <span class="n">lat_flat</span> <span class="o">=</span> <span class="n">lat_grid</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">lon_flat</span> <span class="o">=</span> <span class="n">lon_grid</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">scatter_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">lat_flat</span><span class="p">,</span> <span class="n">lon_flat</span><span class="p">))</span>
    <span class="n">scatter_points_rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">scatter_points</span><span class="p">)</span>

    <span class="c1"># Radius for broad-phase query: diagonal of the bounding box</span>
    <span class="c1"># Square box radius: diagonal = radius * sqrt(2)</span>
    <span class="n">diag_radius</span> <span class="o">=</span> <span class="n">radius</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">diag_radius_rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">diag_radius</span><span class="p">)</span>

    <span class="n">indices_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">lat_flat</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>
    <span class="n">goes_shape</span> <span class="o">=</span> <span class="n">Goeslat</span><span class="o">.</span><span class="n">shape</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">lat_val</span><span class="p">,</span> <span class="n">lon_val</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">lat_flat</span><span class="p">,</span> <span class="n">lon_flat</span><span class="p">)):</span>
        <span class="c1"># Broad-phase: query all points within diagonal distance</span>
        <span class="n">candidate_indices</span> <span class="o">=</span> <span class="n">goes_tree</span><span class="o">.</span><span class="n">query_radius</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">scatter_points_rad</span><span class="p">[</span><span class="n">i</span><span class="p">]]),</span> <span class="n">r</span><span class="o">=</span><span class="n">diag_radius_rad</span>
        <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">candidate_indices</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># No points found, store empty</span>
            <span class="n">indices_array</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">))</span>
            <span class="k">continue</span>

        <span class="c1"># Post-filter candidates to keep only those in the bounding box</span>
        <span class="n">lat_min</span> <span class="o">=</span> <span class="n">lat_val</span> <span class="o">-</span> <span class="n">radius</span>
        <span class="n">lat_max</span> <span class="o">=</span> <span class="n">lat_val</span> <span class="o">+</span> <span class="n">radius</span>
        <span class="n">lon_min</span> <span class="o">=</span> <span class="n">lon_val</span> <span class="o">-</span> <span class="n">radius</span>
        <span class="n">lon_max</span> <span class="o">=</span> <span class="n">lon_val</span> <span class="o">+</span> <span class="n">radius</span>

        <span class="n">cand_lats</span> <span class="o">=</span> <span class="n">Goeslat_flat</span><span class="p">[</span><span class="n">candidate_indices</span><span class="p">]</span>
        <span class="n">cand_lons</span> <span class="o">=</span> <span class="n">Goeslon_flat</span><span class="p">[</span><span class="n">candidate_indices</span><span class="p">]</span>

        <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">cand_lats</span> <span class="o">&gt;=</span> <span class="n">lat_min</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">cand_lats</span> <span class="o">&lt;=</span> <span class="n">lat_max</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">cand_lons</span> <span class="o">&gt;=</span> <span class="n">lon_min</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">cand_lons</span> <span class="o">&lt;=</span> <span class="n">lon_max</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="n">final_indices</span> <span class="o">=</span> <span class="n">candidate_indices</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>

        <span class="c1"># Convert these flat indices back to row,col</span>
        <span class="n">rows</span><span class="p">,</span> <span class="n">cols</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unravel_index</span><span class="p">(</span><span class="n">final_indices</span><span class="p">,</span> <span class="n">goes_shape</span><span class="p">)</span>
        <span class="n">indices_array</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">)</span>

    <span class="c1"># Reshape indices_array to the original shape</span>
    <span class="n">indices_array</span> <span class="o">=</span> <span class="n">indices_array</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">lat_grid</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">indices_array</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.main_func.get_mlp" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_mlp</span><span class="p">(</span><span class="n">in_features</span><span class="p">,</span> <span class="n">hidden_units</span><span class="p">,</span> <span class="n">out_features</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Returns a MLP head</p>
<p>taken from https://www.kaggle.com/code/umongsain/vision-transformer-from-scratch-pytorch</p>


            <details class="quote">
              <summary>Source code in <code>windscangeo\Models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_mlp</span><span class="p">(</span><span class="n">in_features</span><span class="p">,</span> <span class="n">hidden_units</span><span class="p">,</span> <span class="n">out_features</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a MLP head</span>

<span class="sd">    taken from https://www.kaggle.com/code/umongsain/vision-transformer-from-scratch-pytorch</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dims</span> <span class="o">=</span> <span class="p">[</span><span class="n">in_features</span><span class="p">]</span> <span class="o">+</span> <span class="n">hidden_units</span> <span class="o">+</span> <span class="p">[</span><span class="n">out_features</span><span class="p">]</span>
    <span class="n">layers</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">dim1</span><span class="p">,</span> <span class="n">dim2</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">dims</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="n">dims</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">dim1</span><span class="p">,</span> <span class="n">dim2</span><span class="p">))</span>
        <span class="n">layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">())</span>
    <span class="n">layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">dims</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="n">dims</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
    <span class="k">return</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span><span class="o">*</span><span class="n">layers</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.main_func.goes_index" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">goes_index</span><span class="p">(</span><span class="n">parallel_index</span><span class="p">,</span> <span class="n">lat_grd</span><span class="p">,</span> <span class="n">lon_grd</span><span class="p">,</span> <span class="n">lat_search</span><span class="p">,</span> <span class="n">lon_search</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>This function retrieves the indices of the GOES image corresponding to a given latitude and longitude. This is an archived function. Current implementation decides on extent based on chosen image size.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>parallel_index</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The precomputed indices for GOES pixels corresponding to scatterometer lat/lon.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lat_grd</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The latitude grid of the scatterometer data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lon_grd</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The longitude grid of the scatterometer data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lat_search</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The latitude to search for in the GOES data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lon_search</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The longitude to search for in the GOES data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>min_row</code></td>            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The minimum row index of the GOES image.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>max_row</code></td>            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The maximum row index of the GOES image.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>min_col</code></td>            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The minimum column index of the GOES image.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>max_col</code></td>            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The maximum column index of the GOES image.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\func.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">goes_index</span><span class="p">(</span><span class="n">parallel_index</span><span class="p">,</span> <span class="n">lat_grd</span><span class="p">,</span> <span class="n">lon_grd</span><span class="p">,</span> <span class="n">lat_search</span><span class="p">,</span> <span class="n">lon_search</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function retrieves the indices of the GOES image corresponding to a given latitude and longitude. This is an archived function. Current implementation decides on extent based on chosen image size.</span>

<span class="sd">    Args:</span>
<span class="sd">        parallel_index (numpy.ndarray): The precomputed indices for GOES pixels corresponding to scatterometer lat/lon.</span>
<span class="sd">        lat_grd (numpy.ndarray): The latitude grid of the scatterometer data.</span>
<span class="sd">        lon_grd (numpy.ndarray): The longitude grid of the scatterometer data.</span>
<span class="sd">        lat_search (float): The latitude to search for in the GOES data.</span>
<span class="sd">        lon_search (float): The longitude to search for in the GOES data.</span>

<span class="sd">    Returns:</span>
<span class="sd">        min_row (int): The minimum row index of the GOES image.</span>
<span class="sd">        max_row (int): The maximum row index of the GOES image.</span>
<span class="sd">        min_col (int): The minimum column index of the GOES image.</span>
<span class="sd">        max_col (int): The maximum column index of the GOES image.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">index_row</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">lat_grd</span> <span class="o">==</span> <span class="n">lat_search</span><span class="p">)</span>
    <span class="n">index_column</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">lon_grd</span> <span class="o">==</span> <span class="n">lon_search</span><span class="p">)</span>

    <span class="n">rows_goes</span> <span class="o">=</span> <span class="n">parallel_index</span><span class="p">[</span><span class="n">index_row</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">index_column</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">columns_goes</span> <span class="o">=</span> <span class="n">parallel_index</span><span class="p">[</span><span class="n">index_row</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">index_column</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]][</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">rows_goes</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">columns_goes</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="n">min_row</span> <span class="o">=</span> <span class="n">rows_goes</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">max_row</span> <span class="o">=</span> <span class="n">rows_goes</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

    <span class="n">min_col</span> <span class="o">=</span> <span class="n">columns_goes</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">max_col</span> <span class="o">=</span> <span class="n">columns_goes</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">min_row</span><span class="p">,</span> <span class="n">max_row</span><span class="p">,</span> <span class="n">min_col</span><span class="p">,</span> <span class="n">max_col</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.main_func.index_parallel" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">index_parallel</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">ScatterDataset</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Finds the corresponding GOES row and column indices for the entire scatterometer dataset.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>ScatterDataset</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>xarray Dataset containing scatterometer data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>scatter_name</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name for the output file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>output_path</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to save the output file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>parallel_indice_values</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>2D array of tuples containing GOES row and column indices corresponding to scatterometer data.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\func.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">index_parallel</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">ScatterDataset</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Finds the corresponding GOES row and column indices for the entire scatterometer dataset.</span>

<span class="sd">    Args:</span>
<span class="sd">        ScatterDataset: xarray Dataset containing scatterometer data.</span>
<span class="sd">        scatter_name: Name for the output file.</span>
<span class="sd">        output_path: Path to save the output file.</span>

<span class="sd">    Returns:</span>
<span class="sd">        parallel_indice_values: 2D array of tuples containing GOES row and column indices corresponding to scatterometer data.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">create_folder</span><span class="p">(</span><span class="s2">&quot;satellite_indices&quot;</span><span class="p">)</span>
    <span class="n">ds_spatial_resolution</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">spatial_resolution</span>
    <span class="n">ds_spatial_resolution</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>

    <span class="n">name_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;lat_</span><span class="si">{</span><span class="n">ScatterDataset</span><span class="o">.</span><span class="n">latitude</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">ScatterDataset</span><span class="o">.</span><span class="n">latitude</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="si">}</span><span class="s2">_lon_</span><span class="si">{</span><span class="n">ScatterDataset</span><span class="o">.</span><span class="n">longitude</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">ScatterDataset</span><span class="o">.</span><span class="n">longitude</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="si">}</span><span class="s2">_res_</span><span class="si">{</span><span class="n">ds_spatial_resolution</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">name_str</span> <span class="o">=</span> <span class="n">name_str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;./satellite_indices/</span><span class="si">{</span><span class="n">ds_spatial_resolution</span><span class="si">}</span><span class="s2">_index.npy&quot;</span>
    <span class="p">):</span>
        <span class="n">parallel_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;./satellite_indices/</span><span class="si">{</span><span class="n">ds_spatial_resolution</span><span class="si">}</span><span class="s2">_index.npy&quot;</span><span class="p">,</span>
            <span class="n">allow_pickle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">parallel_index</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;INFO : Satellite index file not found, creating new index file. This might take a while.&quot;</span>
        <span class="p">)</span>

        <span class="c1"># Extract scatterometer latitudes and longitudes</span>
        <span class="n">Latitudes_Scatter</span> <span class="o">=</span> <span class="n">ScatterDataset</span><span class="p">[</span><span class="s2">&quot;latitude&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">Longitudes_Scatter</span> <span class="o">=</span> <span class="n">ScatterDataset</span><span class="p">[</span><span class="s2">&quot;longitude&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

        <span class="c1"># Create a meshgrid of scatterometer coordinates</span>
        <span class="n">lon_grid</span><span class="p">,</span> <span class="n">lat_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">Longitudes_Scatter</span><span class="p">,</span> <span class="n">Latitudes_Scatter</span><span class="p">)</span>

        <span class="c1"># Extract GOES latitudes and longitudes</span>
        <span class="n">Goeslat</span><span class="p">,</span> <span class="n">Goeslon</span> <span class="o">=</span> <span class="n">calculate_degrees</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>
        <span class="n">Goeslat</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">Goeslat</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">999</span>
        <span class="n">Goeslon</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">Goeslon</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">999</span>
        <span class="c1"># Use the optimized get_indices function</span>
        <span class="n">parallel_indice_values</span> <span class="o">=</span> <span class="n">get_indices</span><span class="p">(</span><span class="n">lat_grid</span><span class="p">,</span> <span class="n">lon_grid</span><span class="p">,</span> <span class="n">Goeslat</span><span class="p">,</span> <span class="n">Goeslon</span><span class="p">)</span>

        <span class="c1"># Save the indices array</span>
        <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;./satellite_indices/</span><span class="si">{</span><span class="n">ds_spatial_resolution</span><span class="si">}</span><span class="s2">_index.npy&quot;</span><span class="p">,</span>
            <span class="n">parallel_indice_values</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">parallel_indice_values</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.main_func.inference_full_goes_image" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">inference_full_goes_image</span><span class="p">(</span><span class="n">datetime</span><span class="p">,</span> <span class="n">scatterometer_data_path</span><span class="p">,</span> <span class="n">result_path_folder</span><span class="p">,</span> <span class="n">model_parameters</span><span class="p">,</span> <span class="n">buoy_path</span><span class="p">,</span> <span class="n">normalization_factors</span><span class="p">,</span> <span class="n">goes_aws_url_folder</span><span class="o">=</span><span class="s1">&#39;noaa-goes16/ABI-L2-CMIPF&#39;</span><span class="p">,</span> <span class="n">goes_channel</span><span class="o">=</span><span class="s1">&#39;C01&#39;</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Runs the inference on a full GOES image for a given datetime using the pre-trained model from the function <code>train_test_model</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>datetime</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Date and time in 'YYYY-MM-DD HH:MM:SS'</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>scatterometer_data_path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the pre-downloaded scatterometer data. Must be the same used in for extracting the matching orbits.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>result_path_folder</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the folder where the results of the model training are</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>model_parameters</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary containing model parameters such as batch size, image size, learning rate, etc. Must be identical as those used in <code>train_test_model</code>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>buoy_path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the buoy data folder. Must be a folder containing the buoy data in <code>.nc</code> format. More details about how to download the buoy data can be found in the tutorial.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>normalization_factors</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary containing normalization factors (mean and std) for the images dataset.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>goes_aws_url_folder</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>AWS URL folder for the GOES data, default is "noaa-goes16/ABI-L2-CMIPF". Must be the same as used in the matching orbits extraction.</p>
              </div>
            </td>
            <td>
                  <code>&#39;noaa-goes16/ABI-L2-CMIPF&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>goes_channel</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>GOES channel to extract, default is "C01" (visible).</p>
              </div>
            </td>
            <td>
                  <code>&#39;C01&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None, but saves the inference results in a folder named <code>inference_&lt;datetime&gt;</code> in the <code>result_path_folder</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\main_func.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">inference_full_goes_image</span><span class="p">(</span>
    <span class="n">datetime</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">scatterometer_data_path</span> <span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">result_path_folder</span> <span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">model_parameters</span> <span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="n">buoy_path</span> <span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">normalization_factors</span> <span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="n">goes_aws_url_folder</span> <span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;noaa-goes16/ABI-L2-CMIPF&quot;</span><span class="p">,</span>
    <span class="n">goes_channel</span> <span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;C01&#39;</span><span class="p">,</span>
<span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot; Runs the inference on a full GOES image for a given datetime using the pre-trained model from the function `train_test_model`.</span>

<span class="sd">    Args:</span>
<span class="sd">            datetime (str): Date and time in &#39;YYYY-MM-DD HH:MM:SS&#39;</span>
<span class="sd">            scatterometer_data_path (str): Path to the pre-downloaded scatterometer data. Must be the same used in for extracting the matching orbits.</span>
<span class="sd">            result_path_folder (str): Path to the folder where the results of the model training are</span>
<span class="sd">            model_parameters (dict): Dictionary containing model parameters such as batch size, image size, learning rate, etc. Must be identical as those used in `train_test_model`.</span>
<span class="sd">            buoy_path (str): Path to the buoy data folder. Must be a folder containing the buoy data in `.nc` format. More details about how to download the buoy data can be found in the tutorial.</span>
<span class="sd">            normalization_factors (dict): Dictionary containing normalization factors (mean and std) for the images dataset.</span>
<span class="sd">            goes_aws_url_folder (str): AWS URL folder for the GOES data, default is &quot;noaa-goes16/ABI-L2-CMIPF&quot;. Must be the same as used in the matching orbits extraction.</span>
<span class="sd">            goes_channel (str): GOES channel to extract, default is &quot;C01&quot; (visible).</span>

<span class="sd">    Returns:</span>
<span class="sd">            None, but saves the inference results in a folder named `inference_&lt;datetime&gt;` in the `result_path_folder`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Getting polar data from the scatterometer data path</span>
    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">scatterometer_data_path</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.nc&quot;</span><span class="p">):</span>
            <span class="n">polar_data</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">scatterometer_data_path</span><span class="p">,</span> <span class="n">file</span><span class="p">),</span>
                <span class="n">engine</span><span class="o">=</span><span class="s2">&quot;h5netcdf&quot;</span><span class="p">,</span>
                <span class="n">drop_variables</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;DQF&quot;</span><span class="p">],</span>
            <span class="p">)</span>
            <span class="k">break</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;WARNING : No .nc file found in the scatterometer data path, please check the path&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">goes_channel</span> <span class="o">==</span> <span class="s1">&#39;C01&#39;</span> <span class="ow">or</span> <span class="n">goes_channel</span> <span class="o">==</span> <span class="s1">&#39;C03&#39;</span> <span class="ow">or</span> <span class="n">goes_channel</span> <span class="o">==</span> <span class="s1">&#39;C05&#39;</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="s1">&#39;./satellite_indices/&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.npy&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;1km&quot;</span> <span class="ow">in</span> <span class="n">file</span><span class="p">:</span>
                    <span class="n">parallel_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;./satellite_indices/&#39;</span><span class="p">,</span> <span class="n">file</span><span class="p">),</span> <span class="n">allow_pickle</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>
                    <span class="k">break</span>
    <span class="k">elif</span> <span class="n">goes_channel</span> <span class="o">==</span> <span class="s1">&#39;C02&#39;</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="s1">&#39;./satellite_indices/&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.npy&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;0.5km&quot;</span> <span class="ow">in</span> <span class="n">file</span><span class="p">:</span>
                    <span class="n">parallel_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;./satellite_indices/&#39;</span><span class="p">,</span> <span class="n">file</span><span class="p">),</span> <span class="n">allow_pickle</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>
                    <span class="k">break</span>
    <span class="k">else</span> <span class="p">:</span>
        <span class="n">parallel_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;./satellite_indices/2km at nadir_index.npy&#39;</span><span class="p">,</span> <span class="n">allow_pickle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">datetime</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">datetime</span><span class="p">)</span>


    <span class="n">images</span><span class="p">,</span> <span class="n">valid_lats</span><span class="p">,</span> <span class="n">valid_lons</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">extract_goes_production</span><span class="p">(</span><span class="n">datetime</span><span class="p">,</span><span class="n">polar_data</span><span class="p">,</span><span class="n">parallel_index</span><span class="p">,</span><span class="n">goes_channel</span><span class="p">,</span><span class="n">goes_aws_url_folder</span><span class="p">)</span>
    <span class="n">lat_inference</span><span class="p">,</span> <span class="n">lon_inference</span><span class="p">,</span> <span class="n">wind_speeds_inference</span> <span class="o">=</span> <span class="n">inference_whole_image</span><span class="p">(</span><span class="n">result_path_folder</span><span class="p">,</span><span class="n">images</span><span class="p">,</span><span class="n">valid_lats</span><span class="p">,</span><span class="n">valid_lons</span><span class="p">,</span><span class="n">model_parameters</span><span class="p">,</span><span class="n">normalization_factors</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">buoy_lat</span><span class="p">,</span><span class="n">buoy_lon</span><span class="p">,</span><span class="n">buoy_time</span><span class="p">,</span><span class="n">buoy_wind_speed</span><span class="p">,</span><span class="n">buoy_name</span> <span class="o">=</span> <span class="n">buoy_data_extract</span><span class="p">(</span><span class="n">buoy_path</span><span class="p">,</span><span class="n">polar_data</span><span class="p">,</span><span class="n">datetime</span><span class="p">)</span>

    <span class="n">safe_file_name</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">_%H-%M-%S&#39;</span><span class="p">)</span>
    <span class="n">path_inference</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">result_path_folder</span><span class="si">}</span><span class="s1">/inference_</span><span class="si">{</span><span class="n">safe_file_name</span><span class="si">}</span><span class="s1">/&#39;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path_inference</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">path_inference</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;INFO : Folder of inference created:&#39;</span><span class="p">,</span> <span class="n">path_inference</span><span class="p">)</span>

    <span class="n">goes_image</span> <span class="o">=</span> <span class="n">plot_goes_image</span><span class="p">(</span><span class="n">lat_inference</span><span class="p">,</span><span class="n">lon_inference</span><span class="p">,</span><span class="n">images</span><span class="p">,</span><span class="n">path_inference</span><span class="p">,</span><span class="n">buoy_name</span><span class="p">,</span><span class="n">buoy_lat</span><span class="p">,</span><span class="n">buoy_lon</span><span class="p">,</span><span class="n">datetime</span><span class="p">)</span>
    <span class="n">plot_wind_speeds</span><span class="p">(</span><span class="n">lat_inference</span><span class="p">,</span><span class="n">lon_inference</span><span class="p">,</span><span class="n">wind_speeds_inference</span><span class="p">,</span><span class="n">path_inference</span><span class="p">,</span><span class="n">buoy_name</span><span class="p">,</span><span class="n">buoy_lat</span><span class="p">,</span><span class="n">buoy_lon</span><span class="p">,</span><span class="n">datetime</span><span class="p">)</span>

    <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">path_inference</span><span class="si">}</span><span class="s1">/data_goes_image.npy&#39;</span><span class="p">,</span><span class="n">goes_image</span><span class="p">)</span>
    <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">path_inference</span><span class="si">}</span><span class="s1">/data_wind_speeds.npy&#39;</span><span class="p">,</span><span class="n">wind_speeds_inference</span><span class="p">)</span>
    <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">path_inference</span><span class="si">}</span><span class="s1">/data_lat.npy&#39;</span><span class="p">,</span><span class="n">lat_inference</span><span class="p">)</span>
    <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">path_inference</span><span class="si">}</span><span class="s1">/data_lon.npy&#39;</span><span class="p">,</span><span class="n">lon_inference</span><span class="p">)</span>

    <span class="n">reshaped_images</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="p">(</span><span class="mi">160</span><span class="p">,</span><span class="mi">340</span><span class="p">,</span><span class="mi">128</span><span class="p">,</span><span class="mi">128</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">buoy_wind_speed</span><span class="p">)):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">lat_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">lat_inference</span> <span class="o">==</span> <span class="n">buoy_lat</span><span class="p">[</span><span class="n">i</span><span class="p">])[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">lon_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">lon_inference</span> <span class="o">==</span> <span class="n">buoy_lon</span><span class="p">[</span><span class="n">i</span><span class="p">])[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

            <span class="n">buoy_image</span> <span class="o">=</span>  <span class="n">reshaped_images</span><span class="p">[</span><span class="n">lat_index</span><span class="p">,</span><span class="n">lon_index</span><span class="p">]</span>
            <span class="n">threshold</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">buoy_image</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.6</span>
            <span class="n">cloud_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">buoy_image</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">percentage_cloud</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">cloud_mask</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">cloud_mask</span><span class="p">)</span>

            <span class="n">wind_speeds_inference_buoy</span> <span class="o">=</span> <span class="n">wind_speeds_inference</span><span class="p">[</span><span class="n">lat_index</span><span class="p">,</span><span class="n">lon_index</span><span class="p">]</span>
            <span class="n">difference</span> <span class="o">=</span> <span class="n">wind_speeds_inference_buoy</span> <span class="o">-</span> <span class="n">buoy_wind_speed</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;EVAL : Buoy </span><span class="si">{</span><span class="n">buoy_name</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1"> - Inference Wind Speed : </span><span class="si">{</span><span class="n">wind_speeds_inference_buoy</span><span class="si">}</span><span class="s1"> - Buoy Wind Speed : </span><span class="si">{</span><span class="n">buoy_wind_speed</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1"> - Difference : </span><span class="si">{</span><span class="n">difference</span><span class="si">}</span><span class="s1">, Percentage Cloud : </span><span class="si">{</span><span class="n">percentage_cloud</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="n">update_buoy_comparison_csv</span><span class="p">(</span>
                <span class="n">result_path_folder</span><span class="p">,</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">buoy_name</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span>
                <span class="n">wind_speeds_inference_buoy</span><span class="p">,</span> <span class="n">buoy_wind_speed</span><span class="p">,</span> <span class="n">difference</span><span class="p">,</span> <span class="n">percentage_cloud</span>
            <span class="p">)</span>

        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;EVAL : Buoy </span><span class="si">{</span><span class="n">buoy_name</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1"> not in the inference area&#39;</span><span class="p">)</span>
            <span class="k">continue</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.main_func.inference_model" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">inference_model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">inference_loader</span><span class="p">,</span> <span class="n">device</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Perform inference on the model using the provided DataLoader and return the outputs. Same as train_model but for a fixed given model.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>model</code>
            </td>
            <td>
                  <code><span title="torch.nn.Module">Module</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The trained model to be used for inference.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>inference_loader</code>
            </td>
            <td>
                  <code><span title="torch.utils.data.DataLoader">DataLoader</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataLoader for the inference dataset.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>device</code>
            </td>
            <td>
                  <code><span title="torch.device">device</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Device to run the model on (CPU or GPU).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>inference_outputs</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Outputs from the model on the inference dataset.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\impl.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">inference_model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">inference_loader</span><span class="p">,</span> <span class="n">device</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Perform inference on the model using the provided DataLoader and return the outputs. Same as train_model but for a fixed given model.</span>

<span class="sd">    Args:</span>
<span class="sd">        model (torch.nn.Module): The trained model to be used for inference.</span>
<span class="sd">        inference_loader (torch.utils.data.DataLoader): DataLoader for the inference dataset.</span>
<span class="sd">        device (torch.device): Device to run the model on (CPU or GPU).</span>

<span class="sd">    Returns:</span>
<span class="sd">        inference_outputs (numpy.ndarray): Outputs from the model on the inference dataset.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>  <span class="c1"># Disable gradient calculation for inference</span>

        <span class="n">inference_outputs</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">images</span> <span class="ow">in</span> <span class="n">inference_loader</span><span class="p">:</span>
            <span class="n">images</span> <span class="o">=</span> <span class="n">images</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>

            <span class="n">outputs</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">images</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

            <span class="c1"># Append outputs to the list</span>
            <span class="n">inference_outputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">outputs</span><span class="p">)</span>

        <span class="n">inference_outputs</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">inference_outputs</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">inference_outputs</span> <span class="o">=</span> <span class="n">inference_outputs</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span>
        <span class="n">inference_outputs</span> <span class="o">=</span> <span class="n">inference_outputs</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">inference_outputs</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.main_func.inference_run" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">inference_run</span><span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="n">model_parameters</span><span class="p">,</span> <span class="n">model_path</span><span class="p">,</span> <span class="n">normalization_factors</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Runs inference on the provided images using the specified model parameters and normalization factors.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>images</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of images to be used for inference.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>model_parameters</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary containing model parameters such as batch size, image size, channels</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>model_path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the pre-trained model file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>normalization_factors</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary containing normalization factors such as mean and standard deviation.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>inference_output</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of inference outputs (wind speeds).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\func_inference.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">inference_run</span><span class="p">(</span>
    <span class="n">images</span><span class="p">,</span> <span class="n">model_parameters</span><span class="p">,</span> <span class="n">model_path</span><span class="p">,</span> <span class="n">normalization_factors</span>
<span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Runs inference on the provided images using the specified model parameters and normalization factors.</span>

<span class="sd">    Args:</span>
<span class="sd">        images (np.ndarray): Array of images to be used for inference.</span>
<span class="sd">        model_parameters (dict): Dictionary containing model parameters such as batch size, image size, channels</span>
<span class="sd">        model_path (str): Path to the pre-trained model file.</span>
<span class="sd">        normalization_factors (dict): Dictionary containing normalization factors such as mean and standard deviation.</span>

<span class="sd">    Returns:</span>
<span class="sd">        inference_output (np.ndarray): Array of inference outputs (wind speeds).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">device</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s2">&quot;cuda&quot;</span> <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">()</span> <span class="k">else</span> <span class="s2">&quot;cpu&quot;</span><span class="p">)</span>

    <span class="n">batch_size</span> <span class="o">=</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s2">&quot;batch_size&quot;</span><span class="p">]</span>
    <span class="n">image_height</span> <span class="o">=</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s2">&quot;image_size&quot;</span><span class="p">]</span>
    <span class="n">image_width</span> <span class="o">=</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s2">&quot;image_size&quot;</span><span class="p">]</span>
    <span class="n">in_channels</span> <span class="o">=</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s2">&quot;image_channels&quot;</span><span class="p">]</span>
    <span class="n">dropout_rate</span> <span class="o">=</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s2">&quot;dropout_rate&quot;</span><span class="p">]</span>
    <span class="n">model_choice</span> <span class="o">=</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s2">&quot;model_choice&quot;</span><span class="p">]</span>

    <span class="n">mean</span> <span class="o">=</span> <span class="n">normalization_factors</span><span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">]</span>
    <span class="n">std</span> <span class="o">=</span> <span class="n">normalization_factors</span><span class="p">[</span><span class="s2">&quot;std&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">model_choice</span> <span class="o">==</span> <span class="s1">&#39;CNN&#39;</span><span class="p">:</span>

        <span class="n">features_cnn</span> <span class="o">=</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s2">&quot;features_cnn&quot;</span><span class="p">]</span>
        <span class="n">kernel_size</span> <span class="o">=</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s2">&quot;kernel_size&quot;</span><span class="p">]</span>
        <span class="n">activation_cnn</span> <span class="o">=</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s2">&quot;activation_cnn&quot;</span><span class="p">]</span>
        <span class="n">activation_final</span> <span class="o">=</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s2">&quot;activation_final&quot;</span><span class="p">]</span>
        <span class="n">stride</span> <span class="o">=</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s2">&quot;stride&quot;</span><span class="p">]</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;model choice is CNN&quot;</span><span class="p">)</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">ConventionalCNN</span><span class="p">(</span>
            <span class="n">image_height</span><span class="p">,</span>
            <span class="n">image_width</span><span class="p">,</span>
            <span class="n">features_cnn</span><span class="p">,</span>
            <span class="n">kernel_size</span><span class="p">,</span>
            <span class="n">in_channels</span><span class="p">,</span>
            <span class="n">activation_cnn</span><span class="p">,</span>
            <span class="n">activation_final</span><span class="p">,</span>
            <span class="n">stride</span><span class="p">,</span>
            <span class="n">dropout_rate</span>
        <span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">model_choice</span> <span class="o">==</span> <span class="s1">&#39;ViT&#39;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;model choice is ViT&#39;</span><span class="p">)</span>
        <span class="c1"># Load the model</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">ViT</span><span class="p">(</span>
            <span class="n">img_size</span> <span class="o">=</span> <span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">),</span>
            <span class="n">patch_size</span> <span class="o">=</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">),</span>
            <span class="n">n_channels</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">d_model</span> <span class="o">=</span> <span class="mi">1024</span><span class="p">,</span>
            <span class="n">nhead</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
            <span class="n">dim_feedforward</span> <span class="o">=</span> <span class="mi">2048</span><span class="p">,</span>
            <span class="n">blocks</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span>
            <span class="n">mlp_head_units</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1024</span><span class="p">,</span> <span class="mi">512</span><span class="p">],</span>
            <span class="n">n_classes</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">model_choice</span> <span class="o">==</span> <span class="s1">&#39;ResNet&#39;</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">ResNet50</span><span class="p">(</span><span class="n">num_classes</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">channels</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>



    <span class="n">model</span><span class="o">.</span><span class="n">load_state_dict</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">model_path</span><span class="p">,</span> <span class="n">map_location</span><span class="o">=</span><span class="n">device</span><span class="p">))</span>
    <span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>

    <span class="n">inference_dataset</span> <span class="o">=</span> <span class="n">conventional_dataset_inference</span><span class="p">(</span>
        <span class="n">images</span><span class="p">,</span>
        <span class="n">transform</span><span class="o">=</span><span class="n">Normalize</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span><span class="n">std</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="n">inference_loader</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span><span class="n">inference_dataset</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">inference_output</span> <span class="o">=</span> <span class="n">inference_model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">inference_loader</span><span class="p">,</span> <span class="n">device</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">inference_output</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.main_func.manage_saved_models" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">manage_saved_models</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Manage saved model files in the specified directory by deleting older epoch files.
Keeps only the latest epoch file and deletes all others. From @ Jing Sun</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>directory</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The directory where model files are saved.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\impl.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">manage_saved_models</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>  <span class="c1"># From @Jing</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Manage saved model files in the specified directory by deleting older epoch files.</span>
<span class="sd">    Keeps only the latest epoch file and deletes all others. From @ Jing Sun</span>

<span class="sd">    Args:</span>
<span class="sd">        directory (str): The directory where model files are saved.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;epoch_(\d+)\.pth&quot;</span><span class="p">)</span>
    <span class="n">epoch_files</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                <span class="n">epoch_num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
                <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
                <span class="n">epoch_files</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">file_path</span><span class="p">,</span> <span class="n">epoch_num</span><span class="p">))</span>

    <span class="c1"># Check if there are more than 5 files</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">epoch_files</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">epoch_files</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">files_to_delete</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">epoch_files</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">files_to_delete</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">epoch_files</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.main_func.package_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">package_data</span><span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="n">numerical_data</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">solar_conversion</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>This function packages the images and numerical data into a format that can be used for training a machine learning model.
The function will filter out invalid images and fill in any NaN values. (Invalid images = empty images from GOES data)
The function will also convert the observation times, latitudes and longitudes to solar angles (sza, saa) if solar_conversion is set to True.
The function will return the images and numerical data in a numpy array format.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>images</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The GOES images corresponding to the observation data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>numerical_data</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary containing the numerical data corresponding to the observation data. The keys should include "observation_lats", "observation_lons", "observation_times" and optionally "wind_speeds".</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>filter</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, the function will filter out invalid images and fill in Nan values. Default is True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>solar_conversion</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, the function will convert the observation times, latitudes and longitudes to solar angles (sza, saa). Default is False. (Not used in current implementation, but kept in case of future use)</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>verbose</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, the function will print progress information. Default is True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>images</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The GOES images corresponding to the observation data.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>numerical_data</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The numerical data corresponding to the observation data. (sza, saa, main_parameter if solar_conversion is set to True or lat, lon, time, wind_speeds if solar_conversion is set to False)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\func.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span>
<span class="normal">934</span>
<span class="normal">935</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">package_data</span><span class="p">(</span>
    <span class="n">images</span><span class="p">,</span>
    <span class="n">numerical_data</span><span class="p">,</span>
    <span class="nb">filter</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">solar_conversion</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function packages the images and numerical data into a format that can be used for training a machine learning model.</span>
<span class="sd">    The function will filter out invalid images and fill in any NaN values. (Invalid images = empty images from GOES data)</span>
<span class="sd">    The function will also convert the observation times, latitudes and longitudes to solar angles (sza, saa) if solar_conversion is set to True.</span>
<span class="sd">    The function will return the images and numerical data in a numpy array format.</span>

<span class="sd">    Args:</span>
<span class="sd">        images (numpy.ndarray): The GOES images corresponding to the observation data.</span>
<span class="sd">        numerical_data (dict): A dictionary containing the numerical data corresponding to the observation data. The keys should include &quot;observation_lats&quot;, &quot;observation_lons&quot;, &quot;observation_times&quot; and optionally &quot;wind_speeds&quot;.</span>
<span class="sd">        filter (bool): If True, the function will filter out invalid images and fill in Nan values. Default is True.</span>
<span class="sd">        solar_conversion (bool): If True, the function will convert the observation times, latitudes and longitudes to solar angles (sza, saa). Default is False. (Not used in current implementation, but kept in case of future use)</span>
<span class="sd">        verbose (bool): If True, the function will print progress information. Default is True.</span>

<span class="sd">    Returns:</span>
<span class="sd">        images (numpy.ndarray): The GOES images corresponding to the observation data.</span>
<span class="sd">        numerical_data (numpy.ndarray): The numerical data corresponding to the observation data. (sza, saa, main_parameter if solar_conversion is set to True or lat, lon, time, wind_speeds if solar_conversion is set to False)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">filter</span><span class="p">:</span>
        <span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="n">numerical_data</span><span class="p">)</span> <span class="o">=</span> <span class="n">filter_invalid</span><span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="n">numerical_data</span><span class="p">)</span>
        <span class="n">images</span> <span class="o">=</span> <span class="n">fill_nans</span><span class="p">(</span><span class="n">images</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">solar_conversion</span><span class="p">:</span>
        <span class="n">observation_lats</span> <span class="o">=</span> <span class="n">numerical_data</span><span class="p">[</span><span class="s2">&quot;observation_lats&quot;</span><span class="p">]</span>
        <span class="n">observation_lons</span> <span class="o">=</span> <span class="n">numerical_data</span><span class="p">[</span><span class="s2">&quot;observation_lons&quot;</span><span class="p">]</span>
        <span class="n">observation_times</span> <span class="o">=</span> <span class="n">numerical_data</span><span class="p">[</span><span class="s2">&quot;observation_times&quot;</span><span class="p">]</span>

        <span class="n">sza</span><span class="p">,</span> <span class="n">saa</span> <span class="o">=</span> <span class="n">vectorized_solar_angles</span><span class="p">(</span>
            <span class="n">observation_lats</span><span class="p">,</span> <span class="n">observation_lons</span><span class="p">,</span> <span class="n">observation_times</span>
        <span class="p">)</span>

        <span class="n">sza_rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">sza</span><span class="p">)</span>
        <span class="n">sza_sin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">sza_rad</span><span class="p">)</span>
        <span class="n">sza_cos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">sza_rad</span><span class="p">)</span>

        <span class="n">saa_rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">saa</span><span class="p">)</span>
        <span class="n">saa_sin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">saa_rad</span><span class="p">)</span>
        <span class="n">saa_cos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">saa_rad</span><span class="p">)</span>

        <span class="c1"># Add the solar angles to the numerical data dictionary</span>

        <span class="n">numerical_data</span><span class="p">[</span><span class="s2">&quot;sza_sin&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sza_sin</span>
        <span class="n">numerical_data</span><span class="p">[</span><span class="s2">&quot;sza_cos&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sza_cos</span>
        <span class="n">numerical_data</span><span class="p">[</span><span class="s2">&quot;saa_sin&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">saa_sin</span>
        <span class="n">numerical_data</span><span class="p">[</span><span class="s2">&quot;saa_cos&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">saa_cos</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Data Preparation : converted to solar angles (sza, saa)&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Data Preparation : returning images, numerical_data&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">images</span><span class="p">,</span> <span class="n">numerical_data</span>

    <span class="k">else</span><span class="p">:</span>

        <span class="k">return</span> <span class="n">images</span><span class="p">,</span> <span class="n">numerical_data</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.main_func.patchify" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">patchify</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">patch_size</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Patchify the batch of images</p>


<details class="shape" open>
  <summary>Shape</summary>
  <p>batch: (b, h, w, c)
output: (b, nh, nw, ph, pw, c)</p>
</details>        <p>taken from https://www.kaggle.com/code/umongsain/vision-transformer-from-scratch-pytorch</p>


            <details class="quote">
              <summary>Source code in <code>windscangeo\Models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">patchify</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">patch_size</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Patchify the batch of images</span>

<span class="sd">    Shape:</span>
<span class="sd">        batch: (b, h, w, c)</span>
<span class="sd">        output: (b, nh, nw, ph, pw, c)</span>

<span class="sd">    taken from https://www.kaggle.com/code/umongsain/vision-transformer-from-scratch-pytorch</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="n">batch</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">ph</span><span class="p">,</span> <span class="n">pw</span> <span class="o">=</span> <span class="n">patch_size</span>
    <span class="n">nh</span><span class="p">,</span> <span class="n">nw</span> <span class="o">=</span> <span class="n">h</span> <span class="o">//</span> <span class="n">ph</span><span class="p">,</span> <span class="n">w</span> <span class="o">//</span> <span class="n">pw</span>

    <span class="n">batch_patches</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">nh</span><span class="p">,</span> <span class="n">ph</span><span class="p">,</span> <span class="n">nw</span><span class="p">,</span> <span class="n">pw</span><span class="p">))</span>
    <span class="n">batch_patches</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="n">batch_patches</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">batch_patches</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.main_func.plot_cloud_cover" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plot_cloud_cover</span><span class="p">(</span><span class="n">lat_inference</span><span class="p">,</span> <span class="n">lon_inference</span><span class="p">,</span> <span class="n">images</span><span class="p">,</span> <span class="n">path_folder</span><span class="p">,</span> <span class="n">buoy_name</span><span class="p">,</span> <span class="n">buoy_lat</span><span class="p">,</span> <span class="n">buoy_lon</span><span class="p">,</span> <span class="n">time_choice</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Plot the cloud cover mask on a map with buoy locations. This works well with 30x30 images but larger images can diluted. Can be adapted to work with larger images.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>lat_inference</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Latitude values for the inference grid.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lon_inference</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Longitude values for the inference grid.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>images</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>GOES image data to be used for cloud cover calculation.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>path_folder</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to save the plot.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>buoy_name</code>
            </td>
            <td>
                  <code><span title="list">list</span> or <span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Names of the buoys.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>buoy_lat</code>
            </td>
            <td>
                  <code><span title="list">list</span> or <span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Latitude values of the buoys.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>buoy_lon</code>
            </td>
            <td>
                  <code><span title="list">list</span> or <span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Longitude values of the buoys.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>time_choice</code>
            </td>
            <td>
                  <code><span title="datetime">datetime</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Time of the inference.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\func_ml.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">plot_cloud_cover</span><span class="p">(</span><span class="n">lat_inference</span><span class="p">,</span><span class="n">lon_inference</span><span class="p">,</span><span class="n">images</span><span class="p">,</span><span class="n">path_folder</span><span class="p">,</span><span class="n">buoy_name</span><span class="p">,</span><span class="n">buoy_lat</span><span class="p">,</span><span class="n">buoy_lon</span><span class="p">,</span><span class="n">time_choice</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot the cloud cover mask on a map with buoy locations. This works well with 30x30 images but larger images can diluted. Can be adapted to work with larger images.</span>

<span class="sd">    Args:</span>
<span class="sd">        lat_inference (np.ndarray): Latitude values for the inference grid.</span>
<span class="sd">        lon_inference (np.ndarray): Longitude values for the inference grid.</span>
<span class="sd">        images (np.ndarray): GOES image data to be used for cloud cover calculation.</span>
<span class="sd">        path_folder (str): Path to save the plot.</span>
<span class="sd">        buoy_name (list or np.ndarray): Names of the buoys.</span>
<span class="sd">        buoy_lat (list or np.ndarray): Latitude values of the buoys.</span>
<span class="sd">        buoy_lon (list or np.ndarray): Longitude values of the buoys.</span>
<span class="sd">        time_choice (datetime): Time of the inference.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mean_images</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
    <span class="n">threshold</span> <span class="o">=</span> <span class="mf">0.11</span>
    <span class="n">cloud_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mean_images</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">cloud_mask</span> <span class="o">=</span> <span class="n">cloud_mask</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">160</span><span class="p">,</span><span class="mi">340</span><span class="p">)</span>

    <span class="n">plot_cloud_mask</span><span class="p">(</span><span class="n">lat_inference</span><span class="p">,</span><span class="n">lon_inference</span><span class="p">,</span><span class="n">cloud_mask</span><span class="p">,</span><span class="n">path_folder</span><span class="p">,</span><span class="n">buoy_name</span><span class="p">,</span><span class="n">buoy_lat</span><span class="p">,</span><span class="n">buoy_lon</span><span class="p">,</span><span class="n">time_choice</span><span class="p">)</span>

    <span class="n">percentage_cloud</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">cloud_mask</span><span class="p">)</span><span class="o">/</span><span class="n">cloud_mask</span><span class="o">.</span><span class="n">size</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Cloud coverage : &#39;</span><span class="p">,</span><span class="n">percentage_cloud</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span><span class="s1">&#39;%&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">cloud_mask</span><span class="p">,</span> <span class="n">percentage_cloud</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.main_func.plot_cloud_mask" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plot_cloud_mask</span><span class="p">(</span><span class="n">lat_inference</span><span class="p">,</span> <span class="n">lon_inference</span><span class="p">,</span> <span class="n">wind_speeds_inference</span><span class="p">,</span> <span class="n">path_folder</span><span class="p">,</span> <span class="n">buoy_name</span><span class="p">,</span> <span class="n">buoy_lat</span><span class="p">,</span> <span class="n">buoy_lon</span><span class="p">,</span> <span class="n">time_choice</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Plot the cloud mask on a map with buoy locations. This works well with 30x30 images but larger images can diluted. Can be adapted to work with larger images.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>lat_inference</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Latitude values for the inference grid.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lon_inference</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Longitude values for the inference grid.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>wind_speeds_inference</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Cloud mask data to be plotted.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>path_folder</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to save the plot.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>buoy_name</code>
            </td>
            <td>
                  <code><span title="list">list</span> or <span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Names of the buoys.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>buoy_lat</code>
            </td>
            <td>
                  <code><span title="list">list</span> or <span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Latitude values of the buoys.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>buoy_lon</code>
            </td>
            <td>
                  <code><span title="list">list</span> or <span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Longitude values of the buoys.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>time_choice</code>
            </td>
            <td>
                  <code><span title="datetime">datetime</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Time of the inference.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\func_ml.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">plot_cloud_mask</span><span class="p">(</span><span class="n">lat_inference</span><span class="p">,</span><span class="n">lon_inference</span><span class="p">,</span><span class="n">wind_speeds_inference</span><span class="p">,</span><span class="n">path_folder</span><span class="p">,</span><span class="n">buoy_name</span><span class="p">,</span><span class="n">buoy_lat</span><span class="p">,</span><span class="n">buoy_lon</span><span class="p">,</span><span class="n">time_choice</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot the cloud mask on a map with buoy locations. This works well with 30x30 images but larger images can diluted. Can be adapted to work with larger images.</span>

<span class="sd">    Args:</span>
<span class="sd">        lat_inference (np.ndarray): Latitude values for the inference grid.</span>
<span class="sd">        lon_inference (np.ndarray): Longitude values for the inference grid.</span>
<span class="sd">        wind_speeds_inference (np.ndarray): Cloud mask data to be plotted.</span>
<span class="sd">        path_folder (str): Path to save the plot.</span>
<span class="sd">        buoy_name (list or np.ndarray): Names of the buoys.</span>
<span class="sd">        buoy_lat (list or np.ndarray): Latitude values of the buoys.</span>
<span class="sd">        buoy_lon (list or np.ndarray): Longitude values of the buoys.</span>
<span class="sd">        time_choice (datetime): Time of the inference.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>

    <span class="c1"># Plot wind speed data (continuous colormap)</span>
    <span class="n">pcm</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span>
        <span class="n">lon_inference</span><span class="p">,</span> <span class="n">lat_inference</span><span class="p">,</span> <span class="n">wind_speeds_inference</span><span class="p">,</span>
        <span class="n">shading</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span>
        <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">)</span>

    <span class="c1"># Add colorbar</span>
    <span class="n">cbar</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">pcm</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;0 = Clear, 1 = Cloudy&#39;</span><span class="p">)</span>

    <span class="c1"># Add coastlines and land</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cfeature</span><span class="o">.</span><span class="n">LAND</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>  
    <span class="n">ax</span><span class="o">.</span><span class="n">coastlines</span><span class="p">(</span><span class="n">zorder</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>

    <span class="c1"># Flatten buoy_name if it&#39;s a list of arrays</span>
    <span class="n">buoy_name_flat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">buoy_name</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">unique_buoys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">buoy_name_flat</span><span class="p">))</span>

    <span class="c1"># Generate enough distinct colors for all buoys from the &quot;tab20&quot; palette</span>
    <span class="c1"># (tab20 provides 20 colors; if there are more than 20 unique buoys, colors will repeat)</span>
    <span class="n">color_map</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s2">&quot;tab20&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_buoys</span><span class="p">))</span>

    <span class="c1"># Plot each buoy in a single color</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">buoy_id</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">unique_buoys</span><span class="p">):</span>
        <span class="c1"># Pick a distinct color from tab20</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">color_map</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

        <span class="c1"># Identify the indices belonging to this buoy</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">buoy_name_flat</span><span class="p">)</span> <span class="o">==</span> <span class="n">buoy_id</span>

        <span class="c1"># Scatter just those points</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">buoy_lon</span><span class="p">)[</span><span class="n">mask</span><span class="p">],</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">buoy_lat</span><span class="p">)[</span><span class="n">mask</span><span class="p">],</span>
            <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>            <span class="c1"># Set the fill color</span>
            <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">zorder</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="n">buoy_id</span>           <span class="c1"># Use buoy_id as the legend label</span>
        <span class="p">)</span>

    <span class="c1"># Create the legend</span>
    <span class="n">leg</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Buoy Stations&quot;</span><span class="p">,</span>
        <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper right&quot;</span><span class="p">,</span>
        <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
        <span class="n">bbox_transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span>
    <span class="p">)</span>

    <span class="c1"># Ensure legend is above all other layers</span>
    <span class="n">leg</span><span class="o">.</span><span class="n">set_zorder</span><span class="p">(</span><span class="mi">999</span><span class="p">)</span>

    <span class="c1"># Add grid lines</span>
    <span class="n">gl</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">gridlines</span><span class="p">(</span><span class="n">draw_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">gl</span><span class="o">.</span><span class="n">right_labels</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">gl</span><span class="o">.</span><span class="n">top_labels</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Cloud Mask at time </span><span class="si">{</span><span class="n">time_choice</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Longitude&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Latitude&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">lat_inference</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">lat_inference</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">lon_inference</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">lon_inference</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>


    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">path_folder</span><span class="si">}</span><span class="s1">/plot_cloud_mask.png&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.main_func.plot_goes_image" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plot_goes_image</span><span class="p">(</span><span class="n">lat_inference</span><span class="p">,</span> <span class="n">lon_inference</span><span class="p">,</span> <span class="n">images</span><span class="p">,</span> <span class="n">path_folder</span><span class="p">,</span> <span class="n">buoy_name</span><span class="p">,</span> <span class="n">buoy_lat</span><span class="p">,</span> <span class="n">buoy_lon</span><span class="p">,</span> <span class="n">time_choice</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Plot the GOES image data on a map with buoy locations. Made for 128x128 images where the middpoint is at (64,64). If using other image sizes, the plotting will probably not work as expected.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>lat_inference</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Latitude values for the inference grid.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lon_inference</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Longitude values for the inference grid.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>images</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>GOES image data to be plotted.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>path_folder</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to save the plot.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>buoy_name</code>
            </td>
            <td>
                  <code><span title="list">list</span> or <span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Names of the buoys.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>buoy_lat</code>
            </td>
            <td>
                  <code><span title="list">list</span> or <span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Latitude values of the buoys.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>buoy_lon</code>
            </td>
            <td>
                  <code><span title="list">list</span> or <span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Longitude values of the buoys.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>time_choice</code>
            </td>
            <td>
                  <code><span title="datetime">datetime</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Time of the inference.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\func_ml.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">plot_goes_image</span><span class="p">(</span><span class="n">lat_inference</span><span class="p">,</span><span class="n">lon_inference</span><span class="p">,</span><span class="n">images</span><span class="p">,</span><span class="n">path_folder</span><span class="p">,</span><span class="n">buoy_name</span><span class="p">,</span><span class="n">buoy_lat</span><span class="p">,</span><span class="n">buoy_lon</span><span class="p">,</span><span class="n">time_choice</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot the GOES image data on a map with buoy locations. Made for 128x128 images where the middpoint is at (64,64). If using other image sizes, the plotting will probably not work as expected.</span>

<span class="sd">    Args:</span>
<span class="sd">        lat_inference (np.ndarray): Latitude values for the inference grid.</span>
<span class="sd">        lon_inference (np.ndarray): Longitude values for the inference grid.</span>
<span class="sd">        images (np.ndarray): GOES image data to be plotted.</span>
<span class="sd">        path_folder (str): Path to save the plot.</span>
<span class="sd">        buoy_name (list or np.ndarray): Names of the buoys.</span>
<span class="sd">        buoy_lat (list or np.ndarray): Latitude values of the buoys.</span>
<span class="sd">        buoy_lon (list or np.ndarray): Longitude values of the buoys.</span>
<span class="sd">        time_choice (datetime): Time of the inference.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mean_images</span> <span class="o">=</span> <span class="n">images</span><span class="p">[:,:,</span><span class="mi">64</span><span class="p">,</span><span class="mi">64</span><span class="p">]</span>
    <span class="n">mean_images</span> <span class="o">=</span> <span class="n">mean_images</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
    <span class="n">mean_images</span> <span class="o">=</span> <span class="n">mean_images</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">160</span><span class="p">,</span><span class="mi">340</span><span class="p">)</span>


    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>


    <span class="c1"># Plot wind speed data (continuous colormap)</span>
    <span class="n">pcm</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span>
        <span class="n">lon_inference</span><span class="p">,</span> <span class="n">lat_inference</span><span class="p">,</span> <span class="n">mean_images</span><span class="p">,</span>
        <span class="n">shading</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span>
        <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Add colorbar</span>
    <span class="n">cbar</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">pcm</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Brightness Temperature (K) - C01&#39;</span><span class="p">)</span>

    <span class="c1"># Add coastlines and land</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cfeature</span><span class="o">.</span><span class="n">LAND</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>  
    <span class="n">ax</span><span class="o">.</span><span class="n">coastlines</span><span class="p">(</span><span class="n">zorder</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>


    <span class="c1"># Flatten buoy_name if it&#39;s a list of arrays</span>
    <span class="n">buoy_name_flat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">buoy_name</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">unique_buoys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">buoy_name_flat</span><span class="p">))</span>

    <span class="c1"># Generate enough distinct colors for all buoys from the &quot;tab20&quot; palette</span>
    <span class="c1"># (tab20 provides 20 colors; if there are more than 20 unique buoys, colors will repeat)</span>
    <span class="n">color_map</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s2">&quot;tab20&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_buoys</span><span class="p">))</span>


    <span class="c1"># Add grid lines</span>
    <span class="n">gl</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">gridlines</span><span class="p">(</span><span class="n">draw_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">gl</span><span class="o">.</span><span class="n">right_labels</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">gl</span><span class="o">.</span><span class="n">top_labels</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;GOES image at time </span><span class="si">{</span><span class="n">time_choice</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Longitude&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Latitude&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">lat_inference</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">lat_inference</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">lon_inference</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">lon_inference</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">path_folder</span><span class="si">}</span><span class="s1">/plot_goes_image.png&#39;</span><span class="p">)</span>

    <span class="n">mean_images</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mean_images</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">mean_images</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.main_func.plot_save_loss" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plot_save_loss</span><span class="p">(</span><span class="n">best_val_outputs</span><span class="p">,</span> <span class="n">best_val_labels</span><span class="p">,</span> <span class="n">train_losses</span><span class="p">,</span> <span class="n">val_losses</span><span class="p">,</span> <span class="n">path_folder</span><span class="p">,</span> <span class="n">saving</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Plot and save the training and validation losses, and optionally save the best validation outputs and labels.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>best_val_outputs</code>
            </td>
            <td>
                  <code><span title="list">list</span> or <span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Model outputs for the validation dataset.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>best_val_labels</code>
            </td>
            <td>
                  <code><span title="list">list</span> or <span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True labels for the validation dataset.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>train_losses</code>
            </td>
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of training losses per epoch.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>val_losses</code>
            </td>
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of validation losses per epoch.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>path_folder</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to save the plot and optionally the outputs and labels.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>saving</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, save the best validation outputs and labels. Default is False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\func_ml.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">plot_save_loss</span><span class="p">(</span>
    <span class="n">best_val_outputs</span><span class="p">,</span>
    <span class="n">best_val_labels</span><span class="p">,</span>
    <span class="n">train_losses</span><span class="p">,</span>
    <span class="n">val_losses</span><span class="p">,</span>
    <span class="n">path_folder</span><span class="p">,</span>
    <span class="n">saving</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot and save the training and validation losses, and optionally save the best validation outputs and labels.</span>

<span class="sd">    Args:</span>
<span class="sd">        best_val_outputs (list or np.ndarray): Model outputs for the validation dataset.</span>
<span class="sd">        best_val_labels (list or np.ndarray): True labels for the validation dataset.</span>
<span class="sd">        train_losses (list): List of training losses per epoch.</span>
<span class="sd">        val_losses (list): List of validation losses per epoch.</span>
<span class="sd">        path_folder (str): Path to save the plot and optionally the outputs and labels.</span>
<span class="sd">        saving (bool, optional): If True, save the best validation outputs and labels. Default is False.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># After training, save only the best validation outputs and labels</span>
    <span class="k">if</span> <span class="n">saving</span><span class="p">:</span>
        <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_folder</span><span class="p">,</span> <span class="s2">&quot;best_validation_outputs.npy&quot;</span><span class="p">),</span> <span class="n">best_val_outputs</span>
        <span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_folder</span><span class="p">,</span> <span class="s2">&quot;best_validation_labels.npy&quot;</span><span class="p">),</span> <span class="n">best_val_labels</span>
        <span class="p">)</span>

    <span class="n">num_epochs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">train_losses</span><span class="p">)</span>
    <span class="c1"># Plotting the training and validation losses</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_epochs</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">train_losses</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Training Loss&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_epochs</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">val_losses</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Validation Loss&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Epoch&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Loss&quot;</span><span class="p">)</span>
    <span class="n">text_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;num_epochs = </span><span class="si">{</span><span class="n">num_epochs</span><span class="si">}</span><span class="s2">, train loss = </span><span class="si">{</span><span class="n">train_losses</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, validation loss = </span><span class="si">{</span><span class="n">val_losses</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
        <span class="mf">0.05</span><span class="p">,</span>
        <span class="mf">0.05</span><span class="p">,</span>
        <span class="n">text_str</span><span class="p">,</span>
        <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
        <span class="n">va</span><span class="o">=</span><span class="s2">&quot;bottom&quot;</span><span class="p">,</span>
        <span class="n">transform</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>  <span class="c1"># Ensures the coordinates are relative to the axes (0 to 1 range)</span>
    <span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Training and Validation Loss Over Epochs&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_folder</span><span class="p">,</span> <span class="s2">&quot;loss_plot.png&quot;</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.main_func.plot_wind_speeds" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plot_wind_speeds</span><span class="p">(</span><span class="n">lat_inference</span><span class="p">,</span> <span class="n">lon_inference</span><span class="p">,</span> <span class="n">wind_speeds_inference</span><span class="p">,</span> <span class="n">path_folder</span><span class="p">,</span> <span class="n">buoy_name</span><span class="p">,</span> <span class="n">buoy_lat</span><span class="p">,</span> <span class="n">buoy_lon</span><span class="p">,</span> <span class="n">time_choice</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Plot the wind speeds on a map with buoy locations. Filter nighttime images and add coastlines, gridlines, and buoy locations.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>lat_inference</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Latitude values for the inference grid.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lon_inference</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Longitude values for the inference grid.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>wind_speeds_inference</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Wind speed data to be plotted.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>path_folder</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to save the plot.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>buoy_name</code>
            </td>
            <td>
                  <code><span title="list">list</span> or <span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Names of the buoys.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>buoy_lat</code>
            </td>
            <td>
                  <code><span title="list">list</span> or <span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Latitude values of the buoys.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>buoy_lon</code>
            </td>
            <td>
                  <code><span title="list">list</span> or <span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Longitude values of the buoys.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>time_choice</code>
            </td>
            <td>
                  <code><span title="datetime">datetime</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Time of the inference.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\func_ml.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">plot_wind_speeds</span><span class="p">(</span><span class="n">lat_inference</span><span class="p">,</span><span class="n">lon_inference</span><span class="p">,</span><span class="n">wind_speeds_inference</span><span class="p">,</span><span class="n">path_folder</span><span class="p">,</span><span class="n">buoy_name</span><span class="p">,</span><span class="n">buoy_lat</span><span class="p">,</span><span class="n">buoy_lon</span><span class="p">,</span><span class="n">time_choice</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot the wind speeds on a map with buoy locations. Filter nighttime images and add coastlines, gridlines, and buoy locations.</span>

<span class="sd">    Args:</span>
<span class="sd">        lat_inference (np.ndarray): Latitude values for the inference grid.</span>
<span class="sd">        lon_inference (np.ndarray): Longitude values for the inference grid.</span>
<span class="sd">        wind_speeds_inference (np.ndarray): Wind speed data to be plotted.</span>
<span class="sd">        path_folder (str): Path to save the plot.</span>
<span class="sd">        buoy_name (list or np.ndarray): Names of the buoys.</span>
<span class="sd">        buoy_lat (list or np.ndarray): Latitude values of the buoys.</span>
<span class="sd">        buoy_lon (list or np.ndarray): Longitude values of the buoys.</span>
<span class="sd">        time_choice (datetime): Time of the inference.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">time_str</span> <span class="o">=</span> <span class="n">time_choice</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span>
    <span class="n">date</span><span class="p">,</span> <span class="n">time</span> <span class="o">=</span> <span class="n">time_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
    <span class="n">lat</span> <span class="o">=</span> <span class="n">lat_inference</span>
    <span class="n">lon</span> <span class="o">=</span> <span class="n">lon_inference</span>
    <span class="n">wind_speeds</span> <span class="o">=</span> <span class="n">wind_speeds_inference</span>


    <span class="n">buoy_names</span> <span class="o">=</span> <span class="n">buoy_name</span>
    <span class="n">buoy_lat</span> <span class="o">=</span> <span class="n">buoy_lat</span>
    <span class="n">buoy_lon</span> <span class="o">=</span> <span class="n">buoy_lon</span>


    <span class="c1"># nighttime mask</span>

    <span class="n">lat_flat</span> <span class="o">=</span> <span class="n">lat</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">lon_flat</span> <span class="o">=</span> <span class="n">lon</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">time_flat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lat_flat</span><span class="p">),</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">date</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">time</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[ns]&#39;</span><span class="p">)</span>


    <span class="n">sza</span><span class="p">,</span> <span class="n">saa</span> <span class="o">=</span> <span class="n">vectorized_solar_angles</span><span class="p">(</span><span class="n">lat_flat</span><span class="p">,</span> <span class="n">lon_flat</span><span class="p">,</span> <span class="n">time_flat</span><span class="p">)</span>
    <span class="n">saa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">saa</span><span class="p">,</span><span class="n">lat</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">sza</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">sza</span><span class="p">,</span><span class="n">lat</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

    <span class="n">night_time_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">sza</span> <span class="o">&gt;</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
    <span class="n">cmap</span> <span class="o">=</span> <span class="n">ListedColormap</span><span class="p">([</span><span class="s1">&#39;white&#39;</span><span class="p">])</span>

    <span class="c1">###############</span>

    <span class="n">min_lon</span><span class="p">,</span> <span class="n">max_lon</span><span class="p">,</span> <span class="n">min_lat</span><span class="p">,</span> <span class="n">max_lat</span> <span class="o">=</span> <span class="o">-</span><span class="mi">70</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">12</span><span class="p">,</span> <span class="mi">20</span>

    <span class="c1"># add coastlines and gridlines</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">22</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
    <span class="n">levels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">line_colour</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span>
    <span class="n">line_colours</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;black&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">levels</span><span class="p">]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">set_text</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Wind Speed prediction from C01 GOES image (m/s) </span><span class="si">{</span><span class="n">date</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">time</span><span class="si">}</span><span class="s1"> &#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">wind_speeds</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;jet&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span><span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span><span class="n">zorder</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">night_time_mask</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span><span class="n">zorder</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cfeature</span><span class="o">.</span><span class="n">COASTLINE</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cfeature</span><span class="o">.</span><span class="n">LAND</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span> <span class="mi">20</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">70</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">crs</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">FuncFormatter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">_</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">x</span><span class="si">:</span><span class="s1">.0f</span><span class="si">}</span><span class="s1">E&#39;</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">15</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">crs</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">FuncFormatter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">y</span><span class="p">,</span> <span class="n">_</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">y</span><span class="si">:</span><span class="s1">.0f</span><span class="si">}</span><span class="s1">N&#39;</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_extent</span><span class="p">((</span><span class="o">-</span><span class="mi">70</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">12</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">70</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">wind_speeds</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;jet&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span><span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="mi">15</span><span class="p">),</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Wind Speed (m/s)&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">gridlines</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span> <span class="mi">999</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">buoy</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">buoy_names</span><span class="p">)):</span>
        <span class="n">lon_b</span><span class="p">,</span> <span class="n">lat_b</span> <span class="o">=</span> <span class="n">buoy_lon</span><span class="p">[</span><span class="n">buoy</span><span class="p">],</span> <span class="n">buoy_lat</span><span class="p">[</span><span class="n">buoy</span><span class="p">]</span>

        <span class="c1"># Skip if out of bounds</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">min_lon</span> <span class="o">&lt;=</span> <span class="n">lon_b</span> <span class="o">&lt;=</span> <span class="n">max_lon</span> <span class="ow">and</span> <span class="n">min_lat</span> <span class="o">&lt;=</span> <span class="n">lat_b</span> <span class="o">&lt;=</span> <span class="n">max_lat</span><span class="p">):</span>
            <span class="k">continue</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lon_b</span><span class="p">,</span> <span class="n">lat_b</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="n">label</span><span class="o">=</span><span class="n">buoy_names</span><span class="p">[</span><span class="n">buoy</span><span class="p">],</span><span class="n">zorder</span> <span class="o">=</span> <span class="mi">999</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
            <span class="n">lon_b</span> <span class="o">+</span> <span class="mf">0.2</span><span class="p">,</span> <span class="n">lat_b</span> <span class="o">+</span> <span class="mf">0.2</span><span class="p">,</span> <span class="n">buoy_names</span><span class="p">[</span><span class="n">buoy</span><span class="p">],</span>
            <span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span>
            <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>
            <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">boxstyle</span><span class="o">=</span><span class="s1">&#39;square,pad=0.2&#39;</span><span class="p">),</span><span class="n">zorder</span> <span class="o">=</span> <span class="mi">999</span>
        <span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">path_folder</span><span class="si">}</span><span class="s1">/plot_wind_speeds.png&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.main_func.rmse_per_range" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">rmse_per_range</span><span class="p">(</span><span class="n">model_output</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">path_folder</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Calculate the RMSE for different ranges of wind speeds and save the results to a CSV file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>model_output</code>
            </td>
            <td>
                  <code><span title="list">list</span> or <span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Model outputs for the validation dataset.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>target</code>
            </td>
            <td>
                  <code><span title="list">list</span> or <span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True labels for the validation dataset.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>path_folder</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to save the CSV file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Returns:
    pd.DataFrame: DataFrame containing the RMSE and count for each range.</p>


            <details class="quote">
              <summary>Source code in <code>windscangeo\func_ml.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">rmse_per_range</span><span class="p">(</span><span class="n">model_output</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span><span class="n">path_folder</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the RMSE for different ranges of wind speeds and save the results to a CSV file.</span>

<span class="sd">    Args:</span>
<span class="sd">        model_output (list or np.ndarray): Model outputs for the validation dataset.</span>
<span class="sd">        target (list or np.ndarray): True labels for the validation dataset.</span>
<span class="sd">        path_folder (str): Path to save the CSV file.</span>
<span class="sd">    Returns:</span>
<span class="sd">        pd.DataFrame: DataFrame containing the RMSE and count for each range.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">max_target</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
    <span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_target</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bins</span><span class="p">))</span>
    <span class="n">count</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bins</span><span class="p">))</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bins</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">target</span> <span class="o">&gt;=</span> <span class="n">bins</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">target</span> <span class="o">&lt;=</span> <span class="n">bins</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">rmse</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">model_output</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">-</span> <span class="n">target</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">count</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;EVAL : Range </span><span class="si">{</span><span class="n">bins</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2"> m/s - </span><span class="si">{</span><span class="n">bins</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> m/s: RMSE = </span><span class="si">{</span><span class="n">rmse</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2">, count = </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">count</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;bin_start&#39;</span><span class="p">:</span> <span class="n">bins</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s1">&#39;bin_end&#39;</span><span class="p">:</span> <span class="n">bins</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;rmse&#39;</span><span class="p">:</span> <span class="n">rmse</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s1">&#39;count&#39;</span><span class="p">:</span> <span class="n">count</span><span class="p">[</span><span class="n">i</span><span class="p">]})</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
    <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">path_folder</span><span class="si">}</span><span class="s1">/rmse_per_range.csv&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.main_func.save_overpass_time" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">save_overpass_time</span><span class="p">(</span><span class="n">time_list</span><span class="p">,</span> <span class="n">name_scatter</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>This function prints the overpass time of the scatterometer.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>time_list</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The measurement time values of the scatterometer data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>name_scatter</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the scatterometer data source (e.g. ASCAT, HYSCAT etc).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\func.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">save_overpass_time</span><span class="p">(</span><span class="n">time_list</span><span class="p">,</span><span class="n">name_scatter</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function prints the overpass time of the scatterometer.</span>

<span class="sd">    Args:</span>
<span class="sd">        time_list (numpy.ndarray): The measurement time values of the scatterometer data.</span>
<span class="sd">        name_scatter (str): The name of the scatterometer data source (e.g. ASCAT, HYSCAT etc).</span>

<span class="sd">    Returns:</span>
<span class="sd">        None </span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">formated_time</span> <span class="o">=</span> <span class="n">time_list</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;datetime64[ns]&#39;</span><span class="p">)</span>
    <span class="n">hour_minute</span> <span class="o">=</span> <span class="n">formated_time</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;datetime64[m]&#39;</span><span class="p">)</span>
    <span class="n">unique_hour_minute</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">hour_minute</span><span class="p">)</span>

    <span class="n">filtered</span> <span class="o">=</span> <span class="p">[</span><span class="n">unique_hour_minute</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>

    <span class="n">delta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">timedelta64</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="n">unique_hour_minute</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
        <span class="k">if</span> <span class="n">time</span> <span class="o">-</span> <span class="n">filtered</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">delta</span><span class="p">:</span>
            <span class="n">filtered</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>

    <span class="n">time_only</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="n">filtered</span><span class="p">:</span>
        <span class="n">time</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">time</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">time_only</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ORBIT : </span><span class="si">{</span><span class="n">name_scatter</span><span class="si">}</span><span class="s2"> overpass time : </span><span class="si">{</span><span class="n">time_only</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.main_func.savedataseperated" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">savedataseperated</span><span class="p">(</span><span class="n">ScatterData</span><span class="p">,</span> <span class="n">main_parameter</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>This function extracts the valid lon / lat / measurement time and the main parameter from ever pixel
of the scatterometer data and saves it to a numpy file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>ScatterData</code>
            </td>
            <td>
                  <code><span title="xarray.Dataset">Dataset</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The ASCAT dataset containing the scatterometer data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>main_parameter</code>
            </td>
            <td>
                  <code><span title="xarray.DataArray">DataArray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The main parameter to be saved. This can be a classification / wind speed / wind direction etc.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Returns:</p>
<pre><code>lat_list (numpy.ndarray): The latitude values of the scatterometer data.
lon_list (numpy.ndarray): The longitude values of the scatterometer data.
time_list (numpy.ndarray): The measurement time values of the scatterometer data.
main_parameter_list (numpy.ndarray): The main parameter values of the scatterometer data.
</code></pre>
<p>this function saves the data locally to a folder called data_processed_scat</p>


            <details class="quote">
              <summary>Source code in <code>windscangeo\func.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">savedataseperated</span><span class="p">(</span><span class="n">ScatterData</span><span class="p">,</span> <span class="n">main_parameter</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function extracts the valid lon / lat / measurement time and the main parameter from ever pixel</span>
<span class="sd">    of the scatterometer data and saves it to a numpy file.</span>

<span class="sd">    Args:</span>
<span class="sd">        ScatterData (xarray.Dataset): The ASCAT dataset containing the scatterometer data.</span>
<span class="sd">        main_parameter (xarray.DataArray): The main parameter to be saved. This can be a classification / wind speed / wind direction etc.</span>

<span class="sd">    Returns:</span>

<span class="sd">        lat_list (numpy.ndarray): The latitude values of the scatterometer data.</span>
<span class="sd">        lon_list (numpy.ndarray): The longitude values of the scatterometer data.</span>
<span class="sd">        time_list (numpy.ndarray): The measurement time values of the scatterometer data.</span>
<span class="sd">        main_parameter_list (numpy.ndarray): The main parameter values of the scatterometer data.</span>

<span class="sd">    this function saves the data locally to a folder called data_processed_scat</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">lat_full</span><span class="p">,</span> <span class="n">lon_full</span><span class="p">,</span> <span class="n">time_full</span> <span class="o">=</span> <span class="n">ScatterData</span><span class="o">.</span><span class="n">indexes</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
    <span class="n">measurement_time_full</span> <span class="o">=</span> <span class="n">ScatterData</span><span class="o">.</span><span class="n">measurement_time</span>

    <span class="n">lat_full</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lat_full</span><span class="p">)</span>
    <span class="n">lon_full</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lon_full</span><span class="p">)</span>
    <span class="n">measurement_time_full</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">measurement_time_full</span><span class="p">)</span>
    <span class="n">main_parameter</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">main_parameter</span><span class="p">)</span>

    <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">main_parameter</span><span class="p">))</span>

    <span class="n">index_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">lat_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">lon_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">time_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">wind_speed_list</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">name_scatter</span> <span class="o">=</span> <span class="n">ScatterData</span><span class="o">.</span><span class="n">source</span>

    <span class="k">for</span> <span class="n">t</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">index</span><span class="p">:</span>

        <span class="c1"># print(t,&#39;= time&#39;, i,&#39;=row&#39;, j, &#39;=column&#39;)</span>
        <span class="n">index_list</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">t</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">))</span>

        <span class="c1"># print(measurement_time_full[t, i, j].astype(&#39;datetime64[ns]&#39;))</span>
        <span class="n">time_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">measurement_time_full</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span>

        <span class="c1"># print(lat_full[i])</span>
        <span class="n">lat_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lat_full</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

        <span class="c1"># print(lon_full[j])</span>
        <span class="n">lon_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lon_full</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>

        <span class="c1"># print(AllWindSpeeds[t, i, j])</span>
        <span class="n">wind_speed_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">main_parameter</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span>

    <span class="n">lat_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lat_list</span><span class="p">)</span>
    <span class="n">lon_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lon_list</span><span class="p">)</span>
    <span class="n">time_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">time_list</span><span class="p">)</span>
    <span class="n">wind_speed_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">wind_speed_list</span><span class="p">)</span>

    <span class="n">lat_list</span><span class="p">,</span> <span class="n">lon_list</span><span class="p">,</span> <span class="n">time_list</span><span class="p">,</span> <span class="n">wind_speed_list</span> <span class="o">=</span> <span class="n">sort_by_time</span><span class="p">(</span>
        <span class="n">lat_list</span><span class="p">,</span> <span class="n">lon_list</span><span class="p">,</span> <span class="n">time_list</span><span class="p">,</span> <span class="n">wind_speed_list</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="n">save_overpass_time</span><span class="p">(</span><span class="n">time_list</span><span class="p">,</span><span class="n">name_scatter</span><span class="p">)</span>    

    <span class="k">return</span> <span class="n">lat_list</span><span class="p">,</span> <span class="n">lon_list</span><span class="p">,</span> <span class="n">time_list</span><span class="p">,</span> <span class="n">wind_speed_list</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.main_func.snap_to_nearest" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">snap_to_nearest</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">reference_array</span><span class="p">,</span> <span class="n">cutoff</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Snap an array of values to the nearest values in a reference array.
If the difference is greater than the cutoff, the original value is returned.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>values</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of values to snap.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>reference_array</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of reference values.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cutoff</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum allowable difference for snapping.</p>
              </div>
            </td>
            <td>
                  <code>1.0</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>np.ndarray: Snapped values.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\func_inference.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">snap_to_nearest</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">reference_array</span><span class="p">,</span> <span class="n">cutoff</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Snap an array of values to the nearest values in a reference array.</span>
<span class="sd">    If the difference is greater than the cutoff, the original value is returned.</span>

<span class="sd">    Args:</span>
<span class="sd">        values (np.ndarray): Array of values to snap.</span>
<span class="sd">        reference_array (np.ndarray): Array of reference values.</span>
<span class="sd">        cutoff (float): Maximum allowable difference for snapping.</span>

<span class="sd">    Returns:</span>
<span class="sd">        np.ndarray: Snapped values.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Convert inputs to NumPy arrays for compatibility</span>
    <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
    <span class="n">reference_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">reference_array</span><span class="p">)</span>

    <span class="c1"># Find the nearest reference value for each input value</span>
    <span class="c1"># Reshape reference_array to allow broadcasting</span>
    <span class="n">reference_array</span> <span class="o">=</span> <span class="n">reference_array</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">differences</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">reference_array</span><span class="p">)</span>
    <span class="n">nearest_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">differences</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">nearest_values</span> <span class="o">=</span> <span class="n">reference_array</span><span class="o">.</span><span class="n">ravel</span><span class="p">()[</span><span class="n">nearest_indices</span><span class="p">]</span>

    <span class="c1"># Apply the cutoff condition</span>
    <span class="n">snap_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">values</span> <span class="o">-</span> <span class="n">nearest_values</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">cutoff</span>
    <span class="n">snapped_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">snap_mask</span><span class="p">,</span> <span class="n">nearest_values</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">snapped_values</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.main_func.sort_by_time" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">sort_by_time</span><span class="p">(</span><span class="n">lat_list</span><span class="p">,</span> <span class="n">lon_list</span><span class="p">,</span> <span class="n">time_list</span><span class="p">,</span> <span class="n">wind_speed_list</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>This function sorts the output of savedataseperated() by time.
This allows for more efficient data processing and allows file caching for times that are represented by the same GOES file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>lat_list</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The latitude values of the scatterometer data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lon_list</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The longitude values of the scatterometer data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>time_list</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The measurement time values of the scatterometer data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>wind_speed_list</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The wind speed values of the scatterometer data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>lat_list_sorted</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The sorted latitude values of the scatterometer data.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>lon_list_sorted</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The sorted longitude values of the scatterometer data.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>time_list_sorted</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The sorted measurement time values of the scatterometer data.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>wind_speed_list_sorted</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The sorted wind speed values of the scatterometer data.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\func.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">sort_by_time</span><span class="p">(</span><span class="n">lat_list</span><span class="p">,</span> <span class="n">lon_list</span><span class="p">,</span> <span class="n">time_list</span><span class="p">,</span> <span class="n">wind_speed_list</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function sorts the output of savedataseperated() by time.</span>
<span class="sd">    This allows for more efficient data processing and allows file caching for times that are represented by the same GOES file.</span>

<span class="sd">    Args:</span>
<span class="sd">        lat_list (numpy.ndarray): The latitude values of the scatterometer data.</span>
<span class="sd">        lon_list (numpy.ndarray): The longitude values of the scatterometer data.</span>
<span class="sd">        time_list (numpy.ndarray): The measurement time values of the scatterometer data.</span>
<span class="sd">        wind_speed_list (numpy.ndarray): The wind speed values of the scatterometer data.</span>

<span class="sd">    Returns:</span>
<span class="sd">        lat_list_sorted (numpy.ndarray): The sorted latitude values of the scatterometer data.</span>
<span class="sd">        lon_list_sorted (numpy.ndarray): The sorted longitude values of the scatterometer data.</span>
<span class="sd">        time_list_sorted (numpy.ndarray): The sorted measurement time values of the scatterometer data.</span>
<span class="sd">        wind_speed_list_sorted (numpy.ndarray): The sorted wind speed values of the scatterometer data.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Get the indices that would sort the measurement_time array</span>
    <span class="n">sorted_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">time_list</span><span class="p">)</span>

    <span class="c1"># Reorder the arrays using the sorted indices</span>
    <span class="n">time_list_sorted</span> <span class="o">=</span> <span class="n">time_list</span><span class="p">[</span><span class="n">sorted_indices</span><span class="p">]</span>
    <span class="n">lat_list_sorted</span> <span class="o">=</span> <span class="n">lat_list</span><span class="p">[</span><span class="n">sorted_indices</span><span class="p">]</span>
    <span class="n">lon_list_sorted</span> <span class="o">=</span> <span class="n">lon_list</span><span class="p">[</span><span class="n">sorted_indices</span><span class="p">]</span>
    <span class="n">speed_list_sorted</span> <span class="o">=</span> <span class="n">wind_speed_list</span><span class="p">[</span><span class="n">sorted_indices</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">lat_list_sorted</span><span class="p">,</span> <span class="n">lon_list_sorted</span><span class="p">,</span> <span class="n">time_list_sorted</span><span class="p">,</span> <span class="n">speed_list_sorted</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.main_func.test_model" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">test_model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">test_loader</span><span class="p">,</span> <span class="n">criterion</span><span class="p">,</span> <span class="n">device</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Evaluate the model on the test dataset and return the outputs, targets, and average loss.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>model</code>
            </td>
            <td>
                  <code><span title="torch.nn.Module">Module</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The trained model to be evaluated.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>test_loader</code>
            </td>
            <td>
                  <code><span title="torch.utils.data.DataLoader">DataLoader</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataLoader for the test dataset.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>criterion</code>
            </td>
            <td>
                  <code><span title="torch.nn.Module">Module</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Loss function to be used for evaluation.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>device</code>
            </td>
            <td>
                  <code><span title="torch.device">device</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Device to run the model on (CPU or GPU).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>test_outputs</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Outputs from the model on the test dataset.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>test_targets</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Targets corresponding to the test outputs.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>avg_test_loss</code></td>            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Average loss on the test dataset.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\impl.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">test_model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">test_loader</span><span class="p">,</span> <span class="n">criterion</span><span class="p">,</span> <span class="n">device</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Evaluate the model on the test dataset and return the outputs, targets, and average loss.</span>

<span class="sd">    Args:</span>
<span class="sd">        model (torch.nn.Module): The trained model to be evaluated.</span>
<span class="sd">        test_loader (torch.utils.data.DataLoader): DataLoader for the test dataset.</span>
<span class="sd">        criterion (torch.nn.Module): Loss function to be used for evaluation.</span>
<span class="sd">        device (torch.device): Device to run the model on (CPU or GPU).</span>

<span class="sd">    Returns:</span>
<span class="sd">        test_outputs (numpy.ndarray): Outputs from the model on the test dataset.</span>
<span class="sd">        test_targets (numpy.ndarray): Targets corresponding to the test outputs.</span>
<span class="sd">        avg_test_loss (float): Average loss on the test dataset.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>  <span class="c1"># Set the model to evaluation mode</span>
    <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>  <span class="c1"># Disable gradient calculation for inference</span>

        <span class="n">test_outputs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">test_targets</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">test_loss</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="k">for</span> <span class="n">images</span><span class="p">,</span> <span class="n">targets</span> <span class="ow">in</span> <span class="n">test_loader</span><span class="p">:</span>
            <span class="n">images</span> <span class="o">=</span> <span class="n">images</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
            <span class="n">targets</span> <span class="o">=</span> <span class="n">targets</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>

            <span class="n">outputs</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">images</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">loss</span> <span class="o">=</span> <span class="n">criterion</span><span class="p">(</span><span class="n">outputs</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span>
            <span class="n">test_loss</span> <span class="o">+=</span> <span class="n">loss</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>

            <span class="c1"># Append outputs to the list</span>
            <span class="n">test_outputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">outputs</span><span class="p">)</span>
            <span class="n">test_targets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">targets</span><span class="p">)</span>

        <span class="n">avg_test_loss</span> <span class="o">=</span> <span class="n">test_loss</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">test_loader</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;EVAL : Test Loss: </span><span class="si">{</span><span class="n">avg_test_loss</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">test_outputs</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">test_outputs</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">test_outputs</span> <span class="o">=</span> <span class="n">test_outputs</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span>
        <span class="n">test_outputs</span> <span class="o">=</span> <span class="n">test_outputs</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>

        <span class="n">test_targets</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">test_targets</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">test_targets</span> <span class="o">=</span> <span class="n">test_targets</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span>
        <span class="n">test_targets</span> <span class="o">=</span> <span class="n">test_targets</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">test_outputs</span><span class="p">,</span> <span class="n">test_targets</span><span class="p">,</span> <span class="n">avg_test_loss</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.main_func.train_model" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">train_model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">train_loader</span><span class="p">,</span> <span class="n">val_loader</span><span class="p">,</span> <span class="n">num_epochs</span><span class="p">,</span> <span class="n">lr</span><span class="p">,</span> <span class="n">weight_decay</span><span class="p">,</span> <span class="n">criterion</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="n">optimizer_choice</span><span class="p">,</span> <span class="n">patience_epochs</span><span class="p">,</span> <span class="n">patience_loss</span><span class="p">,</span> <span class="n">path_folder</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Train the model with the given parameters dictionary and save the best validation outputs, labels, and model.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>model</code>
            </td>
            <td>
                  <code><span title="torch.nn.Module">Module</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The model to be trained.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>train_loader</code>
            </td>
            <td>
                  <code><span title="torch.utils.data.DataLoader">DataLoader</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataLoader for the training dataset.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>val_loader</code>
            </td>
            <td>
                  <code><span title="torch.utils.data.DataLoader">DataLoader</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataLoader for the validation dataset.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>num_epochs</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of epochs to train the model.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lr</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Learning rate for the optimizer.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>weight_decay</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Weight decay for the optimizer.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>criterion</code>
            </td>
            <td>
                  <code><span title="torch.nn.Module">Module</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Loss function to be used.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>device</code>
            </td>
            <td>
                  <code><span title="torch.device">device</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Device to run the model on (CPU or GPU).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>optimizer_choice</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Choice of optimizer ('Adam', 'SGD', 'RMSprop').</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>patience_epochs</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of epochs to wait before stopping if no improvement in validation loss.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>patience_loss</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Minimum change in validation loss to consider as an improvement.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>path_folder</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to save the model checkpoints.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>best_val_outputs</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Best validation outputs from the model.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>best_val_labels</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Best validation labels corresponding to the outputs.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>best_model</code></td>            <td>
                  <code><span title="torch.nn.Module">Module</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The best model based on validation loss.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>train_losses</code></td>            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of training losses for each epoch.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>val_losses</code></td>            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of validation losses for each epoch.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\impl.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">train_model</span><span class="p">(</span>
    <span class="n">model</span><span class="p">,</span>
    <span class="n">train_loader</span><span class="p">,</span>
    <span class="n">val_loader</span><span class="p">,</span>
    <span class="n">num_epochs</span><span class="p">,</span>
    <span class="n">lr</span><span class="p">,</span>
    <span class="n">weight_decay</span><span class="p">,</span>
    <span class="n">criterion</span><span class="p">,</span>
    <span class="n">device</span><span class="p">,</span>
    <span class="n">optimizer_choice</span><span class="p">,</span>
    <span class="n">patience_epochs</span><span class="p">,</span>
    <span class="n">patience_loss</span><span class="p">,</span>
    <span class="n">path_folder</span><span class="p">,</span>
<span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Train the model with the given parameters dictionary and save the best validation outputs, labels, and model.</span>

<span class="sd">    Args:</span>
<span class="sd">        model (torch.nn.Module): The model to be trained.</span>
<span class="sd">        train_loader (torch.utils.data.DataLoader): DataLoader for the training dataset.</span>
<span class="sd">        val_loader (torch.utils.data.DataLoader): DataLoader for the validation dataset.</span>
<span class="sd">        num_epochs (int): Number of epochs to train the model.</span>
<span class="sd">        lr (float): Learning rate for the optimizer.</span>
<span class="sd">        weight_decay (float): Weight decay for the optimizer.</span>
<span class="sd">        criterion (torch.nn.Module): Loss function to be used.</span>
<span class="sd">        device (torch.device): Device to run the model on (CPU or GPU).</span>
<span class="sd">        optimizer_choice (str): Choice of optimizer (&#39;Adam&#39;, &#39;SGD&#39;, &#39;RMSprop&#39;).</span>
<span class="sd">        patience_epochs (int): Number of epochs to wait before stopping if no improvement in validation loss.</span>
<span class="sd">        patience_loss (float): Minimum change in validation loss to consider as an improvement.</span>
<span class="sd">        path_folder (str): Path to save the model checkpoints.</span>

<span class="sd">    Returns:</span>
<span class="sd">        best_val_outputs (numpy.ndarray): Best validation outputs from the model.</span>
<span class="sd">        best_val_labels (numpy.ndarray): Best validation labels corresponding to the outputs.</span>
<span class="sd">        best_model (torch.nn.Module): The best model based on validation loss.</span>
<span class="sd">        train_losses (list): List of training losses for each epoch.</span>
<span class="sd">        val_losses (list): List of validation losses for each epoch.</span>
<span class="sd">    &quot;&quot;&quot;</span>


    <span class="k">if</span> <span class="n">optimizer_choice</span> <span class="o">==</span> <span class="s2">&quot;Adam&quot;</span><span class="p">:</span>
        <span class="n">optimizer</span> <span class="o">=</span> <span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="n">lr</span><span class="p">,</span> <span class="n">weight_decay</span><span class="o">=</span><span class="n">weight_decay</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">optimizer_choice</span> <span class="o">==</span> <span class="s2">&quot;SGD&quot;</span><span class="p">:</span>
        <span class="n">optimizer</span> <span class="o">=</span> <span class="n">optim</span><span class="o">.</span><span class="n">SGD</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="n">lr</span><span class="p">,</span> <span class="n">weight_decay</span><span class="o">=</span><span class="n">weight_decay</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">optimizer_choice</span> <span class="o">==</span> <span class="s2">&quot;RMSprop&quot;</span><span class="p">:</span>
        <span class="n">optimizer</span> <span class="o">=</span> <span class="n">optim</span><span class="o">.</span><span class="n">RMSprop</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="n">lr</span><span class="p">,</span> <span class="n">weight_decay</span><span class="o">=</span><span class="n">weight_decay</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid optimizer choice. Please choose &#39;Adam&#39; or &#39;SGD&#39;.&quot;</span><span class="p">)</span>

    <span class="n">scheduler</span> <span class="o">=</span> <span class="n">lr_scheduler</span><span class="o">.</span><span class="n">StepLR</span><span class="p">(</span><span class="n">optimizer</span><span class="p">,</span> <span class="n">step_size</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>

    <span class="c1"># Initialize lists to store loss values and validation predictions</span>
    <span class="n">train_losses</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">val_losses</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">best_val_loss</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)</span>
    <span class="n">best_val_outputs</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">best_val_labels</span> <span class="o">=</span> <span class="kc">None</span>


    <span class="n">pbar</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">num_epochs</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;TRAIN : Training Progress&quot;</span><span class="p">)</span>    
    <span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="n">pbar</span><span class="p">:</span>
        <span class="c1"># Training Phase</span>
        <span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
        <span class="n">running_loss</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="k">for</span> <span class="n">images</span><span class="p">,</span> <span class="n">targets</span> <span class="ow">in</span> <span class="n">train_loader</span><span class="p">:</span>

            <span class="c1"># Move data to GPU</span>
            <span class="n">images</span> <span class="o">=</span> <span class="n">images</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
            <span class="n">targets</span> <span class="o">=</span> <span class="n">targets</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>            

            <span class="c1"># Forward pass</span>
            <span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
            <span class="n">outputs</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">images</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">loss</span> <span class="o">=</span> <span class="n">criterion</span><span class="p">(</span><span class="n">outputs</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span>  <span class="c1"># Ensure target shape matches output</span>
            <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
            <span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
            <span class="n">running_loss</span> <span class="o">+=</span> <span class="n">loss</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>

        <span class="c1"># Calculate average training loss for the epoch</span>
        <span class="n">avg_train_loss</span> <span class="o">=</span> <span class="n">running_loss</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">train_loader</span><span class="p">)</span>
        <span class="n">train_losses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">avg_train_loss</span><span class="p">)</span>
        <span class="c1">#print(f&quot;Epoch {epoch+1}, Training Loss: {avg_train_loss}&quot;)</span>
        <span class="n">pbar</span><span class="o">.</span><span class="n">set_postfix</span><span class="p">({</span><span class="s2">&quot;Train Loss&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">avg_train_loss</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">})</span>

        <span class="c1"># Validation Phase</span>
        <span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
        <span class="n">val_loss</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">val_outputs</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Temporary list to store outputs for this epoch</span>
        <span class="n">val_labels</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Temporary list to store labels for this epoch</span>
        <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">images</span><span class="p">,</span> <span class="n">targets</span> <span class="ow">in</span> <span class="n">val_loader</span><span class="p">:</span>
                <span class="c1"># Move data to GPU</span>
                <span class="n">images</span> <span class="o">=</span> <span class="n">images</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
                <span class="n">targets</span> <span class="o">=</span> <span class="n">targets</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>

                <span class="c1"># Get model output</span>
                <span class="n">outputs</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">images</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

                <span class="c1"># Calculate loss</span>
                <span class="n">loss</span> <span class="o">=</span> <span class="n">criterion</span><span class="p">(</span><span class="n">outputs</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span>  <span class="c1"># Ensure target shape matches output</span>
                <span class="n">val_loss</span> <span class="o">+=</span> <span class="n">loss</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>

                <span class="c1"># Append outputs and targets to lists</span>
                <span class="n">val_outputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">outputs</span><span class="o">.</span><span class="n">cpu</span><span class="p">())</span>  <span class="c1"># Move to CPU for concatenation</span>
                <span class="n">val_labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">targets</span><span class="o">.</span><span class="n">cpu</span><span class="p">())</span>

        <span class="c1"># Concatenate outputs and labels across all batches to ensure all samples are included</span>
        <span class="n">val_outputs</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">val_outputs</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
        <span class="n">val_labels</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">val_labels</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>

        <span class="c1"># Calculate average validation loss for the epoch</span>
        <span class="n">avg_val_loss</span> <span class="o">=</span> <span class="n">val_loss</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">val_loader</span><span class="p">)</span>
        <span class="n">val_losses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">avg_val_loss</span><span class="p">)</span>
        <span class="c1">#print(f&quot;Epoch {epoch+1}, Validation Loss: {avg_val_loss}&quot;)</span>
        <span class="n">pbar</span><span class="o">.</span><span class="n">set_postfix</span><span class="p">({</span><span class="s2">&quot;Train Loss&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">avg_train_loss</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;Val Loss&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">avg_val_loss</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">})</span>

        <span class="c1"># Check if this is the best validation loss so far and store best outputs/labels</span>
        <span class="k">if</span> <span class="n">avg_val_loss</span> <span class="o">&lt;</span> <span class="n">best_val_loss</span><span class="p">:</span>
            <span class="n">best_val_loss</span> <span class="o">=</span> <span class="n">avg_val_loss</span>
            <span class="n">best_val_outputs</span> <span class="o">=</span> <span class="n">val_outputs</span>
            <span class="n">best_val_labels</span> <span class="o">=</span> <span class="n">val_labels</span>

            <span class="n">best_model</span> <span class="o">=</span> <span class="n">model</span>
            <span class="n">best_model_state</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">state_dict</span><span class="p">()</span>
            <span class="n">torch</span><span class="o">.</span><span class="n">save</span><span class="p">(</span>
                <span class="n">best_model_state</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_folder</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;./epoch_</span><span class="si">{</span><span class="n">epoch</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">.pth&quot;</span><span class="p">)</span>
            <span class="p">)</span>


        <span class="n">manage_saved_models</span><span class="p">(</span><span class="n">path_folder</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">early_stopping</span><span class="p">(</span><span class="n">val_losses</span><span class="p">,</span> <span class="n">patience_epochs</span><span class="p">,</span> <span class="n">patience_loss</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="n">best_val_outputs</span><span class="p">,</span>
                <span class="n">best_val_labels</span><span class="p">,</span>
                <span class="n">best_model</span><span class="p">,</span>
                <span class="n">train_losses</span><span class="p">,</span>
                <span class="n">val_losses</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="n">scheduler</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>



    <span class="k">return</span> <span class="n">best_val_outputs</span><span class="p">,</span> <span class="n">best_val_labels</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">train_losses</span><span class="p">,</span> <span class="n">val_losses</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.main_func.train_test_model" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">train_test_model</span><span class="p">(</span><span class="n">saved_file_path</span><span class="p">,</span> <span class="n">run_name</span><span class="p">,</span> <span class="n">model_parameters</span><span class="p">,</span> <span class="n">normalization_factors</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Trains and tests a model using the provided parameters and data from a saved file (from <code>extract_matching_orbits</code>).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>saved_file_path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the saved .npz file containing preloaded data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>run_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the run, used to create a folder for saving results.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>model_parameters</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary containing model parameters such as batch size, image size, learning rate, etc (Supports CNN, ResNet, ViT). See tutorial for details.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>normalization_factors</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary containing normalization factors (mean and std) for the images dataset.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>result_path_folder</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the folder where results are saved.  </p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
        <p>model_parameters should contain the following (dictionary, values can be changed as needed):
        "batch_size" : 256,
        "image_size": 128, 
        "image_channels" : 1,<br />
        "model_choice" : "ResNet", # or "CNN" or"ViT"
        "criterion" : nn.MSELoss(), # or any other PyTorch loss function
        "optimizer_choice" : "Adam", 
        "learning_rate" : 0.003305753102490767,
        "weight_decay" : 0.00000148842072509874,
        "dropout_rate" : 0.2752124679248082,
        "num_epochs" : 10, 
        "patience_epochs" : 20, # early stopping
        "patience_loss" : 0.001,</p>
<pre><code>    # The following additional parameters are required with the CNN :
    "activation_cnn" : nn.ReLU(),
    "activation_final" : nn.Identity(),
    "kernel_size" : 3,
    "features_cnn" : [64,64,64,64],
    "stride" : 1,
</code></pre>
<p>normalization_factors should contain the following (dictionary, values can be changed as needed):
        "mean" : 0.0, # mean of the images dataset
        "std" : 1.0, # std of the images dataset</p>


            <details class="quote">
              <summary>Source code in <code>windscangeo\main_func.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">train_test_model</span><span class="p">(</span>
    <span class="n">saved_file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">run_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">model_parameters</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="n">normalization_factors</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Trains and tests a model using the provided parameters and data from a saved file (from `extract_matching_orbits`).</span>

<span class="sd">    Args:</span>
<span class="sd">        saved_file_path (str): Path to the saved .npz file containing preloaded data.</span>
<span class="sd">        run_name (str): Name of the run, used to create a folder for saving results.</span>
<span class="sd">        model_parameters (dict): Dictionary containing model parameters such as batch size, image size, learning rate, etc (Supports CNN, ResNet, ViT). See tutorial for details.</span>
<span class="sd">        normalization_factors (dict): Dictionary containing normalization factors (mean and std) for the images dataset.</span>

<span class="sd">    Returns:</span>
<span class="sd">        result_path_folder (str): Path to the folder where results are saved.  </span>


<span class="sd">    model_parameters should contain the following (dictionary, values can be changed as needed):</span>
<span class="sd">            &quot;batch_size&quot; : 256,</span>
<span class="sd">            &quot;image_size&quot;: 128, </span>
<span class="sd">            &quot;image_channels&quot; : 1,  </span>
<span class="sd">            &quot;model_choice&quot; : &quot;ResNet&quot;, # or &quot;CNN&quot; or&quot;ViT&quot;</span>
<span class="sd">            &quot;criterion&quot; : nn.MSELoss(), # or any other PyTorch loss function</span>
<span class="sd">            &quot;optimizer_choice&quot; : &quot;Adam&quot;, </span>
<span class="sd">            &quot;learning_rate&quot; : 0.003305753102490767,</span>
<span class="sd">            &quot;weight_decay&quot; : 0.00000148842072509874,</span>
<span class="sd">            &quot;dropout_rate&quot; : 0.2752124679248082,</span>
<span class="sd">            &quot;num_epochs&quot; : 10, </span>
<span class="sd">            &quot;patience_epochs&quot; : 20, # early stopping</span>
<span class="sd">            &quot;patience_loss&quot; : 0.001,</span>

<span class="sd">            # The following additional parameters are required with the CNN :</span>
<span class="sd">            &quot;activation_cnn&quot; : nn.ReLU(),</span>
<span class="sd">            &quot;activation_final&quot; : nn.Identity(),</span>
<span class="sd">            &quot;kernel_size&quot; : 3,</span>
<span class="sd">            &quot;features_cnn&quot; : [64,64,64,64],</span>
<span class="sd">            &quot;stride&quot; : 1,</span>

<span class="sd">    normalization_factors should contain the following (dictionary, values can be changed as needed):</span>
<span class="sd">            &quot;mean&quot; : 0.0, # mean of the images dataset</span>
<span class="sd">            &quot;std&quot; : 1.0, # std of the images dataset</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Ignore warnings for division by zero and invalid operations</span>
    <span class="n">np</span><span class="o">.</span><span class="n">seterr</span><span class="p">(</span><span class="n">divide</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">invalid</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>

    <span class="c1"># create a folder for the experiment</span>
    <span class="n">result_path_folder</span> <span class="o">=</span> <span class="n">create_folder</span><span class="p">(</span><span class="n">run_name</span><span class="p">)</span>

    <span class="c1"># load the model parameters</span>
    <span class="n">batch_size</span> <span class="o">=</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s2">&quot;batch_size&quot;</span><span class="p">]</span>
    <span class="n">image_height</span> <span class="o">=</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s2">&quot;image_size&quot;</span><span class="p">]</span>
    <span class="n">image_width</span> <span class="o">=</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s2">&quot;image_size&quot;</span><span class="p">]</span>
    <span class="n">in_channels</span> <span class="o">=</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s2">&quot;image_channels&quot;</span><span class="p">]</span>
    <span class="n">lr</span> <span class="o">=</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s2">&quot;learning_rate&quot;</span><span class="p">]</span>
    <span class="n">weight_decay</span> <span class="o">=</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s2">&quot;weight_decay&quot;</span><span class="p">]</span>
    <span class="n">criterion</span> <span class="o">=</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s2">&quot;criterion&quot;</span><span class="p">]</span>
    <span class="n">optimizer_choice</span> <span class="o">=</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s2">&quot;optimizer_choice&quot;</span><span class="p">]</span>
    <span class="n">dropout_rate</span> <span class="o">=</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s2">&quot;dropout_rate&quot;</span><span class="p">]</span>


    <span class="n">num_epochs</span> <span class="o">=</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s2">&quot;num_epochs&quot;</span><span class="p">]</span>
    <span class="n">patience_epochs</span> <span class="o">=</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s2">&quot;patience_epochs&quot;</span><span class="p">]</span>
    <span class="n">patience_loss</span> <span class="o">=</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s2">&quot;patience_loss&quot;</span><span class="p">]</span>
    <span class="n">model_choice</span> <span class="o">=</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s2">&quot;model_choice&quot;</span><span class="p">]</span>

    <span class="c1"># specify the device</span>
    <span class="n">device</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s2">&quot;cuda&quot;</span> <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">()</span> <span class="k">else</span> <span class="s2">&quot;cpu&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;INFO : Pytorch is using device: </span><span class="si">{</span><span class="n">device</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Load the model</span>

    <span class="k">if</span> <span class="n">model_choice</span> <span class="o">==</span> <span class="s2">&quot;CNN&quot;</span><span class="p">:</span>

        <span class="n">activation_cnn</span> <span class="o">=</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s2">&quot;activation_cnn&quot;</span><span class="p">]</span>
        <span class="n">activation_final</span> <span class="o">=</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s2">&quot;activation_final&quot;</span><span class="p">]</span>
        <span class="n">kernel_size</span> <span class="o">=</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s2">&quot;kernel_size&quot;</span><span class="p">]</span>
        <span class="n">features_cnn</span> <span class="o">=</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s2">&quot;features_cnn&quot;</span><span class="p">]</span>
        <span class="n">stride</span> <span class="o">=</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s2">&quot;stride&quot;</span><span class="p">]</span>

        <span class="n">model</span> <span class="o">=</span> <span class="n">ConventionalCNN</span><span class="p">(</span>
            <span class="n">image_height</span><span class="p">,</span>
            <span class="n">image_width</span><span class="p">,</span>
            <span class="n">features_cnn</span><span class="p">,</span>
            <span class="n">kernel_size</span><span class="p">,</span>
            <span class="n">in_channels</span><span class="p">,</span>
            <span class="n">activation_cnn</span><span class="p">,</span>
            <span class="n">activation_final</span><span class="p">,</span>
            <span class="n">stride</span><span class="p">,</span>
            <span class="n">dropout_rate</span>
        <span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;INFO : model choice is CNN&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">model_choice</span> <span class="o">==</span> <span class="s1">&#39;ViT&#39;</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">ViT</span><span class="p">(</span>
            <span class="n">img_size</span> <span class="o">=</span> <span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">),</span>
            <span class="n">patch_size</span> <span class="o">=</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">16</span><span class="p">),</span>
            <span class="n">n_channels</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">d_model</span> <span class="o">=</span> <span class="mi">1024</span><span class="p">,</span>
            <span class="n">nhead</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
            <span class="n">dim_feedforward</span> <span class="o">=</span> <span class="mi">2048</span><span class="p">,</span>
            <span class="n">blocks</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span>
            <span class="n">mlp_head_units</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1024</span><span class="p">,</span> <span class="mi">512</span><span class="p">],</span>
            <span class="n">n_classes</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;INFO : model choice is ViT&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">model_choice</span> <span class="o">==</span> <span class="s1">&#39;ResNet&#39;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;INFO : model choice is ResNet&#39;</span><span class="p">)</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">ResNet50</span><span class="p">(</span><span class="n">num_classes</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">channels</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>

        <span class="c1"># use the best saved model for test</span>
        <span class="c1"># print(&#39;using preloaded model, continuing training&#39;)</span>
        <span class="c1"># model_file = [file for file in os.listdir(path_folder) if file.endswith(&quot;.pth&quot;)][0]</span>
        <span class="c1"># model_path = os.path.join(path_folder, model_file)</span>
        <span class="c1"># model.load_state_dict(torch.load(model_path,map_location=torch.device(device)) )</span>


    <span class="c1"># loading normalization factors</span>
    <span class="n">mean</span> <span class="o">=</span> <span class="n">normalization_factors</span><span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">]</span>
    <span class="n">std</span> <span class="o">=</span> <span class="n">normalization_factors</span><span class="p">[</span><span class="s2">&quot;std&quot;</span><span class="p">]</span>

    <span class="n">data_file</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">saved_file_path</span><span class="p">,</span><span class="n">allow_pickle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">data_file_images</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data_file</span><span class="p">[</span><span class="s1">&#39;images&#39;</span><span class="p">])</span>
    <span class="n">data_file_numerical_data</span> <span class="o">=</span> <span class="n">data_file</span><span class="p">[</span><span class="s1">&#39;numerical_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">item</span><span class="p">()[</span><span class="s1">&#39;observation_wind_speeds&#39;</span><span class="p">]</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;INFO : Data loaded from file:&quot;</span><span class="p">,</span> <span class="n">saved_file_path</span><span class="p">)</span>

    <span class="n">train_images</span><span class="p">,</span> <span class="n">rest_images</span><span class="p">,</span> <span class="n">train_targets</span><span class="p">,</span> <span class="n">rest_targets</span> <span class="o">=</span> <span class="n">sklearn</span><span class="o">.</span><span class="n">model_selection</span><span class="o">.</span><span class="n">train_test_split</span><span class="p">(</span><span class="n">data_file_images</span><span class="p">,</span><span class="n">data_file_numerical_data</span><span class="p">,</span><span class="n">train_size</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">,</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
    <span class="n">val_images</span><span class="p">,</span> <span class="n">test_images</span><span class="p">,</span> <span class="n">val_targets</span><span class="p">,</span> <span class="n">test_targets</span> <span class="o">=</span> <span class="n">sklearn</span><span class="o">.</span><span class="n">model_selection</span><span class="o">.</span><span class="n">train_test_split</span><span class="p">(</span><span class="n">rest_images</span><span class="p">,</span><span class="n">rest_targets</span><span class="p">,</span><span class="n">train_size</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;INFO : Data split into train (0.8), validation (0.1) and test sets (0.1)&quot;</span><span class="p">)</span>
    <span class="c1"># loading the data </span>


    <span class="n">train_dataset</span> <span class="o">=</span> <span class="n">conventional_dataset</span><span class="p">(</span>
        <span class="n">train_images</span><span class="p">,</span>
        <span class="n">train_targets</span><span class="p">,</span>
        <span class="c1">#transform=Normalize(mean,std),</span>
    <span class="p">)</span>

    <span class="n">validation_dataset</span> <span class="o">=</span> <span class="n">conventional_dataset</span><span class="p">(</span>
        <span class="n">val_images</span><span class="p">,</span>
        <span class="n">val_targets</span><span class="p">,</span>
        <span class="c1">#transform=Normalize(mean,std),</span>
    <span class="p">)</span>

    <span class="n">test_dataset</span> <span class="o">=</span> <span class="n">conventional_dataset</span><span class="p">(</span>
        <span class="n">test_images</span><span class="p">,</span>
        <span class="n">test_targets</span><span class="p">,</span>
        <span class="c1">#transform=Normalize(mean,std),</span>
    <span class="p">)</span>

    <span class="c1"># Native pytorch dataloader</span>

    <span class="n">train_loader</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DataLoader</span><span class="p">(</span>
        <span class="n">train_dataset</span><span class="p">,</span>
        <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span>
        <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">drop_last</span><span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">pin_memory</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">validation_loader</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DataLoader</span><span class="p">(</span>
        <span class="n">validation_dataset</span><span class="p">,</span>
        <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span>
        <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">drop_last</span><span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">pin_memory</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>

    <span class="p">)</span>
    <span class="n">test_loader</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DataLoader</span><span class="p">(</span>
        <span class="n">test_dataset</span><span class="p">,</span>
        <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span>
        <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">drop_last</span><span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">pin_memory</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>

    <span class="p">)</span>

    <span class="c1"># Train the model ! </span>

    <span class="n">best_val_outputs</span><span class="p">,</span> <span class="n">best_val_labels</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">train_losses</span><span class="p">,</span> <span class="n">val_losses</span> <span class="o">=</span> <span class="n">train_model</span><span class="p">(</span>
        <span class="n">model</span><span class="p">,</span>
        <span class="n">train_loader</span><span class="p">,</span>
        <span class="n">validation_loader</span><span class="p">,</span>
        <span class="n">num_epochs</span><span class="p">,</span>
        <span class="n">lr</span><span class="p">,</span>
        <span class="n">weight_decay</span><span class="p">,</span>
        <span class="n">criterion</span><span class="p">,</span>
        <span class="n">device</span><span class="p">,</span>
        <span class="n">optimizer_choice</span><span class="p">,</span>
        <span class="n">patience_epochs</span><span class="p">,</span>
        <span class="n">patience_loss</span><span class="p">,</span>
        <span class="n">result_path_folder</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Ploting and saving the results</span>

    <span class="n">plot_save_loss</span><span class="p">(</span>
        <span class="n">best_val_outputs</span><span class="p">,</span>
        <span class="n">best_val_labels</span><span class="p">,</span>
        <span class="n">train_losses</span><span class="p">,</span>
        <span class="n">val_losses</span><span class="p">,</span>
        <span class="n">result_path_folder</span><span class="p">,</span>
        <span class="n">saving</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">model_file</span> <span class="o">=</span> <span class="p">[</span><span class="n">file</span> <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">result_path_folder</span><span class="p">)</span> <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.pth&quot;</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">model_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">result_path_folder</span><span class="p">,</span> <span class="n">model_file</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">load_state_dict</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">model_path</span><span class="p">,</span><span class="n">map_location</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="n">device</span><span class="p">))</span> <span class="p">)</span>

    <span class="c1"># Running the test</span>
    <span class="n">test_output</span><span class="p">,</span> <span class="n">test_target</span><span class="p">,</span> <span class="n">test_loss</span> <span class="o">=</span> <span class="n">test_model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">test_loader</span><span class="p">,</span> <span class="n">criterion</span><span class="p">,</span> <span class="n">device</span><span class="p">)</span>

    <span class="c1"># Plotting the results</span>
    <span class="n">error_plot</span><span class="p">(</span><span class="n">test_output</span><span class="p">,</span> <span class="n">test_target</span><span class="p">,</span> <span class="n">result_path_folder</span><span class="p">)</span>
    <span class="n">rmse_per_range</span><span class="p">(</span><span class="n">test_output</span><span class="p">,</span> <span class="n">test_target</span><span class="p">,</span> <span class="n">result_path_folder</span><span class="p">)</span>  <span class="c1"># ADD TO METADATA</span>

    <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">result_path_folder</span><span class="p">,</span> <span class="s2">&quot;test_loss.npy&quot;</span><span class="p">),</span>
            <span class="n">test_loss</span><span class="p">)</span>


    <span class="c1"># saving the test output and labels</span>
    <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span>
        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">result_path_folder</span><span class="p">,</span> <span class="s2">&quot;test_output.npy&quot;</span><span class="p">),</span>
        <span class="n">test_output</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span>
        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">result_path_folder</span><span class="p">,</span> <span class="s2">&quot;test_labels.npy&quot;</span><span class="p">),</span>
        <span class="n">test_target</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">result_path_folder</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.main_func.vectorized_solar_angles" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">vectorized_solar_angles</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">time_utc</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>This function calculates the solar zenith angle (SZA) and solar azimuth angle (SAA) for a given latitude, longitude, and time. This is an archived function. Current implementation does not use solar angles but only image input.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>lat</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The latitude values of the scatterometer data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lon</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The longitude values of the scatterometer data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>time_utc</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The observation times in UTC.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>sza</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The solar zenith angle in degrees.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>saa</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The solar azimuth angle in degrees.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\func_ml.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">vectorized_solar_angles</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">time_utc</span><span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function calculates the solar zenith angle (SZA) and solar azimuth angle (SAA) for a given latitude, longitude, and time. This is an archived function. Current implementation does not use solar angles but only image input.</span>

<span class="sd">    Args:</span>
<span class="sd">        lat (numpy.ndarray): The latitude values of the scatterometer data.</span>
<span class="sd">        lon (numpy.ndarray): The longitude values of the scatterometer data.</span>
<span class="sd">        time_utc (numpy.ndarray): The observation times in UTC.</span>

<span class="sd">    Returns:</span>
<span class="sd">        sza (numpy.ndarray): The solar zenith angle in degrees.</span>
<span class="sd">        saa (numpy.ndarray): The solar azimuth angle in degrees.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Convert time to Julian Day</span>
    <span class="n">timestamp</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">time_utc</span><span class="p">)</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">jd</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">timestamp</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;datetime64[ns]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span> <span class="o">/</span> <span class="mi">86400000000000</span> <span class="o">+</span> <span class="mf">2440587.5</span>
    <span class="p">)</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">jd</span> <span class="o">-</span> <span class="mf">2451545.0</span>  <span class="c1"># Days since J2000</span>

    <span class="c1"># Mean longitude, mean anomaly, ecliptic longitude</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">((</span><span class="mf">357.529</span> <span class="o">+</span> <span class="mf">0.98560028</span> <span class="o">*</span> <span class="n">d</span><span class="p">)</span> <span class="o">%</span> <span class="mi">360</span><span class="p">)</span>  <span class="c1"># Mean anomaly</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">((</span><span class="mf">280.459</span> <span class="o">+</span> <span class="mf">0.98564736</span> <span class="o">*</span> <span class="n">d</span><span class="p">)</span> <span class="o">%</span> <span class="mi">360</span><span class="p">)</span>  <span class="c1"># Mean longitude</span>
    <span class="n">L</span> <span class="o">=</span> <span class="p">(</span><span class="n">q</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="mf">1.915</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">g</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="mf">0.020</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">g</span><span class="p">))</span> <span class="o">%</span> <span class="p">(</span>
        <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
    <span class="p">)</span>  <span class="c1"># Ecliptic long</span>

    <span class="c1"># Obliquity of the ecliptic</span>
    <span class="n">e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="mf">23.439</span> <span class="o">-</span> <span class="mf">0.00000036</span> <span class="o">*</span> <span class="n">d</span><span class="p">)</span>

    <span class="c1"># Sun declination</span>
    <span class="n">sin_delta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">L</span><span class="p">)</span>
    <span class="n">delta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="n">sin_delta</span><span class="p">)</span>

    <span class="c1"># Equation of time (in minutes)</span>
    <span class="n">E</span> <span class="o">=</span> <span class="mf">229.18</span> <span class="o">*</span> <span class="p">(</span>
        <span class="mf">0.000075</span>
        <span class="o">+</span> <span class="mf">0.001868</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
        <span class="o">-</span> <span class="mf">0.032077</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
        <span class="o">-</span> <span class="mf">0.014615</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">g</span><span class="p">)</span>
        <span class="o">-</span> <span class="mf">0.040849</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">g</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="c1"># Convert time to fractional hours (UTC)</span>
    <span class="n">fractional_hour</span> <span class="o">=</span> <span class="n">timestamp</span><span class="o">.</span><span class="n">hour</span> <span class="o">+</span> <span class="n">timestamp</span><span class="o">.</span><span class="n">minute</span> <span class="o">/</span> <span class="mi">60</span> <span class="o">+</span> <span class="n">timestamp</span><span class="o">.</span><span class="n">second</span> <span class="o">/</span> <span class="mi">3600</span>

    <span class="c1"># Solar time correction</span>
    <span class="n">time_offset</span> <span class="o">=</span> <span class="n">E</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">lon</span>  <span class="c1"># lon in degrees</span>
    <span class="n">tst</span> <span class="o">=</span> <span class="n">fractional_hour</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">+</span> <span class="n">time_offset</span>  <span class="c1"># True Solar Time in minutes</span>
    <span class="n">ha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">((</span><span class="n">tst</span> <span class="o">/</span> <span class="mi">4</span> <span class="o">-</span> <span class="mi">180</span><span class="p">)</span> <span class="o">%</span> <span class="mi">360</span><span class="p">)</span>  <span class="c1"># Hour angle in radians</span>

    <span class="c1"># Convert lat/lon to radians</span>
    <span class="n">lat_rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span>

    <span class="c1"># Solar zenith angle</span>
    <span class="n">cos_zenith</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">lat_rad</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">delta</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">lat_rad</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span>
        <span class="n">delta</span>
    <span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ha</span><span class="p">)</span>
    <span class="n">zenith</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">cos_zenith</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>  <span class="c1"># in degrees</span>

    <span class="c1"># Solar saa angle</span>
    <span class="n">sin_saa</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ha</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">delta</span><span class="p">)</span>
    <span class="n">cos_saa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">lat_rad</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">delta</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">lat_rad</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span>
        <span class="n">delta</span>
    <span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ha</span><span class="p">)</span>
    <span class="n">saa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">sin_saa</span><span class="p">,</span> <span class="n">cos_saa</span><span class="p">))</span>
    <span class="n">saa</span> <span class="o">=</span> <span class="p">(</span><span class="n">saa</span> <span class="o">+</span> <span class="mi">360</span><span class="p">)</span> <span class="o">%</span> <span class="mi">360</span>  <span class="c1"># Normalize</span>

    <span class="k">return</span> <span class="n">zenith</span><span class="p">,</span> <span class="n">saa</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="windscangeo.func"></a>
    <div class="doc doc-contents first">









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="windscangeo.func.calculate_degrees" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_degrees</span><span class="p">(</span><span class="n">file_id</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>This function calculates the latitude and longitude of the GOES ABI fixed grid projection. 
This function comes from NOAA/NESDIS/STAR. (2025). Latitude and longitude remapping of GOES-R ABI imagery using Python . Atmospheric Composition Science Team. Retrieved from https://www.star.nesdis.noaa.gov/atmospheric-composition-training/python_abi_lat_lon.php</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>file_id</code>
            </td>
            <td>
                  <code><span title="xarray.Dataset">Dataset</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The xarray dataset containing the GOES ABI fixed grid projection variables.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>abi_lat</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The latitude of the GOES ABI fixed grid projection.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>abi_lon</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The longitude of the GOES ABI fixed grid projection.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\func.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate_degrees</span><span class="p">(</span><span class="n">file_id</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This function calculates the latitude and longitude of the GOES ABI fixed grid projection. </span>
<span class="sd">    This function comes from NOAA/NESDIS/STAR. (2025). Latitude and longitude remapping of GOES-R ABI imagery using Python . Atmospheric Composition Science Team. Retrieved from https://www.star.nesdis.noaa.gov/atmospheric-composition-training/python_abi_lat_lon.php</span>

<span class="sd">    Args:</span>
<span class="sd">        file_id (xarray.Dataset): The xarray dataset containing the GOES ABI fixed grid projection variables.</span>

<span class="sd">    Returns:</span>
<span class="sd">        abi_lat (numpy.ndarray): The latitude of the GOES ABI fixed grid projection.</span>
<span class="sd">        abi_lon (numpy.ndarray): The longitude of the GOES ABI fixed grid projection.</span>


<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Read in GOES ABI fixed grid projection variables and constants</span>
    <span class="n">x_coordinate_1d</span> <span class="o">=</span> <span class="n">file_id</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">][:]</span>  <span class="c1"># E/W scanning angle in radians</span>
    <span class="n">y_coordinate_1d</span> <span class="o">=</span> <span class="n">file_id</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">][:]</span>  <span class="c1"># N/S elevation angle in radians</span>
    <span class="n">projection_info</span> <span class="o">=</span> <span class="n">file_id</span><span class="o">.</span><span class="n">goes_imager_projection</span>
    <span class="n">lon_origin</span> <span class="o">=</span> <span class="n">projection_info</span><span class="o">.</span><span class="n">longitude_of_projection_origin</span>
    <span class="n">H</span> <span class="o">=</span> <span class="n">projection_info</span><span class="o">.</span><span class="n">perspective_point_height</span> <span class="o">+</span> <span class="n">projection_info</span><span class="o">.</span><span class="n">semi_major_axis</span>
    <span class="n">r_eq</span> <span class="o">=</span> <span class="n">projection_info</span><span class="o">.</span><span class="n">semi_major_axis</span>
    <span class="n">r_pol</span> <span class="o">=</span> <span class="n">projection_info</span><span class="o">.</span><span class="n">semi_minor_axis</span>

    <span class="c1"># Create 2D coordinate matrices from 1D coordinate vectors</span>
    <span class="n">x_coordinate_2d</span><span class="p">,</span> <span class="n">y_coordinate_2d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x_coordinate_1d</span><span class="p">,</span> <span class="n">y_coordinate_1d</span><span class="p">)</span>

    <span class="c1"># Equations to calculate latitude and longitude</span>
    <span class="n">lambda_0</span> <span class="o">=</span> <span class="p">(</span><span class="n">lon_origin</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">/</span> <span class="mf">180.0</span>
    <span class="n">a_var</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x_coordinate_2d</span><span class="p">),</span> <span class="mf">2.0</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">x_coordinate_2d</span><span class="p">),</span> <span class="mf">2.0</span><span class="p">)</span>
        <span class="o">*</span> <span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">y_coordinate_2d</span><span class="p">),</span> <span class="mf">2.0</span><span class="p">)</span>
            <span class="o">+</span> <span class="p">(</span>
                <span class="p">((</span><span class="n">r_eq</span> <span class="o">*</span> <span class="n">r_eq</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">r_pol</span> <span class="o">*</span> <span class="n">r_pol</span><span class="p">))</span>
                <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">y_coordinate_2d</span><span class="p">),</span> <span class="mf">2.0</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="n">b_var</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">H</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">x_coordinate_2d</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">y_coordinate_2d</span><span class="p">)</span>
    <span class="n">c_var</span> <span class="o">=</span> <span class="p">(</span><span class="n">H</span><span class="o">**</span><span class="mf">2.0</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">r_eq</span><span class="o">**</span><span class="mf">2.0</span><span class="p">)</span>
    <span class="n">r_s</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">1.0</span> <span class="o">*</span> <span class="n">b_var</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">b_var</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="mf">4.0</span> <span class="o">*</span> <span class="n">a_var</span> <span class="o">*</span> <span class="n">c_var</span><span class="p">)))</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">a_var</span><span class="p">)</span>
    <span class="n">s_x</span> <span class="o">=</span> <span class="n">r_s</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">x_coordinate_2d</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">y_coordinate_2d</span><span class="p">)</span>
    <span class="n">s_y</span> <span class="o">=</span> <span class="o">-</span><span class="n">r_s</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x_coordinate_2d</span><span class="p">)</span>
    <span class="n">s_z</span> <span class="o">=</span> <span class="n">r_s</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">x_coordinate_2d</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">y_coordinate_2d</span><span class="p">)</span>

    <span class="c1"># Ignore numpy errors for sqrt of negative number; occurs for GOES-16 ABI CONUS sector data</span>
    <span class="n">np</span><span class="o">.</span><span class="n">seterr</span><span class="p">(</span><span class="nb">all</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>

    <span class="n">abi_lat</span> <span class="o">=</span> <span class="p">(</span><span class="mf">180.0</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span>
            <span class="p">((</span><span class="n">r_eq</span> <span class="o">*</span> <span class="n">r_eq</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">r_pol</span> <span class="o">*</span> <span class="n">r_pol</span><span class="p">))</span>
            <span class="o">*</span> <span class="p">((</span><span class="n">s_z</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(((</span><span class="n">H</span> <span class="o">-</span> <span class="n">s_x</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">H</span> <span class="o">-</span> <span class="n">s_x</span><span class="p">))</span> <span class="o">+</span> <span class="p">(</span><span class="n">s_y</span> <span class="o">*</span> <span class="n">s_y</span><span class="p">))))</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="n">abi_lon</span> <span class="o">=</span> <span class="p">(</span><span class="n">lambda_0</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">s_y</span> <span class="o">/</span> <span class="p">(</span><span class="n">H</span> <span class="o">-</span> <span class="n">s_x</span><span class="p">)))</span> <span class="o">*</span> <span class="p">(</span><span class="mf">180.0</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;INFO : Latitude and longitude calculated&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">abi_lat</span><span class="p">,</span> <span class="n">abi_lon</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.func.create_folder" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_folder</span><span class="p">(</span><span class="n">experiment_name</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Create a folder for saving results based on the experiment name.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>experiment_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the experiment to create a folder for.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the created folder.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\func.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create_folder</span><span class="p">(</span><span class="n">experiment_name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a folder for saving results based on the experiment name.</span>

<span class="sd">    Args:</span>
<span class="sd">        experiment_name (str): Name of the experiment to create a folder for.</span>
<span class="sd">        If the folder already exists, it will not be created again.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Path to the created folder.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">path_folder</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;./results_folder/model_day_</span><span class="si">{</span><span class="n">experiment_name</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path_folder</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">path_folder</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Folder created at </span><span class="si">{</span><span class="n">path_folder</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">path_folder</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.func.extract_goes" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">extract_goes</span><span class="p">(</span><span class="n">observation_times</span><span class="p">,</span> <span class="n">observation_lats</span><span class="p">,</span> <span class="n">observation_lons</span><span class="p">,</span> <span class="n">scatterometer_data_path</span><span class="p">,</span> <span class="n">goes_aws_url_folder</span><span class="p">,</span> <span class="n">goes_channel</span><span class="o">=</span><span class="s1">&#39;C01&#39;</span><span class="p">,</span> <span class="n">goes_image_size</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>This function extracts GOES images for the given observation times, latitudes, and longitudes.
It retrieves the GOES data from the specified AWS S3 bucket and processes it to create images of the specified size.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>observation_times</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The times of observation of the scatterometer data. </p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>observation_lats</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The latitudes of the scatterometer data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>observation_lons</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The longitudes of the scatterometer data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>scatterometer_data_path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The path to the scatterometer data directory.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>goes_aws_url_folder</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The folder in the AWS S3 bucket where the GOES data is stored.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>goes_channel</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The channel of interest. Default is "C01".</p>
              </div>
            </td>
            <td>
                  <code>&#39;C01&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>goes_image_size</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The size of the output images. Default is 128.</p>
              </div>
            </td>
            <td>
                  <code>128</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>verbose</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, prints progress information.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>images</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A 4D numpy array of shape (num_observations, num_channels, goes_image_size, goes_image_size) containing the extracted GOES images.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\func.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">extract_goes</span><span class="p">(</span>
    <span class="n">observation_times</span><span class="p">,</span>
    <span class="n">observation_lats</span><span class="p">,</span>
    <span class="n">observation_lons</span><span class="p">,</span>
    <span class="n">scatterometer_data_path</span><span class="p">,</span>
    <span class="n">goes_aws_url_folder</span><span class="p">,</span>
    <span class="n">goes_channel</span><span class="o">=</span><span class="s2">&quot;C01&quot;</span><span class="p">,</span>
    <span class="n">goes_image_size</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function extracts GOES images for the given observation times, latitudes, and longitudes.</span>
<span class="sd">    It retrieves the GOES data from the specified AWS S3 bucket and processes it to create images of the specified size.</span>

<span class="sd">    Args:</span>
<span class="sd">        observation_times (numpy.ndarray): The times of observation of the scatterometer data. </span>
<span class="sd">        observation_lats (numpy.ndarray): The latitudes of the scatterometer data.</span>
<span class="sd">        observation_lons (numpy.ndarray): The longitudes of the scatterometer data.</span>
<span class="sd">        scatterometer_data_path (str): The path to the scatterometer data directory.</span>
<span class="sd">        goes_aws_url_folder (str): The folder in the AWS S3 bucket where the GOES data is stored.</span>
<span class="sd">        goes_channel (str): The channel of interest. Default is &quot;C01&quot;.</span>
<span class="sd">        goes_image_size (int): The size of the output images. Default is 128.</span>
<span class="sd">        verbose (bool): If True, prints progress information.</span>

<span class="sd">    Returns:</span>
<span class="sd">        images (numpy.ndarray): A 4D numpy array of shape (num_observations, num_channels, goes_image_size, goes_image_size) containing the extracted GOES images.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">scatterometer_data_path</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.nc&quot;</span><span class="p">):</span>
            <span class="n">polar</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">scatterometer_data_path</span><span class="p">,</span> <span class="n">file</span><span class="p">),</span>
                <span class="n">engine</span><span class="o">=</span><span class="s2">&quot;h5netcdf&quot;</span><span class="p">,</span>
                <span class="n">drop_variables</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;DQF&quot;</span><span class="p">],</span>
            <span class="p">)</span>
            <span class="k">break</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;WARNING : No .nc file found in the scatterometer data path, please check the path&#39;</span><span class="p">)</span>

    <span class="n">template_scatter</span> <span class="o">=</span> <span class="n">polar</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">lat_grd</span><span class="p">,</span> <span class="n">lon_grd</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">template_scatter</span><span class="p">[</span><span class="s2">&quot;latitude&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
        <span class="n">template_scatter</span><span class="p">[</span><span class="s2">&quot;longitude&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">fs</span> <span class="o">=</span> <span class="n">fsspec</span><span class="o">.</span><span class="n">filesystem</span><span class="p">(</span><span class="s2">&quot;s3&quot;</span><span class="p">,</span> <span class="n">anon</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default_block_size</span><span class="o">=</span><span class="mi">512</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">1024</span><span class="p">)</span>

    <span class="n">values</span><span class="p">,</span> <span class="n">counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">observation_times</span><span class="p">,</span> <span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">all_urls</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># getting unique URLS</span>
    <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
        <span class="n">urls</span> <span class="o">=</span> <span class="n">get_goes_url</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">goes_aws_url_folder</span><span class="p">,</span><span class="n">goes_channel</span><span class="p">)</span>
        <span class="n">all_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">urls</span><span class="p">)</span>

    <span class="n">values_url</span><span class="p">,</span> <span class="n">indices_url</span><span class="p">,</span> <span class="n">counts_url</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
        <span class="n">all_urls</span><span class="p">,</span> <span class="n">return_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span>
    <span class="p">)</span>
    <span class="c1"># Sort indices to &quot;unsort&quot; the URLs</span>
    <span class="n">sorted_indices</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">indices_url</span><span class="p">)),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">k</span><span class="p">:</span> <span class="n">indices_url</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
    <span class="n">values_url</span> <span class="o">=</span> <span class="p">[</span><span class="n">all_urls</span><span class="p">[</span><span class="n">indices_url</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">sorted_indices</span><span class="p">]</span>

    <span class="c1"># Reorder counts_url using the same sorted indices</span>
    <span class="n">counts_url</span> <span class="o">=</span> <span class="p">[</span><span class="n">counts_url</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">sorted_indices</span><span class="p">]</span>

    <span class="n">compressed_urls</span> <span class="o">=</span> <span class="n">values_url</span>
    <span class="n">compressed_counts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">start_idx</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">size</span> <span class="ow">in</span> <span class="n">counts_url</span><span class="p">:</span>
        <span class="n">group_sum</span> <span class="o">=</span> <span class="n">counts</span><span class="p">[</span><span class="n">start_idx</span> <span class="p">:</span> <span class="n">start_idx</span> <span class="o">+</span> <span class="n">size</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="n">compressed_counts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">group_sum</span><span class="p">)</span>
        <span class="n">start_idx</span> <span class="o">+=</span> <span class="n">size</span>

    <span class="n">width</span> <span class="o">=</span> <span class="n">goes_image_size</span>
    <span class="n">height</span> <span class="o">=</span> <span class="n">goes_image_size</span>

    <span class="n">images</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">observation_times</span><span class="p">),</span> <span class="mi">1</span> <span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

    <span class="n">total_idx</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">unique_idx</span><span class="p">,</span> <span class="n">unique_urls</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span>
        <span class="nb">enumerate</span><span class="p">(</span><span class="n">compressed_urls</span><span class="p">),</span>
        <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;INFO : Retrieving and processing GOES data&quot;</span><span class="p">,</span>
        <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">compressed_urls</span><span class="p">),</span>
        <span class="n">disable</span><span class="o">=</span><span class="ow">not</span> <span class="n">verbose</span><span class="p">,</span>
    <span class="p">):</span>


        <span class="k">for</span> <span class="n">CH_idx</span><span class="p">,</span> <span class="n">url_CH</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">unique_urls</span><span class="p">):</span>

            <span class="k">if</span> <span class="n">url_CH</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">images</span><span class="p">[</span><span class="n">total_idx</span><span class="p">,</span> <span class="n">CH_idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">])</span>
                <span class="k">continue</span>

            <span class="k">with</span> <span class="n">fs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">url_CH</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>

                <span class="n">ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span>
                    <span class="n">f</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s2">&quot;h5netcdf&quot;</span><span class="p">,</span> <span class="n">drop_variables</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;DQF&quot;</span><span class="p">]</span>
                <span class="p">)</span>  <span class="c1"># this is the bottleneck</span>

                <span class="n">parallel_index</span> <span class="o">=</span> <span class="n">index_parallel</span><span class="p">(</span>
                    <span class="n">ds</span><span class="p">,</span>
                    <span class="n">template_scatter</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">compressed_counts</span><span class="p">[</span><span class="n">unique_idx</span><span class="p">]):</span>
                    <span class="n">images</span><span class="p">[</span><span class="n">total_idx</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span> <span class="n">CH_idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_image</span><span class="p">(</span>
                        <span class="n">ds</span><span class="o">=</span><span class="n">ds</span><span class="p">,</span>
                        <span class="n">parallel_index</span><span class="o">=</span><span class="n">parallel_index</span><span class="p">,</span>
                        <span class="n">lat_grd</span><span class="o">=</span><span class="n">lat_grd</span><span class="p">,</span>
                        <span class="n">lon_grd</span><span class="o">=</span><span class="n">lon_grd</span><span class="p">,</span>
                        <span class="n">lat_search</span><span class="o">=</span><span class="n">observation_lats</span><span class="p">[</span><span class="n">total_idx</span> <span class="o">+</span> <span class="n">i</span><span class="p">],</span>
                        <span class="n">lon_search</span><span class="o">=</span><span class="n">observation_lons</span><span class="p">[</span><span class="n">total_idx</span> <span class="o">+</span> <span class="n">i</span><span class="p">],</span>
                        <span class="n">goes_image_size</span><span class="o">=</span><span class="n">goes_image_size</span><span class="p">,</span>
                    <span class="p">)</span>

        <span class="n">total_idx</span> <span class="o">+=</span> <span class="n">compressed_counts</span><span class="p">[</span><span class="n">unique_idx</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;INFO : Extracted </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">observation_times</span><span class="p">)</span><span class="si">}</span><span class="s2"> images from </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">compressed_urls</span><span class="p">)</span><span class="si">}</span><span class="s2"> GOES files.&quot;</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">images</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.func.extract_goes_inference" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">extract_goes_inference</span><span class="p">(</span><span class="n">date_time</span><span class="p">,</span> <span class="n">parallel_index</span><span class="p">,</span> <span class="n">channels</span><span class="o">=</span><span class="s1">&#39;C01&#39;</span><span class="p">,</span> <span class="n">goes_aws_url_folder</span><span class="o">=</span><span class="s1">&#39;noaa-goes16/ABI-L2-CMIPF&#39;</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>This function extracts GOES images for a given date_time and parallel_index. (whole GOES slice, used for inference which differs from images used in training that have a matched orbit with scatterometers.)
It retrieves the GOES data from the specified AWS S3 bucket and processes it to create
images of the specified size (128x128).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>date_time</code>
            </td>
            <td>
                  <code><span title="numpy.datetime64">datetime64</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The time of the GOES data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>parallel_index</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The precomputed indices for GOES pixels corresponding to scatterometer lat/lon.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>channels</code>
            </td>
            <td>
                  <code><span title="str">str</span> or <span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The channel(s) of interest. Default is "C01".</p>
              </div>
            </td>
            <td>
                  <code>&#39;C01&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>goes_aws_url_folder</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The folder in the AWS S3 bucket where the GOES data is stored. Default is 'noaa-goes16/ABI-L2-CMIPF'.</p>
              </div>
            </td>
            <td>
                  <code>&#39;noaa-goes16/ABI-L2-CMIPF&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>images</code></td>            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of numpy arrays containing the extracted GOES images of shape (128, 128).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\func.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">extract_goes_inference</span><span class="p">(</span><span class="n">date_time</span><span class="p">,</span> <span class="n">parallel_index</span><span class="p">,</span><span class="n">channels</span><span class="o">=</span><span class="s2">&quot;C01&quot;</span><span class="p">,</span><span class="n">goes_aws_url_folder</span><span class="o">=</span> <span class="s1">&#39;noaa-goes16/ABI-L2-CMIPF&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function extracts GOES images for a given date_time and parallel_index. (whole GOES slice, used for inference which differs from images used in training that have a matched orbit with scatterometers.)</span>
<span class="sd">    It retrieves the GOES data from the specified AWS S3 bucket and processes it to create</span>
<span class="sd">    images of the specified size (128x128).</span>

<span class="sd">    Args:</span>
<span class="sd">        date_time (numpy.datetime64): The time of the GOES data.</span>
<span class="sd">        parallel_index (numpy.ndarray): The precomputed indices for GOES pixels corresponding to scatterometer lat/lon.</span>
<span class="sd">        channels (str or list): The channel(s) of interest. Default is &quot;C01&quot;.</span>
<span class="sd">        goes_aws_url_folder (str): The folder in the AWS S3 bucket where the GOES data is stored. Default is &#39;noaa-goes16/ABI-L2-CMIPF&#39;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        images (list): A list of numpy arrays containing the extracted GOES images of shape (128, 128).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># ignore divide by zero errors which occur when the GOES data can&#39;t form a 128x128 image</span>
    <span class="n">np</span><span class="o">.</span><span class="n">seterr</span><span class="p">(</span><span class="n">invalid</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">divide</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>

    <span class="n">fs</span> <span class="o">=</span> <span class="n">fsspec</span><span class="o">.</span><span class="n">filesystem</span><span class="p">(</span><span class="s2">&quot;s3&quot;</span><span class="p">,</span> <span class="n">anon</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default_block_size</span><span class="o">=</span><span class="mi">512</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">1024</span><span class="p">)</span>
    <span class="n">urls</span> <span class="o">=</span> <span class="n">get_goes_url</span><span class="p">(</span><span class="n">date_time</span><span class="p">,</span> <span class="n">goes_aws_url_folder</span><span class="o">=</span><span class="s1">&#39;noaa-goes16/ABI-L2-CMIPF&#39;</span><span class="p">,</span> <span class="n">goes_channel</span><span class="o">=</span> <span class="n">channels</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">fs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">urls</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;INFO : Reading file:&quot;</span><span class="p">,</span> <span class="n">urls</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">goes_image</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">goes_image</span> <span class="o">=</span> <span class="n">goes_image</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="s2">&quot;x_index&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="s2">&quot;y_index&quot;</span><span class="p">})</span>

        <span class="c1"># Assign the index coordinates (if not already done)</span>
        <span class="n">goes_image</span> <span class="o">=</span> <span class="n">goes_image</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">(</span>
            <span class="n">x_index</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">goes_image</span><span class="o">.</span><span class="n">sizes</span><span class="p">[</span><span class="s2">&quot;x_index&quot;</span><span class="p">]),</span>
            <span class="n">y_index</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">goes_image</span><span class="o">.</span><span class="n">sizes</span><span class="p">[</span><span class="s2">&quot;y_index&quot;</span><span class="p">]),</span>
        <span class="p">)</span>

        <span class="n">images</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">goes_image</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;INFO : Extracting images&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">parallel_index</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">parallel_index</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">x_mean</span> <span class="o">=</span> <span class="n">parallel_index</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
                    <span class="n">x_min</span> <span class="o">=</span> <span class="n">x_mean</span> <span class="o">-</span> <span class="mi">63</span>
                    <span class="n">x_max</span> <span class="o">=</span> <span class="n">x_mean</span> <span class="o">+</span> <span class="mi">63</span>
                    <span class="n">y_mean</span> <span class="o">=</span> <span class="n">parallel_index</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
                    <span class="n">y_min</span> <span class="o">=</span> <span class="n">y_mean</span> <span class="o">-</span> <span class="mi">63</span>
                    <span class="n">y_max</span> <span class="o">=</span> <span class="n">y_mean</span> <span class="o">+</span> <span class="mi">63</span>
                    <span class="n">image</span> <span class="o">=</span> <span class="n">goes_image</span><span class="o">.</span><span class="n">CMI</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span>
                        <span class="n">x_index</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">),</span> <span class="n">y_index</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span><span class="p">)</span>
                    <span class="p">)</span>

                    <span class="n">target_size</span> <span class="o">=</span> <span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">)</span>

                    <span class="n">padded_image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span>
                        <span class="n">image</span><span class="p">,</span>
                        <span class="p">(</span>
                            <span class="p">(</span>
                                <span class="p">(</span><span class="n">target_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span>
                                <span class="p">(</span><span class="n">target_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span>
                            <span class="p">),</span>
                            <span class="p">(</span>
                                <span class="p">(</span><span class="n">target_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span>
                                <span class="p">(</span><span class="n">target_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span>
                            <span class="p">),</span>
                        <span class="p">),</span>
                        <span class="n">constant_values</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                    <span class="p">)</span>

                <span class="k">except</span><span class="p">:</span>
                    <span class="n">images</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">)))</span>

                    <span class="k">continue</span>
                <span class="n">images</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">padded_image</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">images</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.func.extract_scatter" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">extract_scatter</span><span class="p">(</span><span class="n">polar_data</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">lat_range</span><span class="p">,</span> <span class="n">lon_range</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">main_variable</span><span class="o">=</span><span class="s1">&#39;wind_speed&#39;</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>This function extracts the scatterometer data from the polar_data dataset for the given time range, latitude range and longitude range.
The function then saves the data into 4 numpy files : time of observation, latitude, longitude and main variable.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>polar_data</code>
            </td>
            <td>
                  <code><span title="xarray.Dataset">Dataset</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The scatterometer dataset (ASCAT, HYSCAT etc).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>date</code>
            </td>
            <td>
                  <code><span title="numpy.datetime64">datetime64</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The time of the scatterometer data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lat_range</code>
            </td>
            <td>
                  <code><span title="tuple">tuple</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The latitude range of the scatterometer data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lon_range</code>
            </td>
            <td>
                  <code><span title="tuple">tuple</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The longitude range of the scatterometer data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>verbose</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, the function will print the progress of the extraction.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>main_variable</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The main variable to be extracted from the scatterometer data. This can be wind speed, wind direction, classification etc.</p>
              </div>
            </td>
            <td>
                  <code>&#39;wind_speed&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>observation_times</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The time of observation of the scatterometer data.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>observation_lats</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The latitude of the scatterometer data.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>observation_lons</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The longitude of the scatterometer data.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>observation_main_parameter</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>main parameter extracted (wind_speed).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\func.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">extract_scatter</span><span class="p">(</span>
    <span class="n">polar_data</span><span class="p">,</span>
    <span class="n">date</span><span class="p">,</span>
    <span class="n">lat_range</span><span class="p">,</span>
    <span class="n">lon_range</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">main_variable</span><span class="o">=</span><span class="s2">&quot;wind_speed&quot;</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function extracts the scatterometer data from the polar_data dataset for the given time range, latitude range and longitude range.</span>
<span class="sd">    The function then saves the data into 4 numpy files : time of observation, latitude, longitude and main variable.</span>

<span class="sd">    Args:</span>
<span class="sd">        polar_data (xarray.Dataset): The scatterometer dataset (ASCAT, HYSCAT etc).</span>
<span class="sd">        date (numpy.datetime64): The time of the scatterometer data.</span>
<span class="sd">        lat_range (tuple): The latitude range of the scatterometer data.</span>
<span class="sd">        lon_range (tuple): The longitude range of the scatterometer data.</span>
<span class="sd">        verbose (bool): If True, the function will print the progress of the extraction.</span>
<span class="sd">        main_variable (str): The main variable to be extracted from the scatterometer data. This can be wind speed, wind direction, classification etc.</span>

<span class="sd">    Returns:</span>
<span class="sd">        observation_times (numpy.ndarray): The time of observation of the scatterometer data.</span>
<span class="sd">        observation_lats (numpy.ndarray): The latitude of the scatterometer data.</span>
<span class="sd">        observation_lons (numpy.ndarray): The longitude of the scatterometer data.</span>
<span class="sd">        observation_main_parameter (numpy.ndarray): main parameter extracted (wind_speed).</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">polar</span> <span class="o">=</span> <span class="n">polar_data</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span>
        <span class="n">time</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="n">date</span><span class="p">),</span>
        <span class="n">latitude</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">lat_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lat_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
        <span class="n">longitude</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">lon_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lon_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
    <span class="p">)</span>

    <span class="n">seperated_scatter</span> <span class="o">=</span> <span class="n">savedataseperated</span><span class="p">(</span><span class="n">polar</span><span class="p">,</span> <span class="n">polar</span><span class="p">[</span><span class="n">main_variable</span><span class="p">],</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>

    <span class="n">observation_times</span> <span class="o">=</span> <span class="n">seperated_scatter</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">observation_lats</span> <span class="o">=</span> <span class="n">seperated_scatter</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">observation_lons</span> <span class="o">=</span> <span class="n">seperated_scatter</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">observation_wind_speeds</span> <span class="o">=</span> <span class="n">seperated_scatter</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>



    <span class="k">return</span> <span class="p">(</span>
        <span class="n">observation_times</span><span class="p">,</span>
        <span class="n">observation_lats</span><span class="p">,</span>
        <span class="n">observation_lons</span><span class="p">,</span>
        <span class="n">observation_wind_speeds</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.func.fill_nans" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">fill_nans</span><span class="p">(</span><span class="n">images</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>This function fills NaN values in the images with zeros. (This is simply np.nan_to_num)</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>images</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A 4D numpy array of shape (num_images, num_channels, height, width) containing the GOES images.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>images</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A 4D numpy array with NaN values replaced by zeros.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\func.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fill_nans</span><span class="p">(</span><span class="n">images</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function fills NaN values in the images with zeros. (This is simply np.nan_to_num)</span>

<span class="sd">    Args:</span>
<span class="sd">        images (numpy.ndarray): A 4D numpy array of shape (num_images, num_channels, height, width) containing the GOES images.</span>

<span class="sd">    Returns:</span>
<span class="sd">        images (numpy.ndarray): A 4D numpy array with NaN values replaced by zeros.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">images</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="n">nan</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;INFO : Filled nans&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">images</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.func.filter_invalid" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">filter_invalid</span><span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="n">numerical_data</span><span class="p">,</span> <span class="n">min_nonzero_pixels</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>This function filters out invalid images and corresponding numerical data based on two criteria:
1) The sum of pixel values in the image is not zero (i.e., the image is not completely empty).
2) The number of non-zero pixels in the image is greater than or equal to a specified minimum threshold (default is 50).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>images</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A 4D numpy array of shape (num_images, num_channels, height, width) containing the GOES images.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>numerical_data</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary containing numerical data associated with the images. The keys should match the dimensions of the images.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>min_nonzero_pixels</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The minimum number of non-zero pixels required for an image to be considered valid. Default is 50.</p>
              </div>
            </td>
            <td>
                  <code>50</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>filtered_images</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A 4D numpy array of shape (num_valid_images, num_channels, height, width) containing the filtered GOES images.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>filtered_numerical_data</code></td>            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary containing the numerical data associated with the valid images.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\func.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">filter_invalid</span><span class="p">(</span>
    <span class="n">images</span><span class="p">,</span>
    <span class="n">numerical_data</span><span class="p">,</span>
    <span class="n">min_nonzero_pixels</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
<span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function filters out invalid images and corresponding numerical data based on two criteria:</span>
<span class="sd">    1) The sum of pixel values in the image is not zero (i.e., the image is not completely empty).</span>
<span class="sd">    2) The number of non-zero pixels in the image is greater than or equal to a specified minimum threshold (default is 50).</span>

<span class="sd">    Args:</span>
<span class="sd">        images (numpy.ndarray): A 4D numpy array of shape (num_images, num_channels, height, width) containing the GOES images.</span>
<span class="sd">        numerical_data (dict): A dictionary containing numerical data associated with the images. The keys should match the dimensions of the images.</span>
<span class="sd">        min_nonzero_pixels (int): The minimum number of non-zero pixels required for an image to be considered valid. Default is 50.</span>

<span class="sd">    Returns:</span>
<span class="sd">        filtered_images (numpy.ndarray): A 4D numpy array of shape (num_valid_images, num_channels, height, width) containing the filtered GOES images.</span>
<span class="sd">        filtered_numerical_data (dict): A dictionary containing the numerical data associated with the valid images.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Sums of pixel values in each image</span>
    <span class="n">sums_images</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">images</span><span class="p">]</span>

    <span class="c1"># Counts of non-zero pixels in each image</span>
    <span class="n">nonzero_counts</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">images</span><span class="p">]</span>

    <span class="c1"># Build a &quot;mask_invalid&quot; array of indices that fail any criterion:</span>
    <span class="c1"># 1) sum == 0 (completely empty)</span>
    <span class="c1"># 2) nonzero pixel count &lt; min_nonzero_pixels (not enough data)</span>

    <span class="n">mask_valid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
        <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sums_images</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">nonzero_counts</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">min_nonzero_pixels</span><span class="p">)</span>
    <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># Delete the invalid entries from each array</span>
    <span class="n">filtered_numerical_data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">key</span><span class="p">:</span> <span class="n">value</span><span class="p">[</span><span class="n">mask_valid</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">numerical_data</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
    <span class="p">}</span>
    <span class="n">filtered_images</span> <span class="o">=</span> <span class="n">images</span><span class="p">[</span><span class="n">mask_valid</span><span class="p">]</span>
    <span class="n">n_removed_images</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">images</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">filtered_images</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span>
        <span class="s2">&quot;INFO : Filtered invalid images. Removed </span><span class="si">{}</span><span class="s2"> entries.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">n_removed_images</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="n">filtered_images</span><span class="p">,</span>
        <span class="n">filtered_numerical_data</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.func.filter_nighttime" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">filter_nighttime</span><span class="p">(</span><span class="n">observation_times</span><span class="p">,</span> <span class="n">observation_lats</span><span class="p">,</span> <span class="n">observation_lons</span><span class="p">,</span> <span class="n">observation_wind_speeds</span><span class="p">,</span> <span class="n">min_hour</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">max_hour</span><span class="o">=</span><span class="mi">19</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>This function filters the scatterometer data to only include observations that were made during daylight hours.
The function checks the hour of each observation time and only keeps those that fall within the specified
range (default is 10 to 19, which corresponds to 10 AM to 7 PM UTC).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>observation_times</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The times of observation of the scatterometer data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>observation_lats</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The latitudes of the scatterometer data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>observation_lons</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The longitudes of the scatterometer data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>observation_wind_speeds</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The wind speeds of the scatterometer data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>min_hour</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The minimum hour of the day to include (default is 10).</p>
              </div>
            </td>
            <td>
                  <code>10</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_hour</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The maximum hour of the day to include (default is 19).</p>
              </div>
            </td>
            <td>
                  <code>19</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>verbose</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, prints the number of valid scatterometer data points at daylight.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>valid_times</code></td>            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of valid observation times that fall within the specified hour range.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>valid_lats</code></td>            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of valid latitudes corresponding to the valid observation times</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>valid_lons</code></td>            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of valid longitudes corresponding to the valid observation times.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>valid_wind_speeds</code></td>            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of valid wind speeds corresponding to the valid observation times.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\func.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">filter_nighttime</span><span class="p">(</span>
    <span class="n">observation_times</span><span class="p">,</span>
    <span class="n">observation_lats</span><span class="p">,</span>
    <span class="n">observation_lons</span><span class="p">,</span>
    <span class="n">observation_wind_speeds</span><span class="p">,</span>
    <span class="n">min_hour</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">max_hour</span><span class="o">=</span><span class="mi">19</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function filters the scatterometer data to only include observations that were made during daylight hours.</span>
<span class="sd">    The function checks the hour of each observation time and only keeps those that fall within the specified</span>
<span class="sd">    range (default is 10 to 19, which corresponds to 10 AM to 7 PM UTC).</span>

<span class="sd">    Args:</span>
<span class="sd">        observation_times (numpy.ndarray): The times of observation of the scatterometer data.</span>
<span class="sd">        observation_lats (numpy.ndarray): The latitudes of the scatterometer data.</span>
<span class="sd">        observation_lons (numpy.ndarray): The longitudes of the scatterometer data.</span>
<span class="sd">        observation_wind_speeds (numpy.ndarray): The wind speeds of the scatterometer data.</span>
<span class="sd">        min_hour (int): The minimum hour of the day to include (default is 10).</span>
<span class="sd">        max_hour (int): The maximum hour of the day to include (default is 19).</span>
<span class="sd">        verbose (bool): If True, prints the number of valid scatterometer data points at daylight.</span>

<span class="sd">    Returns:</span>
<span class="sd">        valid_times (list): A list of valid observation times that fall within the specified hour range.</span>
<span class="sd">        valid_lats (list): A list of valid latitudes corresponding to the valid observation times</span>
<span class="sd">        valid_lons (list): A list of valid longitudes corresponding to the valid observation times.</span>
<span class="sd">        valid_wind_speeds (list): A list of valid wind speeds corresponding to the valid observation times.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">valid_times</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">valid_lats</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">valid_lons</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">valid_wind_speeds</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">observation_times</span><span class="p">)):</span>
        <span class="n">only_hour</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
            <span class="n">observation_times</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;datetime64[ns]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;str&quot;</span><span class="p">)[</span><span class="mi">11</span><span class="p">:</span><span class="mi">13</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">min_hour</span> <span class="o">&lt;=</span> <span class="n">only_hour</span> <span class="o">&lt;=</span> <span class="n">max_hour</span><span class="p">:</span>
            <span class="n">valid_times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">observation_times</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
            <span class="n">valid_lats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">observation_lats</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
            <span class="n">valid_lons</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">observation_lons</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
            <span class="n">valid_wind_speeds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">observation_wind_speeds</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;INFO : Total number of scatterometer data points at daylight : </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">valid_times</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">valid_times</span><span class="p">,</span> <span class="n">valid_lats</span><span class="p">,</span> <span class="n">valid_lons</span><span class="p">,</span> <span class="n">valid_wind_speeds</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.func.get_goes_url" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_goes_url</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">goes_aws_url_folder</span><span class="o">=</span><span class="s1">&#39;noaa-goes16/ABI-L2-CMIPF&#39;</span><span class="p">,</span> <span class="n">goes_channel</span><span class="o">=</span><span class="s1">&#39;C01&#39;</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>This function gets the nearest GOES-16 files from the time given.
The function returns a list of urls to the files.
The function uses the s3fs library to access the AWS GOES-16 data.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>time</code>
            </td>
            <td>
                  <code><span title="numpy.datetime">datetime</span>[<span title="ns">ns</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The time of the scatterometer data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>goes_aws_url_folder</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The folder in the AWS S3 bucket where the GOES-16 data is stored.</p>
              </div>
            </td>
            <td>
                  <code>&#39;noaa-goes16/ABI-L2-CMIPF&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>goes_channel</code>
            </td>
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The channel of interest.</p>
              </div>
            </td>
            <td>
                  <code>&#39;C01&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>urls</code></td>            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of urls to the GOES-16 files.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\func.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_goes_url</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">goes_aws_url_folder</span><span class="o">=</span><span class="s1">&#39;noaa-goes16/ABI-L2-CMIPF&#39;</span><span class="p">,</span> <span class="n">goes_channel</span><span class="o">=</span><span class="s2">&quot;C01&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function gets the nearest GOES-16 files from the time given.</span>
<span class="sd">    The function returns a list of urls to the files.</span>
<span class="sd">    The function uses the s3fs library to access the AWS GOES-16 data.</span>

<span class="sd">    Args:</span>
<span class="sd">        time (numpy.datetime[ns]): The time of the scatterometer data.</span>
<span class="sd">        goes_aws_url_folder (str): The folder in the AWS S3 bucket where the GOES-16 data is stored.</span>
<span class="sd">        goes_channel (list): The channel of interest.</span>

<span class="sd">    Returns:</span>
<span class="sd">        urls (list): A list of urls to the GOES-16 files.</span>


<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">date_c</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;datetime64[ns]&quot;</span><span class="p">)</span>
    <span class="n">date</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">date_c</span><span class="p">)</span>
    <span class="n">date_str</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y/%j/%H&quot;</span><span class="p">)</span>
    <span class="nb">min</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%M&quot;</span><span class="p">))</span>
    <span class="n">min_range</span> <span class="o">=</span> <span class="p">[(</span><span class="nb">min</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span> <span class="o">%</span> <span class="mi">60</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">)]</span>
    <span class="n">min_range_str</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">x</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">min_range</span><span class="p">]</span>
    <span class="n">fs</span> <span class="o">=</span> <span class="n">s3fs</span><span class="o">.</span><span class="n">S3FileSystem</span><span class="p">(</span><span class="n">anon</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># get the nearest goes file from time</span>

    <span class="n">urls</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">channel</span> <span class="o">=</span> <span class="n">goes_channel</span>
    <span class="n">path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">goes_aws_url_folder</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">date_str</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">files</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">ls</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="n">filter_channel</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">files</span> <span class="k">if</span> <span class="n">channel</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">filter_channel</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;INFO :No file found for </span><span class="si">{</span><span class="n">channel</span><span class="si">}</span><span class="s2"> on day </span><span class="si">{</span><span class="n">date_str</span><span class="si">}</span><span class="s2">, skipping file&quot;</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="n">file</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">filter_channel</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">73</span><span class="p">:</span><span class="mi">75</span><span class="p">]</span> <span class="ow">in</span> <span class="n">min_range_str</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">file</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;INFO :No file found for </span><span class="si">{</span><span class="n">channel</span><span class="si">}</span><span class="s2"> on day </span><span class="si">{</span><span class="n">date_str</span><span class="si">}</span><span class="s2"> for minute </span><span class="si">{</span><span class="nb">min</span><span class="si">}</span><span class="s2">, skipping file&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">goes_channel</span><span class="p">))</span>
    <span class="n">urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;s3://&quot;</span> <span class="o">+</span> <span class="n">file</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">urls</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.func.get_image" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_image</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">parallel_index</span><span class="p">,</span> <span class="n">lat_grd</span><span class="p">,</span> <span class="n">lon_grd</span><span class="p">,</span> <span class="n">lat_search</span><span class="p">,</span> <span class="n">lon_search</span><span class="p">,</span> <span class="n">goes_image_size</span><span class="o">=</span><span class="mi">128</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>This function retrieves a trainable GOES image for a given latitude and longitude from a GOES16 <code>.nc</code> file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>ds</code>
            </td>
            <td>
                  <code><span title="xarray.Dataset">Dataset</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The xarray dataset containing the GOES data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>parallel_index</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The precomputed indices for GOES pixels corresponding to scatterometer lat/lon.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lat_grd</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The latitude grid of the scatterometer data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lon_grd</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The longitude grid of the scatterometer data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lat_search</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The latitude to search for in the GOES data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lon_search</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The longitude to search for in the GOES data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>goes_image_size</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The size of the output image. Default is 128.</p>
              </div>
            </td>
            <td>
                  <code>128</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>padded_image</code></td>            <td>
                  <code><span title="xarray.DataArray">DataArray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A padded xarray DataArray containing the GOES image centered around the specified lat/lon.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\func.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_image</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">parallel_index</span><span class="p">,</span> <span class="n">lat_grd</span><span class="p">,</span> <span class="n">lon_grd</span><span class="p">,</span> <span class="n">lat_search</span><span class="p">,</span> <span class="n">lon_search</span><span class="p">,</span><span class="n">goes_image_size</span><span class="o">=</span><span class="mi">128</span><span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function retrieves a trainable GOES image for a given latitude and longitude from a GOES16 `.nc` file.</span>

<span class="sd">    Args:</span>
<span class="sd">        ds (xarray.Dataset): The xarray dataset containing the GOES data.</span>
<span class="sd">        parallel_index (numpy.ndarray): The precomputed indices for GOES pixels corresponding to scatterometer lat/lon.</span>
<span class="sd">        lat_grd (numpy.ndarray): The latitude grid of the scatterometer data.</span>
<span class="sd">        lon_grd (numpy.ndarray): The longitude grid of the scatterometer data.</span>
<span class="sd">        lat_search (float): The latitude to search for in the GOES data.</span>
<span class="sd">        lon_search (float): The longitude to search for in the GOES data.</span>
<span class="sd">        goes_image_size (int): The size of the output image. Default is 128.</span>

<span class="sd">    Returns:</span>
<span class="sd">        padded_image (xarray.DataArray): A padded xarray DataArray containing the GOES image centered around the specified lat/lon.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">index_row</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
        <span class="n">lat_grd</span> <span class="o">==</span> <span class="n">lat_search</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">index_column</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">lon_grd</span> <span class="o">==</span> <span class="n">lon_search</span><span class="p">)</span>

    <span class="n">rows_goes</span> <span class="o">=</span> <span class="n">parallel_index</span><span class="p">[</span><span class="n">index_row</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">index_column</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">columns_goes</span> <span class="o">=</span> <span class="n">parallel_index</span><span class="p">[</span><span class="n">index_row</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">index_column</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]][</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">rows_goes</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">columns_goes</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="n">pixels_from_center</span> <span class="o">=</span> <span class="p">(</span><span class="n">goes_image_size</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
    <span class="n">mean_row</span> <span class="o">=</span> <span class="n">rows_goes</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">min_row</span> <span class="o">=</span> <span class="n">mean_row</span> <span class="o">-</span> <span class="n">pixels_from_center</span>
    <span class="n">max_row</span> <span class="o">=</span> <span class="n">mean_row</span> <span class="o">+</span> <span class="n">pixels_from_center</span>

    <span class="n">mean_col</span> <span class="o">=</span> <span class="n">columns_goes</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">min_col</span> <span class="o">=</span> <span class="n">mean_col</span> <span class="o">-</span> <span class="n">pixels_from_center</span>
    <span class="n">max_col</span> <span class="o">=</span> <span class="n">mean_col</span> <span class="o">+</span> <span class="n">pixels_from_center</span>

    <span class="k">if</span> <span class="s2">&quot;CMI&quot;</span> <span class="ow">in</span> <span class="n">ds</span><span class="p">:</span> <span class="c1"># If using GOES-16 L2 processed data</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">CMI</span><span class="p">[</span><span class="n">min_row</span><span class="p">:</span><span class="n">max_row</span><span class="p">,</span> <span class="n">min_col</span><span class="p">:</span><span class="n">max_col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

    <span class="k">elif</span> <span class="s2">&quot;Rad&quot;</span> <span class="ow">in</span> <span class="n">ds</span><span class="p">:</span> <span class="c1">#If using GOES-16 L1b data</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">Rad</span><span class="p">[</span><span class="n">min_row</span><span class="p">:</span><span class="n">max_row</span><span class="p">,</span> <span class="n">min_col</span><span class="p">:</span><span class="n">max_col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

    <span class="c1"># debug</span>
    <span class="c1"># print(min_row,&#39;= min_row&#39;, max_row,&#39;= max_row&#39;, min_col, &#39;= min_col&#39;, max_col, &#39;= max_col&#39;)</span>
    <span class="n">target_size</span> <span class="o">=</span> <span class="p">(</span><span class="n">goes_image_size</span><span class="p">,</span> <span class="n">goes_image_size</span><span class="p">)</span>

    <span class="n">padded_image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span>
        <span class="n">image</span><span class="p">,</span>
        <span class="p">(</span>
            <span class="p">(</span>
                <span class="p">(</span><span class="n">target_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span>
                <span class="p">(</span><span class="n">target_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="p">(</span>
                <span class="p">(</span><span class="n">target_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span>
                <span class="p">(</span><span class="n">target_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">),</span>
        <span class="n">constant_values</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">padded_image</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">padded_image</span><span class="p">,</span> <span class="n">dims</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">padded_image</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.func.get_indices" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_indices</span><span class="p">(</span><span class="n">lat_grid</span><span class="p">,</span> <span class="n">lon_grid</span><span class="p">,</span> <span class="n">Goeslat</span><span class="p">,</span> <span class="n">Goeslon</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mf">0.125</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Finds the corresponding GOES row and column indices for each scatterometer point
using a BallTree for efficiency, and then filtering points to form a square bounding box.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>lat_grid</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>2D array of latitudes from the scatterometer data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lon_grid</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>2D array of longitudes from the scatterometer data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>Goeslat</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>2D array of latitudes from the GOES data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>Goeslon</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>2D array of longitudes from the GOES data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>radius</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Radius in degrees to define the bounding box around each scatterometer point.</p>
              </div>
            </td>
            <td>
                  <code>0.125</code>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Returns:
    indices_array (numpy.ndarray): 2D array of tuples, where each tuple contains the row and column indices of the corresponding GOES pixel for each scatterometer point.</p>


            <details class="quote">
              <summary>Source code in <code>windscangeo\func.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_indices</span><span class="p">(</span><span class="n">lat_grid</span><span class="p">,</span> <span class="n">lon_grid</span><span class="p">,</span> <span class="n">Goeslat</span><span class="p">,</span> <span class="n">Goeslon</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mf">0.125</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Finds the corresponding GOES row and column indices for each scatterometer point</span>
<span class="sd">    using a BallTree for efficiency, and then filtering points to form a square bounding box.</span>

<span class="sd">    Args:</span>
<span class="sd">        lat_grid (numpy.ndarray): 2D array of latitudes from the scatterometer data.</span>
<span class="sd">        lon_grid (numpy.ndarray): 2D array of longitudes from the scatterometer data.</span>
<span class="sd">        Goeslat (numpy.ndarray): 2D array of latitudes from the GOES data.</span>
<span class="sd">        Goeslon (numpy.ndarray): 2D array of longitudes from the GOES data.</span>
<span class="sd">        radius (float): Radius in degrees to define the bounding box around each scatterometer point.</span>
<span class="sd">    Returns:</span>
<span class="sd">        indices_array (numpy.ndarray): 2D array of tuples, where each tuple contains the row and column indices of the corresponding GOES pixel for each scatterometer point.</span>


<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;INFO : Calculating indices&quot;</span><span class="p">)</span>
    <span class="c1"># Flatten GOES data</span>
    <span class="n">Goeslat_flat</span> <span class="o">=</span> <span class="n">Goeslat</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">Goeslon_flat</span> <span class="o">=</span> <span class="n">Goeslon</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">goes_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">Goeslat_flat</span><span class="p">,</span> <span class="n">Goeslon_flat</span><span class="p">))</span>

    <span class="c1"># Build BallTree with haversine distance</span>
    <span class="n">goes_points_rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">goes_points</span><span class="p">)</span>
    <span class="n">goes_tree</span> <span class="o">=</span> <span class="n">BallTree</span><span class="p">(</span><span class="n">goes_points_rad</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s2">&quot;haversine&quot;</span><span class="p">)</span>

    <span class="c1"># Flatten scatter grids</span>
    <span class="n">lat_flat</span> <span class="o">=</span> <span class="n">lat_grid</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">lon_flat</span> <span class="o">=</span> <span class="n">lon_grid</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">scatter_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">lat_flat</span><span class="p">,</span> <span class="n">lon_flat</span><span class="p">))</span>
    <span class="n">scatter_points_rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">scatter_points</span><span class="p">)</span>

    <span class="c1"># Radius for broad-phase query: diagonal of the bounding box</span>
    <span class="c1"># Square box radius: diagonal = radius * sqrt(2)</span>
    <span class="n">diag_radius</span> <span class="o">=</span> <span class="n">radius</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">diag_radius_rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">diag_radius</span><span class="p">)</span>

    <span class="n">indices_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">lat_flat</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>
    <span class="n">goes_shape</span> <span class="o">=</span> <span class="n">Goeslat</span><span class="o">.</span><span class="n">shape</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">lat_val</span><span class="p">,</span> <span class="n">lon_val</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">lat_flat</span><span class="p">,</span> <span class="n">lon_flat</span><span class="p">)):</span>
        <span class="c1"># Broad-phase: query all points within diagonal distance</span>
        <span class="n">candidate_indices</span> <span class="o">=</span> <span class="n">goes_tree</span><span class="o">.</span><span class="n">query_radius</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">scatter_points_rad</span><span class="p">[</span><span class="n">i</span><span class="p">]]),</span> <span class="n">r</span><span class="o">=</span><span class="n">diag_radius_rad</span>
        <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">candidate_indices</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># No points found, store empty</span>
            <span class="n">indices_array</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">))</span>
            <span class="k">continue</span>

        <span class="c1"># Post-filter candidates to keep only those in the bounding box</span>
        <span class="n">lat_min</span> <span class="o">=</span> <span class="n">lat_val</span> <span class="o">-</span> <span class="n">radius</span>
        <span class="n">lat_max</span> <span class="o">=</span> <span class="n">lat_val</span> <span class="o">+</span> <span class="n">radius</span>
        <span class="n">lon_min</span> <span class="o">=</span> <span class="n">lon_val</span> <span class="o">-</span> <span class="n">radius</span>
        <span class="n">lon_max</span> <span class="o">=</span> <span class="n">lon_val</span> <span class="o">+</span> <span class="n">radius</span>

        <span class="n">cand_lats</span> <span class="o">=</span> <span class="n">Goeslat_flat</span><span class="p">[</span><span class="n">candidate_indices</span><span class="p">]</span>
        <span class="n">cand_lons</span> <span class="o">=</span> <span class="n">Goeslon_flat</span><span class="p">[</span><span class="n">candidate_indices</span><span class="p">]</span>

        <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">cand_lats</span> <span class="o">&gt;=</span> <span class="n">lat_min</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">cand_lats</span> <span class="o">&lt;=</span> <span class="n">lat_max</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">cand_lons</span> <span class="o">&gt;=</span> <span class="n">lon_min</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">cand_lons</span> <span class="o">&lt;=</span> <span class="n">lon_max</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="n">final_indices</span> <span class="o">=</span> <span class="n">candidate_indices</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>

        <span class="c1"># Convert these flat indices back to row,col</span>
        <span class="n">rows</span><span class="p">,</span> <span class="n">cols</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unravel_index</span><span class="p">(</span><span class="n">final_indices</span><span class="p">,</span> <span class="n">goes_shape</span><span class="p">)</span>
        <span class="n">indices_array</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">)</span>

    <span class="c1"># Reshape indices_array to the original shape</span>
    <span class="n">indices_array</span> <span class="o">=</span> <span class="n">indices_array</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">lat_grid</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">indices_array</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.func.goes_index" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">goes_index</span><span class="p">(</span><span class="n">parallel_index</span><span class="p">,</span> <span class="n">lat_grd</span><span class="p">,</span> <span class="n">lon_grd</span><span class="p">,</span> <span class="n">lat_search</span><span class="p">,</span> <span class="n">lon_search</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>This function retrieves the indices of the GOES image corresponding to a given latitude and longitude. This is an archived function. Current implementation decides on extent based on chosen image size.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>parallel_index</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The precomputed indices for GOES pixels corresponding to scatterometer lat/lon.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lat_grd</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The latitude grid of the scatterometer data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lon_grd</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The longitude grid of the scatterometer data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lat_search</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The latitude to search for in the GOES data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lon_search</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The longitude to search for in the GOES data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>min_row</code></td>            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The minimum row index of the GOES image.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>max_row</code></td>            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The maximum row index of the GOES image.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>min_col</code></td>            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The minimum column index of the GOES image.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>max_col</code></td>            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The maximum column index of the GOES image.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\func.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">goes_index</span><span class="p">(</span><span class="n">parallel_index</span><span class="p">,</span> <span class="n">lat_grd</span><span class="p">,</span> <span class="n">lon_grd</span><span class="p">,</span> <span class="n">lat_search</span><span class="p">,</span> <span class="n">lon_search</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function retrieves the indices of the GOES image corresponding to a given latitude and longitude. This is an archived function. Current implementation decides on extent based on chosen image size.</span>

<span class="sd">    Args:</span>
<span class="sd">        parallel_index (numpy.ndarray): The precomputed indices for GOES pixels corresponding to scatterometer lat/lon.</span>
<span class="sd">        lat_grd (numpy.ndarray): The latitude grid of the scatterometer data.</span>
<span class="sd">        lon_grd (numpy.ndarray): The longitude grid of the scatterometer data.</span>
<span class="sd">        lat_search (float): The latitude to search for in the GOES data.</span>
<span class="sd">        lon_search (float): The longitude to search for in the GOES data.</span>

<span class="sd">    Returns:</span>
<span class="sd">        min_row (int): The minimum row index of the GOES image.</span>
<span class="sd">        max_row (int): The maximum row index of the GOES image.</span>
<span class="sd">        min_col (int): The minimum column index of the GOES image.</span>
<span class="sd">        max_col (int): The maximum column index of the GOES image.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">index_row</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">lat_grd</span> <span class="o">==</span> <span class="n">lat_search</span><span class="p">)</span>
    <span class="n">index_column</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">lon_grd</span> <span class="o">==</span> <span class="n">lon_search</span><span class="p">)</span>

    <span class="n">rows_goes</span> <span class="o">=</span> <span class="n">parallel_index</span><span class="p">[</span><span class="n">index_row</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">index_column</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">columns_goes</span> <span class="o">=</span> <span class="n">parallel_index</span><span class="p">[</span><span class="n">index_row</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">index_column</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]][</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">rows_goes</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">columns_goes</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="n">min_row</span> <span class="o">=</span> <span class="n">rows_goes</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">max_row</span> <span class="o">=</span> <span class="n">rows_goes</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

    <span class="n">min_col</span> <span class="o">=</span> <span class="n">columns_goes</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">max_col</span> <span class="o">=</span> <span class="n">columns_goes</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">min_row</span><span class="p">,</span> <span class="n">max_row</span><span class="p">,</span> <span class="n">min_col</span><span class="p">,</span> <span class="n">max_col</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.func.index_parallel" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">index_parallel</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">ScatterDataset</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Finds the corresponding GOES row and column indices for the entire scatterometer dataset.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>ScatterDataset</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>xarray Dataset containing scatterometer data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>scatter_name</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name for the output file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>output_path</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to save the output file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>parallel_indice_values</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>2D array of tuples containing GOES row and column indices corresponding to scatterometer data.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\func.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">index_parallel</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">ScatterDataset</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Finds the corresponding GOES row and column indices for the entire scatterometer dataset.</span>

<span class="sd">    Args:</span>
<span class="sd">        ScatterDataset: xarray Dataset containing scatterometer data.</span>
<span class="sd">        scatter_name: Name for the output file.</span>
<span class="sd">        output_path: Path to save the output file.</span>

<span class="sd">    Returns:</span>
<span class="sd">        parallel_indice_values: 2D array of tuples containing GOES row and column indices corresponding to scatterometer data.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">create_folder</span><span class="p">(</span><span class="s2">&quot;satellite_indices&quot;</span><span class="p">)</span>
    <span class="n">ds_spatial_resolution</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">spatial_resolution</span>
    <span class="n">ds_spatial_resolution</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>

    <span class="n">name_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;lat_</span><span class="si">{</span><span class="n">ScatterDataset</span><span class="o">.</span><span class="n">latitude</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">ScatterDataset</span><span class="o">.</span><span class="n">latitude</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="si">}</span><span class="s2">_lon_</span><span class="si">{</span><span class="n">ScatterDataset</span><span class="o">.</span><span class="n">longitude</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">ScatterDataset</span><span class="o">.</span><span class="n">longitude</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="si">}</span><span class="s2">_res_</span><span class="si">{</span><span class="n">ds_spatial_resolution</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">name_str</span> <span class="o">=</span> <span class="n">name_str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;./satellite_indices/</span><span class="si">{</span><span class="n">ds_spatial_resolution</span><span class="si">}</span><span class="s2">_index.npy&quot;</span>
    <span class="p">):</span>
        <span class="n">parallel_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;./satellite_indices/</span><span class="si">{</span><span class="n">ds_spatial_resolution</span><span class="si">}</span><span class="s2">_index.npy&quot;</span><span class="p">,</span>
            <span class="n">allow_pickle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">parallel_index</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;INFO : Satellite index file not found, creating new index file. This might take a while.&quot;</span>
        <span class="p">)</span>

        <span class="c1"># Extract scatterometer latitudes and longitudes</span>
        <span class="n">Latitudes_Scatter</span> <span class="o">=</span> <span class="n">ScatterDataset</span><span class="p">[</span><span class="s2">&quot;latitude&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">Longitudes_Scatter</span> <span class="o">=</span> <span class="n">ScatterDataset</span><span class="p">[</span><span class="s2">&quot;longitude&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

        <span class="c1"># Create a meshgrid of scatterometer coordinates</span>
        <span class="n">lon_grid</span><span class="p">,</span> <span class="n">lat_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">Longitudes_Scatter</span><span class="p">,</span> <span class="n">Latitudes_Scatter</span><span class="p">)</span>

        <span class="c1"># Extract GOES latitudes and longitudes</span>
        <span class="n">Goeslat</span><span class="p">,</span> <span class="n">Goeslon</span> <span class="o">=</span> <span class="n">calculate_degrees</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>
        <span class="n">Goeslat</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">Goeslat</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">999</span>
        <span class="n">Goeslon</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">Goeslon</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">999</span>
        <span class="c1"># Use the optimized get_indices function</span>
        <span class="n">parallel_indice_values</span> <span class="o">=</span> <span class="n">get_indices</span><span class="p">(</span><span class="n">lat_grid</span><span class="p">,</span> <span class="n">lon_grid</span><span class="p">,</span> <span class="n">Goeslat</span><span class="p">,</span> <span class="n">Goeslon</span><span class="p">)</span>

        <span class="c1"># Save the indices array</span>
        <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;./satellite_indices/</span><span class="si">{</span><span class="n">ds_spatial_resolution</span><span class="si">}</span><span class="s2">_index.npy&quot;</span><span class="p">,</span>
            <span class="n">parallel_indice_values</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">parallel_indice_values</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.func.package_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">package_data</span><span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="n">numerical_data</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">solar_conversion</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>This function packages the images and numerical data into a format that can be used for training a machine learning model.
The function will filter out invalid images and fill in any NaN values. (Invalid images = empty images from GOES data)
The function will also convert the observation times, latitudes and longitudes to solar angles (sza, saa) if solar_conversion is set to True.
The function will return the images and numerical data in a numpy array format.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>images</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The GOES images corresponding to the observation data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>numerical_data</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary containing the numerical data corresponding to the observation data. The keys should include "observation_lats", "observation_lons", "observation_times" and optionally "wind_speeds".</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>filter</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, the function will filter out invalid images and fill in Nan values. Default is True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>solar_conversion</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, the function will convert the observation times, latitudes and longitudes to solar angles (sza, saa). Default is False. (Not used in current implementation, but kept in case of future use)</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>verbose</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, the function will print progress information. Default is True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>images</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The GOES images corresponding to the observation data.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>numerical_data</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The numerical data corresponding to the observation data. (sza, saa, main_parameter if solar_conversion is set to True or lat, lon, time, wind_speeds if solar_conversion is set to False)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\func.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span>
<span class="normal">934</span>
<span class="normal">935</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">package_data</span><span class="p">(</span>
    <span class="n">images</span><span class="p">,</span>
    <span class="n">numerical_data</span><span class="p">,</span>
    <span class="nb">filter</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">solar_conversion</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function packages the images and numerical data into a format that can be used for training a machine learning model.</span>
<span class="sd">    The function will filter out invalid images and fill in any NaN values. (Invalid images = empty images from GOES data)</span>
<span class="sd">    The function will also convert the observation times, latitudes and longitudes to solar angles (sza, saa) if solar_conversion is set to True.</span>
<span class="sd">    The function will return the images and numerical data in a numpy array format.</span>

<span class="sd">    Args:</span>
<span class="sd">        images (numpy.ndarray): The GOES images corresponding to the observation data.</span>
<span class="sd">        numerical_data (dict): A dictionary containing the numerical data corresponding to the observation data. The keys should include &quot;observation_lats&quot;, &quot;observation_lons&quot;, &quot;observation_times&quot; and optionally &quot;wind_speeds&quot;.</span>
<span class="sd">        filter (bool): If True, the function will filter out invalid images and fill in Nan values. Default is True.</span>
<span class="sd">        solar_conversion (bool): If True, the function will convert the observation times, latitudes and longitudes to solar angles (sza, saa). Default is False. (Not used in current implementation, but kept in case of future use)</span>
<span class="sd">        verbose (bool): If True, the function will print progress information. Default is True.</span>

<span class="sd">    Returns:</span>
<span class="sd">        images (numpy.ndarray): The GOES images corresponding to the observation data.</span>
<span class="sd">        numerical_data (numpy.ndarray): The numerical data corresponding to the observation data. (sza, saa, main_parameter if solar_conversion is set to True or lat, lon, time, wind_speeds if solar_conversion is set to False)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">filter</span><span class="p">:</span>
        <span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="n">numerical_data</span><span class="p">)</span> <span class="o">=</span> <span class="n">filter_invalid</span><span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="n">numerical_data</span><span class="p">)</span>
        <span class="n">images</span> <span class="o">=</span> <span class="n">fill_nans</span><span class="p">(</span><span class="n">images</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">solar_conversion</span><span class="p">:</span>
        <span class="n">observation_lats</span> <span class="o">=</span> <span class="n">numerical_data</span><span class="p">[</span><span class="s2">&quot;observation_lats&quot;</span><span class="p">]</span>
        <span class="n">observation_lons</span> <span class="o">=</span> <span class="n">numerical_data</span><span class="p">[</span><span class="s2">&quot;observation_lons&quot;</span><span class="p">]</span>
        <span class="n">observation_times</span> <span class="o">=</span> <span class="n">numerical_data</span><span class="p">[</span><span class="s2">&quot;observation_times&quot;</span><span class="p">]</span>

        <span class="n">sza</span><span class="p">,</span> <span class="n">saa</span> <span class="o">=</span> <span class="n">vectorized_solar_angles</span><span class="p">(</span>
            <span class="n">observation_lats</span><span class="p">,</span> <span class="n">observation_lons</span><span class="p">,</span> <span class="n">observation_times</span>
        <span class="p">)</span>

        <span class="n">sza_rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">sza</span><span class="p">)</span>
        <span class="n">sza_sin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">sza_rad</span><span class="p">)</span>
        <span class="n">sza_cos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">sza_rad</span><span class="p">)</span>

        <span class="n">saa_rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">saa</span><span class="p">)</span>
        <span class="n">saa_sin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">saa_rad</span><span class="p">)</span>
        <span class="n">saa_cos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">saa_rad</span><span class="p">)</span>

        <span class="c1"># Add the solar angles to the numerical data dictionary</span>

        <span class="n">numerical_data</span><span class="p">[</span><span class="s2">&quot;sza_sin&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sza_sin</span>
        <span class="n">numerical_data</span><span class="p">[</span><span class="s2">&quot;sza_cos&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sza_cos</span>
        <span class="n">numerical_data</span><span class="p">[</span><span class="s2">&quot;saa_sin&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">saa_sin</span>
        <span class="n">numerical_data</span><span class="p">[</span><span class="s2">&quot;saa_cos&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">saa_cos</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Data Preparation : converted to solar angles (sza, saa)&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Data Preparation : returning images, numerical_data&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">images</span><span class="p">,</span> <span class="n">numerical_data</span>

    <span class="k">else</span><span class="p">:</span>

        <span class="k">return</span> <span class="n">images</span><span class="p">,</span> <span class="n">numerical_data</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.func.save_overpass_time" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">save_overpass_time</span><span class="p">(</span><span class="n">time_list</span><span class="p">,</span> <span class="n">name_scatter</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>This function prints the overpass time of the scatterometer.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>time_list</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The measurement time values of the scatterometer data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>name_scatter</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the scatterometer data source (e.g. ASCAT, HYSCAT etc).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\func.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">save_overpass_time</span><span class="p">(</span><span class="n">time_list</span><span class="p">,</span><span class="n">name_scatter</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function prints the overpass time of the scatterometer.</span>

<span class="sd">    Args:</span>
<span class="sd">        time_list (numpy.ndarray): The measurement time values of the scatterometer data.</span>
<span class="sd">        name_scatter (str): The name of the scatterometer data source (e.g. ASCAT, HYSCAT etc).</span>

<span class="sd">    Returns:</span>
<span class="sd">        None </span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">formated_time</span> <span class="o">=</span> <span class="n">time_list</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;datetime64[ns]&#39;</span><span class="p">)</span>
    <span class="n">hour_minute</span> <span class="o">=</span> <span class="n">formated_time</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;datetime64[m]&#39;</span><span class="p">)</span>
    <span class="n">unique_hour_minute</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">hour_minute</span><span class="p">)</span>

    <span class="n">filtered</span> <span class="o">=</span> <span class="p">[</span><span class="n">unique_hour_minute</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>

    <span class="n">delta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">timedelta64</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="n">unique_hour_minute</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
        <span class="k">if</span> <span class="n">time</span> <span class="o">-</span> <span class="n">filtered</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">delta</span><span class="p">:</span>
            <span class="n">filtered</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>

    <span class="n">time_only</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="n">filtered</span><span class="p">:</span>
        <span class="n">time</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">time</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">time_only</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ORBIT : </span><span class="si">{</span><span class="n">name_scatter</span><span class="si">}</span><span class="s2"> overpass time : </span><span class="si">{</span><span class="n">time_only</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.func.savedataseperated" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">savedataseperated</span><span class="p">(</span><span class="n">ScatterData</span><span class="p">,</span> <span class="n">main_parameter</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>This function extracts the valid lon / lat / measurement time and the main parameter from ever pixel
of the scatterometer data and saves it to a numpy file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>ScatterData</code>
            </td>
            <td>
                  <code><span title="xarray.Dataset">Dataset</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The ASCAT dataset containing the scatterometer data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>main_parameter</code>
            </td>
            <td>
                  <code><span title="xarray.DataArray">DataArray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The main parameter to be saved. This can be a classification / wind speed / wind direction etc.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Returns:</p>
<pre><code>lat_list (numpy.ndarray): The latitude values of the scatterometer data.
lon_list (numpy.ndarray): The longitude values of the scatterometer data.
time_list (numpy.ndarray): The measurement time values of the scatterometer data.
main_parameter_list (numpy.ndarray): The main parameter values of the scatterometer data.
</code></pre>
<p>this function saves the data locally to a folder called data_processed_scat</p>


            <details class="quote">
              <summary>Source code in <code>windscangeo\func.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">savedataseperated</span><span class="p">(</span><span class="n">ScatterData</span><span class="p">,</span> <span class="n">main_parameter</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function extracts the valid lon / lat / measurement time and the main parameter from ever pixel</span>
<span class="sd">    of the scatterometer data and saves it to a numpy file.</span>

<span class="sd">    Args:</span>
<span class="sd">        ScatterData (xarray.Dataset): The ASCAT dataset containing the scatterometer data.</span>
<span class="sd">        main_parameter (xarray.DataArray): The main parameter to be saved. This can be a classification / wind speed / wind direction etc.</span>

<span class="sd">    Returns:</span>

<span class="sd">        lat_list (numpy.ndarray): The latitude values of the scatterometer data.</span>
<span class="sd">        lon_list (numpy.ndarray): The longitude values of the scatterometer data.</span>
<span class="sd">        time_list (numpy.ndarray): The measurement time values of the scatterometer data.</span>
<span class="sd">        main_parameter_list (numpy.ndarray): The main parameter values of the scatterometer data.</span>

<span class="sd">    this function saves the data locally to a folder called data_processed_scat</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">lat_full</span><span class="p">,</span> <span class="n">lon_full</span><span class="p">,</span> <span class="n">time_full</span> <span class="o">=</span> <span class="n">ScatterData</span><span class="o">.</span><span class="n">indexes</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
    <span class="n">measurement_time_full</span> <span class="o">=</span> <span class="n">ScatterData</span><span class="o">.</span><span class="n">measurement_time</span>

    <span class="n">lat_full</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lat_full</span><span class="p">)</span>
    <span class="n">lon_full</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lon_full</span><span class="p">)</span>
    <span class="n">measurement_time_full</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">measurement_time_full</span><span class="p">)</span>
    <span class="n">main_parameter</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">main_parameter</span><span class="p">)</span>

    <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">main_parameter</span><span class="p">))</span>

    <span class="n">index_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">lat_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">lon_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">time_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">wind_speed_list</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">name_scatter</span> <span class="o">=</span> <span class="n">ScatterData</span><span class="o">.</span><span class="n">source</span>

    <span class="k">for</span> <span class="n">t</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">index</span><span class="p">:</span>

        <span class="c1"># print(t,&#39;= time&#39;, i,&#39;=row&#39;, j, &#39;=column&#39;)</span>
        <span class="n">index_list</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">t</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">))</span>

        <span class="c1"># print(measurement_time_full[t, i, j].astype(&#39;datetime64[ns]&#39;))</span>
        <span class="n">time_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">measurement_time_full</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span>

        <span class="c1"># print(lat_full[i])</span>
        <span class="n">lat_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lat_full</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

        <span class="c1"># print(lon_full[j])</span>
        <span class="n">lon_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lon_full</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>

        <span class="c1"># print(AllWindSpeeds[t, i, j])</span>
        <span class="n">wind_speed_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">main_parameter</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span>

    <span class="n">lat_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lat_list</span><span class="p">)</span>
    <span class="n">lon_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lon_list</span><span class="p">)</span>
    <span class="n">time_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">time_list</span><span class="p">)</span>
    <span class="n">wind_speed_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">wind_speed_list</span><span class="p">)</span>

    <span class="n">lat_list</span><span class="p">,</span> <span class="n">lon_list</span><span class="p">,</span> <span class="n">time_list</span><span class="p">,</span> <span class="n">wind_speed_list</span> <span class="o">=</span> <span class="n">sort_by_time</span><span class="p">(</span>
        <span class="n">lat_list</span><span class="p">,</span> <span class="n">lon_list</span><span class="p">,</span> <span class="n">time_list</span><span class="p">,</span> <span class="n">wind_speed_list</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="n">save_overpass_time</span><span class="p">(</span><span class="n">time_list</span><span class="p">,</span><span class="n">name_scatter</span><span class="p">)</span>    

    <span class="k">return</span> <span class="n">lat_list</span><span class="p">,</span> <span class="n">lon_list</span><span class="p">,</span> <span class="n">time_list</span><span class="p">,</span> <span class="n">wind_speed_list</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.func.sort_by_time" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">sort_by_time</span><span class="p">(</span><span class="n">lat_list</span><span class="p">,</span> <span class="n">lon_list</span><span class="p">,</span> <span class="n">time_list</span><span class="p">,</span> <span class="n">wind_speed_list</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>This function sorts the output of savedataseperated() by time.
This allows for more efficient data processing and allows file caching for times that are represented by the same GOES file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>lat_list</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The latitude values of the scatterometer data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lon_list</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The longitude values of the scatterometer data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>time_list</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The measurement time values of the scatterometer data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>wind_speed_list</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The wind speed values of the scatterometer data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>lat_list_sorted</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The sorted latitude values of the scatterometer data.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>lon_list_sorted</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The sorted longitude values of the scatterometer data.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>time_list_sorted</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The sorted measurement time values of the scatterometer data.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>wind_speed_list_sorted</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The sorted wind speed values of the scatterometer data.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\func.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">sort_by_time</span><span class="p">(</span><span class="n">lat_list</span><span class="p">,</span> <span class="n">lon_list</span><span class="p">,</span> <span class="n">time_list</span><span class="p">,</span> <span class="n">wind_speed_list</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function sorts the output of savedataseperated() by time.</span>
<span class="sd">    This allows for more efficient data processing and allows file caching for times that are represented by the same GOES file.</span>

<span class="sd">    Args:</span>
<span class="sd">        lat_list (numpy.ndarray): The latitude values of the scatterometer data.</span>
<span class="sd">        lon_list (numpy.ndarray): The longitude values of the scatterometer data.</span>
<span class="sd">        time_list (numpy.ndarray): The measurement time values of the scatterometer data.</span>
<span class="sd">        wind_speed_list (numpy.ndarray): The wind speed values of the scatterometer data.</span>

<span class="sd">    Returns:</span>
<span class="sd">        lat_list_sorted (numpy.ndarray): The sorted latitude values of the scatterometer data.</span>
<span class="sd">        lon_list_sorted (numpy.ndarray): The sorted longitude values of the scatterometer data.</span>
<span class="sd">        time_list_sorted (numpy.ndarray): The sorted measurement time values of the scatterometer data.</span>
<span class="sd">        wind_speed_list_sorted (numpy.ndarray): The sorted wind speed values of the scatterometer data.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Get the indices that would sort the measurement_time array</span>
    <span class="n">sorted_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">time_list</span><span class="p">)</span>

    <span class="c1"># Reorder the arrays using the sorted indices</span>
    <span class="n">time_list_sorted</span> <span class="o">=</span> <span class="n">time_list</span><span class="p">[</span><span class="n">sorted_indices</span><span class="p">]</span>
    <span class="n">lat_list_sorted</span> <span class="o">=</span> <span class="n">lat_list</span><span class="p">[</span><span class="n">sorted_indices</span><span class="p">]</span>
    <span class="n">lon_list_sorted</span> <span class="o">=</span> <span class="n">lon_list</span><span class="p">[</span><span class="n">sorted_indices</span><span class="p">]</span>
    <span class="n">speed_list_sorted</span> <span class="o">=</span> <span class="n">wind_speed_list</span><span class="p">[</span><span class="n">sorted_indices</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">lat_list_sorted</span><span class="p">,</span> <span class="n">lon_list_sorted</span><span class="p">,</span> <span class="n">time_list_sorted</span><span class="p">,</span> <span class="n">speed_list_sorted</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.func.vectorized_solar_angles" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">vectorized_solar_angles</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">time_utc</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>This function calculates the solar zenith angle (SZA) and solar azimuth angle (SAA) for a given latitude, longitude, and time. This is an archived function. Current implementation does not use solar angles but only image input.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>lat</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The latitude values of the scatterometer data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lon</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The longitude values of the scatterometer data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>time_utc</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The observation times in UTC.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>sza</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The solar zenith angle in degrees.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>saa</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The solar azimuth angle in degrees.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\func.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">vectorized_solar_angles</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">time_utc</span><span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function calculates the solar zenith angle (SZA) and solar azimuth angle (SAA) for a given latitude, longitude, and time. This is an archived function. Current implementation does not use solar angles but only image input.</span>

<span class="sd">    Args:</span>
<span class="sd">        lat (numpy.ndarray): The latitude values of the scatterometer data.</span>
<span class="sd">        lon (numpy.ndarray): The longitude values of the scatterometer data.</span>
<span class="sd">        time_utc (numpy.ndarray): The observation times in UTC.</span>

<span class="sd">    Returns:</span>
<span class="sd">        sza (numpy.ndarray): The solar zenith angle in degrees.</span>
<span class="sd">        saa (numpy.ndarray): The solar azimuth angle in degrees.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Convert time to Julian Day</span>
    <span class="n">timestamp</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">time_utc</span><span class="p">)</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">jd</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">timestamp</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;datetime64[ns]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span> <span class="o">/</span> <span class="mi">86400000000000</span> <span class="o">+</span> <span class="mf">2440587.5</span>
    <span class="p">)</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">jd</span> <span class="o">-</span> <span class="mf">2451545.0</span>  <span class="c1"># Days since J2000</span>

    <span class="c1"># Mean longitude, mean anomaly, ecliptic longitude</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">((</span><span class="mf">357.529</span> <span class="o">+</span> <span class="mf">0.98560028</span> <span class="o">*</span> <span class="n">d</span><span class="p">)</span> <span class="o">%</span> <span class="mi">360</span><span class="p">)</span>  <span class="c1"># Mean anomaly</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">((</span><span class="mf">280.459</span> <span class="o">+</span> <span class="mf">0.98564736</span> <span class="o">*</span> <span class="n">d</span><span class="p">)</span> <span class="o">%</span> <span class="mi">360</span><span class="p">)</span>  <span class="c1"># Mean longitude</span>
    <span class="n">L</span> <span class="o">=</span> <span class="p">(</span><span class="n">q</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="mf">1.915</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">g</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="mf">0.020</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">g</span><span class="p">))</span> <span class="o">%</span> <span class="p">(</span>
        <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
    <span class="p">)</span>  <span class="c1"># Ecliptic long</span>

    <span class="c1"># Obliquity of the ecliptic</span>
    <span class="n">e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="mf">23.439</span> <span class="o">-</span> <span class="mf">0.00000036</span> <span class="o">*</span> <span class="n">d</span><span class="p">)</span>

    <span class="c1"># Sun declination</span>
    <span class="n">sin_delta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">L</span><span class="p">)</span>
    <span class="n">delta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="n">sin_delta</span><span class="p">)</span>

    <span class="c1"># Equation of time (in minutes)</span>
    <span class="n">E</span> <span class="o">=</span> <span class="mf">229.18</span> <span class="o">*</span> <span class="p">(</span>
        <span class="mf">0.000075</span>
        <span class="o">+</span> <span class="mf">0.001868</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
        <span class="o">-</span> <span class="mf">0.032077</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
        <span class="o">-</span> <span class="mf">0.014615</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">g</span><span class="p">)</span>
        <span class="o">-</span> <span class="mf">0.040849</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">g</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="c1"># Convert time to fractional hours (UTC)</span>
    <span class="n">fractional_hour</span> <span class="o">=</span> <span class="n">timestamp</span><span class="o">.</span><span class="n">hour</span> <span class="o">+</span> <span class="n">timestamp</span><span class="o">.</span><span class="n">minute</span> <span class="o">/</span> <span class="mi">60</span> <span class="o">+</span> <span class="n">timestamp</span><span class="o">.</span><span class="n">second</span> <span class="o">/</span> <span class="mi">3600</span>

    <span class="c1"># Solar time correction</span>
    <span class="n">time_offset</span> <span class="o">=</span> <span class="n">E</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">lon</span>  <span class="c1"># lon in degrees</span>
    <span class="n">tst</span> <span class="o">=</span> <span class="n">fractional_hour</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">+</span> <span class="n">time_offset</span>  <span class="c1"># True Solar Time in minutes</span>
    <span class="n">ha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">((</span><span class="n">tst</span> <span class="o">/</span> <span class="mi">4</span> <span class="o">-</span> <span class="mi">180</span><span class="p">)</span> <span class="o">%</span> <span class="mi">360</span><span class="p">)</span>  <span class="c1"># Hour angle in radians</span>

    <span class="c1"># Convert lat/lon to radians</span>
    <span class="n">lat_rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span>

    <span class="c1"># Solar zenith angle</span>
    <span class="n">cos_zenith</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">lat_rad</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">delta</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">lat_rad</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span>
        <span class="n">delta</span>
    <span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ha</span><span class="p">)</span>
    <span class="n">zenith</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">cos_zenith</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>  <span class="c1"># in degrees</span>

    <span class="c1"># Solar saa angle</span>
    <span class="n">sin_saa</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ha</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">delta</span><span class="p">)</span>
    <span class="n">cos_saa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">lat_rad</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">delta</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">lat_rad</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span>
        <span class="n">delta</span>
    <span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ha</span><span class="p">)</span>
    <span class="n">saa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">sin_saa</span><span class="p">,</span> <span class="n">cos_saa</span><span class="p">))</span>
    <span class="n">saa</span> <span class="o">=</span> <span class="p">(</span><span class="n">saa</span> <span class="o">+</span> <span class="mi">360</span><span class="p">)</span> <span class="o">%</span> <span class="mi">360</span>  <span class="c1"># Normalize</span>

    <span class="k">return</span> <span class="n">zenith</span><span class="p">,</span> <span class="n">saa</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="windscangeo.func_ml"></a>
    <div class="doc doc-contents first">









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="windscangeo.func_ml.H5pyDataset" class="doc doc-heading">
            <code>H5pyDataset</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="torch.utils.data.Dataset">Dataset</span></code></p>


        <p>A PyTorch Dataset for loading data from an HDF5 file. This is useful when dealing with large datasets that do not fit into memory.
Need to work on Zarr integration for better performance</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>h5_file_path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the HDF5 file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>transform</code>
            </td>
            <td>
                  <code><span title="callable">callable</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A function/transform to apply to the images.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>windscangeo\func_ml.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">H5pyDataset</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Dataset</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A PyTorch Dataset for loading data from an HDF5 file. This is useful when dealing with large datasets that do not fit into memory.</span>
<span class="sd">    Need to work on Zarr integration for better performance</span>

<span class="sd">    Args:</span>
<span class="sd">        h5_file_path (str): Path to the HDF5 file.</span>
<span class="sd">        transform (callable, optional): A function/transform to apply to the images.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h5_file_path</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">h5_file_path</span> <span class="o">=</span> <span class="n">h5_file_path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transform</span> <span class="o">=</span> <span class="n">transform</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Will be initialized per worker</span>
        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h5_file_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="s1">&#39;targets&#39;</span><span class="p">])</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_ensure_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h5_file_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_file</span><span class="p">()</span>

        <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="p">[</span><span class="s1">&#39;images&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span>
        <span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="p">[</span><span class="s1">&#39;targets&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span>

        <span class="n">image</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="n">target</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">:</span>
            <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">image</span><span class="p">,</span> <span class="n">target</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="windscangeo.func_ml.Normalize" class="doc doc-heading">
            <code>Normalize</code>


</h2>


    <div class="doc doc-contents ">


        <p>Normalize the input tensor by subtracting the mean and dividing by the standard deviation. Done per batch </p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>mean</code>
            </td>
            <td>
                  <code><span title="list">list</span> or <span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mean values for normalization.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>std</code>
            </td>
            <td>
                  <code><span title="list">list</span> or <span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Standard deviation values for normalization.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>windscangeo\func_ml.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Normalize</span><span class="p">:</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Normalize the input tensor by subtracting the mean and dividing by the standard deviation. Done per batch </span>

<span class="sd">    Args:</span>
<span class="sd">        mean (list or np.ndarray): Mean values for normalization.</span>
<span class="sd">        std (list or np.ndarray): Standard deviation values for normalization.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">std</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mean</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">mean</span><span class="p">)</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">std</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">std</span><span class="p">)</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">std</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="windscangeo.func_ml.conventional_dataset" class="doc doc-heading">
            <code>conventional_dataset</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="torch.utils.data.Dataset">Dataset</span></code></p>


        <p>A PyTorch Dataset for loading data using regular numpy arrays.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>images</code>
            </td>
            <td>
                  <code><span title="list">list</span> or <span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List or array of images.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>targets</code>
            </td>
            <td>
                  <code><span title="list">list</span> or <span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List or array of targets corresponding to the images.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>transform</code>
            </td>
            <td>
                  <code><span title="callable">callable</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A function/transform to apply to the images.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>windscangeo\func_ml.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">conventional_dataset</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Dataset</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A PyTorch Dataset for loading data using regular numpy arrays.</span>

<span class="sd">    Args:</span>
<span class="sd">        images (list or np.ndarray): List or array of images.</span>
<span class="sd">        targets (list or np.ndarray): List or array of targets corresponding to the images.</span>
<span class="sd">        transform (callable, optional): A function/transform to apply to the images.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">images</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">images</span> <span class="o">=</span> <span class="n">images</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">targets</span> <span class="o">=</span> <span class="n">targets</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transform</span> <span class="o">=</span> <span class="n">transform</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
        <span class="c1"># 1) Image</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">:</span>
            <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

        <span class="c1"># 2) Target for sample &quot;idx&quot;</span>
        <span class="n">target</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">image</span><span class="p">,</span> <span class="n">target</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="windscangeo.func_ml.conventional_dataset_inference" class="doc doc-heading">
            <code>conventional_dataset_inference</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="torch.utils.data.Dataset">Dataset</span></code></p>


        <p>A PyTorch Dataset for loading data for inference (no lable) using regular numpy arrays.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>images</code>
            </td>
            <td>
                  <code><span title="list">list</span> or <span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List or array of images to be used for inference.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>transform</code>
            </td>
            <td>
                  <code><span title="callable">callable</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A function/transform to apply to the images.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>windscangeo\func_ml.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">conventional_dataset_inference</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Dataset</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A PyTorch Dataset for loading data for inference (no lable) using regular numpy arrays.</span>

<span class="sd">    Args:</span>
<span class="sd">        images (list or np.ndarray): List or array of images to be used for inference.</span>
<span class="sd">        transform (callable, optional): A function/transform to apply to the images.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">images</span><span class="p">,</span><span class="n">transform</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">images</span> <span class="o">=</span> <span class="n">images</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transform</span> <span class="o">=</span> <span class="n">transform</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
        <span class="c1"># 1) Image</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">:</span>
            <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">image</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h2 id="windscangeo.func_ml.error_plot" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">error_plot</span><span class="p">(</span><span class="n">best_val_outputs</span><span class="p">,</span> <span class="n">best_val_labels</span><span class="p">,</span> <span class="n">path_folder</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Plot a scatter plot of model outputs vs true labels for the validation dataset.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>best_val_outputs</code>
            </td>
            <td>
                  <code><span title="list">list</span> or <span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Model outputs for the validation dataset.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>best_val_labels</code>
            </td>
            <td>
                  <code><span title="list">list</span> or <span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True labels for the validation dataset.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>path_folder</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to save the plot. If None, the plot will not be saved.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\func_ml.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">error_plot</span><span class="p">(</span><span class="n">best_val_outputs</span><span class="p">,</span> <span class="n">best_val_labels</span><span class="p">,</span> <span class="n">path_folder</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot a scatter plot of model outputs vs true labels for the validation dataset.</span>

<span class="sd">    Args:</span>
<span class="sd">        best_val_outputs (list or np.ndarray): Model outputs for the validation dataset.</span>
<span class="sd">        best_val_labels (list or np.ndarray): True labels for the validation dataset.</span>
<span class="sd">        path_folder (str, optional): Path to save the plot. If None, the plot will not be saved.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">max_all</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">best_val_outputs</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">best_val_labels</span><span class="p">))</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">best_val_labels</span><span class="p">,</span> <span class="n">best_val_outputs</span><span class="p">,</span> <span class="s2">&quot;o&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s2">&quot;equal&quot;</span><span class="p">,</span> <span class="n">adjustable</span><span class="o">=</span><span class="s2">&quot;box&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_all</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_all</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;True Labels&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Model Output&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Model Output vs True Labels in test dataset&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">best_val_labels</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">best_val_labels</span><span class="p">)],</span>
        <span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">best_val_labels</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">best_val_labels</span><span class="p">)],</span>
        <span class="s2">&quot;r--&quot;</span><span class="p">,</span>
    <span class="p">)</span>  <span class="c1"># y = x reference line</span>
    <span class="k">if</span> <span class="n">path_folder</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_folder</span><span class="p">,</span> <span class="s2">&quot;scatter_plot.png&quot;</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.func_ml.plot_cloud_cover" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plot_cloud_cover</span><span class="p">(</span><span class="n">lat_inference</span><span class="p">,</span> <span class="n">lon_inference</span><span class="p">,</span> <span class="n">images</span><span class="p">,</span> <span class="n">path_folder</span><span class="p">,</span> <span class="n">buoy_name</span><span class="p">,</span> <span class="n">buoy_lat</span><span class="p">,</span> <span class="n">buoy_lon</span><span class="p">,</span> <span class="n">time_choice</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Plot the cloud cover mask on a map with buoy locations. This works well with 30x30 images but larger images can diluted. Can be adapted to work with larger images.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>lat_inference</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Latitude values for the inference grid.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lon_inference</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Longitude values for the inference grid.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>images</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>GOES image data to be used for cloud cover calculation.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>path_folder</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to save the plot.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>buoy_name</code>
            </td>
            <td>
                  <code><span title="list">list</span> or <span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Names of the buoys.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>buoy_lat</code>
            </td>
            <td>
                  <code><span title="list">list</span> or <span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Latitude values of the buoys.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>buoy_lon</code>
            </td>
            <td>
                  <code><span title="list">list</span> or <span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Longitude values of the buoys.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>time_choice</code>
            </td>
            <td>
                  <code><span title="datetime">datetime</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Time of the inference.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\func_ml.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">plot_cloud_cover</span><span class="p">(</span><span class="n">lat_inference</span><span class="p">,</span><span class="n">lon_inference</span><span class="p">,</span><span class="n">images</span><span class="p">,</span><span class="n">path_folder</span><span class="p">,</span><span class="n">buoy_name</span><span class="p">,</span><span class="n">buoy_lat</span><span class="p">,</span><span class="n">buoy_lon</span><span class="p">,</span><span class="n">time_choice</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot the cloud cover mask on a map with buoy locations. This works well with 30x30 images but larger images can diluted. Can be adapted to work with larger images.</span>

<span class="sd">    Args:</span>
<span class="sd">        lat_inference (np.ndarray): Latitude values for the inference grid.</span>
<span class="sd">        lon_inference (np.ndarray): Longitude values for the inference grid.</span>
<span class="sd">        images (np.ndarray): GOES image data to be used for cloud cover calculation.</span>
<span class="sd">        path_folder (str): Path to save the plot.</span>
<span class="sd">        buoy_name (list or np.ndarray): Names of the buoys.</span>
<span class="sd">        buoy_lat (list or np.ndarray): Latitude values of the buoys.</span>
<span class="sd">        buoy_lon (list or np.ndarray): Longitude values of the buoys.</span>
<span class="sd">        time_choice (datetime): Time of the inference.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mean_images</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
    <span class="n">threshold</span> <span class="o">=</span> <span class="mf">0.11</span>
    <span class="n">cloud_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mean_images</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">cloud_mask</span> <span class="o">=</span> <span class="n">cloud_mask</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">160</span><span class="p">,</span><span class="mi">340</span><span class="p">)</span>

    <span class="n">plot_cloud_mask</span><span class="p">(</span><span class="n">lat_inference</span><span class="p">,</span><span class="n">lon_inference</span><span class="p">,</span><span class="n">cloud_mask</span><span class="p">,</span><span class="n">path_folder</span><span class="p">,</span><span class="n">buoy_name</span><span class="p">,</span><span class="n">buoy_lat</span><span class="p">,</span><span class="n">buoy_lon</span><span class="p">,</span><span class="n">time_choice</span><span class="p">)</span>

    <span class="n">percentage_cloud</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">cloud_mask</span><span class="p">)</span><span class="o">/</span><span class="n">cloud_mask</span><span class="o">.</span><span class="n">size</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Cloud coverage : &#39;</span><span class="p">,</span><span class="n">percentage_cloud</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span><span class="s1">&#39;%&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">cloud_mask</span><span class="p">,</span> <span class="n">percentage_cloud</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.func_ml.plot_cloud_mask" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plot_cloud_mask</span><span class="p">(</span><span class="n">lat_inference</span><span class="p">,</span> <span class="n">lon_inference</span><span class="p">,</span> <span class="n">wind_speeds_inference</span><span class="p">,</span> <span class="n">path_folder</span><span class="p">,</span> <span class="n">buoy_name</span><span class="p">,</span> <span class="n">buoy_lat</span><span class="p">,</span> <span class="n">buoy_lon</span><span class="p">,</span> <span class="n">time_choice</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Plot the cloud mask on a map with buoy locations. This works well with 30x30 images but larger images can diluted. Can be adapted to work with larger images.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>lat_inference</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Latitude values for the inference grid.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lon_inference</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Longitude values for the inference grid.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>wind_speeds_inference</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Cloud mask data to be plotted.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>path_folder</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to save the plot.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>buoy_name</code>
            </td>
            <td>
                  <code><span title="list">list</span> or <span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Names of the buoys.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>buoy_lat</code>
            </td>
            <td>
                  <code><span title="list">list</span> or <span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Latitude values of the buoys.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>buoy_lon</code>
            </td>
            <td>
                  <code><span title="list">list</span> or <span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Longitude values of the buoys.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>time_choice</code>
            </td>
            <td>
                  <code><span title="datetime">datetime</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Time of the inference.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\func_ml.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">plot_cloud_mask</span><span class="p">(</span><span class="n">lat_inference</span><span class="p">,</span><span class="n">lon_inference</span><span class="p">,</span><span class="n">wind_speeds_inference</span><span class="p">,</span><span class="n">path_folder</span><span class="p">,</span><span class="n">buoy_name</span><span class="p">,</span><span class="n">buoy_lat</span><span class="p">,</span><span class="n">buoy_lon</span><span class="p">,</span><span class="n">time_choice</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot the cloud mask on a map with buoy locations. This works well with 30x30 images but larger images can diluted. Can be adapted to work with larger images.</span>

<span class="sd">    Args:</span>
<span class="sd">        lat_inference (np.ndarray): Latitude values for the inference grid.</span>
<span class="sd">        lon_inference (np.ndarray): Longitude values for the inference grid.</span>
<span class="sd">        wind_speeds_inference (np.ndarray): Cloud mask data to be plotted.</span>
<span class="sd">        path_folder (str): Path to save the plot.</span>
<span class="sd">        buoy_name (list or np.ndarray): Names of the buoys.</span>
<span class="sd">        buoy_lat (list or np.ndarray): Latitude values of the buoys.</span>
<span class="sd">        buoy_lon (list or np.ndarray): Longitude values of the buoys.</span>
<span class="sd">        time_choice (datetime): Time of the inference.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>

    <span class="c1"># Plot wind speed data (continuous colormap)</span>
    <span class="n">pcm</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span>
        <span class="n">lon_inference</span><span class="p">,</span> <span class="n">lat_inference</span><span class="p">,</span> <span class="n">wind_speeds_inference</span><span class="p">,</span>
        <span class="n">shading</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span>
        <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">)</span>

    <span class="c1"># Add colorbar</span>
    <span class="n">cbar</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">pcm</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;0 = Clear, 1 = Cloudy&#39;</span><span class="p">)</span>

    <span class="c1"># Add coastlines and land</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cfeature</span><span class="o">.</span><span class="n">LAND</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>  
    <span class="n">ax</span><span class="o">.</span><span class="n">coastlines</span><span class="p">(</span><span class="n">zorder</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>

    <span class="c1"># Flatten buoy_name if it&#39;s a list of arrays</span>
    <span class="n">buoy_name_flat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">buoy_name</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">unique_buoys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">buoy_name_flat</span><span class="p">))</span>

    <span class="c1"># Generate enough distinct colors for all buoys from the &quot;tab20&quot; palette</span>
    <span class="c1"># (tab20 provides 20 colors; if there are more than 20 unique buoys, colors will repeat)</span>
    <span class="n">color_map</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s2">&quot;tab20&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_buoys</span><span class="p">))</span>

    <span class="c1"># Plot each buoy in a single color</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">buoy_id</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">unique_buoys</span><span class="p">):</span>
        <span class="c1"># Pick a distinct color from tab20</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">color_map</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

        <span class="c1"># Identify the indices belonging to this buoy</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">buoy_name_flat</span><span class="p">)</span> <span class="o">==</span> <span class="n">buoy_id</span>

        <span class="c1"># Scatter just those points</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">buoy_lon</span><span class="p">)[</span><span class="n">mask</span><span class="p">],</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">buoy_lat</span><span class="p">)[</span><span class="n">mask</span><span class="p">],</span>
            <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>            <span class="c1"># Set the fill color</span>
            <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">zorder</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="n">buoy_id</span>           <span class="c1"># Use buoy_id as the legend label</span>
        <span class="p">)</span>

    <span class="c1"># Create the legend</span>
    <span class="n">leg</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Buoy Stations&quot;</span><span class="p">,</span>
        <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper right&quot;</span><span class="p">,</span>
        <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
        <span class="n">bbox_transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span>
    <span class="p">)</span>

    <span class="c1"># Ensure legend is above all other layers</span>
    <span class="n">leg</span><span class="o">.</span><span class="n">set_zorder</span><span class="p">(</span><span class="mi">999</span><span class="p">)</span>

    <span class="c1"># Add grid lines</span>
    <span class="n">gl</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">gridlines</span><span class="p">(</span><span class="n">draw_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">gl</span><span class="o">.</span><span class="n">right_labels</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">gl</span><span class="o">.</span><span class="n">top_labels</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Cloud Mask at time </span><span class="si">{</span><span class="n">time_choice</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Longitude&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Latitude&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">lat_inference</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">lat_inference</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">lon_inference</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">lon_inference</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>


    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">path_folder</span><span class="si">}</span><span class="s1">/plot_cloud_mask.png&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.func_ml.plot_goes_image" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plot_goes_image</span><span class="p">(</span><span class="n">lat_inference</span><span class="p">,</span> <span class="n">lon_inference</span><span class="p">,</span> <span class="n">images</span><span class="p">,</span> <span class="n">path_folder</span><span class="p">,</span> <span class="n">buoy_name</span><span class="p">,</span> <span class="n">buoy_lat</span><span class="p">,</span> <span class="n">buoy_lon</span><span class="p">,</span> <span class="n">time_choice</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Plot the GOES image data on a map with buoy locations. Made for 128x128 images where the middpoint is at (64,64). If using other image sizes, the plotting will probably not work as expected.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>lat_inference</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Latitude values for the inference grid.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lon_inference</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Longitude values for the inference grid.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>images</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>GOES image data to be plotted.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>path_folder</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to save the plot.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>buoy_name</code>
            </td>
            <td>
                  <code><span title="list">list</span> or <span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Names of the buoys.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>buoy_lat</code>
            </td>
            <td>
                  <code><span title="list">list</span> or <span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Latitude values of the buoys.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>buoy_lon</code>
            </td>
            <td>
                  <code><span title="list">list</span> or <span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Longitude values of the buoys.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>time_choice</code>
            </td>
            <td>
                  <code><span title="datetime">datetime</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Time of the inference.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\func_ml.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">plot_goes_image</span><span class="p">(</span><span class="n">lat_inference</span><span class="p">,</span><span class="n">lon_inference</span><span class="p">,</span><span class="n">images</span><span class="p">,</span><span class="n">path_folder</span><span class="p">,</span><span class="n">buoy_name</span><span class="p">,</span><span class="n">buoy_lat</span><span class="p">,</span><span class="n">buoy_lon</span><span class="p">,</span><span class="n">time_choice</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot the GOES image data on a map with buoy locations. Made for 128x128 images where the middpoint is at (64,64). If using other image sizes, the plotting will probably not work as expected.</span>

<span class="sd">    Args:</span>
<span class="sd">        lat_inference (np.ndarray): Latitude values for the inference grid.</span>
<span class="sd">        lon_inference (np.ndarray): Longitude values for the inference grid.</span>
<span class="sd">        images (np.ndarray): GOES image data to be plotted.</span>
<span class="sd">        path_folder (str): Path to save the plot.</span>
<span class="sd">        buoy_name (list or np.ndarray): Names of the buoys.</span>
<span class="sd">        buoy_lat (list or np.ndarray): Latitude values of the buoys.</span>
<span class="sd">        buoy_lon (list or np.ndarray): Longitude values of the buoys.</span>
<span class="sd">        time_choice (datetime): Time of the inference.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mean_images</span> <span class="o">=</span> <span class="n">images</span><span class="p">[:,:,</span><span class="mi">64</span><span class="p">,</span><span class="mi">64</span><span class="p">]</span>
    <span class="n">mean_images</span> <span class="o">=</span> <span class="n">mean_images</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
    <span class="n">mean_images</span> <span class="o">=</span> <span class="n">mean_images</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">160</span><span class="p">,</span><span class="mi">340</span><span class="p">)</span>


    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>


    <span class="c1"># Plot wind speed data (continuous colormap)</span>
    <span class="n">pcm</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span>
        <span class="n">lon_inference</span><span class="p">,</span> <span class="n">lat_inference</span><span class="p">,</span> <span class="n">mean_images</span><span class="p">,</span>
        <span class="n">shading</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span>
        <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Add colorbar</span>
    <span class="n">cbar</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">pcm</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Brightness Temperature (K) - C01&#39;</span><span class="p">)</span>

    <span class="c1"># Add coastlines and land</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cfeature</span><span class="o">.</span><span class="n">LAND</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>  
    <span class="n">ax</span><span class="o">.</span><span class="n">coastlines</span><span class="p">(</span><span class="n">zorder</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>


    <span class="c1"># Flatten buoy_name if it&#39;s a list of arrays</span>
    <span class="n">buoy_name_flat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">buoy_name</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">unique_buoys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">buoy_name_flat</span><span class="p">))</span>

    <span class="c1"># Generate enough distinct colors for all buoys from the &quot;tab20&quot; palette</span>
    <span class="c1"># (tab20 provides 20 colors; if there are more than 20 unique buoys, colors will repeat)</span>
    <span class="n">color_map</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s2">&quot;tab20&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_buoys</span><span class="p">))</span>


    <span class="c1"># Add grid lines</span>
    <span class="n">gl</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">gridlines</span><span class="p">(</span><span class="n">draw_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">gl</span><span class="o">.</span><span class="n">right_labels</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">gl</span><span class="o">.</span><span class="n">top_labels</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;GOES image at time </span><span class="si">{</span><span class="n">time_choice</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Longitude&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Latitude&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">lat_inference</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">lat_inference</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">lon_inference</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">lon_inference</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">path_folder</span><span class="si">}</span><span class="s1">/plot_goes_image.png&#39;</span><span class="p">)</span>

    <span class="n">mean_images</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mean_images</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">mean_images</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.func_ml.plot_save_loss" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plot_save_loss</span><span class="p">(</span><span class="n">best_val_outputs</span><span class="p">,</span> <span class="n">best_val_labels</span><span class="p">,</span> <span class="n">train_losses</span><span class="p">,</span> <span class="n">val_losses</span><span class="p">,</span> <span class="n">path_folder</span><span class="p">,</span> <span class="n">saving</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Plot and save the training and validation losses, and optionally save the best validation outputs and labels.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>best_val_outputs</code>
            </td>
            <td>
                  <code><span title="list">list</span> or <span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Model outputs for the validation dataset.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>best_val_labels</code>
            </td>
            <td>
                  <code><span title="list">list</span> or <span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True labels for the validation dataset.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>train_losses</code>
            </td>
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of training losses per epoch.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>val_losses</code>
            </td>
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of validation losses per epoch.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>path_folder</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to save the plot and optionally the outputs and labels.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>saving</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, save the best validation outputs and labels. Default is False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\func_ml.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">plot_save_loss</span><span class="p">(</span>
    <span class="n">best_val_outputs</span><span class="p">,</span>
    <span class="n">best_val_labels</span><span class="p">,</span>
    <span class="n">train_losses</span><span class="p">,</span>
    <span class="n">val_losses</span><span class="p">,</span>
    <span class="n">path_folder</span><span class="p">,</span>
    <span class="n">saving</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot and save the training and validation losses, and optionally save the best validation outputs and labels.</span>

<span class="sd">    Args:</span>
<span class="sd">        best_val_outputs (list or np.ndarray): Model outputs for the validation dataset.</span>
<span class="sd">        best_val_labels (list or np.ndarray): True labels for the validation dataset.</span>
<span class="sd">        train_losses (list): List of training losses per epoch.</span>
<span class="sd">        val_losses (list): List of validation losses per epoch.</span>
<span class="sd">        path_folder (str): Path to save the plot and optionally the outputs and labels.</span>
<span class="sd">        saving (bool, optional): If True, save the best validation outputs and labels. Default is False.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># After training, save only the best validation outputs and labels</span>
    <span class="k">if</span> <span class="n">saving</span><span class="p">:</span>
        <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_folder</span><span class="p">,</span> <span class="s2">&quot;best_validation_outputs.npy&quot;</span><span class="p">),</span> <span class="n">best_val_outputs</span>
        <span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_folder</span><span class="p">,</span> <span class="s2">&quot;best_validation_labels.npy&quot;</span><span class="p">),</span> <span class="n">best_val_labels</span>
        <span class="p">)</span>

    <span class="n">num_epochs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">train_losses</span><span class="p">)</span>
    <span class="c1"># Plotting the training and validation losses</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_epochs</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">train_losses</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Training Loss&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_epochs</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">val_losses</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Validation Loss&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Epoch&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Loss&quot;</span><span class="p">)</span>
    <span class="n">text_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;num_epochs = </span><span class="si">{</span><span class="n">num_epochs</span><span class="si">}</span><span class="s2">, train loss = </span><span class="si">{</span><span class="n">train_losses</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, validation loss = </span><span class="si">{</span><span class="n">val_losses</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
        <span class="mf">0.05</span><span class="p">,</span>
        <span class="mf">0.05</span><span class="p">,</span>
        <span class="n">text_str</span><span class="p">,</span>
        <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
        <span class="n">va</span><span class="o">=</span><span class="s2">&quot;bottom&quot;</span><span class="p">,</span>
        <span class="n">transform</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>  <span class="c1"># Ensures the coordinates are relative to the axes (0 to 1 range)</span>
    <span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Training and Validation Loss Over Epochs&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_folder</span><span class="p">,</span> <span class="s2">&quot;loss_plot.png&quot;</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.func_ml.plot_wind_speeds" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plot_wind_speeds</span><span class="p">(</span><span class="n">lat_inference</span><span class="p">,</span> <span class="n">lon_inference</span><span class="p">,</span> <span class="n">wind_speeds_inference</span><span class="p">,</span> <span class="n">path_folder</span><span class="p">,</span> <span class="n">buoy_name</span><span class="p">,</span> <span class="n">buoy_lat</span><span class="p">,</span> <span class="n">buoy_lon</span><span class="p">,</span> <span class="n">time_choice</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Plot the wind speeds on a map with buoy locations. Filter nighttime images and add coastlines, gridlines, and buoy locations.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>lat_inference</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Latitude values for the inference grid.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lon_inference</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Longitude values for the inference grid.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>wind_speeds_inference</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Wind speed data to be plotted.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>path_folder</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to save the plot.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>buoy_name</code>
            </td>
            <td>
                  <code><span title="list">list</span> or <span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Names of the buoys.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>buoy_lat</code>
            </td>
            <td>
                  <code><span title="list">list</span> or <span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Latitude values of the buoys.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>buoy_lon</code>
            </td>
            <td>
                  <code><span title="list">list</span> or <span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Longitude values of the buoys.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>time_choice</code>
            </td>
            <td>
                  <code><span title="datetime">datetime</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Time of the inference.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\func_ml.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">plot_wind_speeds</span><span class="p">(</span><span class="n">lat_inference</span><span class="p">,</span><span class="n">lon_inference</span><span class="p">,</span><span class="n">wind_speeds_inference</span><span class="p">,</span><span class="n">path_folder</span><span class="p">,</span><span class="n">buoy_name</span><span class="p">,</span><span class="n">buoy_lat</span><span class="p">,</span><span class="n">buoy_lon</span><span class="p">,</span><span class="n">time_choice</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot the wind speeds on a map with buoy locations. Filter nighttime images and add coastlines, gridlines, and buoy locations.</span>

<span class="sd">    Args:</span>
<span class="sd">        lat_inference (np.ndarray): Latitude values for the inference grid.</span>
<span class="sd">        lon_inference (np.ndarray): Longitude values for the inference grid.</span>
<span class="sd">        wind_speeds_inference (np.ndarray): Wind speed data to be plotted.</span>
<span class="sd">        path_folder (str): Path to save the plot.</span>
<span class="sd">        buoy_name (list or np.ndarray): Names of the buoys.</span>
<span class="sd">        buoy_lat (list or np.ndarray): Latitude values of the buoys.</span>
<span class="sd">        buoy_lon (list or np.ndarray): Longitude values of the buoys.</span>
<span class="sd">        time_choice (datetime): Time of the inference.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">time_str</span> <span class="o">=</span> <span class="n">time_choice</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span>
    <span class="n">date</span><span class="p">,</span> <span class="n">time</span> <span class="o">=</span> <span class="n">time_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
    <span class="n">lat</span> <span class="o">=</span> <span class="n">lat_inference</span>
    <span class="n">lon</span> <span class="o">=</span> <span class="n">lon_inference</span>
    <span class="n">wind_speeds</span> <span class="o">=</span> <span class="n">wind_speeds_inference</span>


    <span class="n">buoy_names</span> <span class="o">=</span> <span class="n">buoy_name</span>
    <span class="n">buoy_lat</span> <span class="o">=</span> <span class="n">buoy_lat</span>
    <span class="n">buoy_lon</span> <span class="o">=</span> <span class="n">buoy_lon</span>


    <span class="c1"># nighttime mask</span>

    <span class="n">lat_flat</span> <span class="o">=</span> <span class="n">lat</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">lon_flat</span> <span class="o">=</span> <span class="n">lon</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">time_flat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lat_flat</span><span class="p">),</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">date</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">time</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[ns]&#39;</span><span class="p">)</span>


    <span class="n">sza</span><span class="p">,</span> <span class="n">saa</span> <span class="o">=</span> <span class="n">vectorized_solar_angles</span><span class="p">(</span><span class="n">lat_flat</span><span class="p">,</span> <span class="n">lon_flat</span><span class="p">,</span> <span class="n">time_flat</span><span class="p">)</span>
    <span class="n">saa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">saa</span><span class="p">,</span><span class="n">lat</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">sza</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">sza</span><span class="p">,</span><span class="n">lat</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

    <span class="n">night_time_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">sza</span> <span class="o">&gt;</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
    <span class="n">cmap</span> <span class="o">=</span> <span class="n">ListedColormap</span><span class="p">([</span><span class="s1">&#39;white&#39;</span><span class="p">])</span>

    <span class="c1">###############</span>

    <span class="n">min_lon</span><span class="p">,</span> <span class="n">max_lon</span><span class="p">,</span> <span class="n">min_lat</span><span class="p">,</span> <span class="n">max_lat</span> <span class="o">=</span> <span class="o">-</span><span class="mi">70</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">12</span><span class="p">,</span> <span class="mi">20</span>

    <span class="c1"># add coastlines and gridlines</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">22</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
    <span class="n">levels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">line_colour</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span>
    <span class="n">line_colours</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;black&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">levels</span><span class="p">]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">set_text</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Wind Speed prediction from C01 GOES image (m/s) </span><span class="si">{</span><span class="n">date</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">time</span><span class="si">}</span><span class="s1"> &#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">wind_speeds</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;jet&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span><span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span><span class="n">zorder</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">night_time_mask</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span><span class="n">zorder</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cfeature</span><span class="o">.</span><span class="n">COASTLINE</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cfeature</span><span class="o">.</span><span class="n">LAND</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span> <span class="mi">20</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">70</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">crs</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">FuncFormatter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">_</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">x</span><span class="si">:</span><span class="s1">.0f</span><span class="si">}</span><span class="s1">E&#39;</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">15</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">crs</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">FuncFormatter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">y</span><span class="p">,</span> <span class="n">_</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">y</span><span class="si">:</span><span class="s1">.0f</span><span class="si">}</span><span class="s1">N&#39;</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_extent</span><span class="p">((</span><span class="o">-</span><span class="mi">70</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">12</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">70</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">wind_speeds</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;jet&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span><span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="mi">15</span><span class="p">),</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Wind Speed (m/s)&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">gridlines</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span> <span class="mi">999</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">buoy</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">buoy_names</span><span class="p">)):</span>
        <span class="n">lon_b</span><span class="p">,</span> <span class="n">lat_b</span> <span class="o">=</span> <span class="n">buoy_lon</span><span class="p">[</span><span class="n">buoy</span><span class="p">],</span> <span class="n">buoy_lat</span><span class="p">[</span><span class="n">buoy</span><span class="p">]</span>

        <span class="c1"># Skip if out of bounds</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">min_lon</span> <span class="o">&lt;=</span> <span class="n">lon_b</span> <span class="o">&lt;=</span> <span class="n">max_lon</span> <span class="ow">and</span> <span class="n">min_lat</span> <span class="o">&lt;=</span> <span class="n">lat_b</span> <span class="o">&lt;=</span> <span class="n">max_lat</span><span class="p">):</span>
            <span class="k">continue</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lon_b</span><span class="p">,</span> <span class="n">lat_b</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="n">label</span><span class="o">=</span><span class="n">buoy_names</span><span class="p">[</span><span class="n">buoy</span><span class="p">],</span><span class="n">zorder</span> <span class="o">=</span> <span class="mi">999</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
            <span class="n">lon_b</span> <span class="o">+</span> <span class="mf">0.2</span><span class="p">,</span> <span class="n">lat_b</span> <span class="o">+</span> <span class="mf">0.2</span><span class="p">,</span> <span class="n">buoy_names</span><span class="p">[</span><span class="n">buoy</span><span class="p">],</span>
            <span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span>
            <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>
            <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">boxstyle</span><span class="o">=</span><span class="s1">&#39;square,pad=0.2&#39;</span><span class="p">),</span><span class="n">zorder</span> <span class="o">=</span> <span class="mi">999</span>
        <span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">path_folder</span><span class="si">}</span><span class="s1">/plot_wind_speeds.png&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.func_ml.rmse_per_range" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">rmse_per_range</span><span class="p">(</span><span class="n">model_output</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">path_folder</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Calculate the RMSE for different ranges of wind speeds and save the results to a CSV file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>model_output</code>
            </td>
            <td>
                  <code><span title="list">list</span> or <span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Model outputs for the validation dataset.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>target</code>
            </td>
            <td>
                  <code><span title="list">list</span> or <span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True labels for the validation dataset.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>path_folder</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to save the CSV file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Returns:
    pd.DataFrame: DataFrame containing the RMSE and count for each range.</p>


            <details class="quote">
              <summary>Source code in <code>windscangeo\func_ml.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">rmse_per_range</span><span class="p">(</span><span class="n">model_output</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span><span class="n">path_folder</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the RMSE for different ranges of wind speeds and save the results to a CSV file.</span>

<span class="sd">    Args:</span>
<span class="sd">        model_output (list or np.ndarray): Model outputs for the validation dataset.</span>
<span class="sd">        target (list or np.ndarray): True labels for the validation dataset.</span>
<span class="sd">        path_folder (str): Path to save the CSV file.</span>
<span class="sd">    Returns:</span>
<span class="sd">        pd.DataFrame: DataFrame containing the RMSE and count for each range.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">max_target</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
    <span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_target</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bins</span><span class="p">))</span>
    <span class="n">count</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bins</span><span class="p">))</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bins</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">target</span> <span class="o">&gt;=</span> <span class="n">bins</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">target</span> <span class="o">&lt;=</span> <span class="n">bins</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">rmse</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">model_output</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">-</span> <span class="n">target</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">count</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;EVAL : Range </span><span class="si">{</span><span class="n">bins</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2"> m/s - </span><span class="si">{</span><span class="n">bins</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> m/s: RMSE = </span><span class="si">{</span><span class="n">rmse</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2">, count = </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">count</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;bin_start&#39;</span><span class="p">:</span> <span class="n">bins</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s1">&#39;bin_end&#39;</span><span class="p">:</span> <span class="n">bins</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;rmse&#39;</span><span class="p">:</span> <span class="n">rmse</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s1">&#39;count&#39;</span><span class="p">:</span> <span class="n">count</span><span class="p">[</span><span class="n">i</span><span class="p">]})</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
    <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">path_folder</span><span class="si">}</span><span class="s1">/rmse_per_range.csv&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.func_ml.vectorized_solar_angles" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">vectorized_solar_angles</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">time_utc</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>This function calculates the solar zenith angle (SZA) and solar azimuth angle (SAA) for a given latitude, longitude, and time. This is an archived function. Current implementation does not use solar angles but only image input.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>lat</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The latitude values of the scatterometer data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lon</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The longitude values of the scatterometer data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>time_utc</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The observation times in UTC.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>sza</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The solar zenith angle in degrees.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>saa</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The solar azimuth angle in degrees.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\func_ml.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">vectorized_solar_angles</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">time_utc</span><span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function calculates the solar zenith angle (SZA) and solar azimuth angle (SAA) for a given latitude, longitude, and time. This is an archived function. Current implementation does not use solar angles but only image input.</span>

<span class="sd">    Args:</span>
<span class="sd">        lat (numpy.ndarray): The latitude values of the scatterometer data.</span>
<span class="sd">        lon (numpy.ndarray): The longitude values of the scatterometer data.</span>
<span class="sd">        time_utc (numpy.ndarray): The observation times in UTC.</span>

<span class="sd">    Returns:</span>
<span class="sd">        sza (numpy.ndarray): The solar zenith angle in degrees.</span>
<span class="sd">        saa (numpy.ndarray): The solar azimuth angle in degrees.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Convert time to Julian Day</span>
    <span class="n">timestamp</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">time_utc</span><span class="p">)</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">jd</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">timestamp</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;datetime64[ns]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span> <span class="o">/</span> <span class="mi">86400000000000</span> <span class="o">+</span> <span class="mf">2440587.5</span>
    <span class="p">)</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">jd</span> <span class="o">-</span> <span class="mf">2451545.0</span>  <span class="c1"># Days since J2000</span>

    <span class="c1"># Mean longitude, mean anomaly, ecliptic longitude</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">((</span><span class="mf">357.529</span> <span class="o">+</span> <span class="mf">0.98560028</span> <span class="o">*</span> <span class="n">d</span><span class="p">)</span> <span class="o">%</span> <span class="mi">360</span><span class="p">)</span>  <span class="c1"># Mean anomaly</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">((</span><span class="mf">280.459</span> <span class="o">+</span> <span class="mf">0.98564736</span> <span class="o">*</span> <span class="n">d</span><span class="p">)</span> <span class="o">%</span> <span class="mi">360</span><span class="p">)</span>  <span class="c1"># Mean longitude</span>
    <span class="n">L</span> <span class="o">=</span> <span class="p">(</span><span class="n">q</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="mf">1.915</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">g</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="mf">0.020</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">g</span><span class="p">))</span> <span class="o">%</span> <span class="p">(</span>
        <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
    <span class="p">)</span>  <span class="c1"># Ecliptic long</span>

    <span class="c1"># Obliquity of the ecliptic</span>
    <span class="n">e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="mf">23.439</span> <span class="o">-</span> <span class="mf">0.00000036</span> <span class="o">*</span> <span class="n">d</span><span class="p">)</span>

    <span class="c1"># Sun declination</span>
    <span class="n">sin_delta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">L</span><span class="p">)</span>
    <span class="n">delta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="n">sin_delta</span><span class="p">)</span>

    <span class="c1"># Equation of time (in minutes)</span>
    <span class="n">E</span> <span class="o">=</span> <span class="mf">229.18</span> <span class="o">*</span> <span class="p">(</span>
        <span class="mf">0.000075</span>
        <span class="o">+</span> <span class="mf">0.001868</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
        <span class="o">-</span> <span class="mf">0.032077</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
        <span class="o">-</span> <span class="mf">0.014615</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">g</span><span class="p">)</span>
        <span class="o">-</span> <span class="mf">0.040849</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">g</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="c1"># Convert time to fractional hours (UTC)</span>
    <span class="n">fractional_hour</span> <span class="o">=</span> <span class="n">timestamp</span><span class="o">.</span><span class="n">hour</span> <span class="o">+</span> <span class="n">timestamp</span><span class="o">.</span><span class="n">minute</span> <span class="o">/</span> <span class="mi">60</span> <span class="o">+</span> <span class="n">timestamp</span><span class="o">.</span><span class="n">second</span> <span class="o">/</span> <span class="mi">3600</span>

    <span class="c1"># Solar time correction</span>
    <span class="n">time_offset</span> <span class="o">=</span> <span class="n">E</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">lon</span>  <span class="c1"># lon in degrees</span>
    <span class="n">tst</span> <span class="o">=</span> <span class="n">fractional_hour</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">+</span> <span class="n">time_offset</span>  <span class="c1"># True Solar Time in minutes</span>
    <span class="n">ha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">((</span><span class="n">tst</span> <span class="o">/</span> <span class="mi">4</span> <span class="o">-</span> <span class="mi">180</span><span class="p">)</span> <span class="o">%</span> <span class="mi">360</span><span class="p">)</span>  <span class="c1"># Hour angle in radians</span>

    <span class="c1"># Convert lat/lon to radians</span>
    <span class="n">lat_rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span>

    <span class="c1"># Solar zenith angle</span>
    <span class="n">cos_zenith</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">lat_rad</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">delta</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">lat_rad</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span>
        <span class="n">delta</span>
    <span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ha</span><span class="p">)</span>
    <span class="n">zenith</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">cos_zenith</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>  <span class="c1"># in degrees</span>

    <span class="c1"># Solar saa angle</span>
    <span class="n">sin_saa</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ha</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">delta</span><span class="p">)</span>
    <span class="n">cos_saa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">lat_rad</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">delta</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">lat_rad</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span>
        <span class="n">delta</span>
    <span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ha</span><span class="p">)</span>
    <span class="n">saa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">sin_saa</span><span class="p">,</span> <span class="n">cos_saa</span><span class="p">))</span>
    <span class="n">saa</span> <span class="o">=</span> <span class="p">(</span><span class="n">saa</span> <span class="o">+</span> <span class="mi">360</span><span class="p">)</span> <span class="o">%</span> <span class="mi">360</span>  <span class="c1"># Normalize</span>

    <span class="k">return</span> <span class="n">zenith</span><span class="p">,</span> <span class="n">saa</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="windscangeo.func_inference"></a>
    <div class="doc doc-contents first">









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="windscangeo.func_inference.Block" class="doc doc-heading">
            <code>Block</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="torch.nn.Module">Module</span></code></p>


        <p>A basic block for ResNet architecture.
This block consists of two convolutional layers with batch normalization
and ReLU activation. The first layer applies a 3x3 convolution, and the
second layer applies another 3x3 convolution. The block also supports
downsampling through an optional identity downsample layer. The expansion
factor is set to 1, meaning the output channels are the same as the input
channels.</p>
<p>taken from https://github.com/JayPatwardhan/ResNet-PyTorch/blob/master/ResNet/ResNet.py</p>







              <details class="quote">
                <summary>Source code in <code>windscangeo\Models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Block</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A basic block for ResNet architecture.</span>
<span class="sd">    This block consists of two convolutional layers with batch normalization</span>
<span class="sd">    and ReLU activation. The first layer applies a 3x3 convolution, and the</span>
<span class="sd">    second layer applies another 3x3 convolution. The block also supports</span>
<span class="sd">    downsampling through an optional identity downsample layer. The expansion</span>
<span class="sd">    factor is set to 1, meaning the output channels are the same as the input</span>
<span class="sd">    channels.</span>

<span class="sd">    taken from https://github.com/JayPatwardhan/ResNet-PyTorch/blob/master/ResNet/ResNet.py</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">expansion</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">in_channels</span><span class="p">,</span> <span class="n">out_channels</span><span class="p">,</span> <span class="n">i_downsample</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Block</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">conv1</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span><span class="n">in_channels</span><span class="p">,</span> <span class="n">out_channels</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="n">stride</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">batch_norm1</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">BatchNorm2d</span><span class="p">(</span><span class="n">out_channels</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conv2</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span><span class="n">out_channels</span><span class="p">,</span> <span class="n">out_channels</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="n">stride</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">batch_norm2</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">BatchNorm2d</span><span class="p">(</span><span class="n">out_channels</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">i_downsample</span> <span class="o">=</span> <span class="n">i_downsample</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stride</span> <span class="o">=</span> <span class="n">stride</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">relu</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
      <span class="n">identity</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>

      <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">batch_norm2</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conv1</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>
      <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">batch_norm2</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conv2</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">i_downsample</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
          <span class="n">identity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">i_downsample</span><span class="p">(</span><span class="n">identity</span><span class="p">)</span>
      <span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
      <span class="nb">print</span><span class="p">(</span><span class="n">identity</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
      <span class="n">x</span> <span class="o">+=</span> <span class="n">identity</span>
      <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">x</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="windscangeo.func_inference.Bottleneck" class="doc doc-heading">
            <code>Bottleneck</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="torch.nn.Module">Module</span></code></p>


        <p>taken from https://github.com/JayPatwardhan/ResNet-PyTorch/blob/master/ResNet/ResNet.py
A bottleneck block for ResNet architecture.
This block consists of three convolutional layers with batch normalization
and ReLU activation. The first layer reduces the number of channels,
the second layer applies a 3x3 convolution, and the third layer expands
the number of channels back to the original size. The block also supports
downsampling through an optional identity downsample layer.</p>







              <details class="quote">
                <summary>Source code in <code>windscangeo\Models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Bottleneck</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    taken from https://github.com/JayPatwardhan/ResNet-PyTorch/blob/master/ResNet/ResNet.py</span>
<span class="sd">    A bottleneck block for ResNet architecture.</span>
<span class="sd">    This block consists of three convolutional layers with batch normalization</span>
<span class="sd">    and ReLU activation. The first layer reduces the number of channels,</span>
<span class="sd">    the second layer applies a 3x3 convolution, and the third layer expands</span>
<span class="sd">    the number of channels back to the original size. The block also supports</span>
<span class="sd">    downsampling through an optional identity downsample layer.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">expansion</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">in_channels</span><span class="p">,</span> <span class="n">out_channels</span><span class="p">,</span> <span class="n">i_downsample</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Bottleneck</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">conv1</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span><span class="n">in_channels</span><span class="p">,</span> <span class="n">out_channels</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">batch_norm1</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">BatchNorm2d</span><span class="p">(</span><span class="n">out_channels</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">conv2</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span><span class="n">out_channels</span><span class="p">,</span> <span class="n">out_channels</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="n">stride</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">batch_norm2</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">BatchNorm2d</span><span class="p">(</span><span class="n">out_channels</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">conv3</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span><span class="n">out_channels</span><span class="p">,</span> <span class="n">out_channels</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">expansion</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">batch_norm3</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">BatchNorm2d</span><span class="p">(</span><span class="n">out_channels</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">expansion</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">i_downsample</span> <span class="o">=</span> <span class="n">i_downsample</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stride</span> <span class="o">=</span> <span class="n">stride</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">relu</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">identity</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">batch_norm1</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conv1</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>

        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">batch_norm2</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conv2</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>

        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conv3</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">batch_norm3</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

        <span class="c1">#downsample if needed</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">i_downsample</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">identity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">i_downsample</span><span class="p">(</span><span class="n">identity</span><span class="p">)</span>
        <span class="c1">#add identity</span>
        <span class="n">x</span><span class="o">+=</span><span class="n">identity</span>
        <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">x</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="windscangeo.func_inference.ConventionalCNN" class="doc doc-heading">
            <code>ConventionalCNN</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="torch.nn.Module">Module</span></code></p>


        <p>A simple CNN for image regression tasks.
This model consists of a series of convolutional layers followed by
fully connected layers. It is designed to process images and output a
single regression value (e.g., wind speed).</p>







              <details class="quote">
                <summary>Source code in <code>windscangeo\Models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ConventionalCNN</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A simple CNN for image regression tasks.</span>
<span class="sd">    This model consists of a series of convolutional layers followed by</span>
<span class="sd">    fully connected layers. It is designed to process images and output a</span>
<span class="sd">    single regression value (e.g., wind speed).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">image_height</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">image_width</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">features_cnn</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
        <span class="n">kernel_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">in_channels</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">activation_cnn</span><span class="p">:</span> <span class="n">nn</span><span class="o">.</span><span class="n">Module</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(),</span>
        <span class="n">activation_final</span><span class="p">:</span> <span class="n">nn</span><span class="o">.</span><span class="n">Module</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Identity</span><span class="p">(),</span>
        <span class="n">stride</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">dropout_rate</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">activation_cnn</span> <span class="o">=</span> <span class="n">activation_cnn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">activation_final</span> <span class="o">=</span> <span class="n">activation_final</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dropout_rate</span> <span class="o">=</span> <span class="n">dropout_rate</span>

        <span class="c1"># ------- Convolutional backbone -------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">convs</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ModuleList</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">features_cnn</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">convs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span>
                        <span class="n">in_channels</span><span class="o">=</span><span class="n">in_channels</span><span class="p">,</span>
                        <span class="n">out_channels</span><span class="o">=</span><span class="n">feature</span><span class="p">,</span>
                        <span class="n">kernel_size</span><span class="o">=</span><span class="n">kernel_size</span><span class="p">,</span>
                        <span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                        <span class="n">stride</span><span class="o">=</span><span class="n">stride</span><span class="p">,</span>
                    <span class="p">),</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">activation_cnn</span><span class="p">,</span>
                    <span class="n">nn</span><span class="o">.</span><span class="n">MaxPool2d</span><span class="p">(</span><span class="n">kernel_size</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span>
                    <span class="n">nn</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dropout_rate</span><span class="p">),</span>
                <span class="p">]</span>
            <span class="p">)</span>
            <span class="n">in_channels</span> <span class="o">=</span> <span class="n">feature</span>

        <span class="c1"># ------- Classifier / regressor head -------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flattened_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_flattened_size</span><span class="p">(</span><span class="n">image_height</span><span class="p">,</span> <span class="n">image_width</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fc_cnn</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flattened_size</span><span class="p">,</span> <span class="mi">64</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dropout_cnn</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dropout_rate</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">head</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="mi">16</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">activation_cnn</span><span class="p">,</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dropout_rate</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">activation_final</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_flattened_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">w</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">convs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">in_channels</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">convs</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">layer</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">numel</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">image</span>
        <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">convs</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">layer</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>              <span class="c1"># flatten</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">activation_cnn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fc_cnn</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dropout_cnn</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="windscangeo.func_inference.H5pyDataset" class="doc doc-heading">
            <code>H5pyDataset</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="torch.utils.data.Dataset">Dataset</span></code></p>


        <p>A PyTorch Dataset for loading data from an HDF5 file. This is useful when dealing with large datasets that do not fit into memory.
Need to work on Zarr integration for better performance</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>h5_file_path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the HDF5 file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>transform</code>
            </td>
            <td>
                  <code><span title="callable">callable</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A function/transform to apply to the images.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>windscangeo\func_ml.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">H5pyDataset</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Dataset</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A PyTorch Dataset for loading data from an HDF5 file. This is useful when dealing with large datasets that do not fit into memory.</span>
<span class="sd">    Need to work on Zarr integration for better performance</span>

<span class="sd">    Args:</span>
<span class="sd">        h5_file_path (str): Path to the HDF5 file.</span>
<span class="sd">        transform (callable, optional): A function/transform to apply to the images.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h5_file_path</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">h5_file_path</span> <span class="o">=</span> <span class="n">h5_file_path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transform</span> <span class="o">=</span> <span class="n">transform</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Will be initialized per worker</span>
        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h5_file_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="s1">&#39;targets&#39;</span><span class="p">])</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_ensure_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h5_file_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_file</span><span class="p">()</span>

        <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="p">[</span><span class="s1">&#39;images&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span>
        <span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="p">[</span><span class="s1">&#39;targets&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span>

        <span class="n">image</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="n">target</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">:</span>
            <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">image</span><span class="p">,</span> <span class="n">target</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="windscangeo.func_inference.Img2Seq" class="doc doc-heading">
            <code>Img2Seq</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="torch.nn.Module">Module</span></code></p>


        <p>This layers takes a batch of images as input and
returns a batch of sequences</p>


<details class="shape" open>
  <summary>Shape</summary>
  <p>input: (b, h, w, c)
output: (b, s, d)</p>
</details>        <p>taken from https://www.kaggle.com/code/umongsain/vision-transformer-from-scratch-pytorch</p>







              <details class="quote">
                <summary>Source code in <code>windscangeo\Models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Img2Seq</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This layers takes a batch of images as input and</span>
<span class="sd">    returns a batch of sequences</span>

<span class="sd">    Shape:</span>
<span class="sd">        input: (b, h, w, c)</span>
<span class="sd">        output: (b, s, d)</span>

<span class="sd">    taken from https://www.kaggle.com/code/umongsain/vision-transformer-from-scratch-pytorch</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img_size</span><span class="p">,</span> <span class="n">patch_size</span><span class="p">,</span> <span class="n">n_channels</span><span class="p">,</span> <span class="n">d_model</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">patch_size</span> <span class="o">=</span> <span class="n">patch_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">img_size</span> <span class="o">=</span> <span class="n">img_size</span>

        <span class="n">nh</span><span class="p">,</span> <span class="n">nw</span> <span class="o">=</span> <span class="n">img_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="n">patch_size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">img_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">//</span> <span class="n">patch_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">n_tokens</span> <span class="o">=</span> <span class="n">nh</span> <span class="o">*</span> <span class="n">nw</span>

        <span class="n">token_dim</span> <span class="o">=</span> <span class="n">patch_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">patch_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_channels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">linear</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">token_dim</span><span class="p">,</span> <span class="n">d_model</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cls_token</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">d_model</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pos_emb</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">n_tokens</span><span class="p">,</span> <span class="n">d_model</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">):</span>
        <span class="n">batch</span> <span class="o">=</span> <span class="n">patchify</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">patch_size</span><span class="p">)</span>

        <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">nh</span><span class="p">,</span> <span class="n">nw</span><span class="p">,</span> <span class="n">ph</span><span class="p">,</span> <span class="n">pw</span> <span class="o">=</span> <span class="n">batch</span><span class="o">.</span><span class="n">shape</span>

        <span class="c1"># Flattening the patches</span>
        <span class="n">batch</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">batch</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="p">[</span><span class="n">b</span><span class="p">,</span> <span class="n">nh</span> <span class="o">*</span> <span class="n">nw</span><span class="p">,</span> <span class="n">ph</span> <span class="o">*</span> <span class="n">pw</span> <span class="o">*</span> <span class="n">c</span><span class="p">])</span>

        <span class="n">batch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">linear</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span>
        <span class="bp">cls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cls_token</span><span class="o">.</span><span class="n">expand</span><span class="p">([</span><span class="n">b</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">emb</span> <span class="o">=</span> <span class="n">batch</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos_emb</span>

        <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="bp">cls</span><span class="p">,</span> <span class="n">emb</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="windscangeo.func_inference.Normalize" class="doc doc-heading">
            <code>Normalize</code>


</h2>


    <div class="doc doc-contents ">


        <p>Normalize the input tensor by subtracting the mean and dividing by the standard deviation. Done per batch </p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>mean</code>
            </td>
            <td>
                  <code><span title="list">list</span> or <span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mean values for normalization.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>std</code>
            </td>
            <td>
                  <code><span title="list">list</span> or <span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Standard deviation values for normalization.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>windscangeo\func_ml.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Normalize</span><span class="p">:</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Normalize the input tensor by subtracting the mean and dividing by the standard deviation. Done per batch </span>

<span class="sd">    Args:</span>
<span class="sd">        mean (list or np.ndarray): Mean values for normalization.</span>
<span class="sd">        std (list or np.ndarray): Standard deviation values for normalization.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">std</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mean</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">mean</span><span class="p">)</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">std</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">std</span><span class="p">)</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">std</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="windscangeo.func_inference.ResNet" class="doc doc-heading">
            <code>ResNet</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="torch.nn.Module">Module</span></code></p>


        <p>A ResNet model for image classification or regression tasks.
This model consists of an initial convolutional layer, followed by a series
of residual blocks, and a fully connected layer for classification or regression.
The number of residual blocks in each layer is specified by the <code>layer_list</code> parameter.
taken from https://github.com/JayPatwardhan/ResNet-PyTorch/blob/master/ResNet/ResNet.py</p>







              <details class="quote">
                <summary>Source code in <code>windscangeo\Models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ResNet</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A ResNet model for image classification or regression tasks.</span>
<span class="sd">    This model consists of an initial convolutional layer, followed by a series</span>
<span class="sd">    of residual blocks, and a fully connected layer for classification or regression.</span>
<span class="sd">    The number of residual blocks in each layer is specified by the `layer_list` parameter.</span>
<span class="sd">    taken from https://github.com/JayPatwardhan/ResNet-PyTorch/blob/master/ResNet/ResNet.py</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ResBlock</span><span class="p">,</span> <span class="n">layer_list</span><span class="p">,</span> <span class="n">num_classes</span><span class="p">,</span> <span class="n">num_channels</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ResNet</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">in_channels</span> <span class="o">=</span> <span class="mi">64</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">conv1</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span><span class="n">num_channels</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">batch_norm1</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">BatchNorm2d</span><span class="p">(</span><span class="mi">64</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">relu</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_pool</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">MaxPool2d</span><span class="p">(</span><span class="n">kernel_size</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">layer1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_layer</span><span class="p">(</span><span class="n">ResBlock</span><span class="p">,</span> <span class="n">layer_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">planes</span><span class="o">=</span><span class="mi">64</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layer2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_layer</span><span class="p">(</span><span class="n">ResBlock</span><span class="p">,</span> <span class="n">layer_list</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">planes</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layer3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_layer</span><span class="p">(</span><span class="n">ResBlock</span><span class="p">,</span> <span class="n">layer_list</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">planes</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layer4</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_layer</span><span class="p">(</span><span class="n">ResBlock</span><span class="p">,</span> <span class="n">layer_list</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">planes</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">avgpool</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">AdaptiveAvgPool2d</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fc</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">512</span><span class="o">*</span><span class="n">ResBlock</span><span class="o">.</span><span class="n">expansion</span><span class="p">,</span> <span class="n">num_classes</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">batch_norm1</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conv1</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_pool</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">layer1</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">layer2</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">layer3</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">layer4</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">avgpool</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fc</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">x</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_make_layer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ResBlock</span><span class="p">,</span> <span class="n">blocks</span><span class="p">,</span> <span class="n">planes</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">ii_downsample</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">layers</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">stride</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_channels</span> <span class="o">!=</span> <span class="n">planes</span><span class="o">*</span><span class="n">ResBlock</span><span class="o">.</span><span class="n">expansion</span><span class="p">:</span>
            <span class="n">ii_downsample</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
                <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">in_channels</span><span class="p">,</span> <span class="n">planes</span><span class="o">*</span><span class="n">ResBlock</span><span class="o">.</span><span class="n">expansion</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="n">stride</span><span class="p">),</span>
                <span class="n">nn</span><span class="o">.</span><span class="n">BatchNorm2d</span><span class="p">(</span><span class="n">planes</span><span class="o">*</span><span class="n">ResBlock</span><span class="o">.</span><span class="n">expansion</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="n">layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ResBlock</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">in_channels</span><span class="p">,</span> <span class="n">planes</span><span class="p">,</span> <span class="n">i_downsample</span><span class="o">=</span><span class="n">ii_downsample</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="n">stride</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">in_channels</span> <span class="o">=</span> <span class="n">planes</span><span class="o">*</span><span class="n">ResBlock</span><span class="o">.</span><span class="n">expansion</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">blocks</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ResBlock</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">in_channels</span><span class="p">,</span> <span class="n">planes</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span><span class="o">*</span><span class="n">layers</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="windscangeo.func_inference.ViT" class="doc doc-heading">
            <code>ViT</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="torch.nn.Module">Module</span></code></p>


        <p>Vision Transformer (ViT) model for image classification or regression tasks.
This model consists of an image-to-sequence layer, a transformer encoder,
and a multi-layer perceptron (MLP) head for classification or regression.</p>
<p>Taken from # https://www.kaggle.com/code/umongsain/vision-transformer-from-scratch-pytorch</p>







              <details class="quote">
                <summary>Source code in <code>windscangeo\Models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ViT</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Vision Transformer (ViT) model for image classification or regression tasks.</span>
<span class="sd">    This model consists of an image-to-sequence layer, a transformer encoder,</span>
<span class="sd">    and a multi-layer perceptron (MLP) head for classification or regression.</span>

<span class="sd">    Taken from # https://www.kaggle.com/code/umongsain/vision-transformer-from-scratch-pytorch</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">img_size</span><span class="p">,</span>
        <span class="n">patch_size</span><span class="p">,</span>
        <span class="n">n_channels</span><span class="p">,</span>
        <span class="n">d_model</span><span class="p">,</span>
        <span class="n">nhead</span><span class="p">,</span>
        <span class="n">dim_feedforward</span><span class="p">,</span>
        <span class="n">blocks</span><span class="p">,</span>
        <span class="n">mlp_head_units</span><span class="p">,</span>
        <span class="n">n_classes</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            img_size: Size of the image</span>
<span class="sd">            patch_size: Size of the patch</span>
<span class="sd">            n_channels: Number of image channels</span>
<span class="sd">            d_model: The number of features in the transformer encoder</span>
<span class="sd">            nhead: The number of heads in the multiheadattention models</span>
<span class="sd">            dim_feedforward: The dimension of the feedforward network model in the encoder</span>
<span class="sd">            blocks: The number of sub-encoder-layers in the encoder</span>
<span class="sd">            mlp_head_units: The hidden units of mlp_head</span>
<span class="sd">            n_classes: The number of output classes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">img2seq</span> <span class="o">=</span> <span class="n">Img2Seq</span><span class="p">(</span><span class="n">img_size</span><span class="p">,</span> <span class="n">patch_size</span><span class="p">,</span> <span class="n">n_channels</span><span class="p">,</span> <span class="n">d_model</span><span class="p">)</span>

        <span class="n">encoder_layer</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">TransformerEncoderLayer</span><span class="p">(</span>
            <span class="n">d_model</span><span class="p">,</span> <span class="n">nhead</span><span class="p">,</span> <span class="n">dim_feedforward</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s2">&quot;gelu&quot;</span><span class="p">,</span> <span class="n">batch_first</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transformer_encoder</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">TransformerEncoder</span><span class="p">(</span>
            <span class="n">encoder_layer</span><span class="p">,</span> <span class="n">blocks</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mlp</span> <span class="o">=</span> <span class="n">get_mlp</span><span class="p">(</span><span class="n">d_model</span><span class="p">,</span> <span class="n">mlp_head_units</span><span class="p">,</span> <span class="n">n_classes</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">output</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Identity</span><span class="p">()</span> <span class="c1"># For regression</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">):</span>

        <span class="n">batch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img2seq</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span>
        <span class="n">batch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformer_encoder</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span>
        <span class="n">batch</span> <span class="o">=</span> <span class="n">batch</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">batch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mlp</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">output</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="windscangeo.func_inference.conventional_dataset" class="doc doc-heading">
            <code>conventional_dataset</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="torch.utils.data.Dataset">Dataset</span></code></p>


        <p>A PyTorch Dataset for loading data using regular numpy arrays.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>images</code>
            </td>
            <td>
                  <code><span title="list">list</span> or <span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List or array of images.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>targets</code>
            </td>
            <td>
                  <code><span title="list">list</span> or <span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List or array of targets corresponding to the images.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>transform</code>
            </td>
            <td>
                  <code><span title="callable">callable</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A function/transform to apply to the images.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>windscangeo\func_ml.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">conventional_dataset</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Dataset</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A PyTorch Dataset for loading data using regular numpy arrays.</span>

<span class="sd">    Args:</span>
<span class="sd">        images (list or np.ndarray): List or array of images.</span>
<span class="sd">        targets (list or np.ndarray): List or array of targets corresponding to the images.</span>
<span class="sd">        transform (callable, optional): A function/transform to apply to the images.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">images</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">images</span> <span class="o">=</span> <span class="n">images</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">targets</span> <span class="o">=</span> <span class="n">targets</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transform</span> <span class="o">=</span> <span class="n">transform</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
        <span class="c1"># 1) Image</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">:</span>
            <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

        <span class="c1"># 2) Target for sample &quot;idx&quot;</span>
        <span class="n">target</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">image</span><span class="p">,</span> <span class="n">target</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="windscangeo.func_inference.conventional_dataset_inference" class="doc doc-heading">
            <code>conventional_dataset_inference</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="torch.utils.data.Dataset">Dataset</span></code></p>


        <p>A PyTorch Dataset for loading data for inference (no lable) using regular numpy arrays.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>images</code>
            </td>
            <td>
                  <code><span title="list">list</span> or <span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List or array of images to be used for inference.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>transform</code>
            </td>
            <td>
                  <code><span title="callable">callable</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A function/transform to apply to the images.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>windscangeo\func_ml.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">conventional_dataset_inference</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Dataset</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A PyTorch Dataset for loading data for inference (no lable) using regular numpy arrays.</span>

<span class="sd">    Args:</span>
<span class="sd">        images (list or np.ndarray): List or array of images to be used for inference.</span>
<span class="sd">        transform (callable, optional): A function/transform to apply to the images.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">images</span><span class="p">,</span><span class="n">transform</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">images</span> <span class="o">=</span> <span class="n">images</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transform</span> <span class="o">=</span> <span class="n">transform</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
        <span class="c1"># 1) Image</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">:</span>
            <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">image</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h2 id="windscangeo.func_inference.buoy_data_extract" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">buoy_data_extract</span><span class="p">(</span><span class="n">folder_path</span><span class="p">,</span> <span class="n">polar_data</span><span class="p">,</span> <span class="n">date</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Extracts buoy data from a specified folder and returns arrays of latitude, longitude, time, wind speed, and buoy names.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>folder_path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the folder containing buoy data files.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>polar_data</code>
            </td>
            <td>
                  <code><span title="xarray.Dataset">Dataset</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Polar data containing latitude and longitude information. Used to snap buoy data to the nearest polar grid points.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>date</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Date for which to extract buoy data, in 'YYYY-MM-DD' format.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>buoy_lat</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of buoy latitudes snapped to the nearest polar grid points.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>buoy_lon</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of buoy longitudes snapped to the nearest polar grid points</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>buoy_time</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of buoy observation times.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>buoy_wind_speed</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of buoy wind speeds.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>buoy_name</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of buoy names.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\func_inference.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">buoy_data_extract</span><span class="p">(</span><span class="n">folder_path</span><span class="p">,</span> <span class="n">polar_data</span><span class="p">,</span> <span class="n">date</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Extracts buoy data from a specified folder and returns arrays of latitude, longitude, time, wind speed, and buoy names.</span>

<span class="sd">    Args:</span>
<span class="sd">        folder_path (str): Path to the folder containing buoy data files.</span>
<span class="sd">        polar_data (xarray.Dataset): Polar data containing latitude and longitude information. Used to snap buoy data to the nearest polar grid points.</span>
<span class="sd">        date (str): Date for which to extract buoy data, in &#39;YYYY-MM-DD&#39; format.</span>

<span class="sd">    Returns:</span>
<span class="sd">        buoy_lat (np.ndarray): Array of buoy latitudes snapped to the nearest polar grid points.</span>
<span class="sd">        buoy_lon (np.ndarray): Array of buoy longitudes snapped to the nearest polar grid points</span>
<span class="sd">        buoy_time (np.ndarray): Array of buoy observation times.</span>
<span class="sd">        buoy_wind_speed (np.ndarray): Array of buoy wind speeds.</span>
<span class="sd">        buoy_name (np.ndarray): Array of buoy names.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">buoy_lat</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">buoy_lon</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">buoy_wind_speed</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">buoy_time</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">buoy_name</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">folder_path</span><span class="p">):</span>
        <span class="k">if</span> <span class="s2">&quot;.cdf&quot;</span> <span class="ow">in</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder_path</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
            <span class="n">opened</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
            <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">wind_speed</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">form_arrays_buoy</span><span class="p">(</span><span class="n">opened</span><span class="p">,</span> <span class="n">date</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">wind_speed</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">buoy_lat</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span>
                <span class="n">buoy_lon</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">lon</span><span class="p">)</span>
                <span class="n">buoy_wind_speed</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">wind_speed</span><span class="p">)</span>
                <span class="n">buoy_time</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
                <span class="n">buoy_name</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="n">buoy_lat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">buoy_lat</span><span class="p">)</span>
    <span class="n">buoy_lat</span> <span class="o">=</span> <span class="n">snap_to_nearest</span><span class="p">(</span><span class="n">buoy_lat</span><span class="p">,</span> <span class="n">polar_data</span><span class="o">.</span><span class="n">latitude</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">cutoff</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
    <span class="n">buoy_lon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">buoy_lon</span><span class="p">)</span>
    <span class="n">buoy_wind_speed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">buoy_wind_speed</span><span class="p">)</span>
    <span class="n">buoy_time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">buoy_time</span><span class="p">)</span>

    <span class="n">buoy_lon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">buoy_lon</span> <span class="o">&gt;</span> <span class="mi">180</span><span class="p">,</span> <span class="n">buoy_lon</span> <span class="o">-</span> <span class="mi">360</span><span class="p">,</span> <span class="n">buoy_lon</span><span class="p">)</span>
    <span class="n">buoy_lon</span> <span class="o">=</span> <span class="n">snap_to_nearest</span><span class="p">(</span><span class="n">buoy_lon</span><span class="p">,</span> <span class="n">polar_data</span><span class="o">.</span><span class="n">longitude</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">cutoff</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">buoy_lat</span><span class="p">,</span> <span class="n">buoy_lon</span><span class="p">,</span> <span class="n">buoy_time</span><span class="p">,</span> <span class="n">buoy_wind_speed</span><span class="p">,</span> <span class="n">buoy_name</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.func_inference.calculate_degrees" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_degrees</span><span class="p">(</span><span class="n">file_id</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>This function calculates the latitude and longitude of the GOES ABI fixed grid projection. 
This function comes from NOAA/NESDIS/STAR. (2025). Latitude and longitude remapping of GOES-R ABI imagery using Python . Atmospheric Composition Science Team. Retrieved from https://www.star.nesdis.noaa.gov/atmospheric-composition-training/python_abi_lat_lon.php</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>file_id</code>
            </td>
            <td>
                  <code><span title="xarray.Dataset">Dataset</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The xarray dataset containing the GOES ABI fixed grid projection variables.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>abi_lat</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The latitude of the GOES ABI fixed grid projection.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>abi_lon</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The longitude of the GOES ABI fixed grid projection.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\func.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate_degrees</span><span class="p">(</span><span class="n">file_id</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This function calculates the latitude and longitude of the GOES ABI fixed grid projection. </span>
<span class="sd">    This function comes from NOAA/NESDIS/STAR. (2025). Latitude and longitude remapping of GOES-R ABI imagery using Python . Atmospheric Composition Science Team. Retrieved from https://www.star.nesdis.noaa.gov/atmospheric-composition-training/python_abi_lat_lon.php</span>

<span class="sd">    Args:</span>
<span class="sd">        file_id (xarray.Dataset): The xarray dataset containing the GOES ABI fixed grid projection variables.</span>

<span class="sd">    Returns:</span>
<span class="sd">        abi_lat (numpy.ndarray): The latitude of the GOES ABI fixed grid projection.</span>
<span class="sd">        abi_lon (numpy.ndarray): The longitude of the GOES ABI fixed grid projection.</span>


<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Read in GOES ABI fixed grid projection variables and constants</span>
    <span class="n">x_coordinate_1d</span> <span class="o">=</span> <span class="n">file_id</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">][:]</span>  <span class="c1"># E/W scanning angle in radians</span>
    <span class="n">y_coordinate_1d</span> <span class="o">=</span> <span class="n">file_id</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">][:]</span>  <span class="c1"># N/S elevation angle in radians</span>
    <span class="n">projection_info</span> <span class="o">=</span> <span class="n">file_id</span><span class="o">.</span><span class="n">goes_imager_projection</span>
    <span class="n">lon_origin</span> <span class="o">=</span> <span class="n">projection_info</span><span class="o">.</span><span class="n">longitude_of_projection_origin</span>
    <span class="n">H</span> <span class="o">=</span> <span class="n">projection_info</span><span class="o">.</span><span class="n">perspective_point_height</span> <span class="o">+</span> <span class="n">projection_info</span><span class="o">.</span><span class="n">semi_major_axis</span>
    <span class="n">r_eq</span> <span class="o">=</span> <span class="n">projection_info</span><span class="o">.</span><span class="n">semi_major_axis</span>
    <span class="n">r_pol</span> <span class="o">=</span> <span class="n">projection_info</span><span class="o">.</span><span class="n">semi_minor_axis</span>

    <span class="c1"># Create 2D coordinate matrices from 1D coordinate vectors</span>
    <span class="n">x_coordinate_2d</span><span class="p">,</span> <span class="n">y_coordinate_2d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x_coordinate_1d</span><span class="p">,</span> <span class="n">y_coordinate_1d</span><span class="p">)</span>

    <span class="c1"># Equations to calculate latitude and longitude</span>
    <span class="n">lambda_0</span> <span class="o">=</span> <span class="p">(</span><span class="n">lon_origin</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">/</span> <span class="mf">180.0</span>
    <span class="n">a_var</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x_coordinate_2d</span><span class="p">),</span> <span class="mf">2.0</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">x_coordinate_2d</span><span class="p">),</span> <span class="mf">2.0</span><span class="p">)</span>
        <span class="o">*</span> <span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">y_coordinate_2d</span><span class="p">),</span> <span class="mf">2.0</span><span class="p">)</span>
            <span class="o">+</span> <span class="p">(</span>
                <span class="p">((</span><span class="n">r_eq</span> <span class="o">*</span> <span class="n">r_eq</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">r_pol</span> <span class="o">*</span> <span class="n">r_pol</span><span class="p">))</span>
                <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">y_coordinate_2d</span><span class="p">),</span> <span class="mf">2.0</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="n">b_var</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">H</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">x_coordinate_2d</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">y_coordinate_2d</span><span class="p">)</span>
    <span class="n">c_var</span> <span class="o">=</span> <span class="p">(</span><span class="n">H</span><span class="o">**</span><span class="mf">2.0</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">r_eq</span><span class="o">**</span><span class="mf">2.0</span><span class="p">)</span>
    <span class="n">r_s</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">1.0</span> <span class="o">*</span> <span class="n">b_var</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">b_var</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="mf">4.0</span> <span class="o">*</span> <span class="n">a_var</span> <span class="o">*</span> <span class="n">c_var</span><span class="p">)))</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">a_var</span><span class="p">)</span>
    <span class="n">s_x</span> <span class="o">=</span> <span class="n">r_s</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">x_coordinate_2d</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">y_coordinate_2d</span><span class="p">)</span>
    <span class="n">s_y</span> <span class="o">=</span> <span class="o">-</span><span class="n">r_s</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x_coordinate_2d</span><span class="p">)</span>
    <span class="n">s_z</span> <span class="o">=</span> <span class="n">r_s</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">x_coordinate_2d</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">y_coordinate_2d</span><span class="p">)</span>

    <span class="c1"># Ignore numpy errors for sqrt of negative number; occurs for GOES-16 ABI CONUS sector data</span>
    <span class="n">np</span><span class="o">.</span><span class="n">seterr</span><span class="p">(</span><span class="nb">all</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>

    <span class="n">abi_lat</span> <span class="o">=</span> <span class="p">(</span><span class="mf">180.0</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span>
            <span class="p">((</span><span class="n">r_eq</span> <span class="o">*</span> <span class="n">r_eq</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">r_pol</span> <span class="o">*</span> <span class="n">r_pol</span><span class="p">))</span>
            <span class="o">*</span> <span class="p">((</span><span class="n">s_z</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(((</span><span class="n">H</span> <span class="o">-</span> <span class="n">s_x</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">H</span> <span class="o">-</span> <span class="n">s_x</span><span class="p">))</span> <span class="o">+</span> <span class="p">(</span><span class="n">s_y</span> <span class="o">*</span> <span class="n">s_y</span><span class="p">))))</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="n">abi_lon</span> <span class="o">=</span> <span class="p">(</span><span class="n">lambda_0</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">s_y</span> <span class="o">/</span> <span class="p">(</span><span class="n">H</span> <span class="o">-</span> <span class="n">s_x</span><span class="p">)))</span> <span class="o">*</span> <span class="p">(</span><span class="mf">180.0</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;INFO : Latitude and longitude calculated&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">abi_lat</span><span class="p">,</span> <span class="n">abi_lon</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.func_inference.create_folder" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_folder</span><span class="p">(</span><span class="n">experiment_name</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Create a folder for saving results based on the experiment name.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>experiment_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the experiment to create a folder for.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the created folder.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\func.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create_folder</span><span class="p">(</span><span class="n">experiment_name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a folder for saving results based on the experiment name.</span>

<span class="sd">    Args:</span>
<span class="sd">        experiment_name (str): Name of the experiment to create a folder for.</span>
<span class="sd">        If the folder already exists, it will not be created again.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Path to the created folder.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">path_folder</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;./results_folder/model_day_</span><span class="si">{</span><span class="n">experiment_name</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path_folder</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">path_folder</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Folder created at </span><span class="si">{</span><span class="n">path_folder</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">path_folder</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.func_inference.early_stopping" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">early_stopping</span><span class="p">(</span><span class="n">valid_losses</span><span class="p">,</span> <span class="n">patience_epochs</span><span class="p">,</span> <span class="n">patience_loss</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Early stopping function to determine if training should stop based on validation losses. From @ Jing Sun</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>valid_losses</code>
            </td>
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of validation losses recorded during training.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>patience_epochs</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of epochs to wait before stopping if no improvement.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>patience_loss</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Minimum change in validation loss to consider as an improvement.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bool</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if training should stop, False otherwise.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\impl.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">early_stopping</span><span class="p">(</span><span class="n">valid_losses</span><span class="p">,</span> <span class="n">patience_epochs</span><span class="p">,</span> <span class="n">patience_loss</span><span class="p">):</span>  <span class="c1"># From @Jing</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Early stopping function to determine if training should stop based on validation losses. From @ Jing Sun</span>

<span class="sd">    Args:</span>
<span class="sd">        valid_losses (list): List of validation losses recorded during training.</span>
<span class="sd">        patience_epochs (int): Number of epochs to wait before stopping if no improvement.</span>
<span class="sd">        patience_loss (float): Minimum change in validation loss to consider as an improvement.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if training should stop, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">valid_losses</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">patience_epochs</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="n">recent_losses</span> <span class="o">=</span> <span class="n">valid_losses</span><span class="p">[</span><span class="o">-</span><span class="n">patience_epochs</span><span class="p">:]</span>

    <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="n">recent_losses</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">recent_losses</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">if</span> <span class="nb">max</span><span class="p">(</span><span class="n">recent_losses</span><span class="p">)</span> <span class="o">-</span> <span class="nb">min</span><span class="p">(</span><span class="n">recent_losses</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">patience_loss</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.func_inference.error_plot" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">error_plot</span><span class="p">(</span><span class="n">best_val_outputs</span><span class="p">,</span> <span class="n">best_val_labels</span><span class="p">,</span> <span class="n">path_folder</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Plot a scatter plot of model outputs vs true labels for the validation dataset.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>best_val_outputs</code>
            </td>
            <td>
                  <code><span title="list">list</span> or <span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Model outputs for the validation dataset.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>best_val_labels</code>
            </td>
            <td>
                  <code><span title="list">list</span> or <span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True labels for the validation dataset.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>path_folder</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to save the plot. If None, the plot will not be saved.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\func_ml.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">error_plot</span><span class="p">(</span><span class="n">best_val_outputs</span><span class="p">,</span> <span class="n">best_val_labels</span><span class="p">,</span> <span class="n">path_folder</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot a scatter plot of model outputs vs true labels for the validation dataset.</span>

<span class="sd">    Args:</span>
<span class="sd">        best_val_outputs (list or np.ndarray): Model outputs for the validation dataset.</span>
<span class="sd">        best_val_labels (list or np.ndarray): True labels for the validation dataset.</span>
<span class="sd">        path_folder (str, optional): Path to save the plot. If None, the plot will not be saved.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">max_all</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">best_val_outputs</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">best_val_labels</span><span class="p">))</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">best_val_labels</span><span class="p">,</span> <span class="n">best_val_outputs</span><span class="p">,</span> <span class="s2">&quot;o&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s2">&quot;equal&quot;</span><span class="p">,</span> <span class="n">adjustable</span><span class="o">=</span><span class="s2">&quot;box&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_all</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_all</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;True Labels&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Model Output&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Model Output vs True Labels in test dataset&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">best_val_labels</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">best_val_labels</span><span class="p">)],</span>
        <span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">best_val_labels</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">best_val_labels</span><span class="p">)],</span>
        <span class="s2">&quot;r--&quot;</span><span class="p">,</span>
    <span class="p">)</span>  <span class="c1"># y = x reference line</span>
    <span class="k">if</span> <span class="n">path_folder</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_folder</span><span class="p">,</span> <span class="s2">&quot;scatter_plot.png&quot;</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.func_inference.extract_goes" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">extract_goes</span><span class="p">(</span><span class="n">observation_times</span><span class="p">,</span> <span class="n">observation_lats</span><span class="p">,</span> <span class="n">observation_lons</span><span class="p">,</span> <span class="n">scatterometer_data_path</span><span class="p">,</span> <span class="n">goes_aws_url_folder</span><span class="p">,</span> <span class="n">goes_channel</span><span class="o">=</span><span class="s1">&#39;C01&#39;</span><span class="p">,</span> <span class="n">goes_image_size</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>This function extracts GOES images for the given observation times, latitudes, and longitudes.
It retrieves the GOES data from the specified AWS S3 bucket and processes it to create images of the specified size.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>observation_times</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The times of observation of the scatterometer data. </p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>observation_lats</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The latitudes of the scatterometer data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>observation_lons</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The longitudes of the scatterometer data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>scatterometer_data_path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The path to the scatterometer data directory.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>goes_aws_url_folder</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The folder in the AWS S3 bucket where the GOES data is stored.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>goes_channel</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The channel of interest. Default is "C01".</p>
              </div>
            </td>
            <td>
                  <code>&#39;C01&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>goes_image_size</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The size of the output images. Default is 128.</p>
              </div>
            </td>
            <td>
                  <code>128</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>verbose</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, prints progress information.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>images</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A 4D numpy array of shape (num_observations, num_channels, goes_image_size, goes_image_size) containing the extracted GOES images.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\func.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">extract_goes</span><span class="p">(</span>
    <span class="n">observation_times</span><span class="p">,</span>
    <span class="n">observation_lats</span><span class="p">,</span>
    <span class="n">observation_lons</span><span class="p">,</span>
    <span class="n">scatterometer_data_path</span><span class="p">,</span>
    <span class="n">goes_aws_url_folder</span><span class="p">,</span>
    <span class="n">goes_channel</span><span class="o">=</span><span class="s2">&quot;C01&quot;</span><span class="p">,</span>
    <span class="n">goes_image_size</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function extracts GOES images for the given observation times, latitudes, and longitudes.</span>
<span class="sd">    It retrieves the GOES data from the specified AWS S3 bucket and processes it to create images of the specified size.</span>

<span class="sd">    Args:</span>
<span class="sd">        observation_times (numpy.ndarray): The times of observation of the scatterometer data. </span>
<span class="sd">        observation_lats (numpy.ndarray): The latitudes of the scatterometer data.</span>
<span class="sd">        observation_lons (numpy.ndarray): The longitudes of the scatterometer data.</span>
<span class="sd">        scatterometer_data_path (str): The path to the scatterometer data directory.</span>
<span class="sd">        goes_aws_url_folder (str): The folder in the AWS S3 bucket where the GOES data is stored.</span>
<span class="sd">        goes_channel (str): The channel of interest. Default is &quot;C01&quot;.</span>
<span class="sd">        goes_image_size (int): The size of the output images. Default is 128.</span>
<span class="sd">        verbose (bool): If True, prints progress information.</span>

<span class="sd">    Returns:</span>
<span class="sd">        images (numpy.ndarray): A 4D numpy array of shape (num_observations, num_channels, goes_image_size, goes_image_size) containing the extracted GOES images.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">scatterometer_data_path</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.nc&quot;</span><span class="p">):</span>
            <span class="n">polar</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">scatterometer_data_path</span><span class="p">,</span> <span class="n">file</span><span class="p">),</span>
                <span class="n">engine</span><span class="o">=</span><span class="s2">&quot;h5netcdf&quot;</span><span class="p">,</span>
                <span class="n">drop_variables</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;DQF&quot;</span><span class="p">],</span>
            <span class="p">)</span>
            <span class="k">break</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;WARNING : No .nc file found in the scatterometer data path, please check the path&#39;</span><span class="p">)</span>

    <span class="n">template_scatter</span> <span class="o">=</span> <span class="n">polar</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">lat_grd</span><span class="p">,</span> <span class="n">lon_grd</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">template_scatter</span><span class="p">[</span><span class="s2">&quot;latitude&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
        <span class="n">template_scatter</span><span class="p">[</span><span class="s2">&quot;longitude&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">fs</span> <span class="o">=</span> <span class="n">fsspec</span><span class="o">.</span><span class="n">filesystem</span><span class="p">(</span><span class="s2">&quot;s3&quot;</span><span class="p">,</span> <span class="n">anon</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default_block_size</span><span class="o">=</span><span class="mi">512</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">1024</span><span class="p">)</span>

    <span class="n">values</span><span class="p">,</span> <span class="n">counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">observation_times</span><span class="p">,</span> <span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">all_urls</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># getting unique URLS</span>
    <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
        <span class="n">urls</span> <span class="o">=</span> <span class="n">get_goes_url</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">goes_aws_url_folder</span><span class="p">,</span><span class="n">goes_channel</span><span class="p">)</span>
        <span class="n">all_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">urls</span><span class="p">)</span>

    <span class="n">values_url</span><span class="p">,</span> <span class="n">indices_url</span><span class="p">,</span> <span class="n">counts_url</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
        <span class="n">all_urls</span><span class="p">,</span> <span class="n">return_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span>
    <span class="p">)</span>
    <span class="c1"># Sort indices to &quot;unsort&quot; the URLs</span>
    <span class="n">sorted_indices</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">indices_url</span><span class="p">)),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">k</span><span class="p">:</span> <span class="n">indices_url</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
    <span class="n">values_url</span> <span class="o">=</span> <span class="p">[</span><span class="n">all_urls</span><span class="p">[</span><span class="n">indices_url</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">sorted_indices</span><span class="p">]</span>

    <span class="c1"># Reorder counts_url using the same sorted indices</span>
    <span class="n">counts_url</span> <span class="o">=</span> <span class="p">[</span><span class="n">counts_url</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">sorted_indices</span><span class="p">]</span>

    <span class="n">compressed_urls</span> <span class="o">=</span> <span class="n">values_url</span>
    <span class="n">compressed_counts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">start_idx</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">size</span> <span class="ow">in</span> <span class="n">counts_url</span><span class="p">:</span>
        <span class="n">group_sum</span> <span class="o">=</span> <span class="n">counts</span><span class="p">[</span><span class="n">start_idx</span> <span class="p">:</span> <span class="n">start_idx</span> <span class="o">+</span> <span class="n">size</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="n">compressed_counts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">group_sum</span><span class="p">)</span>
        <span class="n">start_idx</span> <span class="o">+=</span> <span class="n">size</span>

    <span class="n">width</span> <span class="o">=</span> <span class="n">goes_image_size</span>
    <span class="n">height</span> <span class="o">=</span> <span class="n">goes_image_size</span>

    <span class="n">images</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">observation_times</span><span class="p">),</span> <span class="mi">1</span> <span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

    <span class="n">total_idx</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">unique_idx</span><span class="p">,</span> <span class="n">unique_urls</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span>
        <span class="nb">enumerate</span><span class="p">(</span><span class="n">compressed_urls</span><span class="p">),</span>
        <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;INFO : Retrieving and processing GOES data&quot;</span><span class="p">,</span>
        <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">compressed_urls</span><span class="p">),</span>
        <span class="n">disable</span><span class="o">=</span><span class="ow">not</span> <span class="n">verbose</span><span class="p">,</span>
    <span class="p">):</span>


        <span class="k">for</span> <span class="n">CH_idx</span><span class="p">,</span> <span class="n">url_CH</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">unique_urls</span><span class="p">):</span>

            <span class="k">if</span> <span class="n">url_CH</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">images</span><span class="p">[</span><span class="n">total_idx</span><span class="p">,</span> <span class="n">CH_idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">])</span>
                <span class="k">continue</span>

            <span class="k">with</span> <span class="n">fs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">url_CH</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>

                <span class="n">ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span>
                    <span class="n">f</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s2">&quot;h5netcdf&quot;</span><span class="p">,</span> <span class="n">drop_variables</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;DQF&quot;</span><span class="p">]</span>
                <span class="p">)</span>  <span class="c1"># this is the bottleneck</span>

                <span class="n">parallel_index</span> <span class="o">=</span> <span class="n">index_parallel</span><span class="p">(</span>
                    <span class="n">ds</span><span class="p">,</span>
                    <span class="n">template_scatter</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">compressed_counts</span><span class="p">[</span><span class="n">unique_idx</span><span class="p">]):</span>
                    <span class="n">images</span><span class="p">[</span><span class="n">total_idx</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span> <span class="n">CH_idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_image</span><span class="p">(</span>
                        <span class="n">ds</span><span class="o">=</span><span class="n">ds</span><span class="p">,</span>
                        <span class="n">parallel_index</span><span class="o">=</span><span class="n">parallel_index</span><span class="p">,</span>
                        <span class="n">lat_grd</span><span class="o">=</span><span class="n">lat_grd</span><span class="p">,</span>
                        <span class="n">lon_grd</span><span class="o">=</span><span class="n">lon_grd</span><span class="p">,</span>
                        <span class="n">lat_search</span><span class="o">=</span><span class="n">observation_lats</span><span class="p">[</span><span class="n">total_idx</span> <span class="o">+</span> <span class="n">i</span><span class="p">],</span>
                        <span class="n">lon_search</span><span class="o">=</span><span class="n">observation_lons</span><span class="p">[</span><span class="n">total_idx</span> <span class="o">+</span> <span class="n">i</span><span class="p">],</span>
                        <span class="n">goes_image_size</span><span class="o">=</span><span class="n">goes_image_size</span><span class="p">,</span>
                    <span class="p">)</span>

        <span class="n">total_idx</span> <span class="o">+=</span> <span class="n">compressed_counts</span><span class="p">[</span><span class="n">unique_idx</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;INFO : Extracted </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">observation_times</span><span class="p">)</span><span class="si">}</span><span class="s2"> images from </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">compressed_urls</span><span class="p">)</span><span class="si">}</span><span class="s2"> GOES files.&quot;</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">images</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.func_inference.extract_goes_inference" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">extract_goes_inference</span><span class="p">(</span><span class="n">date_time</span><span class="p">,</span> <span class="n">parallel_index</span><span class="p">,</span> <span class="n">channels</span><span class="o">=</span><span class="s1">&#39;C01&#39;</span><span class="p">,</span> <span class="n">goes_aws_url_folder</span><span class="o">=</span><span class="s1">&#39;noaa-goes16/ABI-L2-CMIPF&#39;</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>This function extracts GOES images for a given date_time and parallel_index. (whole GOES slice, used for inference which differs from images used in training that have a matched orbit with scatterometers.)
It retrieves the GOES data from the specified AWS S3 bucket and processes it to create
images of the specified size (128x128).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>date_time</code>
            </td>
            <td>
                  <code><span title="numpy.datetime64">datetime64</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The time of the GOES data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>parallel_index</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The precomputed indices for GOES pixels corresponding to scatterometer lat/lon.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>channels</code>
            </td>
            <td>
                  <code><span title="str">str</span> or <span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The channel(s) of interest. Default is "C01".</p>
              </div>
            </td>
            <td>
                  <code>&#39;C01&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>goes_aws_url_folder</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The folder in the AWS S3 bucket where the GOES data is stored. Default is 'noaa-goes16/ABI-L2-CMIPF'.</p>
              </div>
            </td>
            <td>
                  <code>&#39;noaa-goes16/ABI-L2-CMIPF&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>images</code></td>            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of numpy arrays containing the extracted GOES images of shape (128, 128).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\func.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">extract_goes_inference</span><span class="p">(</span><span class="n">date_time</span><span class="p">,</span> <span class="n">parallel_index</span><span class="p">,</span><span class="n">channels</span><span class="o">=</span><span class="s2">&quot;C01&quot;</span><span class="p">,</span><span class="n">goes_aws_url_folder</span><span class="o">=</span> <span class="s1">&#39;noaa-goes16/ABI-L2-CMIPF&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function extracts GOES images for a given date_time and parallel_index. (whole GOES slice, used for inference which differs from images used in training that have a matched orbit with scatterometers.)</span>
<span class="sd">    It retrieves the GOES data from the specified AWS S3 bucket and processes it to create</span>
<span class="sd">    images of the specified size (128x128).</span>

<span class="sd">    Args:</span>
<span class="sd">        date_time (numpy.datetime64): The time of the GOES data.</span>
<span class="sd">        parallel_index (numpy.ndarray): The precomputed indices for GOES pixels corresponding to scatterometer lat/lon.</span>
<span class="sd">        channels (str or list): The channel(s) of interest. Default is &quot;C01&quot;.</span>
<span class="sd">        goes_aws_url_folder (str): The folder in the AWS S3 bucket where the GOES data is stored. Default is &#39;noaa-goes16/ABI-L2-CMIPF&#39;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        images (list): A list of numpy arrays containing the extracted GOES images of shape (128, 128).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># ignore divide by zero errors which occur when the GOES data can&#39;t form a 128x128 image</span>
    <span class="n">np</span><span class="o">.</span><span class="n">seterr</span><span class="p">(</span><span class="n">invalid</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">divide</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>

    <span class="n">fs</span> <span class="o">=</span> <span class="n">fsspec</span><span class="o">.</span><span class="n">filesystem</span><span class="p">(</span><span class="s2">&quot;s3&quot;</span><span class="p">,</span> <span class="n">anon</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default_block_size</span><span class="o">=</span><span class="mi">512</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">1024</span><span class="p">)</span>
    <span class="n">urls</span> <span class="o">=</span> <span class="n">get_goes_url</span><span class="p">(</span><span class="n">date_time</span><span class="p">,</span> <span class="n">goes_aws_url_folder</span><span class="o">=</span><span class="s1">&#39;noaa-goes16/ABI-L2-CMIPF&#39;</span><span class="p">,</span> <span class="n">goes_channel</span><span class="o">=</span> <span class="n">channels</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">fs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">urls</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;INFO : Reading file:&quot;</span><span class="p">,</span> <span class="n">urls</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">goes_image</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">goes_image</span> <span class="o">=</span> <span class="n">goes_image</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="s2">&quot;x_index&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="s2">&quot;y_index&quot;</span><span class="p">})</span>

        <span class="c1"># Assign the index coordinates (if not already done)</span>
        <span class="n">goes_image</span> <span class="o">=</span> <span class="n">goes_image</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">(</span>
            <span class="n">x_index</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">goes_image</span><span class="o">.</span><span class="n">sizes</span><span class="p">[</span><span class="s2">&quot;x_index&quot;</span><span class="p">]),</span>
            <span class="n">y_index</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">goes_image</span><span class="o">.</span><span class="n">sizes</span><span class="p">[</span><span class="s2">&quot;y_index&quot;</span><span class="p">]),</span>
        <span class="p">)</span>

        <span class="n">images</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">goes_image</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;INFO : Extracting images&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">parallel_index</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">parallel_index</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">x_mean</span> <span class="o">=</span> <span class="n">parallel_index</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
                    <span class="n">x_min</span> <span class="o">=</span> <span class="n">x_mean</span> <span class="o">-</span> <span class="mi">63</span>
                    <span class="n">x_max</span> <span class="o">=</span> <span class="n">x_mean</span> <span class="o">+</span> <span class="mi">63</span>
                    <span class="n">y_mean</span> <span class="o">=</span> <span class="n">parallel_index</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
                    <span class="n">y_min</span> <span class="o">=</span> <span class="n">y_mean</span> <span class="o">-</span> <span class="mi">63</span>
                    <span class="n">y_max</span> <span class="o">=</span> <span class="n">y_mean</span> <span class="o">+</span> <span class="mi">63</span>
                    <span class="n">image</span> <span class="o">=</span> <span class="n">goes_image</span><span class="o">.</span><span class="n">CMI</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span>
                        <span class="n">x_index</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">),</span> <span class="n">y_index</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span><span class="p">)</span>
                    <span class="p">)</span>

                    <span class="n">target_size</span> <span class="o">=</span> <span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">)</span>

                    <span class="n">padded_image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span>
                        <span class="n">image</span><span class="p">,</span>
                        <span class="p">(</span>
                            <span class="p">(</span>
                                <span class="p">(</span><span class="n">target_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span>
                                <span class="p">(</span><span class="n">target_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span>
                            <span class="p">),</span>
                            <span class="p">(</span>
                                <span class="p">(</span><span class="n">target_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span>
                                <span class="p">(</span><span class="n">target_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span>
                            <span class="p">),</span>
                        <span class="p">),</span>
                        <span class="n">constant_values</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                    <span class="p">)</span>

                <span class="k">except</span><span class="p">:</span>
                    <span class="n">images</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">)))</span>

                    <span class="k">continue</span>
                <span class="n">images</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">padded_image</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">images</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.func_inference.extract_goes_production" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">extract_goes_production</span><span class="p">(</span><span class="n">time_choice</span><span class="p">,</span> <span class="n">polar_data</span><span class="p">,</span> <span class="n">parallel_index</span><span class="p">,</span> <span class="n">channels</span><span class="p">,</span> <span class="n">goes_aws_url_folder</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Extracts GOES data for a specific time from the polar data and returns the images along with valid latitudes, longitudes, and times.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>time_choice</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The time for which to extract GOES data, in 'YYYY-MM-DD HH:MM:SS' format.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>polar_data</code>
            </td>
            <td>
                  <code><span title="xarray.Dataset">Dataset</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Polar data containing latitude and longitude information. Used to create a grid of valid latitudes and longitudes.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>parallel_index</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Index for parallel processing, used to identify the specific GOES data to extract, generated by the <code>index_parallel</code> function.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>channels</code>
            </td>
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of GOES channels to extract.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>goes_aws_url_folder</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>AWS URL folder for the GOES data, default is "noaa-goes16/ABI-L2-CMIPF".</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>images</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of extracted GOES images for the specified time.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>valid_lats</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of valid latitudes corresponding to the GOES images</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>valid_lons</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of valid longitudes corresponding to the GOES images</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>valid_times</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of valid times corresponding to the GOES images.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\func_inference.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">extract_goes_production</span><span class="p">(</span><span class="n">time_choice</span><span class="p">,</span> <span class="n">polar_data</span><span class="p">,</span> <span class="n">parallel_index</span><span class="p">,</span><span class="n">channels</span><span class="p">,</span><span class="n">goes_aws_url_folder</span><span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    Extracts GOES data for a specific time from the polar data and returns the images along with valid latitudes, longitudes, and times.</span>

<span class="sd">    Args:</span>
<span class="sd">        time_choice (str): The time for which to extract GOES data, in &#39;YYYY-MM-DD HH:MM:SS&#39; format.</span>
<span class="sd">        polar_data (xarray.Dataset): Polar data containing latitude and longitude information. Used to create a grid of valid latitudes and longitudes.</span>
<span class="sd">        parallel_index (int): Index for parallel processing, used to identify the specific GOES data to extract, generated by the `index_parallel` function.</span>
<span class="sd">        channels (list): List of GOES channels to extract.</span>
<span class="sd">        goes_aws_url_folder (str): AWS URL folder for the GOES data, default is &quot;noaa-goes16/ABI-L2-CMIPF&quot;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        images (np.ndarray): Array of extracted GOES images for the specified time.</span>
<span class="sd">        valid_lats (np.ndarray): Array of valid latitudes corresponding to the GOES images</span>
<span class="sd">        valid_lons (np.ndarray): Array of valid longitudes corresponding to the GOES images</span>
<span class="sd">        valid_times (np.ndarray): Array of valid times corresponding to the GOES images.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">time_formated</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="n">time_choice</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;datetime64[ns]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;float64&quot;</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="n">longrid</span><span class="p">,</span> <span class="n">latgrid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">polar_data</span><span class="p">[</span><span class="s2">&quot;longitude&quot;</span><span class="p">],</span> <span class="n">polar_data</span><span class="p">[</span><span class="s2">&quot;latitude&quot;</span><span class="p">])</span>
    <span class="n">lon_array</span> <span class="o">=</span> <span class="n">longrid</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">lat_array</span> <span class="o">=</span> <span class="n">latgrid</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">time_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">lon_array</span><span class="p">,</span> <span class="n">time_formated</span><span class="p">)</span>

    <span class="n">valid_lons</span> <span class="o">=</span> <span class="n">lon_array</span>
    <span class="n">valid_lats</span> <span class="o">=</span> <span class="n">lat_array</span>
    <span class="n">valid_times</span> <span class="o">=</span> <span class="n">time_array</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;INFO : Extracting GOES data&#39;</span><span class="p">)</span>
    <span class="n">images</span> <span class="o">=</span> <span class="n">extract_goes_inference</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="n">time_choice</span><span class="p">),</span> <span class="n">parallel_index</span><span class="p">,</span><span class="n">channels</span><span class="p">,</span><span class="n">goes_aws_url_folder</span><span class="p">)</span>


    <span class="n">images</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>


    <span class="k">return</span> <span class="n">images</span><span class="p">,</span> <span class="n">valid_lats</span><span class="p">,</span> <span class="n">valid_lons</span><span class="p">,</span> <span class="n">valid_times</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.func_inference.extract_scatter" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">extract_scatter</span><span class="p">(</span><span class="n">polar_data</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">lat_range</span><span class="p">,</span> <span class="n">lon_range</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">main_variable</span><span class="o">=</span><span class="s1">&#39;wind_speed&#39;</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>This function extracts the scatterometer data from the polar_data dataset for the given time range, latitude range and longitude range.
The function then saves the data into 4 numpy files : time of observation, latitude, longitude and main variable.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>polar_data</code>
            </td>
            <td>
                  <code><span title="xarray.Dataset">Dataset</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The scatterometer dataset (ASCAT, HYSCAT etc).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>date</code>
            </td>
            <td>
                  <code><span title="numpy.datetime64">datetime64</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The time of the scatterometer data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lat_range</code>
            </td>
            <td>
                  <code><span title="tuple">tuple</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The latitude range of the scatterometer data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lon_range</code>
            </td>
            <td>
                  <code><span title="tuple">tuple</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The longitude range of the scatterometer data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>verbose</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, the function will print the progress of the extraction.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>main_variable</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The main variable to be extracted from the scatterometer data. This can be wind speed, wind direction, classification etc.</p>
              </div>
            </td>
            <td>
                  <code>&#39;wind_speed&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>observation_times</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The time of observation of the scatterometer data.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>observation_lats</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The latitude of the scatterometer data.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>observation_lons</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The longitude of the scatterometer data.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>observation_main_parameter</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>main parameter extracted (wind_speed).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\func.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">extract_scatter</span><span class="p">(</span>
    <span class="n">polar_data</span><span class="p">,</span>
    <span class="n">date</span><span class="p">,</span>
    <span class="n">lat_range</span><span class="p">,</span>
    <span class="n">lon_range</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">main_variable</span><span class="o">=</span><span class="s2">&quot;wind_speed&quot;</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function extracts the scatterometer data from the polar_data dataset for the given time range, latitude range and longitude range.</span>
<span class="sd">    The function then saves the data into 4 numpy files : time of observation, latitude, longitude and main variable.</span>

<span class="sd">    Args:</span>
<span class="sd">        polar_data (xarray.Dataset): The scatterometer dataset (ASCAT, HYSCAT etc).</span>
<span class="sd">        date (numpy.datetime64): The time of the scatterometer data.</span>
<span class="sd">        lat_range (tuple): The latitude range of the scatterometer data.</span>
<span class="sd">        lon_range (tuple): The longitude range of the scatterometer data.</span>
<span class="sd">        verbose (bool): If True, the function will print the progress of the extraction.</span>
<span class="sd">        main_variable (str): The main variable to be extracted from the scatterometer data. This can be wind speed, wind direction, classification etc.</span>

<span class="sd">    Returns:</span>
<span class="sd">        observation_times (numpy.ndarray): The time of observation of the scatterometer data.</span>
<span class="sd">        observation_lats (numpy.ndarray): The latitude of the scatterometer data.</span>
<span class="sd">        observation_lons (numpy.ndarray): The longitude of the scatterometer data.</span>
<span class="sd">        observation_main_parameter (numpy.ndarray): main parameter extracted (wind_speed).</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">polar</span> <span class="o">=</span> <span class="n">polar_data</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span>
        <span class="n">time</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="n">date</span><span class="p">),</span>
        <span class="n">latitude</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">lat_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lat_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
        <span class="n">longitude</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">lon_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lon_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
    <span class="p">)</span>

    <span class="n">seperated_scatter</span> <span class="o">=</span> <span class="n">savedataseperated</span><span class="p">(</span><span class="n">polar</span><span class="p">,</span> <span class="n">polar</span><span class="p">[</span><span class="n">main_variable</span><span class="p">],</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>

    <span class="n">observation_times</span> <span class="o">=</span> <span class="n">seperated_scatter</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">observation_lats</span> <span class="o">=</span> <span class="n">seperated_scatter</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">observation_lons</span> <span class="o">=</span> <span class="n">seperated_scatter</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">observation_wind_speeds</span> <span class="o">=</span> <span class="n">seperated_scatter</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>



    <span class="k">return</span> <span class="p">(</span>
        <span class="n">observation_times</span><span class="p">,</span>
        <span class="n">observation_lats</span><span class="p">,</span>
        <span class="n">observation_lons</span><span class="p">,</span>
        <span class="n">observation_wind_speeds</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.func_inference.extract_scatter_multisat" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">extract_scatter_multisat</span><span class="p">(</span><span class="n">scatterometer_data_path</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">lat_range</span><span class="p">,</span> <span class="n">lon_range</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Extracts scatterometer data from multiple files (<code>.nc</code>) in a specified directory.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>scatterometer_data_path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the directory containing scatterometer data files.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>date</code>
            </td>
            <td>
                  <code><span title="datetime">datetime</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Date for which to extract data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lat_range</code>
            </td>
            <td>
                  <code><span title="tuple">tuple</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Latitude range (min, max) for filtering data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lon_range</code>
            </td>
            <td>
                  <code><span title="tuple">tuple</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Longitude range (min, max) for filtering data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>verbose</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, prints progress information.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>tuple</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A tuple containing:
- list of datetime: observation times
- list of float: latitudes
- list of float: longitudes
- list of float: wind speeds</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\func_inference.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">extract_scatter_multisat</span><span class="p">(</span>
    <span class="n">scatterometer_data_path</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">lat_range</span><span class="p">,</span> <span class="n">lon_range</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="kc">True</span>
<span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extracts scatterometer data from multiple files (`.nc`) in a specified directory.</span>

<span class="sd">    Args:</span>
<span class="sd">        scatterometer_data_path (str): Path to the directory containing scatterometer data files.</span>
<span class="sd">        date (datetime): Date for which to extract data.</span>
<span class="sd">        lat_range (tuple): Latitude range (min, max) for filtering data.</span>
<span class="sd">        lon_range (tuple): Longitude range (min, max) for filtering data.</span>
<span class="sd">        verbose (bool): If True, prints progress information.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple: A tuple containing:</span>
<span class="sd">            - list of datetime: observation times</span>
<span class="sd">            - list of float: latitudes</span>
<span class="sd">            - list of float: longitudes</span>
<span class="sd">            - list of float: wind speeds</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">observation_times</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">observation_lats</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">observation_lons</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">observation_wind_speeds</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;INFO : Extracting scatterometer data from folder : &quot;</span><span class="p">,</span> <span class="n">scatterometer_data_path</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;___&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">scatterometer_data_path</span><span class="p">):</span>
        <span class="k">if</span> <span class="s2">&quot;.nc&quot;</span> <span class="ow">in</span> <span class="n">file</span><span class="p">:</span>
            <span class="c1"># Open the file</span>
            <span class="n">file_path</span> <span class="o">=</span> <span class="n">scatterometer_data_path</span> <span class="o">+</span> <span class="n">file</span>
            <span class="n">polar_data</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
            <span class="p">(</span>
                <span class="n">observation_times_local</span><span class="p">,</span>
                <span class="n">observation_lats_local</span><span class="p">,</span>
                <span class="n">observation_lons_local</span><span class="p">,</span>
                <span class="n">observation_wind_speeds_local</span><span class="p">,</span>
            <span class="p">)</span> <span class="o">=</span> <span class="n">extract_scatter</span><span class="p">(</span>
                <span class="n">polar_data</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">lat_range</span><span class="p">,</span> <span class="n">lon_range</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span>
            <span class="p">)</span>
            <span class="n">observation_times</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">observation_times_local</span><span class="p">)</span>
            <span class="n">observation_lats</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">observation_lats_local</span><span class="p">)</span>
            <span class="n">observation_lons</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">observation_lons_local</span><span class="p">)</span>
            <span class="n">observation_wind_speeds</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">observation_wind_speeds_local</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">verbose</span> <span class="p">:</span> 
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;___&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;INFO : Total number of scatterometer data points: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">observation_times</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="n">observation_times</span><span class="p">,</span>
        <span class="n">observation_lats</span><span class="p">,</span>
        <span class="n">observation_lons</span><span class="p">,</span>
        <span class="n">observation_wind_speeds</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.func_inference.fill_nans" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">fill_nans</span><span class="p">(</span><span class="n">images</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>This function fills NaN values in the images with zeros. (This is simply np.nan_to_num)</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>images</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A 4D numpy array of shape (num_images, num_channels, height, width) containing the GOES images.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>images</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A 4D numpy array with NaN values replaced by zeros.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\func.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fill_nans</span><span class="p">(</span><span class="n">images</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function fills NaN values in the images with zeros. (This is simply np.nan_to_num)</span>

<span class="sd">    Args:</span>
<span class="sd">        images (numpy.ndarray): A 4D numpy array of shape (num_images, num_channels, height, width) containing the GOES images.</span>

<span class="sd">    Returns:</span>
<span class="sd">        images (numpy.ndarray): A 4D numpy array with NaN values replaced by zeros.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">images</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="n">nan</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;INFO : Filled nans&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">images</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.func_inference.filter_invalid" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">filter_invalid</span><span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="n">numerical_data</span><span class="p">,</span> <span class="n">min_nonzero_pixels</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>This function filters out invalid images and corresponding numerical data based on two criteria:
1) The sum of pixel values in the image is not zero (i.e., the image is not completely empty).
2) The number of non-zero pixels in the image is greater than or equal to a specified minimum threshold (default is 50).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>images</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A 4D numpy array of shape (num_images, num_channels, height, width) containing the GOES images.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>numerical_data</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary containing numerical data associated with the images. The keys should match the dimensions of the images.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>min_nonzero_pixels</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The minimum number of non-zero pixels required for an image to be considered valid. Default is 50.</p>
              </div>
            </td>
            <td>
                  <code>50</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>filtered_images</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A 4D numpy array of shape (num_valid_images, num_channels, height, width) containing the filtered GOES images.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>filtered_numerical_data</code></td>            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary containing the numerical data associated with the valid images.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\func.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">filter_invalid</span><span class="p">(</span>
    <span class="n">images</span><span class="p">,</span>
    <span class="n">numerical_data</span><span class="p">,</span>
    <span class="n">min_nonzero_pixels</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
<span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function filters out invalid images and corresponding numerical data based on two criteria:</span>
<span class="sd">    1) The sum of pixel values in the image is not zero (i.e., the image is not completely empty).</span>
<span class="sd">    2) The number of non-zero pixels in the image is greater than or equal to a specified minimum threshold (default is 50).</span>

<span class="sd">    Args:</span>
<span class="sd">        images (numpy.ndarray): A 4D numpy array of shape (num_images, num_channels, height, width) containing the GOES images.</span>
<span class="sd">        numerical_data (dict): A dictionary containing numerical data associated with the images. The keys should match the dimensions of the images.</span>
<span class="sd">        min_nonzero_pixels (int): The minimum number of non-zero pixels required for an image to be considered valid. Default is 50.</span>

<span class="sd">    Returns:</span>
<span class="sd">        filtered_images (numpy.ndarray): A 4D numpy array of shape (num_valid_images, num_channels, height, width) containing the filtered GOES images.</span>
<span class="sd">        filtered_numerical_data (dict): A dictionary containing the numerical data associated with the valid images.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Sums of pixel values in each image</span>
    <span class="n">sums_images</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">images</span><span class="p">]</span>

    <span class="c1"># Counts of non-zero pixels in each image</span>
    <span class="n">nonzero_counts</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">images</span><span class="p">]</span>

    <span class="c1"># Build a &quot;mask_invalid&quot; array of indices that fail any criterion:</span>
    <span class="c1"># 1) sum == 0 (completely empty)</span>
    <span class="c1"># 2) nonzero pixel count &lt; min_nonzero_pixels (not enough data)</span>

    <span class="n">mask_valid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
        <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sums_images</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">nonzero_counts</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">min_nonzero_pixels</span><span class="p">)</span>
    <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># Delete the invalid entries from each array</span>
    <span class="n">filtered_numerical_data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">key</span><span class="p">:</span> <span class="n">value</span><span class="p">[</span><span class="n">mask_valid</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">numerical_data</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
    <span class="p">}</span>
    <span class="n">filtered_images</span> <span class="o">=</span> <span class="n">images</span><span class="p">[</span><span class="n">mask_valid</span><span class="p">]</span>
    <span class="n">n_removed_images</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">images</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">filtered_images</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span>
        <span class="s2">&quot;INFO : Filtered invalid images. Removed </span><span class="si">{}</span><span class="s2"> entries.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">n_removed_images</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="n">filtered_images</span><span class="p">,</span>
        <span class="n">filtered_numerical_data</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.func_inference.filter_nighttime" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">filter_nighttime</span><span class="p">(</span><span class="n">observation_times</span><span class="p">,</span> <span class="n">observation_lats</span><span class="p">,</span> <span class="n">observation_lons</span><span class="p">,</span> <span class="n">observation_wind_speeds</span><span class="p">,</span> <span class="n">min_hour</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">max_hour</span><span class="o">=</span><span class="mi">19</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>This function filters the scatterometer data to only include observations that were made during daylight hours.
The function checks the hour of each observation time and only keeps those that fall within the specified
range (default is 10 to 19, which corresponds to 10 AM to 7 PM UTC).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>observation_times</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The times of observation of the scatterometer data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>observation_lats</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The latitudes of the scatterometer data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>observation_lons</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The longitudes of the scatterometer data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>observation_wind_speeds</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The wind speeds of the scatterometer data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>min_hour</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The minimum hour of the day to include (default is 10).</p>
              </div>
            </td>
            <td>
                  <code>10</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_hour</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The maximum hour of the day to include (default is 19).</p>
              </div>
            </td>
            <td>
                  <code>19</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>verbose</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, prints the number of valid scatterometer data points at daylight.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>valid_times</code></td>            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of valid observation times that fall within the specified hour range.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>valid_lats</code></td>            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of valid latitudes corresponding to the valid observation times</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>valid_lons</code></td>            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of valid longitudes corresponding to the valid observation times.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>valid_wind_speeds</code></td>            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of valid wind speeds corresponding to the valid observation times.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\func.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">filter_nighttime</span><span class="p">(</span>
    <span class="n">observation_times</span><span class="p">,</span>
    <span class="n">observation_lats</span><span class="p">,</span>
    <span class="n">observation_lons</span><span class="p">,</span>
    <span class="n">observation_wind_speeds</span><span class="p">,</span>
    <span class="n">min_hour</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">max_hour</span><span class="o">=</span><span class="mi">19</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function filters the scatterometer data to only include observations that were made during daylight hours.</span>
<span class="sd">    The function checks the hour of each observation time and only keeps those that fall within the specified</span>
<span class="sd">    range (default is 10 to 19, which corresponds to 10 AM to 7 PM UTC).</span>

<span class="sd">    Args:</span>
<span class="sd">        observation_times (numpy.ndarray): The times of observation of the scatterometer data.</span>
<span class="sd">        observation_lats (numpy.ndarray): The latitudes of the scatterometer data.</span>
<span class="sd">        observation_lons (numpy.ndarray): The longitudes of the scatterometer data.</span>
<span class="sd">        observation_wind_speeds (numpy.ndarray): The wind speeds of the scatterometer data.</span>
<span class="sd">        min_hour (int): The minimum hour of the day to include (default is 10).</span>
<span class="sd">        max_hour (int): The maximum hour of the day to include (default is 19).</span>
<span class="sd">        verbose (bool): If True, prints the number of valid scatterometer data points at daylight.</span>

<span class="sd">    Returns:</span>
<span class="sd">        valid_times (list): A list of valid observation times that fall within the specified hour range.</span>
<span class="sd">        valid_lats (list): A list of valid latitudes corresponding to the valid observation times</span>
<span class="sd">        valid_lons (list): A list of valid longitudes corresponding to the valid observation times.</span>
<span class="sd">        valid_wind_speeds (list): A list of valid wind speeds corresponding to the valid observation times.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">valid_times</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">valid_lats</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">valid_lons</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">valid_wind_speeds</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">observation_times</span><span class="p">)):</span>
        <span class="n">only_hour</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
            <span class="n">observation_times</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;datetime64[ns]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;str&quot;</span><span class="p">)[</span><span class="mi">11</span><span class="p">:</span><span class="mi">13</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">min_hour</span> <span class="o">&lt;=</span> <span class="n">only_hour</span> <span class="o">&lt;=</span> <span class="n">max_hour</span><span class="p">:</span>
            <span class="n">valid_times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">observation_times</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
            <span class="n">valid_lats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">observation_lats</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
            <span class="n">valid_lons</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">observation_lons</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
            <span class="n">valid_wind_speeds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">observation_wind_speeds</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;INFO : Total number of scatterometer data points at daylight : </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">valid_times</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">valid_times</span><span class="p">,</span> <span class="n">valid_lats</span><span class="p">,</span> <span class="n">valid_lons</span><span class="p">,</span> <span class="n">valid_wind_speeds</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.func_inference.form_arrays_buoy" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">form_arrays_buoy</span><span class="p">(</span><span class="n">buoy</span><span class="p">,</span> <span class="n">date_choice</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Form arrays from buoy data for a specific date.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>buoy</code>
            </td>
            <td>
                  <code><span title="xarray.Dataset">Dataset</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Buoy data containing time, latitude, longitude, and wind speed.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>date_choice</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Date for which to extract buoy data, in 'YYYY-MM</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>lat</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of buoy latitudes.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>lon</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of buoy longitudes.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>time</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of buoy observation times in nanoseconds since epoch.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>wind_speed</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of buoy wind speeds.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>buoy_name</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of buoy names.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\func_inference.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">form_arrays_buoy</span><span class="p">(</span><span class="n">buoy</span><span class="p">,</span> <span class="n">date_choice</span><span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Form arrays from buoy data for a specific date.</span>

<span class="sd">    Args:</span>
<span class="sd">        buoy (xarray.Dataset): Buoy data containing time, latitude, longitude, and wind speed.</span>
<span class="sd">        date_choice (str): Date for which to extract buoy data, in &#39;YYYY-MM</span>

<span class="sd">    Returns:</span>
<span class="sd">        lat (np.ndarray): Array of buoy latitudes.</span>
<span class="sd">        lon (np.ndarray): Array of buoy longitudes.</span>
<span class="sd">        time (np.ndarray): Array of buoy observation times in nanoseconds since epoch.</span>
<span class="sd">        wind_speed (np.ndarray): Array of buoy wind speeds.</span>
<span class="sd">        buoy_name (np.ndarray): Array of buoy names.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="n">date_choice</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">timedelta64</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;m&quot;</span><span class="p">)</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="n">date_choice</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">timedelta64</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;m&quot;</span><span class="p">)</span>

        <span class="n">wind_speed</span> <span class="o">=</span> <span class="n">buoy</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">))</span><span class="o">.</span><span class="n">WS_401</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="n">time</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">buoy</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">))</span>
            <span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;datetime64[ns]&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int64&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">lat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">wind_speed</span><span class="p">),</span> <span class="n">buoy</span><span class="o">.</span><span class="n">lat</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="n">lon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">wind_speed</span><span class="p">),</span> <span class="n">buoy</span><span class="o">.</span><span class="n">lon</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="n">buoy_name</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">wind_speed</span><span class="p">),</span> <span class="n">buoy</span><span class="o">.</span><span class="n">platform_code</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">wind_speed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="n">lat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="n">lon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="n">buoy_name</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;date selection unavailable&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">wind_speed</span><span class="p">,</span> <span class="n">buoy_name</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.func_inference.get_goes_url" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_goes_url</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">goes_aws_url_folder</span><span class="o">=</span><span class="s1">&#39;noaa-goes16/ABI-L2-CMIPF&#39;</span><span class="p">,</span> <span class="n">goes_channel</span><span class="o">=</span><span class="s1">&#39;C01&#39;</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>This function gets the nearest GOES-16 files from the time given.
The function returns a list of urls to the files.
The function uses the s3fs library to access the AWS GOES-16 data.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>time</code>
            </td>
            <td>
                  <code><span title="numpy.datetime">datetime</span>[<span title="ns">ns</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The time of the scatterometer data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>goes_aws_url_folder</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The folder in the AWS S3 bucket where the GOES-16 data is stored.</p>
              </div>
            </td>
            <td>
                  <code>&#39;noaa-goes16/ABI-L2-CMIPF&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>goes_channel</code>
            </td>
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The channel of interest.</p>
              </div>
            </td>
            <td>
                  <code>&#39;C01&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>urls</code></td>            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of urls to the GOES-16 files.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\func.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_goes_url</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">goes_aws_url_folder</span><span class="o">=</span><span class="s1">&#39;noaa-goes16/ABI-L2-CMIPF&#39;</span><span class="p">,</span> <span class="n">goes_channel</span><span class="o">=</span><span class="s2">&quot;C01&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function gets the nearest GOES-16 files from the time given.</span>
<span class="sd">    The function returns a list of urls to the files.</span>
<span class="sd">    The function uses the s3fs library to access the AWS GOES-16 data.</span>

<span class="sd">    Args:</span>
<span class="sd">        time (numpy.datetime[ns]): The time of the scatterometer data.</span>
<span class="sd">        goes_aws_url_folder (str): The folder in the AWS S3 bucket where the GOES-16 data is stored.</span>
<span class="sd">        goes_channel (list): The channel of interest.</span>

<span class="sd">    Returns:</span>
<span class="sd">        urls (list): A list of urls to the GOES-16 files.</span>


<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">date_c</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;datetime64[ns]&quot;</span><span class="p">)</span>
    <span class="n">date</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">date_c</span><span class="p">)</span>
    <span class="n">date_str</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y/%j/%H&quot;</span><span class="p">)</span>
    <span class="nb">min</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%M&quot;</span><span class="p">))</span>
    <span class="n">min_range</span> <span class="o">=</span> <span class="p">[(</span><span class="nb">min</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span> <span class="o">%</span> <span class="mi">60</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">)]</span>
    <span class="n">min_range_str</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">x</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">min_range</span><span class="p">]</span>
    <span class="n">fs</span> <span class="o">=</span> <span class="n">s3fs</span><span class="o">.</span><span class="n">S3FileSystem</span><span class="p">(</span><span class="n">anon</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># get the nearest goes file from time</span>

    <span class="n">urls</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">channel</span> <span class="o">=</span> <span class="n">goes_channel</span>
    <span class="n">path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">goes_aws_url_folder</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">date_str</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">files</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">ls</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="n">filter_channel</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">files</span> <span class="k">if</span> <span class="n">channel</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">filter_channel</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;INFO :No file found for </span><span class="si">{</span><span class="n">channel</span><span class="si">}</span><span class="s2"> on day </span><span class="si">{</span><span class="n">date_str</span><span class="si">}</span><span class="s2">, skipping file&quot;</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="n">file</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">filter_channel</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">73</span><span class="p">:</span><span class="mi">75</span><span class="p">]</span> <span class="ow">in</span> <span class="n">min_range_str</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">file</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;INFO :No file found for </span><span class="si">{</span><span class="n">channel</span><span class="si">}</span><span class="s2"> on day </span><span class="si">{</span><span class="n">date_str</span><span class="si">}</span><span class="s2"> for minute </span><span class="si">{</span><span class="nb">min</span><span class="si">}</span><span class="s2">, skipping file&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">goes_channel</span><span class="p">))</span>
    <span class="n">urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;s3://&quot;</span> <span class="o">+</span> <span class="n">file</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">urls</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.func_inference.get_image" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_image</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">parallel_index</span><span class="p">,</span> <span class="n">lat_grd</span><span class="p">,</span> <span class="n">lon_grd</span><span class="p">,</span> <span class="n">lat_search</span><span class="p">,</span> <span class="n">lon_search</span><span class="p">,</span> <span class="n">goes_image_size</span><span class="o">=</span><span class="mi">128</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>This function retrieves a trainable GOES image for a given latitude and longitude from a GOES16 <code>.nc</code> file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>ds</code>
            </td>
            <td>
                  <code><span title="xarray.Dataset">Dataset</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The xarray dataset containing the GOES data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>parallel_index</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The precomputed indices for GOES pixels corresponding to scatterometer lat/lon.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lat_grd</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The latitude grid of the scatterometer data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lon_grd</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The longitude grid of the scatterometer data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lat_search</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The latitude to search for in the GOES data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lon_search</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The longitude to search for in the GOES data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>goes_image_size</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The size of the output image. Default is 128.</p>
              </div>
            </td>
            <td>
                  <code>128</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>padded_image</code></td>            <td>
                  <code><span title="xarray.DataArray">DataArray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A padded xarray DataArray containing the GOES image centered around the specified lat/lon.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\func.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_image</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">parallel_index</span><span class="p">,</span> <span class="n">lat_grd</span><span class="p">,</span> <span class="n">lon_grd</span><span class="p">,</span> <span class="n">lat_search</span><span class="p">,</span> <span class="n">lon_search</span><span class="p">,</span><span class="n">goes_image_size</span><span class="o">=</span><span class="mi">128</span><span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function retrieves a trainable GOES image for a given latitude and longitude from a GOES16 `.nc` file.</span>

<span class="sd">    Args:</span>
<span class="sd">        ds (xarray.Dataset): The xarray dataset containing the GOES data.</span>
<span class="sd">        parallel_index (numpy.ndarray): The precomputed indices for GOES pixels corresponding to scatterometer lat/lon.</span>
<span class="sd">        lat_grd (numpy.ndarray): The latitude grid of the scatterometer data.</span>
<span class="sd">        lon_grd (numpy.ndarray): The longitude grid of the scatterometer data.</span>
<span class="sd">        lat_search (float): The latitude to search for in the GOES data.</span>
<span class="sd">        lon_search (float): The longitude to search for in the GOES data.</span>
<span class="sd">        goes_image_size (int): The size of the output image. Default is 128.</span>

<span class="sd">    Returns:</span>
<span class="sd">        padded_image (xarray.DataArray): A padded xarray DataArray containing the GOES image centered around the specified lat/lon.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">index_row</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
        <span class="n">lat_grd</span> <span class="o">==</span> <span class="n">lat_search</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">index_column</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">lon_grd</span> <span class="o">==</span> <span class="n">lon_search</span><span class="p">)</span>

    <span class="n">rows_goes</span> <span class="o">=</span> <span class="n">parallel_index</span><span class="p">[</span><span class="n">index_row</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">index_column</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">columns_goes</span> <span class="o">=</span> <span class="n">parallel_index</span><span class="p">[</span><span class="n">index_row</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">index_column</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]][</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">rows_goes</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">columns_goes</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="n">pixels_from_center</span> <span class="o">=</span> <span class="p">(</span><span class="n">goes_image_size</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
    <span class="n">mean_row</span> <span class="o">=</span> <span class="n">rows_goes</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">min_row</span> <span class="o">=</span> <span class="n">mean_row</span> <span class="o">-</span> <span class="n">pixels_from_center</span>
    <span class="n">max_row</span> <span class="o">=</span> <span class="n">mean_row</span> <span class="o">+</span> <span class="n">pixels_from_center</span>

    <span class="n">mean_col</span> <span class="o">=</span> <span class="n">columns_goes</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">min_col</span> <span class="o">=</span> <span class="n">mean_col</span> <span class="o">-</span> <span class="n">pixels_from_center</span>
    <span class="n">max_col</span> <span class="o">=</span> <span class="n">mean_col</span> <span class="o">+</span> <span class="n">pixels_from_center</span>

    <span class="k">if</span> <span class="s2">&quot;CMI&quot;</span> <span class="ow">in</span> <span class="n">ds</span><span class="p">:</span> <span class="c1"># If using GOES-16 L2 processed data</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">CMI</span><span class="p">[</span><span class="n">min_row</span><span class="p">:</span><span class="n">max_row</span><span class="p">,</span> <span class="n">min_col</span><span class="p">:</span><span class="n">max_col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

    <span class="k">elif</span> <span class="s2">&quot;Rad&quot;</span> <span class="ow">in</span> <span class="n">ds</span><span class="p">:</span> <span class="c1">#If using GOES-16 L1b data</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">Rad</span><span class="p">[</span><span class="n">min_row</span><span class="p">:</span><span class="n">max_row</span><span class="p">,</span> <span class="n">min_col</span><span class="p">:</span><span class="n">max_col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

    <span class="c1"># debug</span>
    <span class="c1"># print(min_row,&#39;= min_row&#39;, max_row,&#39;= max_row&#39;, min_col, &#39;= min_col&#39;, max_col, &#39;= max_col&#39;)</span>
    <span class="n">target_size</span> <span class="o">=</span> <span class="p">(</span><span class="n">goes_image_size</span><span class="p">,</span> <span class="n">goes_image_size</span><span class="p">)</span>

    <span class="n">padded_image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span>
        <span class="n">image</span><span class="p">,</span>
        <span class="p">(</span>
            <span class="p">(</span>
                <span class="p">(</span><span class="n">target_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span>
                <span class="p">(</span><span class="n">target_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="p">(</span>
                <span class="p">(</span><span class="n">target_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span>
                <span class="p">(</span><span class="n">target_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">),</span>
        <span class="n">constant_values</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">padded_image</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">padded_image</span><span class="p">,</span> <span class="n">dims</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">padded_image</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.func_inference.get_indices" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_indices</span><span class="p">(</span><span class="n">lat_grid</span><span class="p">,</span> <span class="n">lon_grid</span><span class="p">,</span> <span class="n">Goeslat</span><span class="p">,</span> <span class="n">Goeslon</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mf">0.125</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Finds the corresponding GOES row and column indices for each scatterometer point
using a BallTree for efficiency, and then filtering points to form a square bounding box.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>lat_grid</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>2D array of latitudes from the scatterometer data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lon_grid</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>2D array of longitudes from the scatterometer data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>Goeslat</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>2D array of latitudes from the GOES data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>Goeslon</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>2D array of longitudes from the GOES data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>radius</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Radius in degrees to define the bounding box around each scatterometer point.</p>
              </div>
            </td>
            <td>
                  <code>0.125</code>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Returns:
    indices_array (numpy.ndarray): 2D array of tuples, where each tuple contains the row and column indices of the corresponding GOES pixel for each scatterometer point.</p>


            <details class="quote">
              <summary>Source code in <code>windscangeo\func.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_indices</span><span class="p">(</span><span class="n">lat_grid</span><span class="p">,</span> <span class="n">lon_grid</span><span class="p">,</span> <span class="n">Goeslat</span><span class="p">,</span> <span class="n">Goeslon</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mf">0.125</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Finds the corresponding GOES row and column indices for each scatterometer point</span>
<span class="sd">    using a BallTree for efficiency, and then filtering points to form a square bounding box.</span>

<span class="sd">    Args:</span>
<span class="sd">        lat_grid (numpy.ndarray): 2D array of latitudes from the scatterometer data.</span>
<span class="sd">        lon_grid (numpy.ndarray): 2D array of longitudes from the scatterometer data.</span>
<span class="sd">        Goeslat (numpy.ndarray): 2D array of latitudes from the GOES data.</span>
<span class="sd">        Goeslon (numpy.ndarray): 2D array of longitudes from the GOES data.</span>
<span class="sd">        radius (float): Radius in degrees to define the bounding box around each scatterometer point.</span>
<span class="sd">    Returns:</span>
<span class="sd">        indices_array (numpy.ndarray): 2D array of tuples, where each tuple contains the row and column indices of the corresponding GOES pixel for each scatterometer point.</span>


<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;INFO : Calculating indices&quot;</span><span class="p">)</span>
    <span class="c1"># Flatten GOES data</span>
    <span class="n">Goeslat_flat</span> <span class="o">=</span> <span class="n">Goeslat</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">Goeslon_flat</span> <span class="o">=</span> <span class="n">Goeslon</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">goes_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">Goeslat_flat</span><span class="p">,</span> <span class="n">Goeslon_flat</span><span class="p">))</span>

    <span class="c1"># Build BallTree with haversine distance</span>
    <span class="n">goes_points_rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">goes_points</span><span class="p">)</span>
    <span class="n">goes_tree</span> <span class="o">=</span> <span class="n">BallTree</span><span class="p">(</span><span class="n">goes_points_rad</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s2">&quot;haversine&quot;</span><span class="p">)</span>

    <span class="c1"># Flatten scatter grids</span>
    <span class="n">lat_flat</span> <span class="o">=</span> <span class="n">lat_grid</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">lon_flat</span> <span class="o">=</span> <span class="n">lon_grid</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">scatter_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">lat_flat</span><span class="p">,</span> <span class="n">lon_flat</span><span class="p">))</span>
    <span class="n">scatter_points_rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">scatter_points</span><span class="p">)</span>

    <span class="c1"># Radius for broad-phase query: diagonal of the bounding box</span>
    <span class="c1"># Square box radius: diagonal = radius * sqrt(2)</span>
    <span class="n">diag_radius</span> <span class="o">=</span> <span class="n">radius</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">diag_radius_rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">diag_radius</span><span class="p">)</span>

    <span class="n">indices_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">lat_flat</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>
    <span class="n">goes_shape</span> <span class="o">=</span> <span class="n">Goeslat</span><span class="o">.</span><span class="n">shape</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">lat_val</span><span class="p">,</span> <span class="n">lon_val</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">lat_flat</span><span class="p">,</span> <span class="n">lon_flat</span><span class="p">)):</span>
        <span class="c1"># Broad-phase: query all points within diagonal distance</span>
        <span class="n">candidate_indices</span> <span class="o">=</span> <span class="n">goes_tree</span><span class="o">.</span><span class="n">query_radius</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">scatter_points_rad</span><span class="p">[</span><span class="n">i</span><span class="p">]]),</span> <span class="n">r</span><span class="o">=</span><span class="n">diag_radius_rad</span>
        <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">candidate_indices</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># No points found, store empty</span>
            <span class="n">indices_array</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">))</span>
            <span class="k">continue</span>

        <span class="c1"># Post-filter candidates to keep only those in the bounding box</span>
        <span class="n">lat_min</span> <span class="o">=</span> <span class="n">lat_val</span> <span class="o">-</span> <span class="n">radius</span>
        <span class="n">lat_max</span> <span class="o">=</span> <span class="n">lat_val</span> <span class="o">+</span> <span class="n">radius</span>
        <span class="n">lon_min</span> <span class="o">=</span> <span class="n">lon_val</span> <span class="o">-</span> <span class="n">radius</span>
        <span class="n">lon_max</span> <span class="o">=</span> <span class="n">lon_val</span> <span class="o">+</span> <span class="n">radius</span>

        <span class="n">cand_lats</span> <span class="o">=</span> <span class="n">Goeslat_flat</span><span class="p">[</span><span class="n">candidate_indices</span><span class="p">]</span>
        <span class="n">cand_lons</span> <span class="o">=</span> <span class="n">Goeslon_flat</span><span class="p">[</span><span class="n">candidate_indices</span><span class="p">]</span>

        <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">cand_lats</span> <span class="o">&gt;=</span> <span class="n">lat_min</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">cand_lats</span> <span class="o">&lt;=</span> <span class="n">lat_max</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">cand_lons</span> <span class="o">&gt;=</span> <span class="n">lon_min</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">cand_lons</span> <span class="o">&lt;=</span> <span class="n">lon_max</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="n">final_indices</span> <span class="o">=</span> <span class="n">candidate_indices</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>

        <span class="c1"># Convert these flat indices back to row,col</span>
        <span class="n">rows</span><span class="p">,</span> <span class="n">cols</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unravel_index</span><span class="p">(</span><span class="n">final_indices</span><span class="p">,</span> <span class="n">goes_shape</span><span class="p">)</span>
        <span class="n">indices_array</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">)</span>

    <span class="c1"># Reshape indices_array to the original shape</span>
    <span class="n">indices_array</span> <span class="o">=</span> <span class="n">indices_array</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">lat_grid</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">indices_array</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.func_inference.get_mlp" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_mlp</span><span class="p">(</span><span class="n">in_features</span><span class="p">,</span> <span class="n">hidden_units</span><span class="p">,</span> <span class="n">out_features</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Returns a MLP head</p>
<p>taken from https://www.kaggle.com/code/umongsain/vision-transformer-from-scratch-pytorch</p>


            <details class="quote">
              <summary>Source code in <code>windscangeo\Models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_mlp</span><span class="p">(</span><span class="n">in_features</span><span class="p">,</span> <span class="n">hidden_units</span><span class="p">,</span> <span class="n">out_features</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a MLP head</span>

<span class="sd">    taken from https://www.kaggle.com/code/umongsain/vision-transformer-from-scratch-pytorch</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dims</span> <span class="o">=</span> <span class="p">[</span><span class="n">in_features</span><span class="p">]</span> <span class="o">+</span> <span class="n">hidden_units</span> <span class="o">+</span> <span class="p">[</span><span class="n">out_features</span><span class="p">]</span>
    <span class="n">layers</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">dim1</span><span class="p">,</span> <span class="n">dim2</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">dims</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="n">dims</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">dim1</span><span class="p">,</span> <span class="n">dim2</span><span class="p">))</span>
        <span class="n">layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">())</span>
    <span class="n">layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">dims</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="n">dims</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
    <span class="k">return</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span><span class="o">*</span><span class="n">layers</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.func_inference.goes_index" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">goes_index</span><span class="p">(</span><span class="n">parallel_index</span><span class="p">,</span> <span class="n">lat_grd</span><span class="p">,</span> <span class="n">lon_grd</span><span class="p">,</span> <span class="n">lat_search</span><span class="p">,</span> <span class="n">lon_search</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>This function retrieves the indices of the GOES image corresponding to a given latitude and longitude. This is an archived function. Current implementation decides on extent based on chosen image size.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>parallel_index</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The precomputed indices for GOES pixels corresponding to scatterometer lat/lon.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lat_grd</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The latitude grid of the scatterometer data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lon_grd</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The longitude grid of the scatterometer data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lat_search</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The latitude to search for in the GOES data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lon_search</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The longitude to search for in the GOES data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>min_row</code></td>            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The minimum row index of the GOES image.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>max_row</code></td>            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The maximum row index of the GOES image.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>min_col</code></td>            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The minimum column index of the GOES image.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>max_col</code></td>            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The maximum column index of the GOES image.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\func.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">goes_index</span><span class="p">(</span><span class="n">parallel_index</span><span class="p">,</span> <span class="n">lat_grd</span><span class="p">,</span> <span class="n">lon_grd</span><span class="p">,</span> <span class="n">lat_search</span><span class="p">,</span> <span class="n">lon_search</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function retrieves the indices of the GOES image corresponding to a given latitude and longitude. This is an archived function. Current implementation decides on extent based on chosen image size.</span>

<span class="sd">    Args:</span>
<span class="sd">        parallel_index (numpy.ndarray): The precomputed indices for GOES pixels corresponding to scatterometer lat/lon.</span>
<span class="sd">        lat_grd (numpy.ndarray): The latitude grid of the scatterometer data.</span>
<span class="sd">        lon_grd (numpy.ndarray): The longitude grid of the scatterometer data.</span>
<span class="sd">        lat_search (float): The latitude to search for in the GOES data.</span>
<span class="sd">        lon_search (float): The longitude to search for in the GOES data.</span>

<span class="sd">    Returns:</span>
<span class="sd">        min_row (int): The minimum row index of the GOES image.</span>
<span class="sd">        max_row (int): The maximum row index of the GOES image.</span>
<span class="sd">        min_col (int): The minimum column index of the GOES image.</span>
<span class="sd">        max_col (int): The maximum column index of the GOES image.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">index_row</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">lat_grd</span> <span class="o">==</span> <span class="n">lat_search</span><span class="p">)</span>
    <span class="n">index_column</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">lon_grd</span> <span class="o">==</span> <span class="n">lon_search</span><span class="p">)</span>

    <span class="n">rows_goes</span> <span class="o">=</span> <span class="n">parallel_index</span><span class="p">[</span><span class="n">index_row</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">index_column</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">columns_goes</span> <span class="o">=</span> <span class="n">parallel_index</span><span class="p">[</span><span class="n">index_row</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">index_column</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]][</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">rows_goes</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">columns_goes</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="n">min_row</span> <span class="o">=</span> <span class="n">rows_goes</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">max_row</span> <span class="o">=</span> <span class="n">rows_goes</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

    <span class="n">min_col</span> <span class="o">=</span> <span class="n">columns_goes</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">max_col</span> <span class="o">=</span> <span class="n">columns_goes</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">min_row</span><span class="p">,</span> <span class="n">max_row</span><span class="p">,</span> <span class="n">min_col</span><span class="p">,</span> <span class="n">max_col</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.func_inference.index_parallel" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">index_parallel</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">ScatterDataset</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Finds the corresponding GOES row and column indices for the entire scatterometer dataset.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>ScatterDataset</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>xarray Dataset containing scatterometer data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>scatter_name</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name for the output file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>output_path</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to save the output file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>parallel_indice_values</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>2D array of tuples containing GOES row and column indices corresponding to scatterometer data.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\func.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">index_parallel</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">ScatterDataset</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Finds the corresponding GOES row and column indices for the entire scatterometer dataset.</span>

<span class="sd">    Args:</span>
<span class="sd">        ScatterDataset: xarray Dataset containing scatterometer data.</span>
<span class="sd">        scatter_name: Name for the output file.</span>
<span class="sd">        output_path: Path to save the output file.</span>

<span class="sd">    Returns:</span>
<span class="sd">        parallel_indice_values: 2D array of tuples containing GOES row and column indices corresponding to scatterometer data.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">create_folder</span><span class="p">(</span><span class="s2">&quot;satellite_indices&quot;</span><span class="p">)</span>
    <span class="n">ds_spatial_resolution</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">spatial_resolution</span>
    <span class="n">ds_spatial_resolution</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>

    <span class="n">name_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;lat_</span><span class="si">{</span><span class="n">ScatterDataset</span><span class="o">.</span><span class="n">latitude</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">ScatterDataset</span><span class="o">.</span><span class="n">latitude</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="si">}</span><span class="s2">_lon_</span><span class="si">{</span><span class="n">ScatterDataset</span><span class="o">.</span><span class="n">longitude</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">ScatterDataset</span><span class="o">.</span><span class="n">longitude</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="si">}</span><span class="s2">_res_</span><span class="si">{</span><span class="n">ds_spatial_resolution</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">name_str</span> <span class="o">=</span> <span class="n">name_str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;./satellite_indices/</span><span class="si">{</span><span class="n">ds_spatial_resolution</span><span class="si">}</span><span class="s2">_index.npy&quot;</span>
    <span class="p">):</span>
        <span class="n">parallel_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;./satellite_indices/</span><span class="si">{</span><span class="n">ds_spatial_resolution</span><span class="si">}</span><span class="s2">_index.npy&quot;</span><span class="p">,</span>
            <span class="n">allow_pickle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">parallel_index</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;INFO : Satellite index file not found, creating new index file. This might take a while.&quot;</span>
        <span class="p">)</span>

        <span class="c1"># Extract scatterometer latitudes and longitudes</span>
        <span class="n">Latitudes_Scatter</span> <span class="o">=</span> <span class="n">ScatterDataset</span><span class="p">[</span><span class="s2">&quot;latitude&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">Longitudes_Scatter</span> <span class="o">=</span> <span class="n">ScatterDataset</span><span class="p">[</span><span class="s2">&quot;longitude&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

        <span class="c1"># Create a meshgrid of scatterometer coordinates</span>
        <span class="n">lon_grid</span><span class="p">,</span> <span class="n">lat_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">Longitudes_Scatter</span><span class="p">,</span> <span class="n">Latitudes_Scatter</span><span class="p">)</span>

        <span class="c1"># Extract GOES latitudes and longitudes</span>
        <span class="n">Goeslat</span><span class="p">,</span> <span class="n">Goeslon</span> <span class="o">=</span> <span class="n">calculate_degrees</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>
        <span class="n">Goeslat</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">Goeslat</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">999</span>
        <span class="n">Goeslon</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">Goeslon</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">999</span>
        <span class="c1"># Use the optimized get_indices function</span>
        <span class="n">parallel_indice_values</span> <span class="o">=</span> <span class="n">get_indices</span><span class="p">(</span><span class="n">lat_grid</span><span class="p">,</span> <span class="n">lon_grid</span><span class="p">,</span> <span class="n">Goeslat</span><span class="p">,</span> <span class="n">Goeslon</span><span class="p">)</span>

        <span class="c1"># Save the indices array</span>
        <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;./satellite_indices/</span><span class="si">{</span><span class="n">ds_spatial_resolution</span><span class="si">}</span><span class="s2">_index.npy&quot;</span><span class="p">,</span>
            <span class="n">parallel_indice_values</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">parallel_indice_values</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.func_inference.inference_model" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">inference_model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">inference_loader</span><span class="p">,</span> <span class="n">device</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Perform inference on the model using the provided DataLoader and return the outputs. Same as train_model but for a fixed given model.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>model</code>
            </td>
            <td>
                  <code><span title="torch.nn.Module">Module</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The trained model to be used for inference.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>inference_loader</code>
            </td>
            <td>
                  <code><span title="torch.utils.data.DataLoader">DataLoader</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataLoader for the inference dataset.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>device</code>
            </td>
            <td>
                  <code><span title="torch.device">device</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Device to run the model on (CPU or GPU).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>inference_outputs</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Outputs from the model on the inference dataset.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\impl.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">inference_model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">inference_loader</span><span class="p">,</span> <span class="n">device</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Perform inference on the model using the provided DataLoader and return the outputs. Same as train_model but for a fixed given model.</span>

<span class="sd">    Args:</span>
<span class="sd">        model (torch.nn.Module): The trained model to be used for inference.</span>
<span class="sd">        inference_loader (torch.utils.data.DataLoader): DataLoader for the inference dataset.</span>
<span class="sd">        device (torch.device): Device to run the model on (CPU or GPU).</span>

<span class="sd">    Returns:</span>
<span class="sd">        inference_outputs (numpy.ndarray): Outputs from the model on the inference dataset.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>  <span class="c1"># Disable gradient calculation for inference</span>

        <span class="n">inference_outputs</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">images</span> <span class="ow">in</span> <span class="n">inference_loader</span><span class="p">:</span>
            <span class="n">images</span> <span class="o">=</span> <span class="n">images</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>

            <span class="n">outputs</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">images</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

            <span class="c1"># Append outputs to the list</span>
            <span class="n">inference_outputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">outputs</span><span class="p">)</span>

        <span class="n">inference_outputs</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">inference_outputs</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">inference_outputs</span> <span class="o">=</span> <span class="n">inference_outputs</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span>
        <span class="n">inference_outputs</span> <span class="o">=</span> <span class="n">inference_outputs</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">inference_outputs</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.func_inference.inference_run" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">inference_run</span><span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="n">model_parameters</span><span class="p">,</span> <span class="n">model_path</span><span class="p">,</span> <span class="n">normalization_factors</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Runs inference on the provided images using the specified model parameters and normalization factors.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>images</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of images to be used for inference.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>model_parameters</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary containing model parameters such as batch size, image size, channels</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>model_path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the pre-trained model file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>normalization_factors</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary containing normalization factors such as mean and standard deviation.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>inference_output</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of inference outputs (wind speeds).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\func_inference.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">inference_run</span><span class="p">(</span>
    <span class="n">images</span><span class="p">,</span> <span class="n">model_parameters</span><span class="p">,</span> <span class="n">model_path</span><span class="p">,</span> <span class="n">normalization_factors</span>
<span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Runs inference on the provided images using the specified model parameters and normalization factors.</span>

<span class="sd">    Args:</span>
<span class="sd">        images (np.ndarray): Array of images to be used for inference.</span>
<span class="sd">        model_parameters (dict): Dictionary containing model parameters such as batch size, image size, channels</span>
<span class="sd">        model_path (str): Path to the pre-trained model file.</span>
<span class="sd">        normalization_factors (dict): Dictionary containing normalization factors such as mean and standard deviation.</span>

<span class="sd">    Returns:</span>
<span class="sd">        inference_output (np.ndarray): Array of inference outputs (wind speeds).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">device</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s2">&quot;cuda&quot;</span> <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">()</span> <span class="k">else</span> <span class="s2">&quot;cpu&quot;</span><span class="p">)</span>

    <span class="n">batch_size</span> <span class="o">=</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s2">&quot;batch_size&quot;</span><span class="p">]</span>
    <span class="n">image_height</span> <span class="o">=</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s2">&quot;image_size&quot;</span><span class="p">]</span>
    <span class="n">image_width</span> <span class="o">=</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s2">&quot;image_size&quot;</span><span class="p">]</span>
    <span class="n">in_channels</span> <span class="o">=</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s2">&quot;image_channels&quot;</span><span class="p">]</span>
    <span class="n">dropout_rate</span> <span class="o">=</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s2">&quot;dropout_rate&quot;</span><span class="p">]</span>
    <span class="n">model_choice</span> <span class="o">=</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s2">&quot;model_choice&quot;</span><span class="p">]</span>

    <span class="n">mean</span> <span class="o">=</span> <span class="n">normalization_factors</span><span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">]</span>
    <span class="n">std</span> <span class="o">=</span> <span class="n">normalization_factors</span><span class="p">[</span><span class="s2">&quot;std&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">model_choice</span> <span class="o">==</span> <span class="s1">&#39;CNN&#39;</span><span class="p">:</span>

        <span class="n">features_cnn</span> <span class="o">=</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s2">&quot;features_cnn&quot;</span><span class="p">]</span>
        <span class="n">kernel_size</span> <span class="o">=</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s2">&quot;kernel_size&quot;</span><span class="p">]</span>
        <span class="n">activation_cnn</span> <span class="o">=</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s2">&quot;activation_cnn&quot;</span><span class="p">]</span>
        <span class="n">activation_final</span> <span class="o">=</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s2">&quot;activation_final&quot;</span><span class="p">]</span>
        <span class="n">stride</span> <span class="o">=</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s2">&quot;stride&quot;</span><span class="p">]</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;model choice is CNN&quot;</span><span class="p">)</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">ConventionalCNN</span><span class="p">(</span>
            <span class="n">image_height</span><span class="p">,</span>
            <span class="n">image_width</span><span class="p">,</span>
            <span class="n">features_cnn</span><span class="p">,</span>
            <span class="n">kernel_size</span><span class="p">,</span>
            <span class="n">in_channels</span><span class="p">,</span>
            <span class="n">activation_cnn</span><span class="p">,</span>
            <span class="n">activation_final</span><span class="p">,</span>
            <span class="n">stride</span><span class="p">,</span>
            <span class="n">dropout_rate</span>
        <span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">model_choice</span> <span class="o">==</span> <span class="s1">&#39;ViT&#39;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;model choice is ViT&#39;</span><span class="p">)</span>
        <span class="c1"># Load the model</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">ViT</span><span class="p">(</span>
            <span class="n">img_size</span> <span class="o">=</span> <span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">),</span>
            <span class="n">patch_size</span> <span class="o">=</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">),</span>
            <span class="n">n_channels</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">d_model</span> <span class="o">=</span> <span class="mi">1024</span><span class="p">,</span>
            <span class="n">nhead</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
            <span class="n">dim_feedforward</span> <span class="o">=</span> <span class="mi">2048</span><span class="p">,</span>
            <span class="n">blocks</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span>
            <span class="n">mlp_head_units</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1024</span><span class="p">,</span> <span class="mi">512</span><span class="p">],</span>
            <span class="n">n_classes</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">model_choice</span> <span class="o">==</span> <span class="s1">&#39;ResNet&#39;</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">ResNet50</span><span class="p">(</span><span class="n">num_classes</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">channels</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>



    <span class="n">model</span><span class="o">.</span><span class="n">load_state_dict</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">model_path</span><span class="p">,</span> <span class="n">map_location</span><span class="o">=</span><span class="n">device</span><span class="p">))</span>
    <span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>

    <span class="n">inference_dataset</span> <span class="o">=</span> <span class="n">conventional_dataset_inference</span><span class="p">(</span>
        <span class="n">images</span><span class="p">,</span>
        <span class="n">transform</span><span class="o">=</span><span class="n">Normalize</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span><span class="n">std</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="n">inference_loader</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span><span class="n">inference_dataset</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">inference_output</span> <span class="o">=</span> <span class="n">inference_model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">inference_loader</span><span class="p">,</span> <span class="n">device</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">inference_output</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.func_inference.manage_saved_models" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">manage_saved_models</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Manage saved model files in the specified directory by deleting older epoch files.
Keeps only the latest epoch file and deletes all others. From @ Jing Sun</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>directory</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The directory where model files are saved.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\impl.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">manage_saved_models</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>  <span class="c1"># From @Jing</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Manage saved model files in the specified directory by deleting older epoch files.</span>
<span class="sd">    Keeps only the latest epoch file and deletes all others. From @ Jing Sun</span>

<span class="sd">    Args:</span>
<span class="sd">        directory (str): The directory where model files are saved.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;epoch_(\d+)\.pth&quot;</span><span class="p">)</span>
    <span class="n">epoch_files</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                <span class="n">epoch_num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
                <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
                <span class="n">epoch_files</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">file_path</span><span class="p">,</span> <span class="n">epoch_num</span><span class="p">))</span>

    <span class="c1"># Check if there are more than 5 files</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">epoch_files</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">epoch_files</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">files_to_delete</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">epoch_files</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">files_to_delete</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">epoch_files</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.func_inference.package_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">package_data</span><span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="n">numerical_data</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">solar_conversion</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>This function packages the images and numerical data into a format that can be used for training a machine learning model.
The function will filter out invalid images and fill in any NaN values. (Invalid images = empty images from GOES data)
The function will also convert the observation times, latitudes and longitudes to solar angles (sza, saa) if solar_conversion is set to True.
The function will return the images and numerical data in a numpy array format.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>images</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The GOES images corresponding to the observation data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>numerical_data</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary containing the numerical data corresponding to the observation data. The keys should include "observation_lats", "observation_lons", "observation_times" and optionally "wind_speeds".</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>filter</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, the function will filter out invalid images and fill in Nan values. Default is True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>solar_conversion</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, the function will convert the observation times, latitudes and longitudes to solar angles (sza, saa). Default is False. (Not used in current implementation, but kept in case of future use)</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>verbose</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, the function will print progress information. Default is True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>images</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The GOES images corresponding to the observation data.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>numerical_data</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The numerical data corresponding to the observation data. (sza, saa, main_parameter if solar_conversion is set to True or lat, lon, time, wind_speeds if solar_conversion is set to False)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\func.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span>
<span class="normal">934</span>
<span class="normal">935</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">package_data</span><span class="p">(</span>
    <span class="n">images</span><span class="p">,</span>
    <span class="n">numerical_data</span><span class="p">,</span>
    <span class="nb">filter</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">solar_conversion</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function packages the images and numerical data into a format that can be used for training a machine learning model.</span>
<span class="sd">    The function will filter out invalid images and fill in any NaN values. (Invalid images = empty images from GOES data)</span>
<span class="sd">    The function will also convert the observation times, latitudes and longitudes to solar angles (sza, saa) if solar_conversion is set to True.</span>
<span class="sd">    The function will return the images and numerical data in a numpy array format.</span>

<span class="sd">    Args:</span>
<span class="sd">        images (numpy.ndarray): The GOES images corresponding to the observation data.</span>
<span class="sd">        numerical_data (dict): A dictionary containing the numerical data corresponding to the observation data. The keys should include &quot;observation_lats&quot;, &quot;observation_lons&quot;, &quot;observation_times&quot; and optionally &quot;wind_speeds&quot;.</span>
<span class="sd">        filter (bool): If True, the function will filter out invalid images and fill in Nan values. Default is True.</span>
<span class="sd">        solar_conversion (bool): If True, the function will convert the observation times, latitudes and longitudes to solar angles (sza, saa). Default is False. (Not used in current implementation, but kept in case of future use)</span>
<span class="sd">        verbose (bool): If True, the function will print progress information. Default is True.</span>

<span class="sd">    Returns:</span>
<span class="sd">        images (numpy.ndarray): The GOES images corresponding to the observation data.</span>
<span class="sd">        numerical_data (numpy.ndarray): The numerical data corresponding to the observation data. (sza, saa, main_parameter if solar_conversion is set to True or lat, lon, time, wind_speeds if solar_conversion is set to False)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">filter</span><span class="p">:</span>
        <span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="n">numerical_data</span><span class="p">)</span> <span class="o">=</span> <span class="n">filter_invalid</span><span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="n">numerical_data</span><span class="p">)</span>
        <span class="n">images</span> <span class="o">=</span> <span class="n">fill_nans</span><span class="p">(</span><span class="n">images</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">solar_conversion</span><span class="p">:</span>
        <span class="n">observation_lats</span> <span class="o">=</span> <span class="n">numerical_data</span><span class="p">[</span><span class="s2">&quot;observation_lats&quot;</span><span class="p">]</span>
        <span class="n">observation_lons</span> <span class="o">=</span> <span class="n">numerical_data</span><span class="p">[</span><span class="s2">&quot;observation_lons&quot;</span><span class="p">]</span>
        <span class="n">observation_times</span> <span class="o">=</span> <span class="n">numerical_data</span><span class="p">[</span><span class="s2">&quot;observation_times&quot;</span><span class="p">]</span>

        <span class="n">sza</span><span class="p">,</span> <span class="n">saa</span> <span class="o">=</span> <span class="n">vectorized_solar_angles</span><span class="p">(</span>
            <span class="n">observation_lats</span><span class="p">,</span> <span class="n">observation_lons</span><span class="p">,</span> <span class="n">observation_times</span>
        <span class="p">)</span>

        <span class="n">sza_rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">sza</span><span class="p">)</span>
        <span class="n">sza_sin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">sza_rad</span><span class="p">)</span>
        <span class="n">sza_cos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">sza_rad</span><span class="p">)</span>

        <span class="n">saa_rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">saa</span><span class="p">)</span>
        <span class="n">saa_sin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">saa_rad</span><span class="p">)</span>
        <span class="n">saa_cos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">saa_rad</span><span class="p">)</span>

        <span class="c1"># Add the solar angles to the numerical data dictionary</span>

        <span class="n">numerical_data</span><span class="p">[</span><span class="s2">&quot;sza_sin&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sza_sin</span>
        <span class="n">numerical_data</span><span class="p">[</span><span class="s2">&quot;sza_cos&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sza_cos</span>
        <span class="n">numerical_data</span><span class="p">[</span><span class="s2">&quot;saa_sin&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">saa_sin</span>
        <span class="n">numerical_data</span><span class="p">[</span><span class="s2">&quot;saa_cos&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">saa_cos</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Data Preparation : converted to solar angles (sza, saa)&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Data Preparation : returning images, numerical_data&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">images</span><span class="p">,</span> <span class="n">numerical_data</span>

    <span class="k">else</span><span class="p">:</span>

        <span class="k">return</span> <span class="n">images</span><span class="p">,</span> <span class="n">numerical_data</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.func_inference.patchify" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">patchify</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">patch_size</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Patchify the batch of images</p>


<details class="shape" open>
  <summary>Shape</summary>
  <p>batch: (b, h, w, c)
output: (b, nh, nw, ph, pw, c)</p>
</details>        <p>taken from https://www.kaggle.com/code/umongsain/vision-transformer-from-scratch-pytorch</p>


            <details class="quote">
              <summary>Source code in <code>windscangeo\Models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">patchify</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">patch_size</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Patchify the batch of images</span>

<span class="sd">    Shape:</span>
<span class="sd">        batch: (b, h, w, c)</span>
<span class="sd">        output: (b, nh, nw, ph, pw, c)</span>

<span class="sd">    taken from https://www.kaggle.com/code/umongsain/vision-transformer-from-scratch-pytorch</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="n">batch</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">ph</span><span class="p">,</span> <span class="n">pw</span> <span class="o">=</span> <span class="n">patch_size</span>
    <span class="n">nh</span><span class="p">,</span> <span class="n">nw</span> <span class="o">=</span> <span class="n">h</span> <span class="o">//</span> <span class="n">ph</span><span class="p">,</span> <span class="n">w</span> <span class="o">//</span> <span class="n">pw</span>

    <span class="n">batch_patches</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">nh</span><span class="p">,</span> <span class="n">ph</span><span class="p">,</span> <span class="n">nw</span><span class="p">,</span> <span class="n">pw</span><span class="p">))</span>
    <span class="n">batch_patches</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="n">batch_patches</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">batch_patches</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.func_inference.plot_cloud_cover" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plot_cloud_cover</span><span class="p">(</span><span class="n">lat_inference</span><span class="p">,</span> <span class="n">lon_inference</span><span class="p">,</span> <span class="n">images</span><span class="p">,</span> <span class="n">path_folder</span><span class="p">,</span> <span class="n">buoy_name</span><span class="p">,</span> <span class="n">buoy_lat</span><span class="p">,</span> <span class="n">buoy_lon</span><span class="p">,</span> <span class="n">time_choice</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Plot the cloud cover mask on a map with buoy locations. This works well with 30x30 images but larger images can diluted. Can be adapted to work with larger images.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>lat_inference</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Latitude values for the inference grid.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lon_inference</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Longitude values for the inference grid.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>images</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>GOES image data to be used for cloud cover calculation.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>path_folder</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to save the plot.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>buoy_name</code>
            </td>
            <td>
                  <code><span title="list">list</span> or <span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Names of the buoys.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>buoy_lat</code>
            </td>
            <td>
                  <code><span title="list">list</span> or <span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Latitude values of the buoys.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>buoy_lon</code>
            </td>
            <td>
                  <code><span title="list">list</span> or <span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Longitude values of the buoys.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>time_choice</code>
            </td>
            <td>
                  <code><span title="datetime">datetime</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Time of the inference.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\func_ml.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">plot_cloud_cover</span><span class="p">(</span><span class="n">lat_inference</span><span class="p">,</span><span class="n">lon_inference</span><span class="p">,</span><span class="n">images</span><span class="p">,</span><span class="n">path_folder</span><span class="p">,</span><span class="n">buoy_name</span><span class="p">,</span><span class="n">buoy_lat</span><span class="p">,</span><span class="n">buoy_lon</span><span class="p">,</span><span class="n">time_choice</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot the cloud cover mask on a map with buoy locations. This works well with 30x30 images but larger images can diluted. Can be adapted to work with larger images.</span>

<span class="sd">    Args:</span>
<span class="sd">        lat_inference (np.ndarray): Latitude values for the inference grid.</span>
<span class="sd">        lon_inference (np.ndarray): Longitude values for the inference grid.</span>
<span class="sd">        images (np.ndarray): GOES image data to be used for cloud cover calculation.</span>
<span class="sd">        path_folder (str): Path to save the plot.</span>
<span class="sd">        buoy_name (list or np.ndarray): Names of the buoys.</span>
<span class="sd">        buoy_lat (list or np.ndarray): Latitude values of the buoys.</span>
<span class="sd">        buoy_lon (list or np.ndarray): Longitude values of the buoys.</span>
<span class="sd">        time_choice (datetime): Time of the inference.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mean_images</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
    <span class="n">threshold</span> <span class="o">=</span> <span class="mf">0.11</span>
    <span class="n">cloud_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mean_images</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">cloud_mask</span> <span class="o">=</span> <span class="n">cloud_mask</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">160</span><span class="p">,</span><span class="mi">340</span><span class="p">)</span>

    <span class="n">plot_cloud_mask</span><span class="p">(</span><span class="n">lat_inference</span><span class="p">,</span><span class="n">lon_inference</span><span class="p">,</span><span class="n">cloud_mask</span><span class="p">,</span><span class="n">path_folder</span><span class="p">,</span><span class="n">buoy_name</span><span class="p">,</span><span class="n">buoy_lat</span><span class="p">,</span><span class="n">buoy_lon</span><span class="p">,</span><span class="n">time_choice</span><span class="p">)</span>

    <span class="n">percentage_cloud</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">cloud_mask</span><span class="p">)</span><span class="o">/</span><span class="n">cloud_mask</span><span class="o">.</span><span class="n">size</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Cloud coverage : &#39;</span><span class="p">,</span><span class="n">percentage_cloud</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span><span class="s1">&#39;%&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">cloud_mask</span><span class="p">,</span> <span class="n">percentage_cloud</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.func_inference.plot_cloud_mask" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plot_cloud_mask</span><span class="p">(</span><span class="n">lat_inference</span><span class="p">,</span> <span class="n">lon_inference</span><span class="p">,</span> <span class="n">wind_speeds_inference</span><span class="p">,</span> <span class="n">path_folder</span><span class="p">,</span> <span class="n">buoy_name</span><span class="p">,</span> <span class="n">buoy_lat</span><span class="p">,</span> <span class="n">buoy_lon</span><span class="p">,</span> <span class="n">time_choice</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Plot the cloud mask on a map with buoy locations. This works well with 30x30 images but larger images can diluted. Can be adapted to work with larger images.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>lat_inference</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Latitude values for the inference grid.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lon_inference</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Longitude values for the inference grid.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>wind_speeds_inference</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Cloud mask data to be plotted.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>path_folder</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to save the plot.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>buoy_name</code>
            </td>
            <td>
                  <code><span title="list">list</span> or <span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Names of the buoys.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>buoy_lat</code>
            </td>
            <td>
                  <code><span title="list">list</span> or <span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Latitude values of the buoys.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>buoy_lon</code>
            </td>
            <td>
                  <code><span title="list">list</span> or <span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Longitude values of the buoys.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>time_choice</code>
            </td>
            <td>
                  <code><span title="datetime">datetime</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Time of the inference.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\func_ml.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">plot_cloud_mask</span><span class="p">(</span><span class="n">lat_inference</span><span class="p">,</span><span class="n">lon_inference</span><span class="p">,</span><span class="n">wind_speeds_inference</span><span class="p">,</span><span class="n">path_folder</span><span class="p">,</span><span class="n">buoy_name</span><span class="p">,</span><span class="n">buoy_lat</span><span class="p">,</span><span class="n">buoy_lon</span><span class="p">,</span><span class="n">time_choice</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot the cloud mask on a map with buoy locations. This works well with 30x30 images but larger images can diluted. Can be adapted to work with larger images.</span>

<span class="sd">    Args:</span>
<span class="sd">        lat_inference (np.ndarray): Latitude values for the inference grid.</span>
<span class="sd">        lon_inference (np.ndarray): Longitude values for the inference grid.</span>
<span class="sd">        wind_speeds_inference (np.ndarray): Cloud mask data to be plotted.</span>
<span class="sd">        path_folder (str): Path to save the plot.</span>
<span class="sd">        buoy_name (list or np.ndarray): Names of the buoys.</span>
<span class="sd">        buoy_lat (list or np.ndarray): Latitude values of the buoys.</span>
<span class="sd">        buoy_lon (list or np.ndarray): Longitude values of the buoys.</span>
<span class="sd">        time_choice (datetime): Time of the inference.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>

    <span class="c1"># Plot wind speed data (continuous colormap)</span>
    <span class="n">pcm</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span>
        <span class="n">lon_inference</span><span class="p">,</span> <span class="n">lat_inference</span><span class="p">,</span> <span class="n">wind_speeds_inference</span><span class="p">,</span>
        <span class="n">shading</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span>
        <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">)</span>

    <span class="c1"># Add colorbar</span>
    <span class="n">cbar</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">pcm</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;0 = Clear, 1 = Cloudy&#39;</span><span class="p">)</span>

    <span class="c1"># Add coastlines and land</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cfeature</span><span class="o">.</span><span class="n">LAND</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>  
    <span class="n">ax</span><span class="o">.</span><span class="n">coastlines</span><span class="p">(</span><span class="n">zorder</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>

    <span class="c1"># Flatten buoy_name if it&#39;s a list of arrays</span>
    <span class="n">buoy_name_flat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">buoy_name</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">unique_buoys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">buoy_name_flat</span><span class="p">))</span>

    <span class="c1"># Generate enough distinct colors for all buoys from the &quot;tab20&quot; palette</span>
    <span class="c1"># (tab20 provides 20 colors; if there are more than 20 unique buoys, colors will repeat)</span>
    <span class="n">color_map</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s2">&quot;tab20&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_buoys</span><span class="p">))</span>

    <span class="c1"># Plot each buoy in a single color</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">buoy_id</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">unique_buoys</span><span class="p">):</span>
        <span class="c1"># Pick a distinct color from tab20</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">color_map</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

        <span class="c1"># Identify the indices belonging to this buoy</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">buoy_name_flat</span><span class="p">)</span> <span class="o">==</span> <span class="n">buoy_id</span>

        <span class="c1"># Scatter just those points</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">buoy_lon</span><span class="p">)[</span><span class="n">mask</span><span class="p">],</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">buoy_lat</span><span class="p">)[</span><span class="n">mask</span><span class="p">],</span>
            <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>            <span class="c1"># Set the fill color</span>
            <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">zorder</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="n">buoy_id</span>           <span class="c1"># Use buoy_id as the legend label</span>
        <span class="p">)</span>

    <span class="c1"># Create the legend</span>
    <span class="n">leg</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Buoy Stations&quot;</span><span class="p">,</span>
        <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper right&quot;</span><span class="p">,</span>
        <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
        <span class="n">bbox_transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span>
    <span class="p">)</span>

    <span class="c1"># Ensure legend is above all other layers</span>
    <span class="n">leg</span><span class="o">.</span><span class="n">set_zorder</span><span class="p">(</span><span class="mi">999</span><span class="p">)</span>

    <span class="c1"># Add grid lines</span>
    <span class="n">gl</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">gridlines</span><span class="p">(</span><span class="n">draw_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">gl</span><span class="o">.</span><span class="n">right_labels</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">gl</span><span class="o">.</span><span class="n">top_labels</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Cloud Mask at time </span><span class="si">{</span><span class="n">time_choice</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Longitude&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Latitude&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">lat_inference</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">lat_inference</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">lon_inference</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">lon_inference</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>


    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">path_folder</span><span class="si">}</span><span class="s1">/plot_cloud_mask.png&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.func_inference.plot_goes_image" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plot_goes_image</span><span class="p">(</span><span class="n">lat_inference</span><span class="p">,</span> <span class="n">lon_inference</span><span class="p">,</span> <span class="n">images</span><span class="p">,</span> <span class="n">path_folder</span><span class="p">,</span> <span class="n">buoy_name</span><span class="p">,</span> <span class="n">buoy_lat</span><span class="p">,</span> <span class="n">buoy_lon</span><span class="p">,</span> <span class="n">time_choice</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Plot the GOES image data on a map with buoy locations. Made for 128x128 images where the middpoint is at (64,64). If using other image sizes, the plotting will probably not work as expected.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>lat_inference</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Latitude values for the inference grid.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lon_inference</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Longitude values for the inference grid.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>images</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>GOES image data to be plotted.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>path_folder</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to save the plot.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>buoy_name</code>
            </td>
            <td>
                  <code><span title="list">list</span> or <span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Names of the buoys.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>buoy_lat</code>
            </td>
            <td>
                  <code><span title="list">list</span> or <span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Latitude values of the buoys.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>buoy_lon</code>
            </td>
            <td>
                  <code><span title="list">list</span> or <span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Longitude values of the buoys.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>time_choice</code>
            </td>
            <td>
                  <code><span title="datetime">datetime</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Time of the inference.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\func_ml.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">plot_goes_image</span><span class="p">(</span><span class="n">lat_inference</span><span class="p">,</span><span class="n">lon_inference</span><span class="p">,</span><span class="n">images</span><span class="p">,</span><span class="n">path_folder</span><span class="p">,</span><span class="n">buoy_name</span><span class="p">,</span><span class="n">buoy_lat</span><span class="p">,</span><span class="n">buoy_lon</span><span class="p">,</span><span class="n">time_choice</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot the GOES image data on a map with buoy locations. Made for 128x128 images where the middpoint is at (64,64). If using other image sizes, the plotting will probably not work as expected.</span>

<span class="sd">    Args:</span>
<span class="sd">        lat_inference (np.ndarray): Latitude values for the inference grid.</span>
<span class="sd">        lon_inference (np.ndarray): Longitude values for the inference grid.</span>
<span class="sd">        images (np.ndarray): GOES image data to be plotted.</span>
<span class="sd">        path_folder (str): Path to save the plot.</span>
<span class="sd">        buoy_name (list or np.ndarray): Names of the buoys.</span>
<span class="sd">        buoy_lat (list or np.ndarray): Latitude values of the buoys.</span>
<span class="sd">        buoy_lon (list or np.ndarray): Longitude values of the buoys.</span>
<span class="sd">        time_choice (datetime): Time of the inference.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mean_images</span> <span class="o">=</span> <span class="n">images</span><span class="p">[:,:,</span><span class="mi">64</span><span class="p">,</span><span class="mi">64</span><span class="p">]</span>
    <span class="n">mean_images</span> <span class="o">=</span> <span class="n">mean_images</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
    <span class="n">mean_images</span> <span class="o">=</span> <span class="n">mean_images</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">160</span><span class="p">,</span><span class="mi">340</span><span class="p">)</span>


    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>


    <span class="c1"># Plot wind speed data (continuous colormap)</span>
    <span class="n">pcm</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span>
        <span class="n">lon_inference</span><span class="p">,</span> <span class="n">lat_inference</span><span class="p">,</span> <span class="n">mean_images</span><span class="p">,</span>
        <span class="n">shading</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span>
        <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Add colorbar</span>
    <span class="n">cbar</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">pcm</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Brightness Temperature (K) - C01&#39;</span><span class="p">)</span>

    <span class="c1"># Add coastlines and land</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cfeature</span><span class="o">.</span><span class="n">LAND</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>  
    <span class="n">ax</span><span class="o">.</span><span class="n">coastlines</span><span class="p">(</span><span class="n">zorder</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>


    <span class="c1"># Flatten buoy_name if it&#39;s a list of arrays</span>
    <span class="n">buoy_name_flat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">buoy_name</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">unique_buoys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">buoy_name_flat</span><span class="p">))</span>

    <span class="c1"># Generate enough distinct colors for all buoys from the &quot;tab20&quot; palette</span>
    <span class="c1"># (tab20 provides 20 colors; if there are more than 20 unique buoys, colors will repeat)</span>
    <span class="n">color_map</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s2">&quot;tab20&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_buoys</span><span class="p">))</span>


    <span class="c1"># Add grid lines</span>
    <span class="n">gl</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">gridlines</span><span class="p">(</span><span class="n">draw_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">gl</span><span class="o">.</span><span class="n">right_labels</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">gl</span><span class="o">.</span><span class="n">top_labels</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;GOES image at time </span><span class="si">{</span><span class="n">time_choice</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Longitude&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Latitude&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">lat_inference</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">lat_inference</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">lon_inference</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">lon_inference</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">path_folder</span><span class="si">}</span><span class="s1">/plot_goes_image.png&#39;</span><span class="p">)</span>

    <span class="n">mean_images</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mean_images</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">mean_images</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.func_inference.plot_save_loss" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plot_save_loss</span><span class="p">(</span><span class="n">best_val_outputs</span><span class="p">,</span> <span class="n">best_val_labels</span><span class="p">,</span> <span class="n">train_losses</span><span class="p">,</span> <span class="n">val_losses</span><span class="p">,</span> <span class="n">path_folder</span><span class="p">,</span> <span class="n">saving</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Plot and save the training and validation losses, and optionally save the best validation outputs and labels.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>best_val_outputs</code>
            </td>
            <td>
                  <code><span title="list">list</span> or <span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Model outputs for the validation dataset.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>best_val_labels</code>
            </td>
            <td>
                  <code><span title="list">list</span> or <span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True labels for the validation dataset.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>train_losses</code>
            </td>
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of training losses per epoch.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>val_losses</code>
            </td>
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of validation losses per epoch.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>path_folder</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to save the plot and optionally the outputs and labels.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>saving</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, save the best validation outputs and labels. Default is False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\func_ml.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">plot_save_loss</span><span class="p">(</span>
    <span class="n">best_val_outputs</span><span class="p">,</span>
    <span class="n">best_val_labels</span><span class="p">,</span>
    <span class="n">train_losses</span><span class="p">,</span>
    <span class="n">val_losses</span><span class="p">,</span>
    <span class="n">path_folder</span><span class="p">,</span>
    <span class="n">saving</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot and save the training and validation losses, and optionally save the best validation outputs and labels.</span>

<span class="sd">    Args:</span>
<span class="sd">        best_val_outputs (list or np.ndarray): Model outputs for the validation dataset.</span>
<span class="sd">        best_val_labels (list or np.ndarray): True labels for the validation dataset.</span>
<span class="sd">        train_losses (list): List of training losses per epoch.</span>
<span class="sd">        val_losses (list): List of validation losses per epoch.</span>
<span class="sd">        path_folder (str): Path to save the plot and optionally the outputs and labels.</span>
<span class="sd">        saving (bool, optional): If True, save the best validation outputs and labels. Default is False.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># After training, save only the best validation outputs and labels</span>
    <span class="k">if</span> <span class="n">saving</span><span class="p">:</span>
        <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_folder</span><span class="p">,</span> <span class="s2">&quot;best_validation_outputs.npy&quot;</span><span class="p">),</span> <span class="n">best_val_outputs</span>
        <span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_folder</span><span class="p">,</span> <span class="s2">&quot;best_validation_labels.npy&quot;</span><span class="p">),</span> <span class="n">best_val_labels</span>
        <span class="p">)</span>

    <span class="n">num_epochs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">train_losses</span><span class="p">)</span>
    <span class="c1"># Plotting the training and validation losses</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_epochs</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">train_losses</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Training Loss&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_epochs</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">val_losses</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Validation Loss&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Epoch&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Loss&quot;</span><span class="p">)</span>
    <span class="n">text_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;num_epochs = </span><span class="si">{</span><span class="n">num_epochs</span><span class="si">}</span><span class="s2">, train loss = </span><span class="si">{</span><span class="n">train_losses</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, validation loss = </span><span class="si">{</span><span class="n">val_losses</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
        <span class="mf">0.05</span><span class="p">,</span>
        <span class="mf">0.05</span><span class="p">,</span>
        <span class="n">text_str</span><span class="p">,</span>
        <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
        <span class="n">va</span><span class="o">=</span><span class="s2">&quot;bottom&quot;</span><span class="p">,</span>
        <span class="n">transform</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>  <span class="c1"># Ensures the coordinates are relative to the axes (0 to 1 range)</span>
    <span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Training and Validation Loss Over Epochs&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_folder</span><span class="p">,</span> <span class="s2">&quot;loss_plot.png&quot;</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.func_inference.plot_wind_speeds" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plot_wind_speeds</span><span class="p">(</span><span class="n">lat_inference</span><span class="p">,</span> <span class="n">lon_inference</span><span class="p">,</span> <span class="n">wind_speeds_inference</span><span class="p">,</span> <span class="n">path_folder</span><span class="p">,</span> <span class="n">buoy_name</span><span class="p">,</span> <span class="n">buoy_lat</span><span class="p">,</span> <span class="n">buoy_lon</span><span class="p">,</span> <span class="n">time_choice</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Plot the wind speeds on a map with buoy locations. Filter nighttime images and add coastlines, gridlines, and buoy locations.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>lat_inference</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Latitude values for the inference grid.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lon_inference</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Longitude values for the inference grid.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>wind_speeds_inference</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Wind speed data to be plotted.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>path_folder</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to save the plot.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>buoy_name</code>
            </td>
            <td>
                  <code><span title="list">list</span> or <span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Names of the buoys.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>buoy_lat</code>
            </td>
            <td>
                  <code><span title="list">list</span> or <span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Latitude values of the buoys.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>buoy_lon</code>
            </td>
            <td>
                  <code><span title="list">list</span> or <span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Longitude values of the buoys.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>time_choice</code>
            </td>
            <td>
                  <code><span title="datetime">datetime</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Time of the inference.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\func_ml.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">plot_wind_speeds</span><span class="p">(</span><span class="n">lat_inference</span><span class="p">,</span><span class="n">lon_inference</span><span class="p">,</span><span class="n">wind_speeds_inference</span><span class="p">,</span><span class="n">path_folder</span><span class="p">,</span><span class="n">buoy_name</span><span class="p">,</span><span class="n">buoy_lat</span><span class="p">,</span><span class="n">buoy_lon</span><span class="p">,</span><span class="n">time_choice</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot the wind speeds on a map with buoy locations. Filter nighttime images and add coastlines, gridlines, and buoy locations.</span>

<span class="sd">    Args:</span>
<span class="sd">        lat_inference (np.ndarray): Latitude values for the inference grid.</span>
<span class="sd">        lon_inference (np.ndarray): Longitude values for the inference grid.</span>
<span class="sd">        wind_speeds_inference (np.ndarray): Wind speed data to be plotted.</span>
<span class="sd">        path_folder (str): Path to save the plot.</span>
<span class="sd">        buoy_name (list or np.ndarray): Names of the buoys.</span>
<span class="sd">        buoy_lat (list or np.ndarray): Latitude values of the buoys.</span>
<span class="sd">        buoy_lon (list or np.ndarray): Longitude values of the buoys.</span>
<span class="sd">        time_choice (datetime): Time of the inference.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">time_str</span> <span class="o">=</span> <span class="n">time_choice</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span>
    <span class="n">date</span><span class="p">,</span> <span class="n">time</span> <span class="o">=</span> <span class="n">time_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
    <span class="n">lat</span> <span class="o">=</span> <span class="n">lat_inference</span>
    <span class="n">lon</span> <span class="o">=</span> <span class="n">lon_inference</span>
    <span class="n">wind_speeds</span> <span class="o">=</span> <span class="n">wind_speeds_inference</span>


    <span class="n">buoy_names</span> <span class="o">=</span> <span class="n">buoy_name</span>
    <span class="n">buoy_lat</span> <span class="o">=</span> <span class="n">buoy_lat</span>
    <span class="n">buoy_lon</span> <span class="o">=</span> <span class="n">buoy_lon</span>


    <span class="c1"># nighttime mask</span>

    <span class="n">lat_flat</span> <span class="o">=</span> <span class="n">lat</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">lon_flat</span> <span class="o">=</span> <span class="n">lon</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">time_flat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lat_flat</span><span class="p">),</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">date</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">time</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[ns]&#39;</span><span class="p">)</span>


    <span class="n">sza</span><span class="p">,</span> <span class="n">saa</span> <span class="o">=</span> <span class="n">vectorized_solar_angles</span><span class="p">(</span><span class="n">lat_flat</span><span class="p">,</span> <span class="n">lon_flat</span><span class="p">,</span> <span class="n">time_flat</span><span class="p">)</span>
    <span class="n">saa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">saa</span><span class="p">,</span><span class="n">lat</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">sza</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">sza</span><span class="p">,</span><span class="n">lat</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

    <span class="n">night_time_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">sza</span> <span class="o">&gt;</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
    <span class="n">cmap</span> <span class="o">=</span> <span class="n">ListedColormap</span><span class="p">([</span><span class="s1">&#39;white&#39;</span><span class="p">])</span>

    <span class="c1">###############</span>

    <span class="n">min_lon</span><span class="p">,</span> <span class="n">max_lon</span><span class="p">,</span> <span class="n">min_lat</span><span class="p">,</span> <span class="n">max_lat</span> <span class="o">=</span> <span class="o">-</span><span class="mi">70</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">12</span><span class="p">,</span> <span class="mi">20</span>

    <span class="c1"># add coastlines and gridlines</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">22</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
    <span class="n">levels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">line_colour</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span>
    <span class="n">line_colours</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;black&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">levels</span><span class="p">]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">set_text</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Wind Speed prediction from C01 GOES image (m/s) </span><span class="si">{</span><span class="n">date</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">time</span><span class="si">}</span><span class="s1"> &#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">wind_speeds</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;jet&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span><span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span><span class="n">zorder</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">night_time_mask</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span><span class="n">zorder</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cfeature</span><span class="o">.</span><span class="n">COASTLINE</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cfeature</span><span class="o">.</span><span class="n">LAND</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span> <span class="mi">20</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">70</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">crs</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">FuncFormatter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">_</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">x</span><span class="si">:</span><span class="s1">.0f</span><span class="si">}</span><span class="s1">E&#39;</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">15</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">crs</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">FuncFormatter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">y</span><span class="p">,</span> <span class="n">_</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">y</span><span class="si">:</span><span class="s1">.0f</span><span class="si">}</span><span class="s1">N&#39;</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_extent</span><span class="p">((</span><span class="o">-</span><span class="mi">70</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">12</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">70</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">wind_speeds</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;jet&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span><span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="mi">15</span><span class="p">),</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Wind Speed (m/s)&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">gridlines</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span> <span class="mi">999</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">buoy</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">buoy_names</span><span class="p">)):</span>
        <span class="n">lon_b</span><span class="p">,</span> <span class="n">lat_b</span> <span class="o">=</span> <span class="n">buoy_lon</span><span class="p">[</span><span class="n">buoy</span><span class="p">],</span> <span class="n">buoy_lat</span><span class="p">[</span><span class="n">buoy</span><span class="p">]</span>

        <span class="c1"># Skip if out of bounds</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">min_lon</span> <span class="o">&lt;=</span> <span class="n">lon_b</span> <span class="o">&lt;=</span> <span class="n">max_lon</span> <span class="ow">and</span> <span class="n">min_lat</span> <span class="o">&lt;=</span> <span class="n">lat_b</span> <span class="o">&lt;=</span> <span class="n">max_lat</span><span class="p">):</span>
            <span class="k">continue</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lon_b</span><span class="p">,</span> <span class="n">lat_b</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="n">label</span><span class="o">=</span><span class="n">buoy_names</span><span class="p">[</span><span class="n">buoy</span><span class="p">],</span><span class="n">zorder</span> <span class="o">=</span> <span class="mi">999</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
            <span class="n">lon_b</span> <span class="o">+</span> <span class="mf">0.2</span><span class="p">,</span> <span class="n">lat_b</span> <span class="o">+</span> <span class="mf">0.2</span><span class="p">,</span> <span class="n">buoy_names</span><span class="p">[</span><span class="n">buoy</span><span class="p">],</span>
            <span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span>
            <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>
            <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">boxstyle</span><span class="o">=</span><span class="s1">&#39;square,pad=0.2&#39;</span><span class="p">),</span><span class="n">zorder</span> <span class="o">=</span> <span class="mi">999</span>
        <span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">path_folder</span><span class="si">}</span><span class="s1">/plot_wind_speeds.png&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.func_inference.rmse_per_range" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">rmse_per_range</span><span class="p">(</span><span class="n">model_output</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">path_folder</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Calculate the RMSE for different ranges of wind speeds and save the results to a CSV file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>model_output</code>
            </td>
            <td>
                  <code><span title="list">list</span> or <span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Model outputs for the validation dataset.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>target</code>
            </td>
            <td>
                  <code><span title="list">list</span> or <span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True labels for the validation dataset.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>path_folder</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to save the CSV file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Returns:
    pd.DataFrame: DataFrame containing the RMSE and count for each range.</p>


            <details class="quote">
              <summary>Source code in <code>windscangeo\func_ml.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">rmse_per_range</span><span class="p">(</span><span class="n">model_output</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span><span class="n">path_folder</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the RMSE for different ranges of wind speeds and save the results to a CSV file.</span>

<span class="sd">    Args:</span>
<span class="sd">        model_output (list or np.ndarray): Model outputs for the validation dataset.</span>
<span class="sd">        target (list or np.ndarray): True labels for the validation dataset.</span>
<span class="sd">        path_folder (str): Path to save the CSV file.</span>
<span class="sd">    Returns:</span>
<span class="sd">        pd.DataFrame: DataFrame containing the RMSE and count for each range.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">max_target</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
    <span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_target</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bins</span><span class="p">))</span>
    <span class="n">count</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bins</span><span class="p">))</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bins</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">target</span> <span class="o">&gt;=</span> <span class="n">bins</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">target</span> <span class="o">&lt;=</span> <span class="n">bins</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">rmse</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">model_output</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">-</span> <span class="n">target</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">count</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;EVAL : Range </span><span class="si">{</span><span class="n">bins</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2"> m/s - </span><span class="si">{</span><span class="n">bins</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> m/s: RMSE = </span><span class="si">{</span><span class="n">rmse</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2">, count = </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">count</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;bin_start&#39;</span><span class="p">:</span> <span class="n">bins</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s1">&#39;bin_end&#39;</span><span class="p">:</span> <span class="n">bins</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;rmse&#39;</span><span class="p">:</span> <span class="n">rmse</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s1">&#39;count&#39;</span><span class="p">:</span> <span class="n">count</span><span class="p">[</span><span class="n">i</span><span class="p">]})</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
    <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">path_folder</span><span class="si">}</span><span class="s1">/rmse_per_range.csv&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.func_inference.save_overpass_time" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">save_overpass_time</span><span class="p">(</span><span class="n">time_list</span><span class="p">,</span> <span class="n">name_scatter</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>This function prints the overpass time of the scatterometer.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>time_list</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The measurement time values of the scatterometer data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>name_scatter</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the scatterometer data source (e.g. ASCAT, HYSCAT etc).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\func.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">save_overpass_time</span><span class="p">(</span><span class="n">time_list</span><span class="p">,</span><span class="n">name_scatter</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function prints the overpass time of the scatterometer.</span>

<span class="sd">    Args:</span>
<span class="sd">        time_list (numpy.ndarray): The measurement time values of the scatterometer data.</span>
<span class="sd">        name_scatter (str): The name of the scatterometer data source (e.g. ASCAT, HYSCAT etc).</span>

<span class="sd">    Returns:</span>
<span class="sd">        None </span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">formated_time</span> <span class="o">=</span> <span class="n">time_list</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;datetime64[ns]&#39;</span><span class="p">)</span>
    <span class="n">hour_minute</span> <span class="o">=</span> <span class="n">formated_time</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;datetime64[m]&#39;</span><span class="p">)</span>
    <span class="n">unique_hour_minute</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">hour_minute</span><span class="p">)</span>

    <span class="n">filtered</span> <span class="o">=</span> <span class="p">[</span><span class="n">unique_hour_minute</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>

    <span class="n">delta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">timedelta64</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="n">unique_hour_minute</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
        <span class="k">if</span> <span class="n">time</span> <span class="o">-</span> <span class="n">filtered</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">delta</span><span class="p">:</span>
            <span class="n">filtered</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>

    <span class="n">time_only</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="n">filtered</span><span class="p">:</span>
        <span class="n">time</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">time</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">time_only</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ORBIT : </span><span class="si">{</span><span class="n">name_scatter</span><span class="si">}</span><span class="s2"> overpass time : </span><span class="si">{</span><span class="n">time_only</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.func_inference.savedataseperated" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">savedataseperated</span><span class="p">(</span><span class="n">ScatterData</span><span class="p">,</span> <span class="n">main_parameter</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>This function extracts the valid lon / lat / measurement time and the main parameter from ever pixel
of the scatterometer data and saves it to a numpy file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>ScatterData</code>
            </td>
            <td>
                  <code><span title="xarray.Dataset">Dataset</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The ASCAT dataset containing the scatterometer data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>main_parameter</code>
            </td>
            <td>
                  <code><span title="xarray.DataArray">DataArray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The main parameter to be saved. This can be a classification / wind speed / wind direction etc.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Returns:</p>
<pre><code>lat_list (numpy.ndarray): The latitude values of the scatterometer data.
lon_list (numpy.ndarray): The longitude values of the scatterometer data.
time_list (numpy.ndarray): The measurement time values of the scatterometer data.
main_parameter_list (numpy.ndarray): The main parameter values of the scatterometer data.
</code></pre>
<p>this function saves the data locally to a folder called data_processed_scat</p>


            <details class="quote">
              <summary>Source code in <code>windscangeo\func.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">savedataseperated</span><span class="p">(</span><span class="n">ScatterData</span><span class="p">,</span> <span class="n">main_parameter</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function extracts the valid lon / lat / measurement time and the main parameter from ever pixel</span>
<span class="sd">    of the scatterometer data and saves it to a numpy file.</span>

<span class="sd">    Args:</span>
<span class="sd">        ScatterData (xarray.Dataset): The ASCAT dataset containing the scatterometer data.</span>
<span class="sd">        main_parameter (xarray.DataArray): The main parameter to be saved. This can be a classification / wind speed / wind direction etc.</span>

<span class="sd">    Returns:</span>

<span class="sd">        lat_list (numpy.ndarray): The latitude values of the scatterometer data.</span>
<span class="sd">        lon_list (numpy.ndarray): The longitude values of the scatterometer data.</span>
<span class="sd">        time_list (numpy.ndarray): The measurement time values of the scatterometer data.</span>
<span class="sd">        main_parameter_list (numpy.ndarray): The main parameter values of the scatterometer data.</span>

<span class="sd">    this function saves the data locally to a folder called data_processed_scat</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">lat_full</span><span class="p">,</span> <span class="n">lon_full</span><span class="p">,</span> <span class="n">time_full</span> <span class="o">=</span> <span class="n">ScatterData</span><span class="o">.</span><span class="n">indexes</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
    <span class="n">measurement_time_full</span> <span class="o">=</span> <span class="n">ScatterData</span><span class="o">.</span><span class="n">measurement_time</span>

    <span class="n">lat_full</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lat_full</span><span class="p">)</span>
    <span class="n">lon_full</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lon_full</span><span class="p">)</span>
    <span class="n">measurement_time_full</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">measurement_time_full</span><span class="p">)</span>
    <span class="n">main_parameter</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">main_parameter</span><span class="p">)</span>

    <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">main_parameter</span><span class="p">))</span>

    <span class="n">index_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">lat_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">lon_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">time_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">wind_speed_list</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">name_scatter</span> <span class="o">=</span> <span class="n">ScatterData</span><span class="o">.</span><span class="n">source</span>

    <span class="k">for</span> <span class="n">t</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">index</span><span class="p">:</span>

        <span class="c1"># print(t,&#39;= time&#39;, i,&#39;=row&#39;, j, &#39;=column&#39;)</span>
        <span class="n">index_list</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">t</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">))</span>

        <span class="c1"># print(measurement_time_full[t, i, j].astype(&#39;datetime64[ns]&#39;))</span>
        <span class="n">time_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">measurement_time_full</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span>

        <span class="c1"># print(lat_full[i])</span>
        <span class="n">lat_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lat_full</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

        <span class="c1"># print(lon_full[j])</span>
        <span class="n">lon_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lon_full</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>

        <span class="c1"># print(AllWindSpeeds[t, i, j])</span>
        <span class="n">wind_speed_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">main_parameter</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span>

    <span class="n">lat_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lat_list</span><span class="p">)</span>
    <span class="n">lon_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lon_list</span><span class="p">)</span>
    <span class="n">time_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">time_list</span><span class="p">)</span>
    <span class="n">wind_speed_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">wind_speed_list</span><span class="p">)</span>

    <span class="n">lat_list</span><span class="p">,</span> <span class="n">lon_list</span><span class="p">,</span> <span class="n">time_list</span><span class="p">,</span> <span class="n">wind_speed_list</span> <span class="o">=</span> <span class="n">sort_by_time</span><span class="p">(</span>
        <span class="n">lat_list</span><span class="p">,</span> <span class="n">lon_list</span><span class="p">,</span> <span class="n">time_list</span><span class="p">,</span> <span class="n">wind_speed_list</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="n">save_overpass_time</span><span class="p">(</span><span class="n">time_list</span><span class="p">,</span><span class="n">name_scatter</span><span class="p">)</span>    

    <span class="k">return</span> <span class="n">lat_list</span><span class="p">,</span> <span class="n">lon_list</span><span class="p">,</span> <span class="n">time_list</span><span class="p">,</span> <span class="n">wind_speed_list</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.func_inference.snap_to_nearest" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">snap_to_nearest</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">reference_array</span><span class="p">,</span> <span class="n">cutoff</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Snap an array of values to the nearest values in a reference array.
If the difference is greater than the cutoff, the original value is returned.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>values</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of values to snap.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>reference_array</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of reference values.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cutoff</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum allowable difference for snapping.</p>
              </div>
            </td>
            <td>
                  <code>1.0</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>np.ndarray: Snapped values.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\func_inference.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">snap_to_nearest</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">reference_array</span><span class="p">,</span> <span class="n">cutoff</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Snap an array of values to the nearest values in a reference array.</span>
<span class="sd">    If the difference is greater than the cutoff, the original value is returned.</span>

<span class="sd">    Args:</span>
<span class="sd">        values (np.ndarray): Array of values to snap.</span>
<span class="sd">        reference_array (np.ndarray): Array of reference values.</span>
<span class="sd">        cutoff (float): Maximum allowable difference for snapping.</span>

<span class="sd">    Returns:</span>
<span class="sd">        np.ndarray: Snapped values.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Convert inputs to NumPy arrays for compatibility</span>
    <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
    <span class="n">reference_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">reference_array</span><span class="p">)</span>

    <span class="c1"># Find the nearest reference value for each input value</span>
    <span class="c1"># Reshape reference_array to allow broadcasting</span>
    <span class="n">reference_array</span> <span class="o">=</span> <span class="n">reference_array</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">differences</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">reference_array</span><span class="p">)</span>
    <span class="n">nearest_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">differences</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">nearest_values</span> <span class="o">=</span> <span class="n">reference_array</span><span class="o">.</span><span class="n">ravel</span><span class="p">()[</span><span class="n">nearest_indices</span><span class="p">]</span>

    <span class="c1"># Apply the cutoff condition</span>
    <span class="n">snap_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">values</span> <span class="o">-</span> <span class="n">nearest_values</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">cutoff</span>
    <span class="n">snapped_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">snap_mask</span><span class="p">,</span> <span class="n">nearest_values</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">snapped_values</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.func_inference.sort_by_time" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">sort_by_time</span><span class="p">(</span><span class="n">lat_list</span><span class="p">,</span> <span class="n">lon_list</span><span class="p">,</span> <span class="n">time_list</span><span class="p">,</span> <span class="n">wind_speed_list</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>This function sorts the output of savedataseperated() by time.
This allows for more efficient data processing and allows file caching for times that are represented by the same GOES file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>lat_list</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The latitude values of the scatterometer data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lon_list</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The longitude values of the scatterometer data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>time_list</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The measurement time values of the scatterometer data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>wind_speed_list</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The wind speed values of the scatterometer data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>lat_list_sorted</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The sorted latitude values of the scatterometer data.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>lon_list_sorted</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The sorted longitude values of the scatterometer data.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>time_list_sorted</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The sorted measurement time values of the scatterometer data.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>wind_speed_list_sorted</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The sorted wind speed values of the scatterometer data.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\func.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">sort_by_time</span><span class="p">(</span><span class="n">lat_list</span><span class="p">,</span> <span class="n">lon_list</span><span class="p">,</span> <span class="n">time_list</span><span class="p">,</span> <span class="n">wind_speed_list</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function sorts the output of savedataseperated() by time.</span>
<span class="sd">    This allows for more efficient data processing and allows file caching for times that are represented by the same GOES file.</span>

<span class="sd">    Args:</span>
<span class="sd">        lat_list (numpy.ndarray): The latitude values of the scatterometer data.</span>
<span class="sd">        lon_list (numpy.ndarray): The longitude values of the scatterometer data.</span>
<span class="sd">        time_list (numpy.ndarray): The measurement time values of the scatterometer data.</span>
<span class="sd">        wind_speed_list (numpy.ndarray): The wind speed values of the scatterometer data.</span>

<span class="sd">    Returns:</span>
<span class="sd">        lat_list_sorted (numpy.ndarray): The sorted latitude values of the scatterometer data.</span>
<span class="sd">        lon_list_sorted (numpy.ndarray): The sorted longitude values of the scatterometer data.</span>
<span class="sd">        time_list_sorted (numpy.ndarray): The sorted measurement time values of the scatterometer data.</span>
<span class="sd">        wind_speed_list_sorted (numpy.ndarray): The sorted wind speed values of the scatterometer data.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Get the indices that would sort the measurement_time array</span>
    <span class="n">sorted_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">time_list</span><span class="p">)</span>

    <span class="c1"># Reorder the arrays using the sorted indices</span>
    <span class="n">time_list_sorted</span> <span class="o">=</span> <span class="n">time_list</span><span class="p">[</span><span class="n">sorted_indices</span><span class="p">]</span>
    <span class="n">lat_list_sorted</span> <span class="o">=</span> <span class="n">lat_list</span><span class="p">[</span><span class="n">sorted_indices</span><span class="p">]</span>
    <span class="n">lon_list_sorted</span> <span class="o">=</span> <span class="n">lon_list</span><span class="p">[</span><span class="n">sorted_indices</span><span class="p">]</span>
    <span class="n">speed_list_sorted</span> <span class="o">=</span> <span class="n">wind_speed_list</span><span class="p">[</span><span class="n">sorted_indices</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">lat_list_sorted</span><span class="p">,</span> <span class="n">lon_list_sorted</span><span class="p">,</span> <span class="n">time_list_sorted</span><span class="p">,</span> <span class="n">speed_list_sorted</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.func_inference.test_model" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">test_model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">test_loader</span><span class="p">,</span> <span class="n">criterion</span><span class="p">,</span> <span class="n">device</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Evaluate the model on the test dataset and return the outputs, targets, and average loss.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>model</code>
            </td>
            <td>
                  <code><span title="torch.nn.Module">Module</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The trained model to be evaluated.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>test_loader</code>
            </td>
            <td>
                  <code><span title="torch.utils.data.DataLoader">DataLoader</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataLoader for the test dataset.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>criterion</code>
            </td>
            <td>
                  <code><span title="torch.nn.Module">Module</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Loss function to be used for evaluation.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>device</code>
            </td>
            <td>
                  <code><span title="torch.device">device</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Device to run the model on (CPU or GPU).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>test_outputs</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Outputs from the model on the test dataset.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>test_targets</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Targets corresponding to the test outputs.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>avg_test_loss</code></td>            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Average loss on the test dataset.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\impl.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">test_model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">test_loader</span><span class="p">,</span> <span class="n">criterion</span><span class="p">,</span> <span class="n">device</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Evaluate the model on the test dataset and return the outputs, targets, and average loss.</span>

<span class="sd">    Args:</span>
<span class="sd">        model (torch.nn.Module): The trained model to be evaluated.</span>
<span class="sd">        test_loader (torch.utils.data.DataLoader): DataLoader for the test dataset.</span>
<span class="sd">        criterion (torch.nn.Module): Loss function to be used for evaluation.</span>
<span class="sd">        device (torch.device): Device to run the model on (CPU or GPU).</span>

<span class="sd">    Returns:</span>
<span class="sd">        test_outputs (numpy.ndarray): Outputs from the model on the test dataset.</span>
<span class="sd">        test_targets (numpy.ndarray): Targets corresponding to the test outputs.</span>
<span class="sd">        avg_test_loss (float): Average loss on the test dataset.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>  <span class="c1"># Set the model to evaluation mode</span>
    <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>  <span class="c1"># Disable gradient calculation for inference</span>

        <span class="n">test_outputs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">test_targets</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">test_loss</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="k">for</span> <span class="n">images</span><span class="p">,</span> <span class="n">targets</span> <span class="ow">in</span> <span class="n">test_loader</span><span class="p">:</span>
            <span class="n">images</span> <span class="o">=</span> <span class="n">images</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
            <span class="n">targets</span> <span class="o">=</span> <span class="n">targets</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>

            <span class="n">outputs</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">images</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">loss</span> <span class="o">=</span> <span class="n">criterion</span><span class="p">(</span><span class="n">outputs</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span>
            <span class="n">test_loss</span> <span class="o">+=</span> <span class="n">loss</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>

            <span class="c1"># Append outputs to the list</span>
            <span class="n">test_outputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">outputs</span><span class="p">)</span>
            <span class="n">test_targets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">targets</span><span class="p">)</span>

        <span class="n">avg_test_loss</span> <span class="o">=</span> <span class="n">test_loss</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">test_loader</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;EVAL : Test Loss: </span><span class="si">{</span><span class="n">avg_test_loss</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">test_outputs</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">test_outputs</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">test_outputs</span> <span class="o">=</span> <span class="n">test_outputs</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span>
        <span class="n">test_outputs</span> <span class="o">=</span> <span class="n">test_outputs</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>

        <span class="n">test_targets</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">test_targets</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">test_targets</span> <span class="o">=</span> <span class="n">test_targets</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span>
        <span class="n">test_targets</span> <span class="o">=</span> <span class="n">test_targets</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">test_outputs</span><span class="p">,</span> <span class="n">test_targets</span><span class="p">,</span> <span class="n">avg_test_loss</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.func_inference.train_model" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">train_model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">train_loader</span><span class="p">,</span> <span class="n">val_loader</span><span class="p">,</span> <span class="n">num_epochs</span><span class="p">,</span> <span class="n">lr</span><span class="p">,</span> <span class="n">weight_decay</span><span class="p">,</span> <span class="n">criterion</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="n">optimizer_choice</span><span class="p">,</span> <span class="n">patience_epochs</span><span class="p">,</span> <span class="n">patience_loss</span><span class="p">,</span> <span class="n">path_folder</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Train the model with the given parameters dictionary and save the best validation outputs, labels, and model.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>model</code>
            </td>
            <td>
                  <code><span title="torch.nn.Module">Module</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The model to be trained.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>train_loader</code>
            </td>
            <td>
                  <code><span title="torch.utils.data.DataLoader">DataLoader</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataLoader for the training dataset.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>val_loader</code>
            </td>
            <td>
                  <code><span title="torch.utils.data.DataLoader">DataLoader</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataLoader for the validation dataset.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>num_epochs</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of epochs to train the model.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lr</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Learning rate for the optimizer.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>weight_decay</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Weight decay for the optimizer.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>criterion</code>
            </td>
            <td>
                  <code><span title="torch.nn.Module">Module</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Loss function to be used.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>device</code>
            </td>
            <td>
                  <code><span title="torch.device">device</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Device to run the model on (CPU or GPU).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>optimizer_choice</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Choice of optimizer ('Adam', 'SGD', 'RMSprop').</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>patience_epochs</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of epochs to wait before stopping if no improvement in validation loss.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>patience_loss</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Minimum change in validation loss to consider as an improvement.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>path_folder</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to save the model checkpoints.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>best_val_outputs</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Best validation outputs from the model.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>best_val_labels</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Best validation labels corresponding to the outputs.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>best_model</code></td>            <td>
                  <code><span title="torch.nn.Module">Module</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The best model based on validation loss.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>train_losses</code></td>            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of training losses for each epoch.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>val_losses</code></td>            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of validation losses for each epoch.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\impl.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">train_model</span><span class="p">(</span>
    <span class="n">model</span><span class="p">,</span>
    <span class="n">train_loader</span><span class="p">,</span>
    <span class="n">val_loader</span><span class="p">,</span>
    <span class="n">num_epochs</span><span class="p">,</span>
    <span class="n">lr</span><span class="p">,</span>
    <span class="n">weight_decay</span><span class="p">,</span>
    <span class="n">criterion</span><span class="p">,</span>
    <span class="n">device</span><span class="p">,</span>
    <span class="n">optimizer_choice</span><span class="p">,</span>
    <span class="n">patience_epochs</span><span class="p">,</span>
    <span class="n">patience_loss</span><span class="p">,</span>
    <span class="n">path_folder</span><span class="p">,</span>
<span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Train the model with the given parameters dictionary and save the best validation outputs, labels, and model.</span>

<span class="sd">    Args:</span>
<span class="sd">        model (torch.nn.Module): The model to be trained.</span>
<span class="sd">        train_loader (torch.utils.data.DataLoader): DataLoader for the training dataset.</span>
<span class="sd">        val_loader (torch.utils.data.DataLoader): DataLoader for the validation dataset.</span>
<span class="sd">        num_epochs (int): Number of epochs to train the model.</span>
<span class="sd">        lr (float): Learning rate for the optimizer.</span>
<span class="sd">        weight_decay (float): Weight decay for the optimizer.</span>
<span class="sd">        criterion (torch.nn.Module): Loss function to be used.</span>
<span class="sd">        device (torch.device): Device to run the model on (CPU or GPU).</span>
<span class="sd">        optimizer_choice (str): Choice of optimizer (&#39;Adam&#39;, &#39;SGD&#39;, &#39;RMSprop&#39;).</span>
<span class="sd">        patience_epochs (int): Number of epochs to wait before stopping if no improvement in validation loss.</span>
<span class="sd">        patience_loss (float): Minimum change in validation loss to consider as an improvement.</span>
<span class="sd">        path_folder (str): Path to save the model checkpoints.</span>

<span class="sd">    Returns:</span>
<span class="sd">        best_val_outputs (numpy.ndarray): Best validation outputs from the model.</span>
<span class="sd">        best_val_labels (numpy.ndarray): Best validation labels corresponding to the outputs.</span>
<span class="sd">        best_model (torch.nn.Module): The best model based on validation loss.</span>
<span class="sd">        train_losses (list): List of training losses for each epoch.</span>
<span class="sd">        val_losses (list): List of validation losses for each epoch.</span>
<span class="sd">    &quot;&quot;&quot;</span>


    <span class="k">if</span> <span class="n">optimizer_choice</span> <span class="o">==</span> <span class="s2">&quot;Adam&quot;</span><span class="p">:</span>
        <span class="n">optimizer</span> <span class="o">=</span> <span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="n">lr</span><span class="p">,</span> <span class="n">weight_decay</span><span class="o">=</span><span class="n">weight_decay</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">optimizer_choice</span> <span class="o">==</span> <span class="s2">&quot;SGD&quot;</span><span class="p">:</span>
        <span class="n">optimizer</span> <span class="o">=</span> <span class="n">optim</span><span class="o">.</span><span class="n">SGD</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="n">lr</span><span class="p">,</span> <span class="n">weight_decay</span><span class="o">=</span><span class="n">weight_decay</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">optimizer_choice</span> <span class="o">==</span> <span class="s2">&quot;RMSprop&quot;</span><span class="p">:</span>
        <span class="n">optimizer</span> <span class="o">=</span> <span class="n">optim</span><span class="o">.</span><span class="n">RMSprop</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="n">lr</span><span class="p">,</span> <span class="n">weight_decay</span><span class="o">=</span><span class="n">weight_decay</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid optimizer choice. Please choose &#39;Adam&#39; or &#39;SGD&#39;.&quot;</span><span class="p">)</span>

    <span class="n">scheduler</span> <span class="o">=</span> <span class="n">lr_scheduler</span><span class="o">.</span><span class="n">StepLR</span><span class="p">(</span><span class="n">optimizer</span><span class="p">,</span> <span class="n">step_size</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>

    <span class="c1"># Initialize lists to store loss values and validation predictions</span>
    <span class="n">train_losses</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">val_losses</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">best_val_loss</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)</span>
    <span class="n">best_val_outputs</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">best_val_labels</span> <span class="o">=</span> <span class="kc">None</span>


    <span class="n">pbar</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">num_epochs</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;TRAIN : Training Progress&quot;</span><span class="p">)</span>    
    <span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="n">pbar</span><span class="p">:</span>
        <span class="c1"># Training Phase</span>
        <span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
        <span class="n">running_loss</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="k">for</span> <span class="n">images</span><span class="p">,</span> <span class="n">targets</span> <span class="ow">in</span> <span class="n">train_loader</span><span class="p">:</span>

            <span class="c1"># Move data to GPU</span>
            <span class="n">images</span> <span class="o">=</span> <span class="n">images</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
            <span class="n">targets</span> <span class="o">=</span> <span class="n">targets</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>            

            <span class="c1"># Forward pass</span>
            <span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
            <span class="n">outputs</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">images</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">loss</span> <span class="o">=</span> <span class="n">criterion</span><span class="p">(</span><span class="n">outputs</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span>  <span class="c1"># Ensure target shape matches output</span>
            <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
            <span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
            <span class="n">running_loss</span> <span class="o">+=</span> <span class="n">loss</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>

        <span class="c1"># Calculate average training loss for the epoch</span>
        <span class="n">avg_train_loss</span> <span class="o">=</span> <span class="n">running_loss</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">train_loader</span><span class="p">)</span>
        <span class="n">train_losses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">avg_train_loss</span><span class="p">)</span>
        <span class="c1">#print(f&quot;Epoch {epoch+1}, Training Loss: {avg_train_loss}&quot;)</span>
        <span class="n">pbar</span><span class="o">.</span><span class="n">set_postfix</span><span class="p">({</span><span class="s2">&quot;Train Loss&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">avg_train_loss</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">})</span>

        <span class="c1"># Validation Phase</span>
        <span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
        <span class="n">val_loss</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">val_outputs</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Temporary list to store outputs for this epoch</span>
        <span class="n">val_labels</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Temporary list to store labels for this epoch</span>
        <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">images</span><span class="p">,</span> <span class="n">targets</span> <span class="ow">in</span> <span class="n">val_loader</span><span class="p">:</span>
                <span class="c1"># Move data to GPU</span>
                <span class="n">images</span> <span class="o">=</span> <span class="n">images</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
                <span class="n">targets</span> <span class="o">=</span> <span class="n">targets</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>

                <span class="c1"># Get model output</span>
                <span class="n">outputs</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">images</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

                <span class="c1"># Calculate loss</span>
                <span class="n">loss</span> <span class="o">=</span> <span class="n">criterion</span><span class="p">(</span><span class="n">outputs</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span>  <span class="c1"># Ensure target shape matches output</span>
                <span class="n">val_loss</span> <span class="o">+=</span> <span class="n">loss</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>

                <span class="c1"># Append outputs and targets to lists</span>
                <span class="n">val_outputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">outputs</span><span class="o">.</span><span class="n">cpu</span><span class="p">())</span>  <span class="c1"># Move to CPU for concatenation</span>
                <span class="n">val_labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">targets</span><span class="o">.</span><span class="n">cpu</span><span class="p">())</span>

        <span class="c1"># Concatenate outputs and labels across all batches to ensure all samples are included</span>
        <span class="n">val_outputs</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">val_outputs</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
        <span class="n">val_labels</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">val_labels</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>

        <span class="c1"># Calculate average validation loss for the epoch</span>
        <span class="n">avg_val_loss</span> <span class="o">=</span> <span class="n">val_loss</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">val_loader</span><span class="p">)</span>
        <span class="n">val_losses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">avg_val_loss</span><span class="p">)</span>
        <span class="c1">#print(f&quot;Epoch {epoch+1}, Validation Loss: {avg_val_loss}&quot;)</span>
        <span class="n">pbar</span><span class="o">.</span><span class="n">set_postfix</span><span class="p">({</span><span class="s2">&quot;Train Loss&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">avg_train_loss</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;Val Loss&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">avg_val_loss</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">})</span>

        <span class="c1"># Check if this is the best validation loss so far and store best outputs/labels</span>
        <span class="k">if</span> <span class="n">avg_val_loss</span> <span class="o">&lt;</span> <span class="n">best_val_loss</span><span class="p">:</span>
            <span class="n">best_val_loss</span> <span class="o">=</span> <span class="n">avg_val_loss</span>
            <span class="n">best_val_outputs</span> <span class="o">=</span> <span class="n">val_outputs</span>
            <span class="n">best_val_labels</span> <span class="o">=</span> <span class="n">val_labels</span>

            <span class="n">best_model</span> <span class="o">=</span> <span class="n">model</span>
            <span class="n">best_model_state</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">state_dict</span><span class="p">()</span>
            <span class="n">torch</span><span class="o">.</span><span class="n">save</span><span class="p">(</span>
                <span class="n">best_model_state</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_folder</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;./epoch_</span><span class="si">{</span><span class="n">epoch</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">.pth&quot;</span><span class="p">)</span>
            <span class="p">)</span>


        <span class="n">manage_saved_models</span><span class="p">(</span><span class="n">path_folder</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">early_stopping</span><span class="p">(</span><span class="n">val_losses</span><span class="p">,</span> <span class="n">patience_epochs</span><span class="p">,</span> <span class="n">patience_loss</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="n">best_val_outputs</span><span class="p">,</span>
                <span class="n">best_val_labels</span><span class="p">,</span>
                <span class="n">best_model</span><span class="p">,</span>
                <span class="n">train_losses</span><span class="p">,</span>
                <span class="n">val_losses</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="n">scheduler</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>



    <span class="k">return</span> <span class="n">best_val_outputs</span><span class="p">,</span> <span class="n">best_val_labels</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">train_losses</span><span class="p">,</span> <span class="n">val_losses</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.func_inference.vectorized_solar_angles" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">vectorized_solar_angles</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">time_utc</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>This function calculates the solar zenith angle (SZA) and solar azimuth angle (SAA) for a given latitude, longitude, and time. This is an archived function. Current implementation does not use solar angles but only image input.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>lat</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The latitude values of the scatterometer data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lon</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The longitude values of the scatterometer data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>time_utc</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The observation times in UTC.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>sza</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The solar zenith angle in degrees.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>saa</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The solar azimuth angle in degrees.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\func_ml.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">vectorized_solar_angles</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">time_utc</span><span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function calculates the solar zenith angle (SZA) and solar azimuth angle (SAA) for a given latitude, longitude, and time. This is an archived function. Current implementation does not use solar angles but only image input.</span>

<span class="sd">    Args:</span>
<span class="sd">        lat (numpy.ndarray): The latitude values of the scatterometer data.</span>
<span class="sd">        lon (numpy.ndarray): The longitude values of the scatterometer data.</span>
<span class="sd">        time_utc (numpy.ndarray): The observation times in UTC.</span>

<span class="sd">    Returns:</span>
<span class="sd">        sza (numpy.ndarray): The solar zenith angle in degrees.</span>
<span class="sd">        saa (numpy.ndarray): The solar azimuth angle in degrees.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Convert time to Julian Day</span>
    <span class="n">timestamp</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">time_utc</span><span class="p">)</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">jd</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">timestamp</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;datetime64[ns]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span> <span class="o">/</span> <span class="mi">86400000000000</span> <span class="o">+</span> <span class="mf">2440587.5</span>
    <span class="p">)</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">jd</span> <span class="o">-</span> <span class="mf">2451545.0</span>  <span class="c1"># Days since J2000</span>

    <span class="c1"># Mean longitude, mean anomaly, ecliptic longitude</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">((</span><span class="mf">357.529</span> <span class="o">+</span> <span class="mf">0.98560028</span> <span class="o">*</span> <span class="n">d</span><span class="p">)</span> <span class="o">%</span> <span class="mi">360</span><span class="p">)</span>  <span class="c1"># Mean anomaly</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">((</span><span class="mf">280.459</span> <span class="o">+</span> <span class="mf">0.98564736</span> <span class="o">*</span> <span class="n">d</span><span class="p">)</span> <span class="o">%</span> <span class="mi">360</span><span class="p">)</span>  <span class="c1"># Mean longitude</span>
    <span class="n">L</span> <span class="o">=</span> <span class="p">(</span><span class="n">q</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="mf">1.915</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">g</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="mf">0.020</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">g</span><span class="p">))</span> <span class="o">%</span> <span class="p">(</span>
        <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
    <span class="p">)</span>  <span class="c1"># Ecliptic long</span>

    <span class="c1"># Obliquity of the ecliptic</span>
    <span class="n">e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="mf">23.439</span> <span class="o">-</span> <span class="mf">0.00000036</span> <span class="o">*</span> <span class="n">d</span><span class="p">)</span>

    <span class="c1"># Sun declination</span>
    <span class="n">sin_delta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">L</span><span class="p">)</span>
    <span class="n">delta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="n">sin_delta</span><span class="p">)</span>

    <span class="c1"># Equation of time (in minutes)</span>
    <span class="n">E</span> <span class="o">=</span> <span class="mf">229.18</span> <span class="o">*</span> <span class="p">(</span>
        <span class="mf">0.000075</span>
        <span class="o">+</span> <span class="mf">0.001868</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
        <span class="o">-</span> <span class="mf">0.032077</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
        <span class="o">-</span> <span class="mf">0.014615</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">g</span><span class="p">)</span>
        <span class="o">-</span> <span class="mf">0.040849</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">g</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="c1"># Convert time to fractional hours (UTC)</span>
    <span class="n">fractional_hour</span> <span class="o">=</span> <span class="n">timestamp</span><span class="o">.</span><span class="n">hour</span> <span class="o">+</span> <span class="n">timestamp</span><span class="o">.</span><span class="n">minute</span> <span class="o">/</span> <span class="mi">60</span> <span class="o">+</span> <span class="n">timestamp</span><span class="o">.</span><span class="n">second</span> <span class="o">/</span> <span class="mi">3600</span>

    <span class="c1"># Solar time correction</span>
    <span class="n">time_offset</span> <span class="o">=</span> <span class="n">E</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">lon</span>  <span class="c1"># lon in degrees</span>
    <span class="n">tst</span> <span class="o">=</span> <span class="n">fractional_hour</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">+</span> <span class="n">time_offset</span>  <span class="c1"># True Solar Time in minutes</span>
    <span class="n">ha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">((</span><span class="n">tst</span> <span class="o">/</span> <span class="mi">4</span> <span class="o">-</span> <span class="mi">180</span><span class="p">)</span> <span class="o">%</span> <span class="mi">360</span><span class="p">)</span>  <span class="c1"># Hour angle in radians</span>

    <span class="c1"># Convert lat/lon to radians</span>
    <span class="n">lat_rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span>

    <span class="c1"># Solar zenith angle</span>
    <span class="n">cos_zenith</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">lat_rad</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">delta</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">lat_rad</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span>
        <span class="n">delta</span>
    <span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ha</span><span class="p">)</span>
    <span class="n">zenith</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">cos_zenith</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>  <span class="c1"># in degrees</span>

    <span class="c1"># Solar saa angle</span>
    <span class="n">sin_saa</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ha</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">delta</span><span class="p">)</span>
    <span class="n">cos_saa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">lat_rad</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">delta</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">lat_rad</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span>
        <span class="n">delta</span>
    <span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ha</span><span class="p">)</span>
    <span class="n">saa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">sin_saa</span><span class="p">,</span> <span class="n">cos_saa</span><span class="p">))</span>
    <span class="n">saa</span> <span class="o">=</span> <span class="p">(</span><span class="n">saa</span> <span class="o">+</span> <span class="mi">360</span><span class="p">)</span> <span class="o">%</span> <span class="mi">360</span>  <span class="c1"># Normalize</span>

    <span class="k">return</span> <span class="n">zenith</span><span class="p">,</span> <span class="n">saa</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="windscangeo.impl"></a>
    <div class="doc doc-contents first">









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="windscangeo.impl.early_stopping" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">early_stopping</span><span class="p">(</span><span class="n">valid_losses</span><span class="p">,</span> <span class="n">patience_epochs</span><span class="p">,</span> <span class="n">patience_loss</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Early stopping function to determine if training should stop based on validation losses. From @ Jing Sun</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>valid_losses</code>
            </td>
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of validation losses recorded during training.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>patience_epochs</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of epochs to wait before stopping if no improvement.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>patience_loss</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Minimum change in validation loss to consider as an improvement.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bool</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if training should stop, False otherwise.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\impl.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">early_stopping</span><span class="p">(</span><span class="n">valid_losses</span><span class="p">,</span> <span class="n">patience_epochs</span><span class="p">,</span> <span class="n">patience_loss</span><span class="p">):</span>  <span class="c1"># From @Jing</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Early stopping function to determine if training should stop based on validation losses. From @ Jing Sun</span>

<span class="sd">    Args:</span>
<span class="sd">        valid_losses (list): List of validation losses recorded during training.</span>
<span class="sd">        patience_epochs (int): Number of epochs to wait before stopping if no improvement.</span>
<span class="sd">        patience_loss (float): Minimum change in validation loss to consider as an improvement.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if training should stop, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">valid_losses</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">patience_epochs</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="n">recent_losses</span> <span class="o">=</span> <span class="n">valid_losses</span><span class="p">[</span><span class="o">-</span><span class="n">patience_epochs</span><span class="p">:]</span>

    <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="n">recent_losses</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">recent_losses</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">if</span> <span class="nb">max</span><span class="p">(</span><span class="n">recent_losses</span><span class="p">)</span> <span class="o">-</span> <span class="nb">min</span><span class="p">(</span><span class="n">recent_losses</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">patience_loss</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.impl.inference_model" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">inference_model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">inference_loader</span><span class="p">,</span> <span class="n">device</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Perform inference on the model using the provided DataLoader and return the outputs. Same as train_model but for a fixed given model.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>model</code>
            </td>
            <td>
                  <code><span title="torch.nn.Module">Module</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The trained model to be used for inference.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>inference_loader</code>
            </td>
            <td>
                  <code><span title="torch.utils.data.DataLoader">DataLoader</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataLoader for the inference dataset.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>device</code>
            </td>
            <td>
                  <code><span title="torch.device">device</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Device to run the model on (CPU or GPU).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>inference_outputs</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Outputs from the model on the inference dataset.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\impl.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">inference_model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">inference_loader</span><span class="p">,</span> <span class="n">device</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Perform inference on the model using the provided DataLoader and return the outputs. Same as train_model but for a fixed given model.</span>

<span class="sd">    Args:</span>
<span class="sd">        model (torch.nn.Module): The trained model to be used for inference.</span>
<span class="sd">        inference_loader (torch.utils.data.DataLoader): DataLoader for the inference dataset.</span>
<span class="sd">        device (torch.device): Device to run the model on (CPU or GPU).</span>

<span class="sd">    Returns:</span>
<span class="sd">        inference_outputs (numpy.ndarray): Outputs from the model on the inference dataset.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>  <span class="c1"># Disable gradient calculation for inference</span>

        <span class="n">inference_outputs</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">images</span> <span class="ow">in</span> <span class="n">inference_loader</span><span class="p">:</span>
            <span class="n">images</span> <span class="o">=</span> <span class="n">images</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>

            <span class="n">outputs</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">images</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

            <span class="c1"># Append outputs to the list</span>
            <span class="n">inference_outputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">outputs</span><span class="p">)</span>

        <span class="n">inference_outputs</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">inference_outputs</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">inference_outputs</span> <span class="o">=</span> <span class="n">inference_outputs</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span>
        <span class="n">inference_outputs</span> <span class="o">=</span> <span class="n">inference_outputs</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">inference_outputs</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.impl.manage_saved_models" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">manage_saved_models</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Manage saved model files in the specified directory by deleting older epoch files.
Keeps only the latest epoch file and deletes all others. From @ Jing Sun</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>directory</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The directory where model files are saved.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\impl.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">manage_saved_models</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>  <span class="c1"># From @Jing</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Manage saved model files in the specified directory by deleting older epoch files.</span>
<span class="sd">    Keeps only the latest epoch file and deletes all others. From @ Jing Sun</span>

<span class="sd">    Args:</span>
<span class="sd">        directory (str): The directory where model files are saved.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;epoch_(\d+)\.pth&quot;</span><span class="p">)</span>
    <span class="n">epoch_files</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                <span class="n">epoch_num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
                <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
                <span class="n">epoch_files</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">file_path</span><span class="p">,</span> <span class="n">epoch_num</span><span class="p">))</span>

    <span class="c1"># Check if there are more than 5 files</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">epoch_files</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">epoch_files</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">files_to_delete</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">epoch_files</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">files_to_delete</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">epoch_files</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.impl.test_model" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">test_model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">test_loader</span><span class="p">,</span> <span class="n">criterion</span><span class="p">,</span> <span class="n">device</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Evaluate the model on the test dataset and return the outputs, targets, and average loss.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>model</code>
            </td>
            <td>
                  <code><span title="torch.nn.Module">Module</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The trained model to be evaluated.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>test_loader</code>
            </td>
            <td>
                  <code><span title="torch.utils.data.DataLoader">DataLoader</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataLoader for the test dataset.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>criterion</code>
            </td>
            <td>
                  <code><span title="torch.nn.Module">Module</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Loss function to be used for evaluation.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>device</code>
            </td>
            <td>
                  <code><span title="torch.device">device</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Device to run the model on (CPU or GPU).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>test_outputs</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Outputs from the model on the test dataset.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>test_targets</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Targets corresponding to the test outputs.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>avg_test_loss</code></td>            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Average loss on the test dataset.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\impl.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">test_model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">test_loader</span><span class="p">,</span> <span class="n">criterion</span><span class="p">,</span> <span class="n">device</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Evaluate the model on the test dataset and return the outputs, targets, and average loss.</span>

<span class="sd">    Args:</span>
<span class="sd">        model (torch.nn.Module): The trained model to be evaluated.</span>
<span class="sd">        test_loader (torch.utils.data.DataLoader): DataLoader for the test dataset.</span>
<span class="sd">        criterion (torch.nn.Module): Loss function to be used for evaluation.</span>
<span class="sd">        device (torch.device): Device to run the model on (CPU or GPU).</span>

<span class="sd">    Returns:</span>
<span class="sd">        test_outputs (numpy.ndarray): Outputs from the model on the test dataset.</span>
<span class="sd">        test_targets (numpy.ndarray): Targets corresponding to the test outputs.</span>
<span class="sd">        avg_test_loss (float): Average loss on the test dataset.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>  <span class="c1"># Set the model to evaluation mode</span>
    <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>  <span class="c1"># Disable gradient calculation for inference</span>

        <span class="n">test_outputs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">test_targets</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">test_loss</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="k">for</span> <span class="n">images</span><span class="p">,</span> <span class="n">targets</span> <span class="ow">in</span> <span class="n">test_loader</span><span class="p">:</span>
            <span class="n">images</span> <span class="o">=</span> <span class="n">images</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
            <span class="n">targets</span> <span class="o">=</span> <span class="n">targets</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>

            <span class="n">outputs</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">images</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">loss</span> <span class="o">=</span> <span class="n">criterion</span><span class="p">(</span><span class="n">outputs</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span>
            <span class="n">test_loss</span> <span class="o">+=</span> <span class="n">loss</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>

            <span class="c1"># Append outputs to the list</span>
            <span class="n">test_outputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">outputs</span><span class="p">)</span>
            <span class="n">test_targets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">targets</span><span class="p">)</span>

        <span class="n">avg_test_loss</span> <span class="o">=</span> <span class="n">test_loss</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">test_loader</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;EVAL : Test Loss: </span><span class="si">{</span><span class="n">avg_test_loss</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">test_outputs</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">test_outputs</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">test_outputs</span> <span class="o">=</span> <span class="n">test_outputs</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span>
        <span class="n">test_outputs</span> <span class="o">=</span> <span class="n">test_outputs</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>

        <span class="n">test_targets</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">test_targets</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">test_targets</span> <span class="o">=</span> <span class="n">test_targets</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span>
        <span class="n">test_targets</span> <span class="o">=</span> <span class="n">test_targets</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">test_outputs</span><span class="p">,</span> <span class="n">test_targets</span><span class="p">,</span> <span class="n">avg_test_loss</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="windscangeo.impl.train_model" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">train_model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">train_loader</span><span class="p">,</span> <span class="n">val_loader</span><span class="p">,</span> <span class="n">num_epochs</span><span class="p">,</span> <span class="n">lr</span><span class="p">,</span> <span class="n">weight_decay</span><span class="p">,</span> <span class="n">criterion</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="n">optimizer_choice</span><span class="p">,</span> <span class="n">patience_epochs</span><span class="p">,</span> <span class="n">patience_loss</span><span class="p">,</span> <span class="n">path_folder</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Train the model with the given parameters dictionary and save the best validation outputs, labels, and model.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>model</code>
            </td>
            <td>
                  <code><span title="torch.nn.Module">Module</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The model to be trained.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>train_loader</code>
            </td>
            <td>
                  <code><span title="torch.utils.data.DataLoader">DataLoader</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataLoader for the training dataset.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>val_loader</code>
            </td>
            <td>
                  <code><span title="torch.utils.data.DataLoader">DataLoader</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataLoader for the validation dataset.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>num_epochs</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of epochs to train the model.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lr</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Learning rate for the optimizer.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>weight_decay</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Weight decay for the optimizer.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>criterion</code>
            </td>
            <td>
                  <code><span title="torch.nn.Module">Module</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Loss function to be used.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>device</code>
            </td>
            <td>
                  <code><span title="torch.device">device</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Device to run the model on (CPU or GPU).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>optimizer_choice</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Choice of optimizer ('Adam', 'SGD', 'RMSprop').</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>patience_epochs</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of epochs to wait before stopping if no improvement in validation loss.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>patience_loss</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Minimum change in validation loss to consider as an improvement.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>path_folder</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to save the model checkpoints.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>best_val_outputs</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Best validation outputs from the model.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>best_val_labels</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Best validation labels corresponding to the outputs.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>best_model</code></td>            <td>
                  <code><span title="torch.nn.Module">Module</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The best model based on validation loss.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>train_losses</code></td>            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of training losses for each epoch.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>val_losses</code></td>            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of validation losses for each epoch.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>windscangeo\impl.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">train_model</span><span class="p">(</span>
    <span class="n">model</span><span class="p">,</span>
    <span class="n">train_loader</span><span class="p">,</span>
    <span class="n">val_loader</span><span class="p">,</span>
    <span class="n">num_epochs</span><span class="p">,</span>
    <span class="n">lr</span><span class="p">,</span>
    <span class="n">weight_decay</span><span class="p">,</span>
    <span class="n">criterion</span><span class="p">,</span>
    <span class="n">device</span><span class="p">,</span>
    <span class="n">optimizer_choice</span><span class="p">,</span>
    <span class="n">patience_epochs</span><span class="p">,</span>
    <span class="n">patience_loss</span><span class="p">,</span>
    <span class="n">path_folder</span><span class="p">,</span>
<span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Train the model with the given parameters dictionary and save the best validation outputs, labels, and model.</span>

<span class="sd">    Args:</span>
<span class="sd">        model (torch.nn.Module): The model to be trained.</span>
<span class="sd">        train_loader (torch.utils.data.DataLoader): DataLoader for the training dataset.</span>
<span class="sd">        val_loader (torch.utils.data.DataLoader): DataLoader for the validation dataset.</span>
<span class="sd">        num_epochs (int): Number of epochs to train the model.</span>
<span class="sd">        lr (float): Learning rate for the optimizer.</span>
<span class="sd">        weight_decay (float): Weight decay for the optimizer.</span>
<span class="sd">        criterion (torch.nn.Module): Loss function to be used.</span>
<span class="sd">        device (torch.device): Device to run the model on (CPU or GPU).</span>
<span class="sd">        optimizer_choice (str): Choice of optimizer (&#39;Adam&#39;, &#39;SGD&#39;, &#39;RMSprop&#39;).</span>
<span class="sd">        patience_epochs (int): Number of epochs to wait before stopping if no improvement in validation loss.</span>
<span class="sd">        patience_loss (float): Minimum change in validation loss to consider as an improvement.</span>
<span class="sd">        path_folder (str): Path to save the model checkpoints.</span>

<span class="sd">    Returns:</span>
<span class="sd">        best_val_outputs (numpy.ndarray): Best validation outputs from the model.</span>
<span class="sd">        best_val_labels (numpy.ndarray): Best validation labels corresponding to the outputs.</span>
<span class="sd">        best_model (torch.nn.Module): The best model based on validation loss.</span>
<span class="sd">        train_losses (list): List of training losses for each epoch.</span>
<span class="sd">        val_losses (list): List of validation losses for each epoch.</span>
<span class="sd">    &quot;&quot;&quot;</span>


    <span class="k">if</span> <span class="n">optimizer_choice</span> <span class="o">==</span> <span class="s2">&quot;Adam&quot;</span><span class="p">:</span>
        <span class="n">optimizer</span> <span class="o">=</span> <span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="n">lr</span><span class="p">,</span> <span class="n">weight_decay</span><span class="o">=</span><span class="n">weight_decay</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">optimizer_choice</span> <span class="o">==</span> <span class="s2">&quot;SGD&quot;</span><span class="p">:</span>
        <span class="n">optimizer</span> <span class="o">=</span> <span class="n">optim</span><span class="o">.</span><span class="n">SGD</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="n">lr</span><span class="p">,</span> <span class="n">weight_decay</span><span class="o">=</span><span class="n">weight_decay</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">optimizer_choice</span> <span class="o">==</span> <span class="s2">&quot;RMSprop&quot;</span><span class="p">:</span>
        <span class="n">optimizer</span> <span class="o">=</span> <span class="n">optim</span><span class="o">.</span><span class="n">RMSprop</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="n">lr</span><span class="p">,</span> <span class="n">weight_decay</span><span class="o">=</span><span class="n">weight_decay</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid optimizer choice. Please choose &#39;Adam&#39; or &#39;SGD&#39;.&quot;</span><span class="p">)</span>

    <span class="n">scheduler</span> <span class="o">=</span> <span class="n">lr_scheduler</span><span class="o">.</span><span class="n">StepLR</span><span class="p">(</span><span class="n">optimizer</span><span class="p">,</span> <span class="n">step_size</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>

    <span class="c1"># Initialize lists to store loss values and validation predictions</span>
    <span class="n">train_losses</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">val_losses</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">best_val_loss</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)</span>
    <span class="n">best_val_outputs</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">best_val_labels</span> <span class="o">=</span> <span class="kc">None</span>


    <span class="n">pbar</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">num_epochs</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;TRAIN : Training Progress&quot;</span><span class="p">)</span>    
    <span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="n">pbar</span><span class="p">:</span>
        <span class="c1"># Training Phase</span>
        <span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
        <span class="n">running_loss</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="k">for</span> <span class="n">images</span><span class="p">,</span> <span class="n">targets</span> <span class="ow">in</span> <span class="n">train_loader</span><span class="p">:</span>

            <span class="c1"># Move data to GPU</span>
            <span class="n">images</span> <span class="o">=</span> <span class="n">images</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
            <span class="n">targets</span> <span class="o">=</span> <span class="n">targets</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>            

            <span class="c1"># Forward pass</span>
            <span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
            <span class="n">outputs</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">images</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">loss</span> <span class="o">=</span> <span class="n">criterion</span><span class="p">(</span><span class="n">outputs</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span>  <span class="c1"># Ensure target shape matches output</span>
            <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
            <span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
            <span class="n">running_loss</span> <span class="o">+=</span> <span class="n">loss</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>

        <span class="c1"># Calculate average training loss for the epoch</span>
        <span class="n">avg_train_loss</span> <span class="o">=</span> <span class="n">running_loss</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">train_loader</span><span class="p">)</span>
        <span class="n">train_losses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">avg_train_loss</span><span class="p">)</span>
        <span class="c1">#print(f&quot;Epoch {epoch+1}, Training Loss: {avg_train_loss}&quot;)</span>
        <span class="n">pbar</span><span class="o">.</span><span class="n">set_postfix</span><span class="p">({</span><span class="s2">&quot;Train Loss&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">avg_train_loss</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">})</span>

        <span class="c1"># Validation Phase</span>
        <span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
        <span class="n">val_loss</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">val_outputs</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Temporary list to store outputs for this epoch</span>
        <span class="n">val_labels</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Temporary list to store labels for this epoch</span>
        <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">images</span><span class="p">,</span> <span class="n">targets</span> <span class="ow">in</span> <span class="n">val_loader</span><span class="p">:</span>
                <span class="c1"># Move data to GPU</span>
                <span class="n">images</span> <span class="o">=</span> <span class="n">images</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
                <span class="n">targets</span> <span class="o">=</span> <span class="n">targets</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>

                <span class="c1"># Get model output</span>
                <span class="n">outputs</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">images</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

                <span class="c1"># Calculate loss</span>
                <span class="n">loss</span> <span class="o">=</span> <span class="n">criterion</span><span class="p">(</span><span class="n">outputs</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span>  <span class="c1"># Ensure target shape matches output</span>
                <span class="n">val_loss</span> <span class="o">+=</span> <span class="n">loss</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>

                <span class="c1"># Append outputs and targets to lists</span>
                <span class="n">val_outputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">outputs</span><span class="o">.</span><span class="n">cpu</span><span class="p">())</span>  <span class="c1"># Move to CPU for concatenation</span>
                <span class="n">val_labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">targets</span><span class="o">.</span><span class="n">cpu</span><span class="p">())</span>

        <span class="c1"># Concatenate outputs and labels across all batches to ensure all samples are included</span>
        <span class="n">val_outputs</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">val_outputs</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
        <span class="n">val_labels</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">val_labels</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>

        <span class="c1"># Calculate average validation loss for the epoch</span>
        <span class="n">avg_val_loss</span> <span class="o">=</span> <span class="n">val_loss</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">val_loader</span><span class="p">)</span>
        <span class="n">val_losses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">avg_val_loss</span><span class="p">)</span>
        <span class="c1">#print(f&quot;Epoch {epoch+1}, Validation Loss: {avg_val_loss}&quot;)</span>
        <span class="n">pbar</span><span class="o">.</span><span class="n">set_postfix</span><span class="p">({</span><span class="s2">&quot;Train Loss&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">avg_train_loss</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;Val Loss&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">avg_val_loss</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">})</span>

        <span class="c1"># Check if this is the best validation loss so far and store best outputs/labels</span>
        <span class="k">if</span> <span class="n">avg_val_loss</span> <span class="o">&lt;</span> <span class="n">best_val_loss</span><span class="p">:</span>
            <span class="n">best_val_loss</span> <span class="o">=</span> <span class="n">avg_val_loss</span>
            <span class="n">best_val_outputs</span> <span class="o">=</span> <span class="n">val_outputs</span>
            <span class="n">best_val_labels</span> <span class="o">=</span> <span class="n">val_labels</span>

            <span class="n">best_model</span> <span class="o">=</span> <span class="n">model</span>
            <span class="n">best_model_state</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">state_dict</span><span class="p">()</span>
            <span class="n">torch</span><span class="o">.</span><span class="n">save</span><span class="p">(</span>
                <span class="n">best_model_state</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_folder</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;./epoch_</span><span class="si">{</span><span class="n">epoch</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">.pth&quot;</span><span class="p">)</span>
            <span class="p">)</span>


        <span class="n">manage_saved_models</span><span class="p">(</span><span class="n">path_folder</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">early_stopping</span><span class="p">(</span><span class="n">val_losses</span><span class="p">,</span> <span class="n">patience_epochs</span><span class="p">,</span> <span class="n">patience_loss</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="n">best_val_outputs</span><span class="p">,</span>
                <span class="n">best_val_labels</span><span class="p">,</span>
                <span class="n">best_model</span><span class="p">,</span>
                <span class="n">train_losses</span><span class="p">,</span>
                <span class="n">val_losses</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="n">scheduler</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>



    <span class="k">return</span> <span class="n">best_val_outputs</span><span class="p">,</span> <span class="n">best_val_labels</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">train_losses</span><span class="p">,</span> <span class="n">val_losses</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                

              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["content.code.annotation", "content.code.copy"], "search": "../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
    
  </body>
</html>